<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- The \(O((n+k)\log n)\) time line segment intersection algorithm by Bentley</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- and Ottmann.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier">intersections</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier">interiorIntersections</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html"><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.Types</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">contains</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Interval.html"><span class="hs-identifier">Data.Geometry.Interval</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.LineSegment.html"><span class="hs-identifier">Data.Geometry.LineSegment</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Point.html"><span class="hs-identifier">Data.Geometry.Point</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Geometry.Properties.html"><span class="hs-identifier">Data.Geometry.Properties</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EQ</span></span><span> </span><span class="hs-comment">-- event queue</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl.CoRec</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- | Compute all intersections</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-44"></span><span id="local-6989586621680110153"><span id="local-6989586621680110154"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-type">intersections</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110154"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110154"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110153"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110154"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110153"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110154"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-46"></span><span id="intersections"><span class="annot"><span class="annottext">intersections :: [LineSegment 2 p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var hs-var">intersections</span></a></span></span><span> </span><span id="local-6989586621680109933"><span class="annot"><span class="annottext">ss :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109933"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r] -&gt; Intersections p r
forall r p.
(Ord r, Fractional r) =&gt;
[IntersectionPoint p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">([IntersectionPoint p r] -&gt; Intersections p r)
-&gt; [IntersectionPoint p r] -&gt; Intersections p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
forall r p.
(Ord r, Fractional r) =&gt;
EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621680109930"><span class="hs-identifier hs-var">pts</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
forall a. Set a
</span><span class="hs-identifier hs-var">SS.empty</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621680109930"><span class="annot"><span class="annottext">pts :: EventQueue p r
</span><a href="#local-6989586621680109930"><span class="hs-identifier hs-var hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; EventQueue p r
forall a. Eq a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.fromAscList</span></span><span> </span><span class="annot"><span class="annottext">([Event p r] -&gt; EventQueue p r)
-&gt; ([LineSegment 2 p r] -&gt; [Event p r])
-&gt; [LineSegment 2 p r]
-&gt; EventQueue p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall r p. Eq r =&gt; [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">([Event p r] -&gt; [Event p r])
-&gt; ([LineSegment 2 p r] -&gt; [Event p r])
-&gt; [LineSegment 2 p r]
-&gt; [Event p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sort</span></span><span> </span><span class="annot"><span class="annottext">([Event p r] -&gt; [Event p r])
-&gt; ([LineSegment 2 p r] -&gt; [Event p r])
-&gt; [LineSegment 2 p r]
-&gt; [Event p r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; [Event p r])
-&gt; [LineSegment 2 p r] -&gt; [Event p r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; [Event p r]
forall r p. Ord r =&gt; LineSegment 2 p r -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var">asEventPts</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; EventQueue p r)
-&gt; [LineSegment 2 p r] -&gt; EventQueue p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109933"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | Computes all intersection points p s.t. p lies in the interior of at least</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- one of the segments.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">--  \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-54"></span><span id="local-6989586621680109921"><span id="local-6989586621680109922"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-type">interiorIntersections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680109922"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680109922"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680109921"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109922"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109921"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109922"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-56"></span><span id="interiorIntersections"><span class="annot"><span class="annottext">interiorIntersections :: [LineSegment 2 p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-var hs-var">interiorIntersections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Associated p r -&gt; Bool) -&gt; Intersections p r -&gt; Intersections p r
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filter</span></span><span> </span><span class="annot"><span class="annottext">Associated p r -&gt; Bool
forall p r. Associated p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#isInteriorIntersection"><span class="hs-identifier hs-var">isInteriorIntersection</span></a></span><span> </span><span class="annot"><span class="annottext">(Intersections p r -&gt; Intersections p r)
-&gt; ([LineSegment 2 p r] -&gt; Intersections p r)
-&gt; [LineSegment 2 p r]
-&gt; Intersections p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; Intersections p r
forall r p.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var">intersections</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Computes the event points for a given line segment</span><span>
</span><span id="line-59"></span><span id="local-6989586621680110163"><span id="local-6989586621680110164"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-type">asEventPts</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110164"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110163"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110164"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110163"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110164"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-60"></span><span id="asEventPts"><span class="annot"><span class="annottext">asEventPts :: LineSegment 2 p r -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var hs-var">asEventPts</span></a></span></span><span> </span><span id="local-6989586621680109918"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680109918"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680109917"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109917"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109916"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680109916"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Point 2 r -&gt; Ordering) -&gt; [Point 2 r] -&gt; [Point 2 r]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortBy</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109918"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109918"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const (Point 2 r) (LineSegment 2 p r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; Getting (Point 2 r) (LineSegment 2 p r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109917"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r)
forall s. NonEmpty s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r))
-&gt; NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109918"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; [LineSegment 2 p r] -&gt; NonEmpty (LineSegment 2 p r)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109916"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; EventType (LineSegment 2 p r)
forall s. s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109918"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- | Group the segments with the intersection points</span><span>
</span><span id="line-64"></span><span id="local-6989586621680110185"><span id="local-6989586621680110186"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110186"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110186"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110185"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110186"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110185"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110186"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-65"></span><span id="merge"><span class="annot"><span class="annottext">merge :: [IntersectionPoint p r] -&gt; Intersections p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IntersectionPoint p r -&gt; Intersections p r -&gt; Intersections p r)
-&gt; Intersections p r
-&gt; [IntersectionPoint p r]
-&gt; Intersections p r
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span id="local-6989586621680109903"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109903"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109902"><span class="annot"><span class="annottext">a :: Associated p r
</span><a href="#local-6989586621680109902"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Associated p r -&gt; Associated p r -&gt; Associated p r)
-&gt; Point 2 r
-&gt; Associated p r
-&gt; Intersections p r
-&gt; Intersections p r
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Associated p r -&gt; Associated p r -&gt; Associated p r
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109903"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Associated p r
</span><a href="#local-6989586621680109902"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Intersections p r
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | Group the startpoints such that segments with the same start point</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- correspond to one event.</span><span>
</span><span id="line-69"></span><span id="local-6989586621680110169"><span id="local-6989586621680110170"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-type">groupStarts</span></a></span><span>                          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680110170"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110169"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110170"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110169"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110170"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-70"></span><span id="groupStarts"><span class="annot"><span class="annottext">groupStarts :: [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var hs-var">groupStarts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-71"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680109899"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109899"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621680109898"><span class="annot"><span class="annottext">s :: NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621680109898"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680109897"><span class="annot"><span class="annottext">es :: [Event p r]
</span><a href="#local-6989586621680109897"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109899"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r) -&gt; EventType (LineSegment 2 p r)
forall s. NonEmpty s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621680109896"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [Event p r] -&gt; [Event p r]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall r p. Eq r =&gt; [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621680109895"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680109894"><span class="annot"><span class="annottext">ss' :: [Event p r]
</span><a href="#local-6989586621680109894"><span class="hs-identifier hs-var">ss'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109895"><span class="annot"><span class="annottext">rest :: [Event p r]
</span><a href="#local-6989586621680109895"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event p r -&gt; Bool) -&gt; [Event p r] -&gt; ([Event p r], [Event p r])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.span</span></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; Bool
</span><a href="#local-6989586621680109892"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621680109897"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- FIXME: this seems to keep the segments on decreasing y, increasing x. shouldn't we</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-comment">-- sort them cyclically around p instead?</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621680109896"><span class="annot"><span class="annottext">ss :: NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621680109896"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680109891"><span class="annot"><span class="annottext">x :: LineSegment 2 p r
</span><a href="#local-6989586621680109891"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span id="local-6989586621680109890"><span class="annot"><span class="annottext">xs :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109890"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621680109898"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-77"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109891"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; [LineSegment 2 p r] -&gt; NonEmpty (LineSegment 2 p r)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109890"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Event p r -&gt; [LineSegment 2 p r])
-&gt; [Event p r] -&gt; [LineSegment 2 p r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [LineSegment 2 p r]
forall p r. Event p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621680109894"><span class="hs-identifier hs-var">ss'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621680109892"><span class="annot"><span class="annottext">sameStart :: Event p r -&gt; Bool
</span><a href="#local-6989586621680109892"><span class="hs-identifier hs-var hs-var">sameStart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680109888"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680109888"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109899"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109888"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="#local-6989586621680109892"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680109887"><span class="annot"><span class="annottext">e :: Event p r
</span><a href="#local-6989586621680109887"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680109886"><span class="annot"><span class="annottext">es :: [Event p r]
</span><a href="#local-6989586621680109886"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621680109887"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [Event p r] -&gt; [Event p r]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Event p r] -&gt; [Event p r]
forall r p. Eq r =&gt; [Event p r] -&gt; [Event p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621680109886"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- * Data type for Events</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Type of segment</span><span>
</span><span id="line-87"></span><span class="hs-keyword">data</span><span> </span><span id="EventType"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-var">EventType</span></a></span></span><span> </span><span id="local-6989586621680110125"><span class="annot"><a href="#local-6989586621680110125"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Start"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680110125"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span id="Intersection"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="End"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621680110125"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680109879"><span id="local-6989586621680109881"><span id="local-6989586621680109883"><span class="annot"><span class="annottext">Int -&gt; EventType s -&gt; ShowS
[EventType s] -&gt; ShowS
EventType s -&gt; String
(Int -&gt; EventType s -&gt; ShowS)
-&gt; (EventType s -&gt; String)
-&gt; ([EventType s] -&gt; ShowS)
-&gt; Show (EventType s)
forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
forall s. Show s =&gt; [EventType s] -&gt; ShowS
forall s. Show s =&gt; EventType s -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EventType s] -&gt; ShowS
$cshowList :: forall s. Show s =&gt; [EventType s] -&gt; ShowS
show :: EventType s -&gt; String
$cshow :: forall s. Show s =&gt; EventType s -&gt; String
showsPrec :: Int -&gt; EventType s -&gt; ShowS
$cshowsPrec :: forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621680109877"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680109874"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109877"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621680109872"><span class="annot"><span class="annottext">a :: EventType s
</span><a href="#local-6989586621680109872"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680109871"><span class="annot"><span class="annottext">== :: EventType s -&gt; EventType s -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621680109870"><span class="annot"><span class="annottext">b :: EventType s
</span><a href="#local-6989586621680109870"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621680109872"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">EventType s -&gt; EventType s -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621680109870"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span id="local-6989586621680109868"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680109854"><span id="local-6989586621680109856"><span id="local-6989586621680109858"><span id="local-6989586621680109860"><span id="local-6989586621680109862"><span id="local-6989586621680109864"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109868"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span id="local-6989586621680109852"><span class="annot"><span class="annottext">compare :: EventType s -&gt; EventType s -&gt; Ordering
</span><a href="#local-6989586621680109852"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-type">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-type">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-type">Intersection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-type">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | The actual event consists of a point and its type</span><span>
</span><span id="line-102"></span><span class="hs-keyword">data</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span id="local-6989586621680110127"><span class="annot"><a href="#local-6989586621680110127"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680110128"><span class="annot"><a href="#local-6989586621680110128"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="eventPoint"><span class="annot"><span class="annottext">Event p r -&gt; Point 2 r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var hs-var">eventPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110128"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="eventType"><span class="annot"><span class="annottext">Event p r -&gt; EventType (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var hs-var">eventType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110127"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110128"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>                       </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680109844"><span id="local-6989586621680109846"><span id="local-6989586621680109848"><span class="annot"><span class="annottext">Int -&gt; Event p r -&gt; ShowS
[Event p r] -&gt; ShowS
Event p r -&gt; String
(Int -&gt; Event p r -&gt; ShowS)
-&gt; (Event p r -&gt; String)
-&gt; ([Event p r] -&gt; ShowS)
-&gt; Show (Event p r)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall p r. (Show r, Show p) =&gt; Int -&gt; Event p r -&gt; ShowS
forall p r. (Show r, Show p) =&gt; [Event p r] -&gt; ShowS
forall p r. (Show r, Show p) =&gt; Event p r -&gt; String
showList :: [Event p r] -&gt; ShowS
$cshowList :: forall p r. (Show r, Show p) =&gt; [Event p r] -&gt; ShowS
show :: Event p r -&gt; String
$cshow :: forall p r. (Show r, Show p) =&gt; Event p r -&gt; String
showsPrec :: Int -&gt; Event p r -&gt; ShowS
$cshowsPrec :: forall p r. (Show r, Show p) =&gt; Int -&gt; Event p r -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680109840"><span id="local-6989586621680109842"><span class="annot"><span class="annottext">Event p r -&gt; Event p r -&gt; Bool
(Event p r -&gt; Event p r -&gt; Bool)
-&gt; (Event p r -&gt; Event p r -&gt; Bool) -&gt; Eq (Event p r)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall p r. Eq r =&gt; Event p r -&gt; Event p r -&gt; Bool
/= :: Event p r -&gt; Event p r -&gt; Bool
$c/= :: forall p r. Eq r =&gt; Event p r -&gt; Event p r -&gt; Bool
== :: Event p r -&gt; Event p r -&gt; Bool
$c== :: forall p r. Eq r =&gt; Event p r -&gt; Event p r -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621680109838"><span id="local-6989586621680109839"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680109824"><span id="local-6989586621680109826"><span id="local-6989586621680109828"><span id="local-6989586621680109830"><span id="local-6989586621680109832"><span id="local-6989586621680109834"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680109839"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109838"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109839"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- decreasing on the y-coord, then increasing on x-coord, and increasing on event-type</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680109823"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109823"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109822"><span class="annot"><span class="annottext">s :: EventType (LineSegment 2 p r)
</span><a href="#local-6989586621680109822"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680109821"><span class="annot"><span class="annottext">compare :: Event p r -&gt; Event p r -&gt; Ordering
</span><a href="#local-6989586621680109821"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680109820"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680109820"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680109819"><span class="annot"><span class="annottext">t :: EventType (LineSegment 2 p r)
</span><a href="#local-6989586621680109819"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109823"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109820"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>                                        </span><span class="annot"><span class="hs-identifier hs-type">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><a href="#local-6989586621680109822"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
-&gt; EventType (LineSegment 2 p r) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
</span><a href="#local-6989586621680109819"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-110"></span><span>                                        </span><span id="local-6989586621680109818"><span class="annot"><span class="annottext">x :: Ordering
</span><a href="#local-6989586621680109818"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621680109818"><span class="hs-identifier hs-var">x</span></a></span></span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Get the segments that start at the given event point</span><span>
</span><span id="line-113"></span><span id="local-6989586621680110107"><span id="local-6989586621680110108"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-type">startSegs</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110108"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110107"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110108"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110107"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-114"></span><span id="startSegs"><span class="annot"><span class="annottext">startSegs :: Event p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var hs-var">startSegs</span></a></span></span><span> </span><span id="local-6989586621680109817"><span class="annot"><span class="annottext">e :: Event p r
</span><a href="#local-6989586621680109817"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; EventType (LineSegment 2 p r)
forall p r. Event p r -&gt; EventType (LineSegment 2 p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var hs-var">eventType</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621680109817"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-115"></span><span>                </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621680109816"><span class="annot"><span class="annottext">ss :: NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621680109816"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r) -&gt; [LineSegment 2 p r]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NonEmpty.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r)
</span><a href="#local-6989586621680109816"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- * The Main Sweep</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">type</span><span> </span><span id="EventQueue"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-var">EventQueue</span></a></span></span><span>      </span><span id="local-6989586621680109814"><span class="annot"><a href="#local-6989586621680109814"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680109813"><span class="annot"><a href="#local-6989586621680109813"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EQ.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109814"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109813"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">type</span><span> </span><span id="StatusStructure"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-var">StatusStructure</span></a></span></span><span> </span><span id="local-6989586621680109812"><span class="annot"><a href="#local-6989586621680109812"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680109811"><span class="annot"><a href="#local-6989586621680109811"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680109812"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109811"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Run the sweep handling all events</span><span>
</span><span id="line-128"></span><span id="local-6989586621680110178"><span id="local-6989586621680110179"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-type">sweep</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110179"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110179"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110178"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110179"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110178"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110179"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110178"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110179"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-130"></span><span id="sweep"><span class="annot"><span class="annottext">sweep :: EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var hs-var">sweep</span></a></span></span><span> </span><span id="local-6989586621680109810"><span class="annot"><span class="annottext">eq :: EventQueue p r
</span><a href="#local-6989586621680109810"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621680109809"><span class="annot"><span class="annottext">ss :: StatusStructure p r
</span><a href="#local-6989586621680109809"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EventQueue p r -&gt; Maybe (Event p r, EventQueue p r)
forall a. Set a -&gt; Maybe (a, Set a)
</span><span class="hs-identifier hs-var">EQ.minView</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621680109810"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680109807"><span class="annot"><span class="annottext">e :: Event p r
</span><a href="#local-6989586621680109807"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109806"><span class="annot"><span class="annottext">eq' :: EventQueue p r
</span><a href="#local-6989586621680109806"><span class="hs-identifier hs-var">eq'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Event p r
-&gt; EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
forall r p.
(Ord r, Fractional r) =&gt;
Event p r
-&gt; EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621680109807"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621680109806"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109809"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="local-6989586621680110032"><span id="local-6989586621680110033"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-type">isClosedStart</span></a></span><span>                     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680110033"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110033"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110032"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110033"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-135"></span><span id="isClosedStart"><span class="annot"><span class="annottext">isClosedStart :: Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-var hs-var">isClosedStart</span></a></span></span><span> </span><span id="local-6989586621680109803"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109803"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span id="local-6989586621680109801"><span class="annot"><span class="annottext">s :: EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680109801"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680109800"><span class="annot"><span class="annottext">e :: EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680109800"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109803"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680109801"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
-&gt; Getting (Point 2 r) (EndPoint (Point 2 r :+ p)) (Point 2 r)
-&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; EndPoint (Point 2 r :+ p)
-&gt; Const (Point 2 r) (EndPoint (Point 2 r :+ p))
forall a b. Lens (EndPoint a) (EndPoint b) a b
</span><span class="hs-identifier hs-var">unEndPoint</span></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
 -&gt; EndPoint (Point 2 r :+ p)
 -&gt; Const (Point 2 r) (EndPoint (Point 2 r :+ p)))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p))
-&gt; Getting (Point 2 r) (EndPoint (Point 2 r :+ p)) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const (Point 2 r) (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p) -&gt; Bool
forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isClosed</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680109801"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p) -&gt; Bool
forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isClosed</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680109800"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- data AssocKind b a = Start b a | End b a | Neighter a</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- -- | test if the given segment has p as its endpoint, an construct the</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- -- appropriate associated representing that.</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- mkAssociated                :: Point 2 r -&gt; LineSegment 2 p r -&gt; AssocKind (LineSegment 2 p r)</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- mkAssociated p s@(LineSegment a b)</span><span>
</span><span id="line-146"></span><span class="hs-comment">--   | p == a^.unEndPoint.core = Start a s</span><span>
</span><span id="line-147"></span><span class="hs-comment">--   | p == b^.unEndPoint.core = End b s</span><span>
</span><span id="line-148"></span><span class="hs-comment">--   | otherwise               = Neighter s</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- -- -- | We need to report a segment as an segment for starting point p if</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- -- -- it is a closed segment starting at p, or an open segment starting</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- -- -- at p that intersects with some other segment.  since the segments</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- -- -- are given in sorted order around s, we can just look at the next</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- -- -- segment to see if we should report such an open-ended segment.</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- -- shouldReportStart   :: Point 2 r -&gt; [LineSegment 2 p r] -&gt; Associated p r</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- -- shouldReportStart p = go . map (categorize p)</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- --   where</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- --     go []     = mempty</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- --     go (s:ss) = let (xs,ys) = List.span overlapsWith s ss</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- --                 in case s of</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- --                      Start (Closed _) s' -&gt; Asso</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- --     (s@(LineSegment a b):ss)</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- --         | p == a^.unEndPoint.core =</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- --           if isClosed a || overlapsWithNext ss</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- --                                     then Associated [s] [] [] &lt;&gt; go ss</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- --         -- | p == b^.unEndPoint.core = Associated [] [s] []</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">--     _  []                  = mempty</span><span>
</span><span id="line-183"></span><span class="hs-comment">--     go certainlyReport (s:ss) = let x  = mkAssociated p s</span><span>
</span><span id="line-184"></span><span class="hs-comment">--                                     x' = then x else mempty</span><span>
</span><span id="line-185"></span><span class="hs-comment">--                                 in</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">--       case shouldReport mp s of</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">--       mkAssociated mp s &lt;&gt; go (Just s) ss</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">--     mkAsscoiated _ s@(LineSegment a b)</span><span>
</span><span id="line-199"></span><span class="hs-comment">--       | p == a^.unEndPoint.core = if isClosed a ||</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">--       = Associated [s] [] []</span><span>
</span><span id="line-204"></span><span class="hs-comment">--       | p == b^.unEndPoint.core = Associated [] [s] []</span><span>
</span><span id="line-205"></span><span class="hs-comment">--       | otherwise               = mempty</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- _ []     = []</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- shouldReportStart _ []     = []</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- shouldReportStart p (s:ss) = case hasStartingPoint p s of</span><span>
</span><span id="line-213"></span><span class="hs-comment">--                                Nothing            -&gt; shouldReportStart ss -- don't report the seg</span><span>
</span><span id="line-214"></span><span class="hs-comment">--                                Just (Closed _, s) -&gt; s : shouldReportStart ss</span><span>
</span><span id="line-215"></span><span class="hs-comment">--                                Just (Open _, )</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- -- [s] | isClosedStart p s = [s]</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- --                         | otherwise         = []</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- -- shouldReportStart p (s:s':ss) | isStart p s =</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- (s:ss) = isClosedStart p s ||</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- shouldReport   :: Eq r =&gt; Point 2 r -&gt; [LineSegment 2 p r] -&gt; Associated p r</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- shouldReport p = foldMap (\(s,c) -&gt; case c of</span><span>
</span><span id="line-229"></span><span class="hs-comment">--                                       Start'   -&gt; Associated [s] [] []</span><span>
</span><span id="line-230"></span><span class="hs-comment">--                                       End'     -&gt; Associated [] [s] []</span><span>
</span><span id="line-231"></span><span class="hs-comment">--                                       Neighter -&gt; Associated [] [] [s]</span><span>
</span><span id="line-232"></span><span class="hs-comment">--                          )</span><span>
</span><span id="line-233"></span><span class="hs-comment">--                . overlapsOr (\(LineSegment a b,c) -&gt; case c of</span><span>
</span><span id="line-234"></span><span class="hs-comment">--                                              Start'   -&gt; isClosed a</span><span>
</span><span id="line-235"></span><span class="hs-comment">--                                              End'     -&gt; isClosed b</span><span>
</span><span id="line-236"></span><span class="hs-comment">--                                              Neighter -&gt; False</span><span>
</span><span id="line-237"></span><span class="hs-comment">--                               ) (overlap p)</span><span>
</span><span id="line-238"></span><span class="hs-comment">--                . map (\s -&gt; (s, categorize p s))</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span id="local-6989586621680109796"><span id="local-6989586621680109797"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlap"><span class="hs-identifier hs-type">overlap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680109797"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680109796"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109797"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Cat"><span class="hs-identifier hs-type">Cat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680109796"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109797"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Cat"><span class="hs-identifier hs-type">Cat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-241"></span><span id="overlap"><span class="annot"><span class="annottext">overlap :: Point 2 r
-&gt; (LineSegment 2 q r, Cat) -&gt; (LineSegment 2 q r, Cat) -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlap"><span class="hs-identifier hs-var hs-var">overlap</span></a></span></span><span> </span><span id="local-6989586621680109794"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109794"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109793"><span class="annot"><span class="annottext">s1 :: (LineSegment 2 q r, Cat)
</span><a href="#local-6989586621680109793"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621680109792"><span class="annot"><span class="annottext">s2 :: (LineSegment 2 q r, Cat)
</span><a href="#local-6989586621680109792"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 q r, Bool) -&gt; (LineSegment 2 q r, Bool) -&gt; Bool
forall a. a
</span><a href="#local-6989586621680109791"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LineSegment 2 q r, Cat) -&gt; (LineSegment 2 q r, Bool)
forall (d :: Nat) p r.
(LineSegment d p r, Cat) -&gt; (LineSegment d p r, Bool)
</span><a href="#local-6989586621680109790"><span class="hs-identifier hs-var">toStart</span></a></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 q r, Cat)
</span><a href="#local-6989586621680109793"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LineSegment 2 q r, Cat) -&gt; (LineSegment 2 q r, Bool)
forall (d :: Nat) p r.
(LineSegment d p r, Cat) -&gt; (LineSegment d p r, Bool)
</span><a href="#local-6989586621680109790"><span class="hs-identifier hs-var">toStart</span></a></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 q r, Cat)
</span><a href="#local-6989586621680109792"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621680109790"><span class="annot"><span class="annottext">toStart :: (LineSegment d p r, Cat) -&gt; (LineSegment d p r, Bool)
</span><a href="#local-6989586621680109790"><span class="hs-identifier hs-var hs-var">toStart</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680109789"><span class="annot"><span class="annottext">s :: LineSegment d p r
</span><a href="#local-6989586621680109789"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span id="local-6989586621680109788"><span class="annot"><span class="annottext">a :: EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109788"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680109787"><span class="annot"><span class="annottext">b :: EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109787"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680109786"><span class="annot"><span class="annottext">c :: Cat
</span><a href="#local-6989586621680109786"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Cat
</span><a href="#local-6989586621680109786"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-244"></span><span>                                        </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start%27"><span class="hs-identifier hs-type">Start'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680109789"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>                                        </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End%27"><span class="hs-identifier hs-type">End'</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
-&gt; EndPoint (Point d r :+ p) -&gt; LineSegment d p r
forall (d :: Nat) r p.
EndPoint (Point d r :+ p)
-&gt; EndPoint (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-var">LineSegment</span></a></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109787"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109788"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- flip to start</span><span>
</span><span id="line-246"></span><span>                                        </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Neighter"><span class="hs-identifier hs-type">Neighter</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680109789"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621680109791"><span class="annot"><span class="annottext">go :: a
</span><a href="#local-6989586621680109791"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-keyword">data</span><span> </span><span id="Cat"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Cat"><span class="hs-identifier hs-var">Cat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Start%27"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start%27"><span class="hs-identifier hs-var">Start'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="End%27"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End%27"><span class="hs-identifier hs-var">End'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Neighter"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Neighter"><span class="hs-identifier hs-var">Neighter</span></a></span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="categorize"><span class="annot"><span class="annottext">categorize :: Point d r -&gt; LineSegment d p r -&gt; Cat
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#categorize"><span class="hs-identifier hs-var hs-var">categorize</span></a></span></span><span> </span><span id="local-6989586621680109780"><span class="annot"><span class="annottext">p :: Point d r
</span><a href="#local-6989586621680109780"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span id="local-6989586621680109779"><span class="annot"><span class="annottext">a :: EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109779"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680109778"><span class="annot"><span class="annottext">b :: EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109778"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680109780"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r -&gt; Point d r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109779"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
-&gt; Getting (Point d r) (EndPoint (Point d r :+ p)) (Point d r)
-&gt; Point d r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p))
-&gt; EndPoint (Point d r :+ p)
-&gt; Const (Point d r) (EndPoint (Point d r :+ p))
forall a b. Lens (EndPoint a) (EndPoint b) a b
</span><span class="hs-identifier hs-var">unEndPoint</span></span><span class="annot"><span class="annottext">(((Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p))
 -&gt; EndPoint (Point d r :+ p)
 -&gt; Const (Point d r) (EndPoint (Point d r :+ p)))
-&gt; ((Point d r -&gt; Const (Point d r) (Point d r))
    -&gt; (Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p))
-&gt; Getting (Point d r) (EndPoint (Point d r :+ p)) (Point d r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point d r -&gt; Const (Point d r) (Point d r))
-&gt; (Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cat
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start%27"><span class="hs-identifier hs-var">Start'</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680109780"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r -&gt; Point d r -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
</span><a href="#local-6989586621680109778"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">EndPoint (Point d r :+ p)
-&gt; Getting (Point d r) (EndPoint (Point d r :+ p)) (Point d r)
-&gt; Point d r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p))
-&gt; EndPoint (Point d r :+ p)
-&gt; Const (Point d r) (EndPoint (Point d r :+ p))
forall a b. Lens (EndPoint a) (EndPoint b) a b
</span><span class="hs-identifier hs-var">unEndPoint</span></span><span class="annot"><span class="annottext">(((Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p))
 -&gt; EndPoint (Point d r :+ p)
 -&gt; Const (Point d r) (EndPoint (Point d r :+ p)))
-&gt; ((Point d r -&gt; Const (Point d r) (Point d r))
    -&gt; (Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p))
-&gt; Getting (Point d r) (EndPoint (Point d r :+ p)) (Point d r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point d r -&gt; Const (Point d r) (Point d r))
-&gt; (Point d r :+ p) -&gt; Const (Point d r) (Point d r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cat
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End%27"><span class="hs-identifier hs-var">End'</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cat
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Neighter"><span class="hs-identifier hs-var">Neighter</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span id="local-6989586621680109777"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-type">overlapsOr</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109777"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109777"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680109777"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680109777"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-264"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680109777"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-265"></span><span id="overlapsOr"><span class="annot"><span class="annottext">overlapsOr :: (a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-var hs-var">overlapsOr</span></a></span></span><span> </span><span id="local-6989586621680109775"><span class="annot"><span class="annottext">p :: a -&gt; Bool
</span><a href="#local-6989586621680109775"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109774"><span class="annot"><span class="annottext">q :: a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109774"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; a) -&gt; [(a, Bool)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [a]) -&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; Bool
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [(a, Bool)])
-&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [(a, Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(((a, Bool), Bool) -&gt; (a, Bool))
-&gt; [((a, Bool), Bool)] -&gt; [(a, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680109773"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621680109773"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109772"><span class="annot"><span class="annottext">b :: Bool
</span><a href="#local-6989586621680109772"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680109771"><span class="annot"><span class="annottext">b' :: Bool
</span><a href="#local-6989586621680109771"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109773"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109772"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109771"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>               </span><span class="annot"><span class="annottext">([((a, Bool), Bool)] -&gt; [(a, Bool)])
-&gt; ([a] -&gt; [((a, Bool), Bool)]) -&gt; [a] -&gt; [(a, Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; (a, Bool) -&gt; Bool)
-&gt; [(a, Bool)] -&gt; [((a, Bool), Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109774"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool)
-&gt; ((a, Bool) -&gt; a) -&gt; (a, Bool) -&gt; (a, Bool) -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>               </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [((a, Bool), Bool)])
-&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [((a, Bool), Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, Bool)) -&gt; [a] -&gt; [(a, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680109768"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109768"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109768"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680109775"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109768"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span id="local-6989586621680110050"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-type">overlapsWithNeighbour</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680110050"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680110050"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680110050"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680110050"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-270"></span><span id="overlapsWithNeighbour"><span class="annot"><span class="annottext">overlapsWithNeighbour :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var hs-var">overlapsWithNeighbour</span></a></span></span><span> </span><span id="local-6989586621680109767"><span class="annot"><span class="annottext">p :: a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109767"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109766"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621680109766"><span class="annot"><span class="annottext">go0 :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109766"><span class="hs-identifier hs-var hs-var">go0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680109765"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109765"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680109764"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621680109764"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109765"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109764"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621680109763"><span class="annot"><span class="annottext">go :: a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109763"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680109762"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109762"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680109761"><span class="annot"><span class="annottext">b :: Bool
</span><a href="#local-6989586621680109761"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680109760"><span class="annot"><span class="annottext">y :: a
</span><a href="#local-6989586621680109760"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680109759"><span class="annot"><span class="annottext">ys :: [a]
</span><a href="#local-6989586621680109759"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680109758"><span class="annot"><span class="annottext">b' :: Bool
</span><a href="#local-6989586621680109758"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109767"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109762"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109760"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109762"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109761"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109758"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109763"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109760"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109758"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109759"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="local-6989586621680109757"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#annotateReport"><span class="hs-identifier hs-type">annotateReport</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109757"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680109757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-290"></span><span id="annotateReport"><span class="annot"><span class="annottext">annotateReport :: (a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#annotateReport"><span class="hs-identifier hs-var hs-var">annotateReport</span></a></span></span><span> </span><span id="local-6989586621680109755"><span class="annot"><span class="annottext">p :: a -&gt; Bool
</span><a href="#local-6989586621680109755"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, Bool)) -&gt; [a] -&gt; [(a, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680109754"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109754"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109754"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680109755"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109754"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span id="local-6989586621680109753"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNext%27"><span class="hs-identifier hs-type">overlapsWithNext'</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109753"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680109753"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680109753"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109753"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-294"></span><span id="overlapsWithNext%27"><span class="annot"><span class="annottext">overlapsWithNext' :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNext%27"><span class="hs-identifier hs-var hs-var">overlapsWithNext'</span></a></span></span><span> </span><span id="local-6989586621680109751"><span class="annot"><span class="annottext">p :: a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109751"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109750"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621680109750"><span class="annot"><span class="annottext">go :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109750"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621680109749"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109749"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109749"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680109748"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109748"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680109747"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621680109747"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680109746"><span class="annot"><span class="annottext">y :: a
</span><a href="#local-6989586621680109746"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109748"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109751"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109748"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109746"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109750"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109747"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621680109745"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithPrev%27"><span class="hs-identifier hs-type">overlapsWithPrev'</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109745"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680109745"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680109745"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680109745"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-302"></span><span id="overlapsWithPrev%27"><span class="annot"><span class="annottext">overlapsWithPrev' :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithPrev%27"><span class="hs-identifier hs-var hs-var">overlapsWithPrev'</span></a></span></span><span> </span><span id="local-6989586621680109743"><span class="annot"><span class="annottext">p :: a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109743"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109742"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621680109742"><span class="annot"><span class="annottext">go0 :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109742"><span class="hs-identifier hs-var hs-var">go0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-306"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680109741"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109741"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680109740"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621680109740"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109741"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109739"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109741"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109740"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621680109739"><span class="annot"><span class="annottext">go :: a -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109739"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680109738"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621680109738"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680109737"><span class="annot"><span class="annottext">y :: a
</span><a href="#local-6989586621680109737"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680109736"><span class="annot"><span class="annottext">ys :: [a]
</span><a href="#local-6989586621680109736"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109737"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109743"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109738"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109737"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; [(a, Bool)] -&gt; [(a, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680109739"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109737"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109736"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span id="overlapsWithNeighbour2"><span class="annot"><span class="annottext">overlapsWithNeighbour2 :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour2"><span class="hs-identifier hs-var hs-var">overlapsWithNeighbour2</span></a></span></span><span> </span><span id="local-6989586621680109734"><span class="annot"><span class="annottext">p :: a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109734"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((a, Bool), Bool) -&gt; (a, Bool))
-&gt; [((a, Bool), Bool)] -&gt; [(a, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680109733"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621680109733"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109732"><span class="annot"><span class="annottext">b :: Bool
</span><a href="#local-6989586621680109732"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680109731"><span class="annot"><span class="annottext">b' :: Bool
</span><a href="#local-6989586621680109731"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680109733"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109732"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680109731"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>                         </span><span class="annot"><span class="annottext">([((a, Bool), Bool)] -&gt; [(a, Bool)])
-&gt; ([a] -&gt; [((a, Bool), Bool)]) -&gt; [a] -&gt; [(a, Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((a, Bool) -&gt; (a, Bool) -&gt; Bool)
-&gt; [(a, Bool)] -&gt; [((a, Bool), Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNext%27"><span class="hs-identifier hs-var">overlapsWithNext'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109734"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool)
-&gt; ((a, Bool) -&gt; a) -&gt; (a, Bool) -&gt; (a, Bool) -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>                         </span><span class="annot"><span class="annottext">([(a, Bool)] -&gt; [((a, Bool), Bool)])
-&gt; ([a] -&gt; [(a, Bool)]) -&gt; [a] -&gt; [((a, Bool), Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithPrev%27"><span class="hs-identifier hs-var">overlapsWithPrev'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109734"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span id="local-6989586621680109730"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldBe"><span class="hs-identifier hs-type">shouldBe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680109730"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680109730"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680109730"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-322"></span><span id="shouldBe"><span class="annot"><span class="annottext">shouldBe :: a -&gt; a -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldBe"><span class="hs-identifier hs-var hs-var">shouldBe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span id="propSameAsSeparate"><span class="annot"><span class="annottext">propSameAsSeparate :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#propSameAsSeparate"><span class="hs-identifier hs-var hs-var">propSameAsSeparate</span></a></span></span><span> </span><span id="local-6989586621680109727"><span class="annot"><span class="annottext">p :: a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109727"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109726"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621680109726"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109727"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109726"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Bool)] -&gt; [(a, Bool)] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldBe"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour2"><span class="hs-identifier hs-var">overlapsWithNeighbour2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680109727"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680109726"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span id="test%27"><span class="annot"><span class="annottext">test' :: [(Integer, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#test%27"><span class="hs-identifier hs-var hs-var">test'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool) -&gt; [Integer] -&gt; [(Integer, Bool)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">[Integer]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#testOverlapNext"><span class="hs-identifier hs-var">testOverlapNext</span></a></span><span>
</span><span id="line-327"></span><span id="testOverlapNext"><span class="annot"><span class="annottext">testOverlapNext :: [Integer]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#testOverlapNext"><span class="hs-identifier hs-var hs-var">testOverlapNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">5</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">10</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">11</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">34</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- reportOverlappingBy :: Eq a =&gt; (a -&gt; Bool) -&gt; [a] -&gt; [a]</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- reportOverlappingBy p = \case</span><span>
</span><span id="line-331"></span><span class="hs-comment">--   []     -&gt; []</span><span>
</span><span id="line-332"></span><span class="hs-comment">--   (x:xs) -&gt; L.span</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | Handle an event point</span><span>
</span><span id="line-336"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-type">handle</span></a></span><span>                           </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680110082"><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680110081"><span class="annot"><a href="#local-6989586621680110081"><span class="hs-identifier hs-type">p</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110081"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110081"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110081"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-338"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110081"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110082"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-339"></span><span id="handle"><span class="annot"><span class="annottext">handle :: Event p r
-&gt; EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621680109723"><span class="annot"><span class="annottext">e :: Event p r
</span><a href="#local-6989586621680109723"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event p r -&gt; Point 2 r
forall p r. Event p r -&gt; Point 2 r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var hs-var">eventPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680109722"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680109721"><span class="annot"><span class="annottext">eq :: EventQueue p r
</span><a href="#local-6989586621680109721"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621680109720"><span class="annot"><span class="annottext">ss :: StatusStructure p r
</span><a href="#local-6989586621680109720"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r]
</span><a href="#local-6989586621680109719"><span class="hs-identifier hs-var">toReport</span></a></span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r]
-&gt; [IntersectionPoint p r] -&gt; [IntersectionPoint p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
forall r p.
(Ord r, Fractional r) =&gt;
EventQueue p r -&gt; StatusStructure p r -&gt; [IntersectionPoint p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621680109718"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109717"><span class="hs-identifier hs-var">ss'</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621680109716"><span class="annot"><span class="annottext">starts :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109716"><span class="hs-identifier hs-var hs-var">starts</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; [LineSegment 2 p r]
forall p r. Event p r -&gt; [LineSegment 2 p r]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r
</span><a href="#local-6989586621680109723"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680109715"><span class="annot"><span class="annottext">before :: StatusStructure p r
</span><a href="#local-6989586621680109715"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109714"><span class="annot"><span class="annottext">contains' :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109714"><span class="hs-identifier hs-var">contains'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109713"><span class="annot"><span class="annottext">after :: StatusStructure p r
</span><a href="#local-6989586621680109713"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, [LineSegment 2 p r], StatusStructure p r)
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, [LineSegment 2 p r], StatusStructure p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var">extractContains</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109720"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680109711"><span class="annot"><span class="annottext">ends :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109711"><span class="hs-identifier hs-var">ends</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109710"><span class="annot"><span class="annottext">contains :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109710"><span class="hs-identifier hs-var">contains</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r]
-&gt; ([LineSegment 2 p r], [LineSegment 2 p r])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall r p. Ord r =&gt; Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var">endsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109714"><span class="hs-identifier hs-var">contains'</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- starting segments, exluding those that have an open starting point</span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621680109707"><span class="annot"><span class="annottext">starts' :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109707"><span class="hs-identifier hs-var hs-var">starts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall r p. Eq r =&gt; Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-var">isClosedStart</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109716"><span class="hs-identifier hs-var">starts</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- starts'' = shouldReport p . SS.toAscList $ newSegs</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- FIXME: we should look at the starts in-order (around p).</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-comment">-- closed endpoints we should report anyway. For an open endpoint</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- we should check if it overlaps with a sucessor or predecessor</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-comment">-- to see if we have to report it.</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-comment">-- I think we could get those from the 'toStatusStruct' structure below</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-comment">-- any (closed) ending segments at this event point.</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621680109706"><span class="annot"><span class="annottext">closedEnds :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109706"><span class="hs-identifier hs-var hs-var">closedEnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall r p. Eq r =&gt; Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#isClosedStart"><span class="hs-identifier hs-var">isClosedStart</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109711"><span class="hs-identifier hs-var">ends</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621680109719"><span class="annot"><span class="annottext">toReport :: [IntersectionPoint p r]
</span><a href="#local-6989586621680109719"><span class="hs-identifier hs-var hs-var">toReport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109707"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109714"><span class="hs-identifier hs-var">contains'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-identifier">_</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point 2 r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; IntersectionPoint p r
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; [LineSegment 2 p r]
-&gt; [LineSegment 2 p r]
-&gt; IntersectionPoint p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#mkIntersectionPoint"><span class="hs-identifier hs-var">mkIntersectionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109707"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109706"><span class="hs-identifier hs-var">closedEnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109710"><span class="hs-identifier hs-var">contains</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-361"></span><span>                 </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- new status structure</span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621680109717"><span class="annot"><span class="annottext">ss' :: StatusStructure p r
</span><a href="#local-6989586621680109717"><span class="hs-identifier hs-var hs-var">ss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109715"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; StatusStructure p r -&gt; StatusStructure p r
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109703"><span class="hs-identifier hs-var">newSegs</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; StatusStructure p r -&gt; StatusStructure p r
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109713"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621680109703"><span class="annot"><span class="annottext">newSegs :: StatusStructure p r
</span><a href="#local-6989586621680109703"><span class="hs-identifier hs-var hs-var">newSegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall r p.
(Fractional r, Ord r) =&gt;
Point 2 r -&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var">toStatusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">([LineSegment 2 p r] -&gt; StatusStructure p r)
-&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109716"><span class="hs-identifier hs-var">starts</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109710"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- the new eeventqueue</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621680109718"><span class="annot"><span class="annottext">eq' :: EventQueue p r
</span><a href="#local-6989586621680109718"><span class="hs-identifier hs-var hs-var">eq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Event p r -&gt; EventQueue p r -&gt; EventQueue p r)
-&gt; EventQueue p r -&gt; [Event p r] -&gt; EventQueue p r
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; EventQueue p r -&gt; EventQueue p r
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.insert</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r
</span><a href="#local-6989586621680109721"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r]
</span><a href="#local-6989586621680109700"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-comment">-- the new events:</span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621680109700"><span class="annot"><span class="annottext">es :: [Event p r]
</span><a href="#local-6989586621680109700"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">F.null</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109703"><span class="hs-identifier hs-var">newSegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r) -&gt; [Event p r]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Event p r) -&gt; [Event p r])
-&gt; Maybe (Event p r) -&gt; [Event p r]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (Event p r)
forall (m :: * -&gt; *) t t b.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680109697"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109695"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109694"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-372"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680109693"><span class="annot"><span class="annottext">s' :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109693"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109703"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-373"></span><span>                               </span><span id="local-6989586621680109691"><span class="annot"><span class="annottext">s'' :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109691"><span class="hs-identifier hs-var hs-var">s''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109703"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-374"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Maybe (Event p r)] -&gt; [Event p r]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (Event p r)
forall (m :: * -&gt; *) t t b.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680109697"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109695"><span class="hs-identifier hs-var">sl</span></a></span><span>  </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109693"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-375"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r))
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (LineSegment 2 p r)
-&gt; Maybe (Event p r)
forall (m :: * -&gt; *) t t b.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680109697"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
forall r p.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109722"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109691"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109694"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-376"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621680109695"><span class="annot"><span class="annottext">sl :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109695"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109715"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621680109694"><span class="annot"><span class="annottext">sr :: Maybe (LineSegment 2 p r)
</span><a href="#local-6989586621680109694"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; Maybe (LineSegment 2 p r)
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109713"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>    </span><span id="local-6989586621680109697"><span class="annot"><span class="annottext">app :: (t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680109697"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621680109688"><span class="annot"><span class="annottext">f :: t -&gt; t -&gt; m b
</span><a href="#local-6989586621680109688"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680109687"><span class="annot"><span class="annottext">x :: m t
</span><a href="#local-6989586621680109687"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680109686"><span class="annot"><span class="annottext">y :: m t
</span><a href="#local-6989586621680109686"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680109685"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680109685"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680109687"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span id="local-6989586621680109684"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680109684"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680109686"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m b
</span><a href="#local-6989586621680109688"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680109685"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680109684"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-comment">-- | split the status structure, extracting the segments that contain p.</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- the result is (before,contains,after)</span><span>
</span><span id="line-384"></span><span id="local-6989586621680110036"><span id="local-6989586621680110037"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-type">extractContains</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-386"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110036"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110037"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-387"></span><span id="extractContains"><span class="annot"><span class="annottext">extractContains :: Point 2 r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, [LineSegment 2 p r], StatusStructure p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var hs-var">extractContains</span></a></span></span><span> </span><span id="local-6989586621680109683"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109683"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109682"><span class="annot"><span class="annottext">ss :: StatusStructure p r
</span><a href="#local-6989586621680109682"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109681"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; [LineSegment 2 p r]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109679"><span class="hs-identifier hs-var">mid1</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; [LineSegment 2 p r] -&gt; [LineSegment 2 p r]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; [LineSegment 2 p r]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109678"><span class="hs-identifier hs-var">mid2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109677"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680109681"><span class="annot"><span class="annottext">before :: StatusStructure p r
</span><a href="#local-6989586621680109681"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680109679"><span class="annot"><span class="annottext">mid1 :: StatusStructure p r
</span><a href="#local-6989586621680109679"><span class="hs-identifier hs-var">mid1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680109676"><span class="annot"><span class="annottext">after' :: StatusStructure p r
</span><a href="#local-6989586621680109676"><span class="hs-identifier hs-var">after'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; r)
-&gt; r
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, StatusStructure p r, StatusStructure p r)
forall b a.
Ord b =&gt;
(a -&gt; b) -&gt; b -&gt; Set a -&gt; (Set a, Set a, Set a)
</span><span class="hs-identifier hs-var">SS.splitOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 p r -&gt; r
forall r p. (Fractional r, Ord r) =&gt; r -&gt; LineSegment 2 p r -&gt; r
</span><a href="Data.Geometry.LineSegment.Internal.html#xCoordAt"><span class="hs-identifier hs-var">xCoordAt</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 p r -&gt; r) -&gt; r -&gt; LineSegment 2 p r -&gt; r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109683"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109683"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109682"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-comment">-- Make sure to also select the horizontal segments containing p</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680109678"><span class="annot"><span class="annottext">mid2 :: StatusStructure p r
</span><a href="#local-6989586621680109678"><span class="hs-identifier hs-var">mid2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680109677"><span class="annot"><span class="annottext">after :: StatusStructure p r
</span><a href="#local-6989586621680109677"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; StatusStructure p r
-&gt; (StatusStructure p r, StatusStructure p r)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">SS.spanAntitone</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-identifier hs-var">intersects</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109683"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109676"><span class="hs-identifier hs-var">after'</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-comment">-- | Given a point and the linesegements that contain it. Create a piece of</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- status structure for it.</span><span>
</span><span id="line-396"></span><span id="local-6989586621680110027"><span id="local-6989586621680110028"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-type">toStatusStruct</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110028"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110028"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110028"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110027"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110028"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110027"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110028"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-398"></span><span id="toStatusStruct"><span class="annot"><span class="annottext">toStatusStruct :: Point 2 r -&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var hs-var">toStatusStruct</span></a></span></span><span> </span><span id="local-6989586621680109669"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109669"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109668"><span class="annot"><span class="annottext">xs :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109668"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109667"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r -&gt; StatusStructure p r -&gt; StatusStructure p r
forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r
</span><a href="#local-6989586621680109666"><span class="hs-identifier hs-var">hors</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-comment">-- ss { SS.nav = ordAtNav $ p^.yCoord } `SS.join` hors</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680109665"><span class="annot"><span class="annottext">hors' :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109665"><span class="hs-identifier hs-var">hors'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680109664"><span class="annot"><span class="annottext">rest :: [LineSegment 2 p r]
</span><a href="#local-6989586621680109664"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; Bool)
-&gt; [LineSegment 2 p r]
-&gt; ([LineSegment 2 p r], [LineSegment 2 p r])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Bool
forall (d :: Nat) (d :: Nat) s a (point :: Nat -&gt; * -&gt; *)
       (point :: Nat -&gt; * -&gt; *).
(ImplicitPeano (Peano d), ImplicitPeano (Peano d), HasEnd s, Eq a,
 HasStart s, ArityPeano (Peano (FromPeano (Peano d))),
 ArityPeano (Peano (FromPeano (Peano d))), KnownNat d,
 KnownNat (FromPeano (Peano d)), KnownNat (FromPeano (Peano d)),
 KnownNat d, AsAPoint point, AsAPoint point, (2 &lt;=? d) ~ 'True,
 (2 &lt;=? d) ~ 'True,
 Peano (FromPeano (Peano d) + 1) ~ 'S (Peano (FromPeano (Peano d))),
 EndCore s ~ point d a, StartCore s ~ point d a,
 Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d)))) =&gt;
s -&gt; Bool
</span><a href="#local-6989586621680109663"><span class="hs-identifier hs-var">isHorizontal</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109668"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621680109667"><span class="annot"><span class="annottext">ss :: StatusStructure p r
</span><a href="#local-6989586621680109667"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">SS.fromListBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall r p.
(Fractional r, Ord r) =&gt;
r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
</span><a href="Data.Geometry.LineSegment.Internal.html#ordAtY"><span class="hs-identifier hs-var">ordAtY</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r] -&gt; r
</span><a href="#local-6989586621680109660"><span class="hs-identifier hs-var">maxY</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109668"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109664"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621680109666"><span class="annot"><span class="annottext">hors :: StatusStructure p r
</span><a href="#local-6989586621680109666"><span class="hs-identifier hs-var hs-var">hors</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering)
-&gt; [LineSegment 2 p r] -&gt; StatusStructure p r
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">SS.fromListBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; r)
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; r
forall r p. Ord r =&gt; LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var">rightEndpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r]
</span><a href="#local-6989586621680109665"><span class="hs-identifier hs-var">hors'</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621680109663"><span class="annot"><span class="annottext">isHorizontal :: s -&gt; Bool
</span><a href="#local-6989586621680109663"><span class="hs-identifier hs-var hs-var">isHorizontal</span></a></span></span><span> </span><span id="local-6989586621680109658"><span class="annot"><span class="annottext">s :: s
</span><a href="#local-6989586621680109658"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621680109658"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">s -&gt; Getting a s a -&gt; a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((point d a :+ StartExtra s)
 -&gt; Const a (point d a :+ StartExtra s))
-&gt; s -&gt; Const a s
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((point d a :+ StartExtra s)
  -&gt; Const a (point d a :+ StartExtra s))
 -&gt; s -&gt; Const a s)
-&gt; ((a -&gt; Const a a)
    -&gt; (point d a :+ StartExtra s)
    -&gt; Const a (point d a :+ StartExtra s))
-&gt; Getting a s a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(point d a -&gt; Const a (point d a))
-&gt; (point d a :+ StartExtra s)
-&gt; Const a (point d a :+ StartExtra s)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((point d a -&gt; Const a (point d a))
 -&gt; (point d a :+ StartExtra s)
 -&gt; Const a (point d a :+ StartExtra s))
-&gt; ((a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a))
-&gt; (a -&gt; Const a a)
-&gt; (point d a :+ StartExtra s)
-&gt; Const a (point d a :+ StartExtra s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621680109658"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">s -&gt; Getting a s a -&gt; a
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
-&gt; s -&gt; Const a s
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
 -&gt; s -&gt; Const a s)
-&gt; ((a -&gt; Const a a)
    -&gt; (point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
-&gt; Getting a s a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(point d a -&gt; Const a (point d a))
-&gt; (point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((point d a -&gt; Const a (point d a))
 -&gt; (point d a :+ EndExtra s) -&gt; Const a (point d a :+ EndExtra s))
-&gt; ((a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a))
-&gt; (a -&gt; Const a a)
-&gt; (point d a :+ EndExtra s)
-&gt; Const a (point d a :+ EndExtra s)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(a -&gt; Const a a) -&gt; point d a -&gt; Const a (point d a)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">-- find the y coord of the first interesting thing below the sweep at y</span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621680109660"><span class="annot"><span class="annottext">maxY :: [LineSegment 2 p r] -&gt; r
</span><a href="#local-6989586621680109660"><span class="hs-identifier hs-var hs-var">maxY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[r] -&gt; r
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">([r] -&gt; r)
-&gt; ([LineSegment 2 p r] -&gt; [r]) -&gt; [LineSegment 2 p r] -&gt; r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Bool) -&gt; [r] -&gt; [r]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; r -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109669"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">Point 2 r -&gt; Getting r (Point 2 r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>         </span><span class="annot"><span class="annottext">([r] -&gt; [r])
-&gt; ([LineSegment 2 p r] -&gt; [r]) -&gt; [LineSegment 2 p r] -&gt; [r]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 p r -&gt; [r]) -&gt; [LineSegment 2 p r] -&gt; [r]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680109655"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680109655"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109655"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (Point 2 r) r
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109655"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (Point 2 r) r
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Getting r (Point 2 r) r
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- | Get the right endpoint of a segment</span><span>
</span><span id="line-412"></span><span id="local-6989586621680109975"><span id="local-6989586621680109976"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-type">rightEndpoint</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680109976"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680109975"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680109976"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680109976"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-413"></span><span id="rightEndpoint"><span class="annot"><span class="annottext">rightEndpoint :: LineSegment 2 p r -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var hs-var">rightEndpoint</span></a></span></span><span> </span><span id="local-6989586621680109654"><span class="annot"><span class="annottext">s :: LineSegment 2 p r
</span><a href="#local-6989586621680109654"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109654"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Data.Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`max`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109654"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">LineSegment 2 p r -&gt; Getting r (LineSegment 2 p r) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r)
forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Data.Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
 -&gt; LineSegment 2 p r -&gt; Const r (LineSegment 2 p r))
-&gt; ((r -&gt; Const r r)
    -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; Getting r (LineSegment 2 p r) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const r (Point 2 r))
-&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point 2 r -&gt; Const r (Point 2 r))
 -&gt; (Point 2 r :+ p) -&gt; Const r (Point 2 r :+ p))
-&gt; ((r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r))
-&gt; (r -&gt; Const r r)
-&gt; (Point 2 r :+ p)
-&gt; Const r (Point 2 r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(r -&gt; Const r r) -&gt; Point 2 r -&gt; Const r (Point 2 r)
forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Data.Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-comment">-- | Test if a segment ends at p</span><span>
</span><span id="line-416"></span><span id="local-6989586621680110034"><span id="local-6989586621680110035"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-type">endsAt</span></a></span><span>                      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110035"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110035"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110034"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110035"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-417"></span><span id="endsAt"><span class="annot"><span class="annottext">endsAt :: Point 2 r -&gt; LineSegment 2 p r -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var hs-var">endsAt</span></a></span></span><span> </span><span id="local-6989586621680109652"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109652"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span id="local-6989586621680109650"><span class="annot"><span class="annottext">a :: Point 2 r :+ p
</span><a href="#local-6989586621680109650"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680109649"><span class="annot"><span class="annottext">b :: Point 2 r :+ p
</span><a href="#local-6989586621680109649"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Bool) -&gt; [Point 2 r :+ p] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680109647"><span class="annot"><span class="annottext">q :: Point 2 r :+ p
</span><a href="#local-6989586621680109647"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680109647"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109652"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680109650"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680109649"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- * Finding New events</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- | Find all events</span><span>
</span><span id="line-423"></span><span id="local-6989586621680110018"><span id="local-6989586621680110019"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-type">findNewEvent</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680110019"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680110019"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110019"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110018"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110019"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680110018"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110019"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-425"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110018"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680110019"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-426"></span><span id="findNewEvent"><span class="annot"><span class="annottext">findNewEvent :: Point 2 r
-&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Maybe (Event p r)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var hs-var">findNewEvent</span></a></span></span><span> </span><span id="local-6989586621680109645"><span class="annot"><span class="annottext">p :: Point 2 r
</span><a href="#local-6989586621680109645"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680109644"><span class="annot"><span class="annottext">l :: LineSegment 2 p r
</span><a href="#local-6989586621680109644"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680109643"><span class="annot"><span class="annottext">r :: LineSegment 2 p r
</span><a href="#local-6989586621680109643"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoRec
  Identity '[NoIntersection, Point 2 r, LineSegment 2 (Either p p) r]
-&gt; Handlers
     '[NoIntersection, Point 2 r, LineSegment 2 (Either p p) r]
     (Maybe (Event p r))
-&gt; Maybe (Event p r)
forall (ts :: [*]) b. CoRec Identity ts -&gt; Handlers ts b -&gt; b
</span><span class="hs-identifier hs-var">match</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109644"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
-&gt; LineSegment 2 p r
-&gt; Intersection (LineSegment 2 p r) (LineSegment 2 p r)
forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680109643"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handlers
   '[NoIntersection, Point 2 r, LineSegment 2 (Either p p) r]
   (Maybe (Event p r))
 -&gt; Maybe (Event p r))
-&gt; Handlers
     '[NoIntersection, Point 2 r, LineSegment 2 (Either p p) r]
     (Maybe (Event p r))
-&gt; Maybe (Event p r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-427"></span><span>     </span><span class="annot"><span class="annottext">(NoIntersection -&gt; Maybe (Event p r))
-&gt; Handler (Maybe (Event p r)) NoIntersection
forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Event p r) -&gt; NoIntersection -&gt; Maybe (Event p r)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NoIntersection</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><span class="annottext">Handler (Maybe (Event p r)) NoIntersection
-&gt; Rec
     (Handler (Maybe (Event p r)))
     '[Point 2 r, LineSegment 2 (Either p p) r]
-&gt; Handlers
     '[NoIntersection, Point 2 r, LineSegment 2 (Either p p) r]
     (Maybe (Event p r))
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Maybe (Event p r))
-&gt; Handler (Maybe (Event p r)) (Point 2 r)
forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680109637"><span class="annot"><span class="annottext">q :: Point 2 r
</span><a href="#local-6989586621680109637"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Point 2 r -&gt; Ordering
forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109637"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109645"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Event p r -&gt; Maybe (Event p r)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
forall p r. Point 2 r -&gt; EventType (LineSegment 2 p r) -&gt; Event p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680109637"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r)
forall s. EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><span class="annottext">Handler (Maybe (Event p r)) (Point 2 r)
-&gt; Rec
     (Handler (Maybe (Event p r))) '[LineSegment 2 (Either p p) r]
-&gt; Rec
     (Handler (Maybe (Event p r)))
     '[Point 2 r, LineSegment 2 (Either p p) r]
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">(LineSegment 2 (Either p p) r -&gt; Maybe (Event p r))
-&gt; Handler (Maybe (Event p r)) (LineSegment 2 (Either p p) r)
forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Event p r)
-&gt; LineSegment 2 (Either p p) r -&gt; Maybe (Event p r)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Event p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- full segment intersectsions are handled</span><span>
</span><span id="line-431"></span><span>                       </span><span class="hs-comment">-- at insertion time</span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><span class="annottext">Handler (Maybe (Event p r)) (LineSegment 2 (Either p p) r)
-&gt; Rec (Handler (Maybe (Event p r))) '[]
-&gt; Rec
     (Handler (Maybe (Event p r))) '[LineSegment 2 (Either p p) r]
forall u (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">Rec (Handler (Maybe (Event p r))) '[]
forall u (a :: u -&gt; *). Rec a '[]
</span><span class="hs-identifier hs-var">RNil</span></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-keyword">type</span><span> </span><span id="R"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#R"><span class="hs-identifier hs-var">R</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg1"><span class="hs-identifier hs-type">seg1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg2"><span class="hs-identifier hs-type">seg2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#R"><span class="hs-identifier hs-type">R</span></a></span><span>
</span><span id="line-439"></span><span id="seg1"><span class="annot"><span class="annottext">seg1 :: LineSegment 2 () R
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg1"><span class="hs-identifier hs-var hs-var">seg1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 R :+ ()) -&gt; (Point 2 R :+ ()) -&gt; LineSegment 2 () R
forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Data.Geometry.LineSegment.Internal.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 R -&gt; Point 2 R :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 R -&gt; Point 2 R :+ ()) -&gt; Point 2 R -&gt; Point 2 R :+ ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 R -&gt; Point 2 R :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 R -&gt; Point 2 R :+ ()) -&gt; Point 2 R -&gt; Point 2 R :+ ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span id="seg2"><span class="annot"><span class="annottext">seg2 :: LineSegment 2 () R
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg2"><span class="hs-identifier hs-var hs-var">seg2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 R :+ ()) -&gt; (Point 2 R :+ ()) -&gt; LineSegment 2 () R
forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Data.Geometry.LineSegment.Internal.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 R -&gt; Point 2 R :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 R -&gt; Point 2 R :+ ()) -&gt; Point 2 R -&gt; Point 2 R :+ ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 R -&gt; Point 2 R :+ ()
forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 R -&gt; Point 2 R :+ ()) -&gt; Point 2 R -&gt; Point 2 R :+ ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">R -&gt; R -&gt; Point 2 R
forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Data.Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">5</span></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span></pre></body></html>