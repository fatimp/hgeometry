<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- Language/Haskell/TH/Desugar/Reify.hs

(c) Richard Eisenberg 2014
rae@cs.brynmawr.edu

Allows for reification from a list of declarations, without looking a name
up in the environment.
-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE CPP, GeneralizedNewtypeDeriving, ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Desugar.Reify</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Reification</span></span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals_maybe"><span class="hs-identifier">reifyWithLocals_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals"><span class="hs-identifier">reifyWithLocals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithWarning"><span class="hs-identifier">reifyWithWarning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDecs"><span class="hs-identifier">reifyInDecs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Fixity reification</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><span class="hs-identifier">qReifyFixity</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reifyFixity</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityWithLocals"><span class="hs-identifier">reifyFixityWithLocals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityInDecs"><span class="hs-identifier">reifyFixityInDecs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Type reification</span></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="hs-identifier">qReifyType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reifyType</span></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals_maybe"><span class="hs-identifier">reifyTypeWithLocals_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals"><span class="hs-identifier">reifyTypeWithLocals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeInDecs"><span class="hs-identifier">reifyTypeInDecs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Datatype lookup</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#getDataD"><span class="hs-identifier">getDataD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToCon"><span class="hs-identifier">dataConNameToCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToDataName"><span class="hs-identifier">dataConNameToDataName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Value and type lookup</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#lookupValueNameWithLocals"><span class="hs-identifier">lookupValueNameWithLocals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#lookupTypeNameWithLocals"><span class="hs-identifier">lookupTypeNameWithLocals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkDataNameWithLocals"><span class="hs-identifier">mkDataNameWithLocals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkTypeNameWithLocals"><span class="hs-identifier">mkTypeNameWithLocals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyNameSpace"><span class="hs-identifier">reifyNameSpace</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Monad support</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier">DsMonad</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier">DsM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#withLocalDeclarations"><span class="hs-identifier">withLocalDeclarations</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fail</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fail</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.RWS</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Instances</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 710
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">foldMap</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Datatype.TyVarBndr</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Instances</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html"><span class="hs-identifier">Language.Haskell.TH.Desugar.Util</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- | Like @reify@ from Template Haskell, but looks also in any not-yet-typechecked</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- declarations. To establish this list of not-yet-typechecked declarations,</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- use 'withLocalDeclarations'. Returns 'Nothing' if reification fails.</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- Note that no inferred type information is available from local declarations;</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- bottoms may be used if necessary.</span><span>
</span><span id="line-66"></span><span id="local-6989586621679508896"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals_maybe"><span class="hs-identifier hs-type">reifyWithLocals_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508896"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508896"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-67"></span><span id="reifyWithLocals_maybe"><span class="annot"><span class="annottext">reifyWithLocals_maybe :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals_maybe"><span class="hs-identifier hs-var hs-var">reifyWithLocals_maybe</span></a></span></span><span> </span><span id="local-6989586621679508479"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508479"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Quasi m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">qRecover</span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Maybe Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDecs"><span class="hs-identifier hs-var">reifyInDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508479"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Info
</span><span class="hs-identifier hs-var">qReify</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508479"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | Like 'reifyWithLocals_maybe', but throws an exception upon failure,</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- warning the user about separating splices.</span><span>
</span><span id="line-73"></span><span id="local-6989586621679508874"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals"><span class="hs-identifier hs-type">reifyWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508874"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508874"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span></span><span>
</span><span id="line-74"></span><span id="reifyWithLocals"><span class="annot"><span class="annottext">reifyWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals"><span class="hs-identifier hs-var hs-var">reifyWithLocals</span></a></span></span><span> </span><span id="local-6989586621679508466"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508466"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>  </span><span id="local-6989586621679508465"><span class="annot"><span class="annottext">Maybe Info
</span><a href="#local-6989586621679508465"><span class="hs-identifier hs-var">m_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals_maybe"><span class="hs-identifier hs-var">reifyWithLocals_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508466"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Info
</span><a href="#local-6989586621679508465"><span class="hs-identifier hs-var">m_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">Maybe Info
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; Name -&gt; m a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFail"><span class="hs-identifier hs-var">reifyFail</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508466"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679508463"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679508463"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679508463"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- | Reify a declaration, warning the user about splices if the reify fails.</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- The warning says that reification can fail if you try to reify a type in</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- the same splice as it is declared.</span><span>
</span><span id="line-83"></span><span id="local-6989586621679508870"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithWarning"><span class="hs-identifier hs-type">reifyWithWarning</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621679508870"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fail.MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679508870"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508870"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span></span><span>
</span><span id="line-84"></span><span id="reifyWithWarning"><span class="annot"><span class="annottext">reifyWithWarning :: forall (q :: * -&gt; *). (Quasi q, MonadFail q) =&gt; Name -&gt; q Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithWarning"><span class="hs-identifier hs-var hs-var">reifyWithWarning</span></a></span></span><span> </span><span id="local-6989586621679508457"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508457"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Quasi m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">qRecover</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; Name -&gt; m a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFail"><span class="hs-identifier hs-var">reifyFail</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508457"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Info
</span><span class="hs-identifier hs-var">qReify</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508457"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Print out a warning about separating splices and fail.</span><span>
</span><span id="line-87"></span><span id="local-6989586621679508871"><span id="local-6989586621679508872"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFail"><span class="hs-identifier hs-type">reifyFail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fail.MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679508872"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508872"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508871"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-88"></span><span id="reifyFail"><span class="annot"><span class="annottext">reifyFail :: forall (m :: * -&gt; *) a. MonadFail m =&gt; Name -&gt; m a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFail"><span class="hs-identifier hs-var hs-var">reifyFail</span></a></span></span><span> </span><span id="local-6989586621679508453"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508453"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">Fail.fail</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Looking up &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508453"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in the list of available &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-90"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;declarations failed.\nThis lookup fails if the declaration &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-91"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;referenced was made in the same Template\nHaskell splice as the use &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-92"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;of the declaration. If this is the case, put\nthe reference to &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-93"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;the declaration in a new splice.&quot;</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- Utilities</span><span>
</span><span id="line-97"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Extract the @TyVarBndr@s and constructors given the @Name@ of a type</span><span>
</span><span id="line-100"></span><span id="local-6989586621679508860"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#getDataD"><span class="hs-identifier hs-type">getDataD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508860"><span class="hs-identifier hs-type">q</span></a></span><span>
</span><span id="line-101"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>       </span><span class="hs-comment">-- ^ Print this out on failure</span><span>
</span><span id="line-102"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>         </span><span class="hs-comment">-- ^ Name of the datatype (@data@ or @newtype@) of interest</span><span>
</span><span id="line-103"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508860"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-104"></span><span id="getDataD"><span class="annot"><span class="annottext">getDataD :: forall (q :: * -&gt; *).
DsMonad q =&gt;
String -&gt; Name -&gt; q ([TyVarBndrUnit], [Con])
</span><a href="Language.Haskell.TH.Desugar.Reify.html#getDataD"><span class="hs-identifier hs-var hs-var">getDataD</span></a></span></span><span> </span><span id="local-6989586621679508441"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679508441"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679508440"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508440"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679508439"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679508439"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals"><span class="hs-identifier hs-var">reifyWithLocals</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508440"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679508438"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679508438"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679508439"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">TyConI</span></span><span> </span><span id="local-6989586621679508436"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679508436"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679508436"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-108"></span><span>           </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a}. q a
</span><a href="#local-6989586621679508435"><span class="hs-identifier hs-var">badDeclaration</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679508438"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="annot"><span class="hs-identifier hs-type">DataD</span></span><span> </span><span id="local-6989586621679508433"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679508433"><span class="hs-identifier hs-var">_cxt</span></a></span></span><span> </span><span id="local-6989586621679508432"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508432"><span class="hs-identifier hs-var">_name</span></a></span></span><span> </span><span id="local-6989586621679508431"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508431"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679508430"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679508430"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679508429"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679508429"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621679508428"><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679508428"><span class="hs-identifier hs-var">_derivings</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {b}.
Quasi m =&gt;
[TyVarBndrUnit] -&gt; Maybe Kind -&gt; b -&gt; m ([TyVarBndrUnit], b)
</span><a href="#local-6989586621679508427"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508431"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679508430"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679508429"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">NewtypeD</span></span><span> </span><span id="local-6989586621679508425"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679508425"><span class="hs-identifier hs-var">_cxt</span></a></span></span><span> </span><span id="local-6989586621679508424"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508424"><span class="hs-identifier hs-var">_name</span></a></span></span><span> </span><span id="local-6989586621679508423"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508423"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679508422"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679508422"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679508421"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679508421"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621679508420"><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679508420"><span class="hs-identifier hs-var">_derivings</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {b}.
Quasi m =&gt;
[TyVarBndrUnit] -&gt; Maybe Kind -&gt; b -&gt; m ([TyVarBndrUnit], b)
</span><a href="#local-6989586621679508427"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508423"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679508422"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679508421"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">_cxt</span><span> </span><span class="hs-identifier">_name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_derivings</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">cons</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_cxt</span><span> </span><span class="hs-identifier">_name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">_derivings</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">con</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a}. q a
</span><a href="#local-6989586621679508435"><span class="hs-identifier hs-var">badDeclaration</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679508427"><span class="annot"><span class="annottext">go :: [TyVarBndrUnit] -&gt; Maybe Kind -&gt; b -&gt; m ([TyVarBndrUnit], b)
</span><a href="#local-6989586621679508427"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679508411"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508411"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679508410"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679508410"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679508409"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679508409"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679508408"><span class="annot"><span class="annottext">k :: Kind
</span><a href="#local-6989586621679508408"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Language.Haskell.TH.Desugar.Util.html#typeKindName"><span class="hs-identifier hs-var">typeKindName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679508410"><span class="hs-identifier hs-var">mk</span></a></span><span>
</span><span id="line-121"></span><span>      </span><span id="local-6989586621679508404"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508404"><span class="hs-identifier hs-var">extra_tvbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). Quasi q =&gt; Kind -&gt; q [TyVarBndrUnit]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkExtraKindBinders"><span class="hs-identifier hs-var">mkExtraKindBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508408"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679508402"><span class="annot"><span class="annottext">all_tvbs :: [TyVarBndrUnit]
</span><a href="#local-6989586621679508402"><span class="hs-identifier hs-var hs-var">all_tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508411"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508404"><span class="hs-identifier hs-var">extra_tvbs</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679508402"><span class="hs-identifier hs-var">all_tvbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679508409"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679508435"><span class="annot"><span class="annottext">badDeclaration :: q a
</span><a href="#local-6989586621679508435"><span class="hs-identifier hs-var hs-var">badDeclaration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name (&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508440"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) refers to something &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-127"></span><span>                 </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;other than a datatype. &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679508441"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Create new kind variable binder names corresponding to the return kind of</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- a data type. This is useful when you have a data type like:</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- data Foo :: forall k. k -&gt; Type -&gt; Type where ...</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- But you want to be able to refer to the type @Foo a b@.</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- 'mkExtraKindBinders' will take the kind @forall k. k -&gt; Type -&gt; Type@,</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- discover that is has two visible argument kinds, and return as a result</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- two new kind variable binders @[a :: k, b :: Type]@, where @a@ and @b@</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- are fresh type variable names.</span><span>
</span><span id="line-141"></span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- This expands kind synonyms if necessary.</span><span>
</span><span id="line-143"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkExtraKindBinders"><span class="hs-identifier hs-type">mkExtraKindBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679508851"><span class="annot"><a href="#local-6989586621679508851"><span class="hs-identifier hs-type">q</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621679508851"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508851"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span>
</span><span id="line-144"></span><span id="mkExtraKindBinders"><span class="annot"><span class="annottext">mkExtraKindBinders :: forall (q :: * -&gt; *). Quasi q =&gt; Kind -&gt; q [TyVarBndrUnit]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkExtraKindBinders"><span class="hs-identifier hs-var hs-var">mkExtraKindBinders</span></a></span></span><span> </span><span id="local-6989586621679508384"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508384"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621679508383"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508383"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Quasi m =&gt; Q a -&gt; m a
</span><span class="hs-identifier hs-var">runQ</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Q Kind
</span><span class="hs-identifier hs-var">resolveTypeSynonyms</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508384"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679508380"><span class="annot"><span class="annottext">FunArgs
</span><a href="#local-6989586621679508380"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; (FunArgs, Kind)
</span><a href="Language.Haskell.TH.Desugar.Util.html#unravelType"><span class="hs-identifier hs-var">unravelType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508383"><span class="hs-identifier hs-var">k'</span></a></span><span>
</span><span id="line-147"></span><span>      </span><span id="local-6989586621679508378"><span class="annot"><span class="annottext">vis_fun_args :: [VisFunArg]
</span><a href="#local-6989586621679508378"><span class="hs-identifier hs-var hs-var">vis_fun_args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunArgs -&gt; [VisFunArg]
</span><a href="Language.Haskell.TH.Desugar.Util.html#filterVisFunArgs"><span class="hs-identifier hs-var">filterVisFunArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunArgs
</span><a href="#local-6989586621679508380"><span class="hs-identifier hs-var">fun_args</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">VisFunArg -&gt; q TyVarBndrUnit
</span><a href="#local-6989586621679508375"><span class="hs-identifier hs-var">mk_tvb</span></a></span><span> </span><span class="annot"><span class="annottext">[VisFunArg]
</span><a href="#local-6989586621679508378"><span class="hs-identifier hs-var">vis_fun_args</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="#local-6989586621679508375"><span class="hs-identifier hs-type">mk_tvb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#VisFunArg"><span class="hs-identifier hs-type">VisFunArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508851"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679508375"><span class="annot"><span class="annottext">mk_tvb :: VisFunArg -&gt; q TyVarBndrUnit
</span><a href="#local-6989586621679508375"><span class="hs-identifier hs-var hs-var">mk_tvb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#VisFADep"><span class="hs-identifier hs-type">VisFADep</span></a></span><span> </span><span id="local-6989586621679508373"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679508373"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679508373"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="#local-6989586621679508375"><span class="hs-identifier hs-var">mk_tvb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#VisFAAnon"><span class="hs-identifier hs-type">VisFAAnon</span></a></span><span> </span><span id="local-6989586621679508371"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508371"><span class="hs-identifier hs-var">ki</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; TyVarBndrUnit
</span><span class="hs-identifier hs-var">kindedTV</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">qNewName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508371"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | From the name of a data constructor, retrive the datatype definition it</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- is a part of.</span><span>
</span><span id="line-156"></span><span id="local-6989586621679508836"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToDataName"><span class="hs-identifier hs-type">dataConNameToDataName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508836"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508836"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span><span>
</span><span id="line-157"></span><span id="dataConNameToDataName"><span class="annot"><span class="annottext">dataConNameToDataName :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Name
</span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToDataName"><span class="hs-identifier hs-var hs-var">dataConNameToDataName</span></a></span></span><span> </span><span id="local-6989586621679508359"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508359"><span class="hs-identifier hs-var">con_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679508358"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679508358"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals"><span class="hs-identifier hs-var">reifyWithLocals</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508359"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679508358"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="annot"><span class="hs-identifier hs-type">DataConI</span></span><span> </span><span id="local-6989586621679508356"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508356"><span class="hs-identifier hs-var">_name</span></a></span></span><span> </span><span id="local-6989586621679508355"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679508355"><span class="hs-identifier hs-var">_type</span></a></span></span><span> </span><span id="local-6989586621679508354"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508354"><span class="hs-identifier hs-var">parent_name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508354"><span class="hs-identifier hs-var">parent_name</span></a></span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">DataConI</span><span> </span><span class="hs-identifier">_name</span><span> </span><span class="hs-identifier">_type</span><span> </span><span class="hs-identifier">parent_name</span><span> </span><span class="hs-identifier">_fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">parent_name</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508359"><span class="hs-identifier hs-var">con_name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; does not appear to be &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-166"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a data constructor.&quot;</span></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | From the name of a data constructor, retrieve its definition as a @Con@</span><span>
</span><span id="line-169"></span><span id="local-6989586621679508834"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToCon"><span class="hs-identifier hs-type">dataConNameToCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508834"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508834"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span></span><span>
</span><span id="line-170"></span><span id="dataConNameToCon"><span class="annot"><span class="annottext">dataConNameToCon :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Con
</span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToCon"><span class="hs-identifier hs-var hs-var">dataConNameToCon</span></a></span></span><span> </span><span id="local-6989586621679508344"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508344"><span class="hs-identifier hs-var">con_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-comment">-- we need to get the field ordering from the constructor. We must reify</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-comment">-- the constructor to get the tycon, and then reify the tycon to get the `Con`s</span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679508343"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508343"><span class="hs-identifier hs-var">type_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Name
</span><a href="Language.Haskell.TH.Desugar.Reify.html#dataConNameToDataName"><span class="hs-identifier hs-var">dataConNameToDataName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508344"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508342"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679508342"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *).
DsMonad q =&gt;
String -&gt; Name -&gt; q ([TyVarBndrUnit], [Con])
</span><a href="Language.Haskell.TH.Desugar.Reify.html#getDataD"><span class="hs-identifier hs-var">getDataD</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This seems to be an error in GHC.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508343"><span class="hs-identifier hs-var">type_name</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679508338"><span class="annot"><span class="annottext">m_con :: Maybe Con
</span><a href="#local-6989586621679508338"><span class="hs-identifier hs-var hs-var">m_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508344"><span class="hs-identifier hs-var">con_name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Con -&gt; [Name]
</span><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679508342"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Con
</span><a href="#local-6989586621679508338"><span class="hs-identifier hs-var">m_con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679508334"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679508334"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679508334"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">Maybe Con
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *) a. MonadFail q =&gt; String -&gt; q a
</span><a href="Language.Haskell.TH.Desugar.Util.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Datatype does not contain one of its own constructors.&quot;</span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679508335"><span class="annot"><span class="annottext">get_con_name :: Con -&gt; [Name]
</span><a href="#local-6989586621679508335"><span class="hs-identifier hs-var hs-var">get_con_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NormalC</span></span><span> </span><span id="local-6989586621679508331"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508331"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">[BangType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508331"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecC</span></span><span> </span><span id="local-6989586621679508329"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508329"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508329"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InfixC</span></span><span> </span><span class="annot"><span class="annottext">BangType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679508327"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508327"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">BangType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679508327"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForallC</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679508325"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679508325"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Con -&gt; [Name]
</span><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679508325"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="annot"><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GadtC</span></span><span> </span><span id="local-6989586621679508323"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679508323"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="annottext">[BangType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679508323"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679508335"><span class="hs-identifier hs-var">get_con_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecGadtC</span></span><span> </span><span id="local-6989586621679508321"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679508321"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679508321"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-190"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- DsMonad</span><span>
</span><span id="line-192"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | A 'DsMonad' stores some list of declarations that should be considered</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- in scope. 'DsM' is the prototypical inhabitant of 'DsMonad'.</span><span>
</span><span id="line-196"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621679508888"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fail.MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679508888"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="DsMonad"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-var">DsMonad</span></a></span></span><span> </span><span id="local-6989586621679508888"><span class="annot"><a href="#local-6989586621679508888"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-comment">-- | Produce a list of local declarations.</span><span>
</span><span id="line-198"></span><span>  </span><span id="localDeclarations"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-type">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679508888"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621679508309"><span class="annot"><span class="annottext">localDeclarations :: Q [Dec]
</span><a href="#local-6989586621679508309"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621679508298"><span class="annot"><span class="annottext">localDeclarations :: IO [Dec]
</span><a href="#local-6989586621679508298"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | A convenient implementation of the 'DsMonad' class. Use by calling</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- 'withLocalDeclarations'.</span><span>
</span><span id="line-207"></span><span class="hs-keyword">newtype</span><span> </span><span id="DsM"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier hs-var">DsM</span></a></span></span><span> </span><span id="local-6989586621679508812"><span class="annot"><a href="#local-6989586621679508812"><span class="hs-identifier hs-type">q</span></a></span></span><span> </span><span id="local-6989586621679508731"><span class="annot"><a href="#local-6989586621679508731"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DsM"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier hs-var">DsM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679508812"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508731"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679508289"><span id="local-6989586621679508294"><span class="annot"><span class="annottext">forall a b. a -&gt; DsM q b -&gt; DsM q a
forall a b. (a -&gt; b) -&gt; DsM q a -&gt; DsM q b
forall (q :: * -&gt; *) a b. Functor q =&gt; a -&gt; DsM q b -&gt; DsM q a
forall (q :: * -&gt; *) a b.
Functor q =&gt;
(a -&gt; b) -&gt; DsM q a -&gt; DsM q b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: forall a b. a -&gt; DsM q b -&gt; DsM q a
$c&lt;$ :: forall (q :: * -&gt; *) a b. Functor q =&gt; a -&gt; DsM q b -&gt; DsM q a
fmap :: forall a b. (a -&gt; b) -&gt; DsM q a -&gt; DsM q b
$cfmap :: forall (q :: * -&gt; *) a b.
Functor q =&gt;
(a -&gt; b) -&gt; DsM q a -&gt; DsM q b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508262"><span id="local-6989586621679508266"><span id="local-6989586621679508270"><span id="local-6989586621679508274"><span id="local-6989586621679508279"><span class="annot"><span class="annottext">forall a. a -&gt; DsM q a
forall a b. DsM q a -&gt; DsM q b -&gt; DsM q a
forall a b. DsM q a -&gt; DsM q b -&gt; DsM q b
forall a b. DsM q (a -&gt; b) -&gt; DsM q a -&gt; DsM q b
forall a b c. (a -&gt; b -&gt; c) -&gt; DsM q a -&gt; DsM q b -&gt; DsM q c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall {q :: * -&gt; *}. Applicative q =&gt; Functor (DsM q)
forall (q :: * -&gt; *) a. Applicative q =&gt; a -&gt; DsM q a
forall (q :: * -&gt; *) a b.
Applicative q =&gt;
DsM q a -&gt; DsM q b -&gt; DsM q a
forall (q :: * -&gt; *) a b.
Applicative q =&gt;
DsM q a -&gt; DsM q b -&gt; DsM q b
forall (q :: * -&gt; *) a b.
Applicative q =&gt;
DsM q (a -&gt; b) -&gt; DsM q a -&gt; DsM q b
forall (q :: * -&gt; *) a b c.
Applicative q =&gt;
(a -&gt; b -&gt; c) -&gt; DsM q a -&gt; DsM q b -&gt; DsM q c
&lt;* :: forall a b. DsM q a -&gt; DsM q b -&gt; DsM q a
$c&lt;* :: forall (q :: * -&gt; *) a b.
Applicative q =&gt;
DsM q a -&gt; DsM q b -&gt; DsM q a
*&gt; :: forall a b. DsM q a -&gt; DsM q b -&gt; DsM q b
$c*&gt; :: forall (q :: * -&gt; *) a b.
Applicative q =&gt;
DsM q a -&gt; DsM q b -&gt; DsM q b
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; DsM q a -&gt; DsM q b -&gt; DsM q c
$cliftA2 :: forall (q :: * -&gt; *) a b c.
Applicative q =&gt;
(a -&gt; b -&gt; c) -&gt; DsM q a -&gt; DsM q b -&gt; DsM q c
&lt;*&gt; :: forall a b. DsM q (a -&gt; b) -&gt; DsM q a -&gt; DsM q b
$c&lt;*&gt; :: forall (q :: * -&gt; *) a b.
Applicative q =&gt;
DsM q (a -&gt; b) -&gt; DsM q a -&gt; DsM q b
pure :: forall a. a -&gt; DsM q a
$cpure :: forall (q :: * -&gt; *) a. Applicative q =&gt; a -&gt; DsM q a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508243"><span id="local-6989586621679508247"><span id="local-6989586621679508252"><span class="annot"><span class="annottext">forall a. a -&gt; DsM q a
forall a b. DsM q a -&gt; DsM q b -&gt; DsM q b
forall a b. DsM q a -&gt; (a -&gt; DsM q b) -&gt; DsM q b
forall {q :: * -&gt; *}. Monad q =&gt; Applicative (DsM q)
forall (q :: * -&gt; *) a. Monad q =&gt; a -&gt; DsM q a
forall (q :: * -&gt; *) a b. Monad q =&gt; DsM q a -&gt; DsM q b -&gt; DsM q b
forall (q :: * -&gt; *) a b.
Monad q =&gt;
DsM q a -&gt; (a -&gt; DsM q b) -&gt; DsM q b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: forall a. a -&gt; DsM q a
$creturn :: forall (q :: * -&gt; *) a. Monad q =&gt; a -&gt; DsM q a
&gt;&gt; :: forall a b. DsM q a -&gt; DsM q b -&gt; DsM q b
$c&gt;&gt; :: forall (q :: * -&gt; *) a b. Monad q =&gt; DsM q a -&gt; DsM q b -&gt; DsM q b
&gt;&gt;= :: forall a b. DsM q a -&gt; (a -&gt; DsM q b) -&gt; DsM q b
$c&gt;&gt;= :: forall (q :: * -&gt; *) a b.
Monad q =&gt;
DsM q a -&gt; (a -&gt; DsM q b) -&gt; DsM q b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508235"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; DsM m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *).
(forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a) -&gt; MonadTrans t
lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; DsM m a
$clift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; DsM m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">MonadTrans</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508104"><span id="local-6989586621679508108"><span id="local-6989586621679508112"><span id="local-6989586621679508116"><span id="local-6989586621679508122"><span id="local-6989586621679508130"><span id="local-6989586621679508136"><span id="local-6989586621679508140"><span id="local-6989586621679508144"><span id="local-6989586621679508148"><span id="local-6989586621679508152"><span id="local-6989586621679508156"><span id="local-6989586621679508160"><span id="local-6989586621679508164"><span id="local-6989586621679508168"><span id="local-6989586621679508172"><span id="local-6989586621679508178"><span id="local-6989586621679508184"><span id="local-6989586621679508188"><span id="local-6989586621679508192"><span id="local-6989586621679508196"><span id="local-6989586621679508200"><span id="local-6989586621679508204"><span id="local-6989586621679508208"><span id="local-6989586621679508212"><span id="local-6989586621679508217"><span class="annot"><span class="annottext">DsM q [Extension]
DsM q Loc
Bool -&gt; String -&gt; DsM q (Maybe Name)
Bool -&gt; String -&gt; DsM q ()
String -&gt; DsM q String
String -&gt; DsM q Name
String -&gt; DsM q ()
[Dec] -&gt; DsM q ()
Q () -&gt; DsM q ()
Name -&gt; DsM q [Role]
Name -&gt; DsM q [DecidedStrictness]
Name -&gt; DsM q (Maybe Fixity)
Name -&gt; DsM q Kind
Name -&gt; DsM q Info
Name -&gt; Cxt -&gt; DsM q [Dec]
Extension -&gt; DsM q Bool
ForeignSrcLang -&gt; String -&gt; DsM q ()
Module -&gt; DsM q ModuleInfo
DocLoc -&gt; DsM q (Maybe String)
DocLoc -&gt; String -&gt; DsM q ()
forall a. Data a =&gt; AnnLookup -&gt; DsM q [a]
forall a. Typeable a =&gt; DsM q (Maybe a)
forall a. Typeable a =&gt; a -&gt; DsM q ()
forall a. IO a -&gt; DsM q a
forall a. DsM q a -&gt; DsM q a -&gt; DsM q a
forall (m :: * -&gt; *).
MonadIO m
-&gt; MonadFail m
-&gt; (String -&gt; m Name)
-&gt; (Bool -&gt; String -&gt; m ())
-&gt; (forall a. m a -&gt; m a -&gt; m a)
-&gt; (Bool -&gt; String -&gt; m (Maybe Name))
-&gt; (Name -&gt; m Info)
-&gt; (Name -&gt; m (Maybe Fixity))
-&gt; (Name -&gt; m Kind)
-&gt; (Name -&gt; Cxt -&gt; m [Dec])
-&gt; (Name -&gt; m [Role])
-&gt; (forall a. Data a =&gt; AnnLookup -&gt; m [a])
-&gt; (Module -&gt; m ModuleInfo)
-&gt; (Name -&gt; m [DecidedStrictness])
-&gt; m Loc
-&gt; (forall a. IO a -&gt; m a)
-&gt; (String -&gt; m ())
-&gt; (String -&gt; m String)
-&gt; ([Dec] -&gt; m ())
-&gt; (ForeignSrcLang -&gt; String -&gt; m ())
-&gt; (Q () -&gt; m ())
-&gt; (String -&gt; m ())
-&gt; (forall a. Typeable a =&gt; m (Maybe a))
-&gt; (forall a. Typeable a =&gt; a -&gt; m ())
-&gt; (Extension -&gt; m Bool)
-&gt; m [Extension]
-&gt; (DocLoc -&gt; String -&gt; m ())
-&gt; (DocLoc -&gt; m (Maybe String))
-&gt; Quasi m
forall {q :: * -&gt; *}. Quasi q =&gt; MonadFail (DsM q)
forall {q :: * -&gt; *}. Quasi q =&gt; MonadIO (DsM q)
forall (q :: * -&gt; *). Quasi q =&gt; DsM q [Extension]
forall (q :: * -&gt; *). Quasi q =&gt; DsM q Loc
forall (q :: * -&gt; *).
Quasi q =&gt;
Bool -&gt; String -&gt; DsM q (Maybe Name)
forall (q :: * -&gt; *). Quasi q =&gt; Bool -&gt; String -&gt; DsM q ()
forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q String
forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q Name
forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q ()
forall (q :: * -&gt; *). Quasi q =&gt; [Dec] -&gt; DsM q ()
forall (q :: * -&gt; *). Quasi q =&gt; Q () -&gt; DsM q ()
forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q [Role]
forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q [DecidedStrictness]
forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q (Maybe Fixity)
forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q Kind
forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q Info
forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; Cxt -&gt; DsM q [Dec]
forall (q :: * -&gt; *). Quasi q =&gt; Extension -&gt; DsM q Bool
forall (q :: * -&gt; *).
Quasi q =&gt;
ForeignSrcLang -&gt; String -&gt; DsM q ()
forall (q :: * -&gt; *). Quasi q =&gt; Module -&gt; DsM q ModuleInfo
forall (q :: * -&gt; *). Quasi q =&gt; DocLoc -&gt; DsM q (Maybe String)
forall (q :: * -&gt; *). Quasi q =&gt; DocLoc -&gt; String -&gt; DsM q ()
forall (q :: * -&gt; *) a. (Quasi q, Data a) =&gt; AnnLookup -&gt; DsM q [a]
forall (q :: * -&gt; *) a. (Quasi q, Typeable a) =&gt; DsM q (Maybe a)
forall (q :: * -&gt; *) a. (Quasi q, Typeable a) =&gt; a -&gt; DsM q ()
forall (q :: * -&gt; *) a. Quasi q =&gt; IO a -&gt; DsM q a
forall (q :: * -&gt; *) a. Quasi q =&gt; DsM q a -&gt; DsM q a -&gt; DsM q a
qGetDoc :: DocLoc -&gt; DsM q (Maybe String)
$cqGetDoc :: forall (q :: * -&gt; *). Quasi q =&gt; DocLoc -&gt; DsM q (Maybe String)
qPutDoc :: DocLoc -&gt; String -&gt; DsM q ()
$cqPutDoc :: forall (q :: * -&gt; *). Quasi q =&gt; DocLoc -&gt; String -&gt; DsM q ()
qExtsEnabled :: DsM q [Extension]
$cqExtsEnabled :: forall (q :: * -&gt; *). Quasi q =&gt; DsM q [Extension]
qIsExtEnabled :: Extension -&gt; DsM q Bool
$cqIsExtEnabled :: forall (q :: * -&gt; *). Quasi q =&gt; Extension -&gt; DsM q Bool
qPutQ :: forall a. Typeable a =&gt; a -&gt; DsM q ()
$cqPutQ :: forall (q :: * -&gt; *) a. (Quasi q, Typeable a) =&gt; a -&gt; DsM q ()
qGetQ :: forall a. Typeable a =&gt; DsM q (Maybe a)
$cqGetQ :: forall (q :: * -&gt; *) a. (Quasi q, Typeable a) =&gt; DsM q (Maybe a)
qAddCorePlugin :: String -&gt; DsM q ()
$cqAddCorePlugin :: forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q ()
qAddModFinalizer :: Q () -&gt; DsM q ()
$cqAddModFinalizer :: forall (q :: * -&gt; *). Quasi q =&gt; Q () -&gt; DsM q ()
qAddForeignFilePath :: ForeignSrcLang -&gt; String -&gt; DsM q ()
$cqAddForeignFilePath :: forall (q :: * -&gt; *).
Quasi q =&gt;
ForeignSrcLang -&gt; String -&gt; DsM q ()
qAddTopDecls :: [Dec] -&gt; DsM q ()
$cqAddTopDecls :: forall (q :: * -&gt; *). Quasi q =&gt; [Dec] -&gt; DsM q ()
qAddTempFile :: String -&gt; DsM q String
$cqAddTempFile :: forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q String
qAddDependentFile :: String -&gt; DsM q ()
$cqAddDependentFile :: forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q ()
qRunIO :: forall a. IO a -&gt; DsM q a
$cqRunIO :: forall (q :: * -&gt; *) a. Quasi q =&gt; IO a -&gt; DsM q a
qLocation :: DsM q Loc
$cqLocation :: forall (q :: * -&gt; *). Quasi q =&gt; DsM q Loc
qReifyConStrictness :: Name -&gt; DsM q [DecidedStrictness]
$cqReifyConStrictness :: forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q [DecidedStrictness]
qReifyModule :: Module -&gt; DsM q ModuleInfo
$cqReifyModule :: forall (q :: * -&gt; *). Quasi q =&gt; Module -&gt; DsM q ModuleInfo
qReifyAnnotations :: forall a. Data a =&gt; AnnLookup -&gt; DsM q [a]
$cqReifyAnnotations :: forall (q :: * -&gt; *) a. (Quasi q, Data a) =&gt; AnnLookup -&gt; DsM q [a]
qReifyRoles :: Name -&gt; DsM q [Role]
$cqReifyRoles :: forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q [Role]
qReifyInstances :: Name -&gt; Cxt -&gt; DsM q [Dec]
$cqReifyInstances :: forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; Cxt -&gt; DsM q [Dec]
qReifyType :: Name -&gt; DsM q Kind
$cqReifyType :: forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q Kind
qReifyFixity :: Name -&gt; DsM q (Maybe Fixity)
$cqReifyFixity :: forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q (Maybe Fixity)
qReify :: Name -&gt; DsM q Info
$cqReify :: forall (q :: * -&gt; *). Quasi q =&gt; Name -&gt; DsM q Info
qLookupName :: Bool -&gt; String -&gt; DsM q (Maybe Name)
$cqLookupName :: forall (q :: * -&gt; *).
Quasi q =&gt;
Bool -&gt; String -&gt; DsM q (Maybe Name)
qRecover :: forall a. DsM q a -&gt; DsM q a -&gt; DsM q a
$cqRecover :: forall (q :: * -&gt; *) a. Quasi q =&gt; DsM q a -&gt; DsM q a -&gt; DsM q a
qReport :: Bool -&gt; String -&gt; DsM q ()
$cqReport :: forall (q :: * -&gt; *). Quasi q =&gt; Bool -&gt; String -&gt; DsM q ()
qNewName :: String -&gt; DsM q Name
$cqNewName :: forall (q :: * -&gt; *). Quasi q =&gt; String -&gt; DsM q Name
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Quasi</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508093"><span class="annot"><span class="annottext">forall a. String -&gt; DsM q a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. String -&gt; m a) -&gt; MonadFail m
forall {q :: * -&gt; *}. MonadFail q =&gt; Monad (DsM q)
forall (q :: * -&gt; *) a. MonadFail q =&gt; String -&gt; DsM q a
fail :: forall a. String -&gt; DsM q a
$cfail :: forall (q :: * -&gt; *) a. MonadFail q =&gt; String -&gt; DsM q a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">Fail.MonadFail</span></span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 803
</span><span>           </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679508083"><span class="annot"><span class="annottext">forall a. IO a -&gt; DsM q a
forall (m :: * -&gt; *).
Monad m -&gt; (forall a. IO a -&gt; m a) -&gt; MonadIO m
forall {q :: * -&gt; *}. MonadIO q =&gt; Monad (DsM q)
forall (q :: * -&gt; *) a. MonadIO q =&gt; IO a -&gt; DsM q a
liftIO :: forall a. IO a -&gt; DsM q a
$cliftIO :: forall (q :: * -&gt; *) a. MonadIO q =&gt; IO a -&gt; DsM q a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></span></span><span class="hs-cpp">
#endif
</span><span>           </span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679508735"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621679508735"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fail.MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679508735"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508735"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621679508066"><span class="annot"><span class="annottext">localDeclarations :: DsM q [Dec]
</span><a href="#local-6989586621679508066"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *) a. ReaderT [Dec] q a -&gt; DsM q a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier hs-var">DsM</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679508725"><span id="local-6989586621679508726"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508726"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="#local-6989586621679508725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508726"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621679508050"><span class="annot"><span class="annottext">localDeclarations :: ReaderT r m [Dec]
</span><a href="#local-6989586621679508050"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679508716"><span id="local-6989586621679508717"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508717"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679508716"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508717"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621679508031"><span class="annot"><span class="annottext">localDeclarations :: StateT s m [Dec]
</span><a href="#local-6989586621679508031"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679508706"><span id="local-6989586621679508707"><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508707"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679508706"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="annot"><a href="#local-6989586621679508706"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508707"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621679508012"><span class="annot"><span class="annottext">localDeclarations :: WriterT w m [Dec]
</span><a href="#local-6989586621679508012"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679508688"><span id="local-6989586621679508689"><span id="local-6989586621679508690"><span id="local-6989586621679508691"><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508691"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679508690"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RWST</span></span><span> </span><span class="annot"><a href="#local-6989586621679508689"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508690"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508688"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508691"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621679507993"><span class="annot"><span class="annottext">localDeclarations :: RWST r w s m [Dec]
</span><a href="#local-6989586621679507993"><span class="hs-identifier hs-var hs-var hs-var hs-var">localDeclarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- | Add a list of declarations to be considered when reifying local</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- declarations.</span><span>
</span><span id="line-231"></span><span id="local-6989586621679508683"><span id="local-6989586621679508684"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#withLocalDeclarations"><span class="hs-identifier hs-type">withLocalDeclarations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508684"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508684"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508683"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508684"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508683"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-232"></span><span id="withLocalDeclarations"><span class="annot"><span class="annottext">withLocalDeclarations :: forall (q :: * -&gt; *) a. DsMonad q =&gt; [Dec] -&gt; DsM q a -&gt; q a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#withLocalDeclarations"><span class="hs-identifier hs-var hs-var">withLocalDeclarations</span></a></span></span><span> </span><span id="local-6989586621679507987"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507987"><span class="hs-identifier hs-var">new_decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span id="local-6989586621679507986"><span class="annot"><span class="annottext">ReaderT [Dec] q a
</span><a href="#local-6989586621679507986"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621679507985"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507985"><span class="hs-identifier hs-var">orig_decs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT [Dec] q a
</span><a href="#local-6989586621679507986"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507985"><span class="hs-identifier hs-var">orig_decs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507987"><span class="hs-identifier hs-var">new_decs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- Reifying local declarations</span><span>
</span><span id="line-238"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | Look through a list of declarations and possibly return a relevant 'Info'</span><span>
</span><span id="line-241"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDecs"><span class="hs-identifier hs-type">reifyInDecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-242"></span><span id="reifyInDecs"><span class="annot"><span class="annottext">reifyInDecs :: Name -&gt; [Dec] -&gt; Maybe Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDecs"><span class="hs-identifier hs-var hs-var">reifyInDecs</span></a></span></span><span> </span><span id="local-6989586621679507983"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507983"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507982"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507982"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Dec -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507983"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507982"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507982"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Look through a list of declarations and possibly return a fixity.</span><span>
</span><span id="line-245"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityInDecs"><span class="hs-identifier hs-type">reifyFixityInDecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fixity</span></span><span>
</span><span id="line-246"></span><span id="reifyFixityInDecs"><span class="annot"><span class="annottext">reifyFixityInDecs :: Name -&gt; [Dec] -&gt; Maybe Fixity
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityInDecs"><span class="hs-identifier hs-var hs-var">reifyFixityInDecs</span></a></span></span><span> </span><span id="local-6989586621679507979"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507979"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe Fixity
</span><a href="#local-6989586621679507978"><span class="hs-identifier hs-var">match_fixity</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679507978"><span class="annot"><span class="annottext">match_fixity :: Dec -&gt; Maybe Fixity
</span><a href="#local-6989586621679507978"><span class="hs-identifier hs-var hs-var">match_fixity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InfixD</span></span><span> </span><span id="local-6989586621679507976"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621679507976"><span class="hs-identifier hs-var">fixity</span></a></span></span><span> </span><span id="local-6989586621679507975"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507975"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507979"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507975"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-249"></span><span>                                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621679507976"><span class="hs-identifier hs-var">fixity</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><a href="#local-6989586621679507978"><span class="hs-identifier hs-var">match_fixity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507972"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507972"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe Fixity
</span><a href="#local-6989586621679507978"><span class="hs-identifier hs-var">match_fixity</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507972"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><a href="#local-6989586621679507978"><span class="hs-identifier hs-var">match_fixity</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">-- | A reified thing along with the name of that thing.</span><span>
</span><span id="line-254"></span><span class="hs-keyword">type</span><span> </span><span id="Named"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-var">Named</span></a></span></span><span> </span><span id="local-6989586621679507971"><span class="annot"><a href="#local-6989586621679507971"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679507971"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-type">reifyInDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span id="reifyInDec"><span class="annot"><span class="annottext">reifyInDec :: Name -&gt; [Dec] -&gt; Dec -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var hs-var">reifyInDec</span></a></span></span><span> </span><span id="local-6989586621679507970"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507970"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507969"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507969"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FunD</span></span><span> </span><span id="local-6989586621679507967"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507967"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507970"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507967"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507967"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarI"><span class="hs-identifier hs-var">mkVarI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507970"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507969"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507965"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507965"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507964"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507964"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ValD</span></span><span> </span><span id="local-6989586621679507962"><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679507962"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="annottext">Body
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507961"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507961"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-identifier hs-var">nameMatches</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507965"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat -&gt; OSet Name
</span><a href="Language.Haskell.TH.Desugar.Util.html#extractBoundNamesPat"><span class="hs-identifier hs-var">extractBoundNamesPat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679507962"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507961"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarI"><span class="hs-identifier hs-var">mkVarI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507965"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507964"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507958"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507958"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621679507957"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507957"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataD</span></span><span>    </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507956"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507956"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507958"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507956"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507956"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><span class="hs-identifier hs-var">TyConI</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507957"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507955"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507955"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621679507954"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507954"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NewtypeD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507953"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507953"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Con
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507955"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507953"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507953"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><span class="hs-identifier hs-var">TyConI</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507954"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">dec</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TyConI</span><span> </span><span class="hs-identifier">dec</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">dec</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TyConI</span><span> </span><span class="hs-identifier">dec</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507952"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507952"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621679507951"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507951"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TySynD</span></span><span> </span><span id="local-6989586621679507949"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507949"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507952"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507949"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507949"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><span class="hs-identifier hs-var">TyConI</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507951"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507948"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507948"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507947"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507947"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span id="local-6989586621679507946"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507946"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507945"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507945"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507948"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507945"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507945"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><span class="hs-identifier hs-var">ClassI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Dec
</span><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassDecMethods"><span class="hs-identifier hs-var">quantifyClassDecMethods</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507946"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findInstances"><span class="hs-identifier hs-var">findInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507948"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507947"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507941"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507941"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507940"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507940"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ImportF</span></span><span> </span><span class="annot"><span class="annottext">Callconv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507937"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507937"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507936"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507936"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507941"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507937"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507937"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Kind -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarITy"><span class="hs-identifier hs-var">mkVarITy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507941"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507940"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507936"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507934"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507934"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507933"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507933"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForeignD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExportF</span></span><span> </span><span class="annot"><span class="annottext">Callconv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507931"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507931"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507930"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507930"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507934"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507931"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507931"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Kind -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarITy"><span class="hs-identifier hs-var">mkVarITy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507934"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507933"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507930"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507929"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507929"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507928"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507928"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span id="local-6989586621679507927"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507927"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenTypeFamilyD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeFamilyHead</span></span><span> </span><span id="local-6989586621679507924"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507924"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507924"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507924"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><span class="hs-identifier hs-var">FamilyI</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507927"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findInstances"><span class="hs-identifier hs-var">findInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507929"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507928"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507922"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507922"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507921"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507921"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span id="local-6989586621679507920"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507920"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataFamilyD</span></span><span> </span><span id="local-6989586621679507918"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507918"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507922"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507918"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507918"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><span class="hs-identifier hs-var">FamilyI</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507920"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findInstances"><span class="hs-identifier hs-var">findInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507922"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507921"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507917"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507917"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span>    </span><span id="local-6989586621679507916"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507916"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClosedTypeFamilyD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeFamilyHead</span></span><span> </span><span id="local-6989586621679507914"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507914"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TySynEqn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507917"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507914"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507914"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><span class="hs-identifier hs-var">FamilyI</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507916"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">dec</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">FamilyI</span><span> </span><span class="hs-identifier">dec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">findInstances</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">dec</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">ClosedTypeFamilyD</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">FamilyI</span><span> </span><span class="hs-identifier">dec</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507913"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507913"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507912"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507912"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PatSynD</span></span><span> </span><span id="local-6989586621679507910"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507910"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">PatSynArgs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PatSynDir
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507913"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507910"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507910"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkPatSynI"><span class="hs-identifier hs-var">mkPatSynI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507913"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507912"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507908"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507908"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507907"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507907"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507906"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507906"><span class="hs-identifier hs-var">ty_name</span></a></span></span><span> </span><span id="local-6989586621679507905"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507905"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507904"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507904"><span class="hs-identifier hs-var">_mk</span></a></span></span><span> </span><span id="local-6989586621679507903"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507903"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507902"><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507902"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Name -&gt; [TypeArg] -&gt; [Con] -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-var">maybeReifyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507908"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507907"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507906"><span class="hs-identifier hs-var">ty_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; TypeArg
</span><a href="Language.Haskell.TH.Desugar.Util.html#tvbToTANormalWithSig"><span class="hs-identifier hs-var">tvbToTANormalWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507905"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507903"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507902"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507899"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507899"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507898"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507898"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NewtypeD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507897"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507897"><span class="hs-identifier hs-var">ty_name</span></a></span></span><span> </span><span id="local-6989586621679507896"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507896"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507895"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507895"><span class="hs-identifier hs-var">_mk</span></a></span></span><span> </span><span id="local-6989586621679507894"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507894"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507893"><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507893"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Name -&gt; [TypeArg] -&gt; [Con] -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-var">maybeReifyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507899"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507898"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507897"><span class="hs-identifier hs-var">ty_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; TypeArg
</span><a href="Language.Haskell.TH.Desugar.Util.html#tvbToTANormalWithSig"><span class="hs-identifier hs-var">tvbToTANormalWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507896"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507894"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507893"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maybeReifyCon</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">tvbToTANormalWithSig</span><span> </span><span class="hs-identifier">tvbs</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">cons</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span>
</span><span id="line-304"></span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maybeReifyCon</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">tvbToTANormalWithSig</span><span> </span><span class="hs-identifier">tvbs</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">con</span><span class="hs-special">]</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt; 710
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507892"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507892"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507891"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507891"><span class="hs-identifier hs-var">_decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507890"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507890"><span class="hs-identifier hs-var">ty_name</span></a></span></span><span> </span><span id="local-6989586621679507889"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507889"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507888"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507888"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507887"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507887"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507886"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507886"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Maybe (Named Kind)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findType"><span class="hs-identifier hs-var">findType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507892"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507888"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507887"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Name -&gt; Info
</span><span class="hs-identifier hs-var">ClassOpI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507892"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndrUnit] -&gt; Bool -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassMethodType"><span class="hs-identifier hs-var">quantifyClassMethodType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507890"><span class="hs-identifier hs-var">ty_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507889"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507886"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507890"><span class="hs-identifier hs-var">ty_name</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClassD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">sub_decs</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">findType</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">sub_decs</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ClassOpI</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">quantifyClassMethodType</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">True</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                       </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromMaybe</span><span> </span><span class="hs-identifier">defaultFixity</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-317"></span><span>                                </span><span class="hs-identifier">reifyFixityInDecs</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">sub_decs</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507882"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507882"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507881"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507881"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507880"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507880"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507879"><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507879"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Dec -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507882"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507881"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507880"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-321"></span><span>                 </span><span class="hs-comment">-- Important: don't pass (sub_decs ++ decs) to reifyInDec</span><span>
</span><span id="line-322"></span><span>                 </span><span class="hs-comment">-- above, or else type family defaults can be confused for</span><span>
</span><span id="line-323"></span><span>                 </span><span class="hs-comment">-- actual instances. See #134.</span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507879"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 711
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507878"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507878"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507877"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507877"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507875"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507875"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">sub_decs</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507874"><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507874"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe (Named Info)
</span><a href="#local-6989586621679507873"><span class="hs-identifier hs-var">reify_in_instance</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507875"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507874"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-333"></span><span>    </span><span id="local-6989586621679507873"><span class="annot"><span class="annottext">reify_in_instance :: Dec -&gt; Maybe (Named Info)
</span><a href="#local-6989586621679507873"><span class="hs-identifier hs-var hs-var">reify_in_instance</span></a></span></span><span> </span><span id="local-6989586621679507872"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507872"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataInstD</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Dec -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507878"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507875"><span class="hs-identifier hs-var">sub_decs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507877"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507872"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="#local-6989586621679507873"><span class="hs-identifier hs-var">reify_in_instance</span></a></span><span> </span><span id="local-6989586621679507870"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621679507870"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NewtypeInstD</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Dec -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507878"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507875"><span class="hs-identifier hs-var">sub_decs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507877"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507870"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><a href="#local-6989586621679507873"><span class="hs-identifier hs-var">reify_in_instance</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 807
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507868"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507868"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507867"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507867"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataInstD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507866"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507866"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507865"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507865"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679507864"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507864"><span class="hs-identifier hs-var">ty_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507863"><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507863"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; (Kind, [TypeArg])
</span><a href="Language.Haskell.TH.Desugar.Util.html#unfoldType"><span class="hs-identifier hs-var">unfoldType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507866"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507861"><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507861"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Name -&gt; [TypeArg] -&gt; [Con] -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-var">maybeReifyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507868"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507867"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507864"><span class="hs-identifier hs-var">ty_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507863"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507865"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507861"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-341"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span id="local-6989586621679507860"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507860"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507859"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507859"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NewtypeInstD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507858"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507858"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507857"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507857"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679507856"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507856"><span class="hs-identifier hs-var">ty_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507855"><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507855"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; (Kind, [TypeArg])
</span><a href="Language.Haskell.TH.Desugar.Util.html#unfoldType"><span class="hs-identifier hs-var">unfoldType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507858"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507854"><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507854"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Name -&gt; [TypeArg] -&gt; [Con] -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-var">maybeReifyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507860"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507859"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507856"><span class="hs-identifier hs-var">ty_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507855"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507857"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Named Info
</span><a href="#local-6989586621679507854"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-cpp">
#elif __GLASGOW_HASKELL__ &gt; 710
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maybeReifyCon</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">TANormal</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">cons</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span>
</span><span id="line-349"></span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maybeReifyCon</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">TANormal</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">con</span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maybeReifyCon</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">TANormal</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">cons</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span>
</span><span id="line-356"></span><span class="hs-identifier">reifyInDec</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">maybeReifyCon</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">TANormal</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">con</span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">info</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-361"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-type">maybeReifyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#TypeArg"><span class="hs-identifier hs-type">TypeArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span id="maybeReifyCon"><span class="annot"><span class="annottext">maybeReifyCon :: Name -&gt; [Dec] -&gt; Name -&gt; [TypeArg] -&gt; [Con] -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-var hs-var">maybeReifyCon</span></a></span></span><span> </span><span id="local-6989586621679507853"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507853"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507852"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507852"><span class="hs-identifier hs-var">_decs</span></a></span></span><span> </span><span id="local-6989586621679507851"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507851"><span class="hs-identifier hs-var">ty_name</span></a></span></span><span> </span><span id="local-6989586621679507850"><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507850"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span> </span><span id="local-6989586621679507849"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507849"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507848"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507848"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507847"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507847"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Con] -&gt; Maybe (Named Con)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findCon"><span class="hs-identifier hs-var">findCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507853"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507849"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-comment">-- See Note [Use unSigType in maybeReifyCon]</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679507845"><span class="annot"><span class="annottext">full_con_ty :: Kind
</span><a href="#local-6989586621679507845"><span class="hs-identifier hs-var hs-var">full_con_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#unSigType"><span class="hs-identifier hs-var">unSigType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Con -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#con_to_type"><span class="hs-identifier hs-var">con_to_type</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507842"><span class="hs-identifier hs-var">h98_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507841"><span class="hs-identifier hs-var">h98_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507847"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507848"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Name -&gt; Info
</span><span class="hs-identifier hs-var">DataConI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507853"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507845"><span class="hs-identifier hs-var">full_con_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507851"><span class="hs-identifier hs-var">ty_name</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 800
</span><span>                        </span><span class="hs-identifier">fixity</span><span class="hs-cpp">
#endif
</span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507840"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507840"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507839"><span class="annot"><span class="annottext">RecSelInfo
</span><a href="#local-6989586621679507839"><span class="hs-identifier hs-var">rec_sel_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Con] -&gt; Maybe (Named RecSelInfo)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findRecSelector"><span class="hs-identifier hs-var">findRecSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507853"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507849"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507837"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507837"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507836"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507836"><span class="hs-identifier hs-var">sel_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507835"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507835"><span class="hs-identifier hs-var">con_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecSelInfo -&gt; ([TyVarBndrUnit], Kind, Kind)
</span><a href="#local-6989586621679507834"><span class="hs-identifier hs-var">extract_rec_sel_info</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelInfo
</span><a href="#local-6989586621679507839"><span class="hs-identifier hs-var">rec_sel_info</span></a></span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-comment">-- See Note [Use unSigType in maybeReifyCon]</span><span>
</span><span id="line-377"></span><span>        </span><span id="local-6989586621679507833"><span class="annot"><span class="annottext">full_sel_ty :: Kind
</span><a href="#local-6989586621679507833"><span class="hs-identifier hs-var hs-var">full_sel_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#unSigType"><span class="hs-identifier hs-var">unSigType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeForallT"><span class="hs-identifier hs-var">maybeForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507837"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507835"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507836"><span class="hs-identifier hs-var">sel_ty</span></a></span><span>
</span><span id="line-378"></span><span>      </span><span class="hs-comment">-- we don't try to ferret out naughty record selectors.</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507840"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Maybe Dec -&gt; Info
</span><span class="hs-identifier hs-var">VarI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507853"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507833"><span class="hs-identifier hs-var">full_sel_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 800
</span><span>                    </span><span class="hs-identifier">fixity</span><span class="hs-cpp">
#endif
</span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="#local-6989586621679507834"><span class="hs-identifier hs-type">extract_rec_sel_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelInfo"><span class="hs-identifier hs-type">RecSelInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-comment">-- Returns ( Selector type variable binders</span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-comment">--         , Record field type</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-comment">--         , constructor result type )</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621679507834"><span class="annot"><span class="annottext">extract_rec_sel_info :: RecSelInfo -&gt; ([TyVarBndrUnit], Kind, Kind)
</span><a href="#local-6989586621679507834"><span class="hs-identifier hs-var hs-var">extract_rec_sel_info</span></a></span></span><span> </span><span id="local-6989586621679507829"><span class="annot"><span class="annottext">RecSelInfo
</span><a href="#local-6989586621679507829"><span class="hs-identifier hs-var">rec_sel_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecSelInfo
</span><a href="#local-6989586621679507829"><span class="hs-identifier hs-var">rec_sel_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelH98"><span class="hs-identifier hs-type">RecSelH98</span></a></span><span> </span><span id="local-6989586621679507827"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507827"><span class="hs-identifier hs-var">sel_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507842"><span class="hs-identifier hs-var">h98_tvbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507827"><span class="hs-identifier hs-var">sel_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507841"><span class="hs-identifier hs-var">h98_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelGADT"><span class="hs-identifier hs-type">RecSelGADT</span></a></span><span> </span><span id="local-6989586621679507825"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507825"><span class="hs-identifier hs-var">sel_ty</span></a></span></span><span> </span><span id="local-6989586621679507824"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507824"><span class="hs-identifier hs-var">con_res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">freeVariablesWellScoped</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507824"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507825"><span class="hs-identifier hs-var">sel_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507825"><span class="hs-identifier hs-var">sel_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507824"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679507842"><span class="annot"><span class="annottext">h98_tvbs :: [TyVarBndrUnit]
</span><a href="#local-6989586621679507842"><span class="hs-identifier hs-var hs-var">h98_tvbs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">freeVariablesWellScoped</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypeArg -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#probablyWrongUnTypeArg"><span class="hs-identifier hs-var">probablyWrongUnTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507850"><span class="hs-identifier hs-var">ty_args</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679507841"><span class="annot"><span class="annottext">h98_res_ty :: Kind
</span><a href="#local-6989586621679507841"><span class="hs-identifier hs-var hs-var">h98_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; [TypeArg] -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#applyType"><span class="hs-identifier hs-var">applyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507851"><span class="hs-identifier hs-var">ty_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TypeArg]
</span><a href="#local-6989586621679507850"><span class="hs-identifier hs-var">ty_args</span></a></span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt; 800
</span><span>    </span><span class="hs-identifier">fixity</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromMaybe</span><span> </span><span class="hs-identifier">defaultFixity</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">reifyFixityInDecs</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_decs</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#maybeReifyCon"><span class="hs-identifier hs-var">maybeReifyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeArg]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-comment">{-
Note [Use unSigType in maybeReifyCon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Make sure to call unSigType on the type of a reified data constructor or
record selector. Otherwise, if you have this:

  data D (a :: k) = MkD { unD :: Proxy a }

Then the type of unD will be reified as:

  unD :: forall k (a :: k). D (a :: k) -&gt; Proxy a

This is contrast to GHC's own reification, which will produce `D a`
(without the explicit kind signature) as the type of the first argument.
-}</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- Reverse-engineer the type of a data constructor.</span><span>
</span><span id="line-421"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#con_to_type"><span class="hs-identifier hs-type">con_to_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- The type variables bound by a data type head.</span><span>
</span><span id="line-422"></span><span>                               </span><span class="hs-comment">-- Only used for Haskell98-style constructors.</span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>            </span><span class="hs-comment">-- The constructor result type.</span><span>
</span><span id="line-424"></span><span>                               </span><span class="hs-comment">-- Only used for Haskell98-style constructors.</span><span>
</span><span id="line-425"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-426"></span><span id="con_to_type"><span class="annot"><span class="annottext">con_to_type :: [TyVarBndrUnit] -&gt; Kind -&gt; Con -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#con_to_type"><span class="hs-identifier hs-var hs-var">con_to_type</span></a></span></span><span> </span><span id="local-6989586621679507820"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507820"><span class="hs-identifier hs-var">h98_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507819"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507819"><span class="hs-identifier hs-var">h98_result_ty</span></a></span></span><span> </span><span id="local-6989586621679507818"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507818"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Con -&gt; (Bool, Kind)
</span><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507818"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679507816"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507816"><span class="hs-identifier hs-var">is_gadt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507815"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507815"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507816"><span class="hs-identifier hs-var">is_gadt</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507815"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-429"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeForallT"><span class="hs-identifier hs-var">maybeForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507820"><span class="hs-identifier hs-var">h98_tvbs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507815"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- Note that we deliberately ignore linear types and use (-&gt;) everywhere.</span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-comment">-- See [Gracefully handling linear types] in L.H.TH.Desugar.Core.</span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><a href="#local-6989586621679507817"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- The Bool is True when dealing with a GADT</span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621679507817"><span class="annot"><span class="annottext">go :: Con -&gt; (Bool, Kind)
</span><a href="#local-6989586621679507817"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NormalC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507814"><span class="annot"><span class="annottext">[BangType]
</span><a href="#local-6989586621679507814"><span class="hs-identifier hs-var">stys</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>    </span><span class="annot"><span class="annottext">[BangType]
</span><a href="#local-6989586621679507814"><span class="hs-identifier hs-var">stys</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507819"><span class="hs-identifier hs-var">h98_result_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507813"><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507813"><span class="hs-identifier hs-var">vstys</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a, b, c) -&gt; c
</span><a href="Language.Haskell.TH.Desugar.Util.html#thdOf3"><span class="hs-identifier hs-var">thdOf3</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507813"><span class="hs-identifier hs-var">vstys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507819"><span class="hs-identifier hs-var">h98_result_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InfixC</span></span><span> </span><span id="local-6989586621679507811"><span class="annot"><span class="annottext">BangType
</span><a href="#local-6989586621679507811"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507810"><span class="annot"><span class="annottext">BangType
</span><a href="#local-6989586621679507810"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BangType
</span><a href="#local-6989586621679507811"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BangType
</span><a href="#local-6989586621679507810"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507819"><span class="hs-identifier hs-var">h98_result_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForallC</span></span><span> </span><span id="local-6989586621679507809"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507809"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621679507808"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507808"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621679507807"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507807"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b) -&gt; (c, a) -&gt; (c, b)
</span><a href="Language.Haskell.TH.Desugar.Util.html#liftSnd"><span class="hs-identifier hs-var">liftSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507809"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507808"><span class="hs-identifier hs-var">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Con -&gt; (Bool, Kind)
</span><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507807"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="annot"><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GadtC</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507804"><span class="annot"><span class="annottext">[BangType]
</span><a href="#local-6989586621679507804"><span class="hs-identifier hs-var">stys</span></a></span></span><span> </span><span id="local-6989586621679507803"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507803"><span class="hs-identifier hs-var">rty</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>    </span><span class="annot"><span class="annottext">[BangType]
</span><a href="#local-6989586621679507804"><span class="hs-identifier hs-var">stys</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507803"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="#local-6989586621679507817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecGadtC</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507802"><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507802"><span class="hs-identifier hs-var">vstys</span></a></span></span><span> </span><span id="local-6989586621679507801"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507801"><span class="hs-identifier hs-var">rty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a, b, c) -&gt; c
</span><a href="Language.Haskell.TH.Desugar.Util.html#thdOf3"><span class="hs-identifier hs-var">thdOf3</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507802"><span class="hs-identifier hs-var">vstys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507801"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-443"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarI"><span class="hs-identifier hs-type">mkVarI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-444"></span><span id="mkVarI"><span class="annot"><span class="annottext">mkVarI :: Name -&gt; [Dec] -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarI"><span class="hs-identifier hs-var hs-var">mkVarI</span></a></span></span><span> </span><span id="local-6989586621679507800"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507800"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507799"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507799"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Kind -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarITy"><span class="hs-identifier hs-var">mkVarITy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507800"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507799"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#no_type"><span class="hs-identifier hs-var">no_type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507800"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Maybe (Named Kind)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findType"><span class="hs-identifier hs-var">findType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507800"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507799"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarITy"><span class="hs-identifier hs-type">mkVarITy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span id="mkVarITy"><span class="annot"><span class="annottext">mkVarITy :: Name -&gt; [Dec] -&gt; Kind -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkVarITy"><span class="hs-identifier hs-var hs-var">mkVarITy</span></a></span></span><span> </span><span id="local-6989586621679507796"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507796"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507795"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507795"><span class="hs-identifier hs-var">_decs</span></a></span></span><span> </span><span id="local-6989586621679507794"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507794"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Maybe Dec -&gt; Info
</span><span class="hs-identifier hs-var">VarI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507796"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507794"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">mkVarITy</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">VarI</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromMaybe</span><span> </span><span class="hs-identifier">defaultFixity</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-451"></span><span>                                        </span><span class="hs-identifier">reifyFixityInDecs</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-454"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#findType"><span class="hs-identifier hs-type">findType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span id="findType"><span class="annot"><span class="annottext">findType :: Name -&gt; [Dec] -&gt; Maybe (Named Kind)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findType"><span class="hs-identifier hs-var hs-var">findType</span></a></span></span><span> </span><span id="local-6989586621679507793"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507793"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe (Named Kind)
</span><a href="#local-6989586621679507792"><span class="hs-identifier hs-var">match_type</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-457"></span><span>    </span><span id="local-6989586621679507792"><span class="annot"><span class="annottext">match_type :: Dec -&gt; Maybe (Named Kind)
</span><a href="#local-6989586621679507792"><span class="hs-identifier hs-var hs-var">match_type</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigD</span></span><span> </span><span id="local-6989586621679507790"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507790"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507789"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507789"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507793"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507790"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507790"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507789"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><a href="#local-6989586621679507792"><span class="hs-identifier hs-var">match_type</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>                                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &gt;= 801
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkPatSynI"><span class="hs-identifier hs-type">mkPatSynI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span>
</span><span id="line-462"></span><span id="mkPatSynI"><span class="annot"><span class="annottext">mkPatSynI :: Name -&gt; [Dec] -&gt; Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkPatSynI"><span class="hs-identifier hs-var hs-var">mkPatSynI</span></a></span></span><span> </span><span id="local-6989586621679507788"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507788"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507787"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507787"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Info
</span><span class="hs-identifier hs-var">PatSynI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507788"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#no_type"><span class="hs-identifier hs-var">no_type</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507788"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findPatSynType"><span class="hs-identifier hs-var">findPatSynType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507788"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507787"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#findPatSynType"><span class="hs-identifier hs-type">findPatSynType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PatSynType</span></span><span>
</span><span id="line-465"></span><span id="findPatSynType"><span class="annot"><span class="annottext">findPatSynType :: Name -&gt; [Dec] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findPatSynType"><span class="hs-identifier hs-var hs-var">findPatSynType</span></a></span></span><span> </span><span id="local-6989586621679507783"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507783"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe Kind
</span><a href="#local-6989586621679507782"><span class="hs-identifier hs-var">match_pat_syn_type</span></a></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-467"></span><span>    </span><span id="local-6989586621679507782"><span class="annot"><span class="annottext">match_pat_syn_type :: Dec -&gt; Maybe Kind
</span><a href="#local-6989586621679507782"><span class="hs-identifier hs-var hs-var">match_pat_syn_type</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PatSynSigD</span></span><span> </span><span id="local-6989586621679507780"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507780"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507779"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507779"><span class="hs-identifier hs-var">psty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507783"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507780"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507779"><span class="hs-identifier hs-var">psty</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><a href="#local-6989586621679507782"><span class="hs-identifier hs-var">match_pat_syn_type</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>                                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-471"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#no_type"><span class="hs-identifier hs-type">no_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-472"></span><span id="no_type"><span class="annot"><span class="annottext">no_type :: Name -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#no_type"><span class="hs-identifier hs-var hs-var">no_type</span></a></span></span><span> </span><span id="local-6989586621679507778"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507778"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No type information found in local declaration for &quot;</span></span><span>
</span><span id="line-473"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507778"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#findInstances"><span class="hs-identifier hs-type">findInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-476"></span><span id="findInstances"><span class="annot"><span class="annottext">findInstances :: Name -&gt; [Dec] -&gt; [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findInstances"><span class="hs-identifier hs-var hs-var">findInstances</span></a></span></span><span> </span><span id="local-6989586621679507776"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507776"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Dec
</span><a href="Language.Haskell.TH.Desugar.Reify.html#stripInstanceDec"><span class="hs-identifier hs-var">stripInstanceDec</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec]
</span><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">where</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 711
</span><span>    </span><span id="local-6989586621679507773"><span class="annot"><span class="annottext">match_instance :: Dec -&gt; [Dec]
</span><a href="#local-6989586621679507773"><span class="hs-identifier hs-var hs-var">match_instance</span></a></span></span><span> </span><span id="local-6989586621679507771"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507771"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507770"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507770"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-identifier">d</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>                                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679507769"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507769"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="#local-6989586621679507768"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507770"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-484"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507776"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507769"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507771"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 807
</span><span>    </span><span class="annot"><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataInstD</span></span><span> </span><span id="local-6989586621679507767"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507767"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507766"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507766"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679507765"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507765"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679507764"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507764"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621679507763"><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679507763"><span class="hs-identifier hs-var">derivs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>                                                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679507762"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507762"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="#local-6989586621679507768"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507766"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-488"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507776"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507762"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507761"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-490"></span><span>        </span><span id="local-6989586621679507760"><span class="annot"><span class="annottext">mtvbs :: Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507760"><span class="hs-identifier hs-var hs-var">mtvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Maybe Kind -&gt; Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507759"><span class="hs-identifier hs-var">rejig_data_inst_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507767"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507766"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507765"><span class="hs-identifier hs-var">mk</span></a></span><span>
</span><span id="line-491"></span><span>        </span><span id="local-6989586621679507761"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507761"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt
-&gt; Maybe [TyVarBndrUnit]
-&gt; Kind
-&gt; Maybe Kind
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">DataInstD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507767"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507760"><span class="hs-identifier hs-var">mtvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507766"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507765"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679507764"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679507763"><span class="hs-identifier hs-var">derivs</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NewtypeInstD</span></span><span> </span><span id="local-6989586621679507758"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507758"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507757"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507757"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679507756"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507756"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621679507755"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507755"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621679507754"><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679507754"><span class="hs-identifier hs-var">derivs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>                                                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679507753"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507753"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="#local-6989586621679507768"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507757"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-494"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507776"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507753"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507752"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-495"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-496"></span><span>        </span><span id="local-6989586621679507751"><span class="annot"><span class="annottext">mtvbs :: Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507751"><span class="hs-identifier hs-var hs-var">mtvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Maybe Kind -&gt; Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507759"><span class="hs-identifier hs-var">rejig_data_inst_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507758"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507757"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507756"><span class="hs-identifier hs-var">mk</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span id="local-6989586621679507752"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507752"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt
-&gt; Maybe [TyVarBndrUnit]
-&gt; Kind
-&gt; Maybe Kind
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">NewtypeInstD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507758"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507751"><span class="hs-identifier hs-var">mtvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507757"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507756"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507755"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679507754"><span class="hs-identifier hs-var">derivs</span></a></span><span class="hs-cpp">
#elif __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-identifier">d</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">DataInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-special">]</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-identifier">d</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-identifier">d</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">DataInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-special">]</span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-identifier">d</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 807
</span><span>    </span><span class="annot"><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TySynInstD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TySynEqn</span></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507748"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507748"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679507747"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507747"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>                                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679507746"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507746"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="#local-6989586621679507768"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507748"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-508"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507776"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507746"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507745"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-509"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-510"></span><span>        </span><span id="local-6989586621679507744"><span class="annot"><span class="annottext">mtvbs :: Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507744"><span class="hs-identifier hs-var hs-var">mtvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507743"><span class="hs-identifier hs-var">rejig_tvbs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507748"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507747"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-511"></span><span>        </span><span id="local-6989586621679507745"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507745"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySynEqn -&gt; Dec
</span><span class="hs-identifier hs-var">TySynInstD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit] -&gt; Kind -&gt; Kind -&gt; TySynEqn
</span><span class="hs-identifier hs-var">TySynEqn</span></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507744"><span class="hs-identifier hs-var">mtvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507748"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507747"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-identifier">d</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">TySynInstD</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 711
</span><span>    </span><span class="annot"><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507742"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507742"><span class="hs-identifier hs-var">decs</span></a></span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">match_instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>                                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec]
</span><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507742"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><a href="#local-6989586621679507773"><span class="hs-identifier hs-var">match_instance</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &gt;= 807
</span><span>    </span><span class="hs-comment">-- See Note [Rejigging reified type family equations variable binders]</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-comment">-- for why this is necessary.</span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><a href="#local-6989586621679507743"><span class="hs-identifier hs-type">rejig_tvbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span>
</span><span id="line-528"></span><span>    </span><span id="local-6989586621679507743"><span class="annot"><span class="annottext">rejig_tvbs :: Cxt -&gt; Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507743"><span class="hs-identifier hs-var hs-var">rejig_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507741"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507741"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-529"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679507740"><span class="annot"><span class="annottext">tvbs :: [TyVarBndrUnit]
</span><a href="#local-6989586621679507740"><span class="hs-identifier hs-var hs-var">tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">freeVariablesWellScoped</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507741"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507740"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-531"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-532"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507740"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><a href="#local-6989586621679507759"><span class="hs-identifier hs-type">rejig_data_inst_tvbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>    </span><span id="local-6989586621679507759"><span class="annot"><span class="annottext">rejig_data_inst_tvbs :: Cxt -&gt; Kind -&gt; Maybe Kind -&gt; Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507759"><span class="hs-identifier hs-var hs-var">rejig_data_inst_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507738"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507738"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621679507737"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507737"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621679507736"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507736"><span class="hs-identifier hs-var">mk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><span class="annottext">Cxt -&gt; Maybe [TyVarBndrUnit]
</span><a href="#local-6989586621679507743"><span class="hs-identifier hs-var">rejig_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507738"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507737"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507736"><span class="hs-identifier hs-var">mk</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-539"></span><span>    </span><span id="local-6989586621679507768"><span class="annot"><span class="annottext">ty_head :: Kind -&gt; Kind
</span><a href="#local-6989586621679507768"><span class="hs-identifier hs-var hs-var">ty_head</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; (Kind, [TypeArg])
</span><a href="Language.Haskell.TH.Desugar.Util.html#unfoldType"><span class="hs-identifier hs-var">unfoldType</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">{-
Note [Rejigging reified type family equations variable binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When reifying a type family instance (on GHC 8.8 or later), which quantified
type variables do you use? This might seem like a strange question to ask since
these instances already come equipped with a field of type `Maybe [TyVarBndr]`,
but it's not always the case that you want to use exactly that field. Here is
an example to better explain it:

  class C a where
    type T b a
  instance C (Maybe a) where
    type forall b. T b (Maybe a) = a

If the above instance were quoted, it would give you `Just [PlainTV b]`. But if
you were to reify ''T (and therefore retrieve the instance for T), you wouldn't
want to use that as your list of type variable binders! This is because
reifiying any type family always presents the information as though the type
family were top-level. Therefore, reifying T (in GHC, at least) would yield:

  type family T b a
  type instance forall b a. T b (Maybe a) = a

Note that we quantify over `b` *and* `a` here, not just `b`. To emulate this
GHC quirk, whenever we reify any type family instance, we just ignore the field
of type `Maybe [TyVarBndr]` and quantify over the instance afresh. It's a bit
tedious, but it gets the job done. (This is accomplished by the rejig_tvbs
function.)
-}</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="hs-comment">-- Consider the following class declaration:</span><span>
</span><span id="line-572"></span><span class="hs-comment">--</span><span>
</span><span id="line-573"></span><span class="hs-comment">--   [d| class C a where</span><span>
</span><span id="line-574"></span><span class="hs-comment">--         method :: a -&gt; b -&gt; a |]</span><span>
</span><span id="line-575"></span><span class="hs-comment">--</span><span>
</span><span id="line-576"></span><span class="hs-comment">-- When reifying C locally, quantifyClassDecMethods serves two purposes:</span><span>
</span><span id="line-577"></span><span class="hs-comment">--</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- 1. It quantifies the class method's local type variables. To illustrate this</span><span>
</span><span id="line-579"></span><span class="hs-comment">--    point, this is how GHC would reify C:</span><span>
</span><span id="line-580"></span><span class="hs-comment">--</span><span>
</span><span id="line-581"></span><span class="hs-comment">--      class C a where</span><span>
</span><span id="line-582"></span><span class="hs-comment">--        method :: forall b. a -&gt; b -&gt; a</span><span>
</span><span id="line-583"></span><span class="hs-comment">--</span><span>
</span><span id="line-584"></span><span class="hs-comment">--    Notice the presence of the explicit `forall b.`. quantifyClassDecMethods</span><span>
</span><span id="line-585"></span><span class="hs-comment">--    performs this explicit quantification if necessary (as in the case in the</span><span>
</span><span id="line-586"></span><span class="hs-comment">--    local C declaration, where `b` is implicitly quantified.)</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- 2. It emulates a quirk in the way old versions of GHC would reify class</span><span>
</span><span id="line-588"></span><span class="hs-comment">--    declarations (Trac #15551). On versions of GHC older than 8.8, it would</span><span>
</span><span id="line-589"></span><span class="hs-comment">--    reify C like so:</span><span>
</span><span id="line-590"></span><span class="hs-comment">--</span><span>
</span><span id="line-591"></span><span class="hs-comment">--      class C a where</span><span>
</span><span id="line-592"></span><span class="hs-comment">--        method :: forall a. C a =&gt; forall b. a -&gt; b -&gt; a</span><span>
</span><span id="line-593"></span><span class="hs-comment">--</span><span>
</span><span id="line-594"></span><span class="hs-comment">--    Notice how GHC has added the (totally extraneous) `forall a. C a =&gt;`</span><span>
</span><span id="line-595"></span><span class="hs-comment">--    part! This is weird, but our primary goal in this module is to mimic</span><span>
</span><span id="line-596"></span><span class="hs-comment">--    GHC's reification, so we play the part by adding the `forall`/class</span><span>
</span><span id="line-597"></span><span class="hs-comment">--    context to each class method in quantifyClassDecMethods.</span><span>
</span><span id="line-598"></span><span class="hs-comment">--</span><span>
</span><span id="line-599"></span><span class="hs-comment">--    Since Trac #15551 was fixed in GHC 8.8, this function doesn't perform</span><span>
</span><span id="line-600"></span><span class="hs-comment">--    this step on 8.7 or later.</span><span>
</span><span id="line-601"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassDecMethods"><span class="hs-identifier hs-type">quantifyClassDecMethods</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-602"></span><span id="quantifyClassDecMethods"><span class="annot"><span class="annottext">quantifyClassDecMethods :: Dec -&gt; Dec
</span><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassDecMethods"><span class="hs-identifier hs-var hs-var">quantifyClassDecMethods</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span id="local-6989586621679507734"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507734"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621679507733"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507733"><span class="hs-identifier hs-var">cls_name</span></a></span></span><span> </span><span id="local-6989586621679507732"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507732"><span class="hs-identifier hs-var">cls_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507731"><span class="annot"><span class="annottext">[FunDep]
</span><a href="#local-6989586621679507731"><span class="hs-identifier hs-var">fds</span></a></span></span><span> </span><span id="local-6989586621679507730"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507730"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Name -&gt; [TyVarBndrUnit] -&gt; [FunDep] -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507734"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507733"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507732"><span class="hs-identifier hs-var">cls_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><a href="#local-6989586621679507731"><span class="hs-identifier hs-var">fds</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507729"><span class="hs-identifier hs-var">sub_decs'</span></a></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-605"></span><span>    </span><span id="local-6989586621679507729"><span class="annot"><span class="annottext">sub_decs' :: [Dec]
</span><a href="#local-6989586621679507729"><span class="hs-identifier hs-var hs-var">sub_decs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe Dec
</span><a href="#local-6989586621679507727"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507730"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621679507727"><span class="annot"><span class="annottext">go :: Dec -&gt; Maybe Dec
</span><a href="#local-6989586621679507727"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigD</span></span><span> </span><span id="local-6989586621679507726"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507726"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507725"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507725"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; Dec
</span><span class="hs-identifier hs-var">SigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507726"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-608"></span><span>           </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndrUnit] -&gt; Bool -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassMethodType"><span class="hs-identifier hs-var">quantifyClassMethodType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507733"><span class="hs-identifier hs-var">cls_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507732"><span class="hs-identifier hs-var">cls_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507724"><span class="hs-identifier hs-var">prepend_cls</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507725"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="#local-6989586621679507727"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679507723"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507723"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TySynInstD</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507723"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="annot"><a href="#local-6989586621679507727"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679507722"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507722"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenTypeFamilyD</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507722"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><a href="#local-6989586621679507727"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679507721"><span class="annot"><span class="annottext">d :: Dec
</span><a href="#local-6989586621679507721"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataFamilyD</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507721"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="#local-6989586621679507727"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>    </span><span class="hs-comment">-- See (2) in the comments for quantifyClassDecMethods.</span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><a href="#local-6989586621679507724"><span class="hs-identifier hs-type">prepend_cls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 807
</span><span>    </span><span id="local-6989586621679507724"><span class="annot"><span class="annottext">prepend_cls :: Bool
</span><a href="#local-6989586621679507724"><span class="hs-identifier hs-var hs-var">prepend_cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">prepend_cls</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassDecMethods"><span class="hs-identifier hs-var">quantifyClassDecMethods</span></a></span><span> </span><span id="local-6989586621679507720"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507720"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507720"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="hs-comment">-- Add explicit quantification to a class method's type if necessary. In this</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- example:</span><span>
</span><span id="line-627"></span><span class="hs-comment">--</span><span>
</span><span id="line-628"></span><span class="hs-comment">--   [d| class C a where</span><span>
</span><span id="line-629"></span><span class="hs-comment">--         method :: a -&gt; b -&gt; a |]</span><span>
</span><span id="line-630"></span><span class="hs-comment">--</span><span>
</span><span id="line-631"></span><span class="hs-comment">-- If one invokes `quantifyClassMethodType C [a] prepend (a -&gt; b -&gt; a)`, then</span><span>
</span><span id="line-632"></span><span class="hs-comment">-- the output will be:</span><span>
</span><span id="line-633"></span><span class="hs-comment">--</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- 1. `forall a. C a =&gt; forall b. a -&gt; b -&gt; a` (if `prepend` is True)</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- 2.                  `forall b. a -&gt; b -&gt; a` (if `prepend` is False)</span><span>
</span><span id="line-636"></span><span class="hs-comment">--</span><span>
</span><span id="line-637"></span><span class="hs-comment">-- Whether you want `prepend` to be True or False depends on the situation.</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- When reifying an entire type class, like C, one does not need to prepend a</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- class context to each of the bundled method types (see the comments for</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- quantifyClassDecMethods), so False is appropriate. When one is only reifying</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- a single class method, like `method`, then one needs the class context to</span><span>
</span><span id="line-642"></span><span class="hs-comment">-- appear in the reified type, so `True` is appropriate.</span><span>
</span><span id="line-643"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassMethodType"><span class="hs-identifier hs-type">quantifyClassMethodType</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>            </span><span class="hs-comment">-- ^ The class name.</span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The class's type variable binders.</span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="hs-comment">-- ^ If 'True', prepend a class predicate.</span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>            </span><span class="hs-comment">-- ^ The method type.</span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-649"></span><span id="quantifyClassMethodType"><span class="annot"><span class="annottext">quantifyClassMethodType :: Name -&gt; [TyVarBndrUnit] -&gt; Bool -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#quantifyClassMethodType"><span class="hs-identifier hs-var hs-var">quantifyClassMethodType</span></a></span></span><span> </span><span id="local-6989586621679507719"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507719"><span class="hs-identifier hs-var">cls_name</span></a></span></span><span> </span><span id="local-6989586621679507718"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507718"><span class="hs-identifier hs-var">cls_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507717"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507717"><span class="hs-identifier hs-var">prepend</span></a></span></span><span> </span><span id="local-6989586621679507716"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507716"><span class="hs-identifier hs-var">meth_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-650"></span><span>  </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><a href="#local-6989586621679507715"><span class="hs-identifier hs-var">add_cls_cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507714"><span class="hs-identifier hs-var">quantified_meth_ty</span></a></span><span>
</span><span id="line-651"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><a href="#local-6989586621679507715"><span class="hs-identifier hs-type">add_cls_cxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-653"></span><span>    </span><span id="local-6989586621679507715"><span class="annot"><span class="annottext">add_cls_cxt :: Kind -&gt; Kind
</span><a href="#local-6989586621679507715"><span class="hs-identifier hs-var hs-var">add_cls_cxt</span></a></span></span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507717"><span class="hs-identifier hs-var">prepend</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall newFlag oldFlag.
newFlag -&gt; [TyVarBndr_ oldFlag] -&gt; [TyVarBndr_ newFlag]
</span><span class="hs-identifier hs-var">changeTVFlags</span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><span class="hs-identifier hs-var">SpecifiedSpec</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507711"><span class="hs-identifier hs-var">all_cls_tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507710"><span class="hs-identifier hs-var">cls_cxt</span></a></span><span>
</span><span id="line-655"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>    </span><span class="annot"><a href="#local-6989586621679507710"><span class="hs-identifier hs-type">cls_cxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 709
</span><span>    </span><span class="hs-identifier">cls_cxt</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">ClassP</span><span> </span><span class="hs-identifier">cls_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">tvbToType</span><span> </span><span class="hs-identifier">cls_tvbs</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span>    </span><span id="local-6989586621679507710"><span class="annot"><span class="annottext">cls_cxt :: Cxt
</span><a href="#local-6989586621679507710"><span class="hs-identifier hs-var hs-var">cls_cxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Kind
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507719"><span class="hs-identifier hs-var">cls_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#tvbToType"><span class="hs-identifier hs-var">tvbToType</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507718"><span class="hs-identifier hs-var">cls_tvbs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><a href="#local-6989586621679507714"><span class="hs-identifier hs-type">quantified_meth_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-665"></span><span>    </span><span id="local-6989586621679507714"><span class="annot"><span class="annottext">quantified_meth_ty :: Kind
</span><a href="#local-6989586621679507714"><span class="hs-identifier hs-var hs-var">quantified_meth_ty</span></a></span></span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507705"><span class="hs-identifier hs-var">meth_tvbs</span></a></span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507716"><span class="hs-identifier hs-var">meth_ty</span></a></span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ForallT</span></span><span> </span><span id="local-6989586621679507704"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507704"><span class="hs-identifier hs-var">meth_tvbs'</span></a></span></span><span> </span><span id="local-6989586621679507703"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507703"><span class="hs-identifier hs-var">meth_ctxt</span></a></span></span><span> </span><span id="local-6989586621679507702"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507702"><span class="hs-identifier hs-var">meth_tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507716"><span class="hs-identifier hs-var">meth_ty</span></a></span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507705"><span class="hs-identifier hs-var">meth_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507704"><span class="hs-identifier hs-var">meth_tvbs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507703"><span class="hs-identifier hs-var">meth_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507702"><span class="hs-identifier hs-var">meth_tau</span></a></span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507705"><span class="hs-identifier hs-var">meth_tvbs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507716"><span class="hs-identifier hs-var">meth_ty</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>    </span><span class="annot"><a href="#local-6989586621679507705"><span class="hs-identifier hs-type">meth_tvbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrSpec</span></span><span class="hs-special">]</span><span>
</span><span id="line-674"></span><span>    </span><span id="local-6989586621679507705"><span class="annot"><span class="annottext">meth_tvbs :: [TyVarBndr Specificity]
</span><a href="#local-6989586621679507705"><span class="hs-identifier hs-var hs-var">meth_tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall newFlag oldFlag.
newFlag -&gt; [TyVarBndr_ oldFlag] -&gt; [TyVarBndr_ newFlag]
</span><span class="hs-identifier hs-var">changeTVFlags</span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><span class="hs-identifier hs-var">SpecifiedSpec</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-675"></span><span>                </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.deleteFirstsBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">freeVariablesWellScoped</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507716"><span class="hs-identifier hs-var">meth_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507711"><span class="hs-identifier hs-var">all_cls_tvbs</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>    </span><span class="hs-comment">-- Explicitly quantify any kind variables bound by the class, if any.</span><span>
</span><span id="line-679"></span><span>    </span><span class="annot"><a href="#local-6989586621679507711"><span class="hs-identifier hs-type">all_cls_tvbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621679507711"><span class="annot"><span class="annottext">all_cls_tvbs :: [TyVarBndrUnit]
</span><a href="#local-6989586621679507711"><span class="hs-identifier hs-var hs-var">all_cls_tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; [TyVarBndrUnit]
</span><span class="hs-identifier hs-var">freeVariablesWellScoped</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#tvbToTypeWithSig"><span class="hs-identifier hs-var">tvbToTypeWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507718"><span class="hs-identifier hs-var">cls_tvbs</span></a></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#stripInstanceDec"><span class="hs-identifier hs-type">stripInstanceDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 711
</span><span id="stripInstanceDec"><span class="annot"><span class="annottext">stripInstanceDec :: Dec -&gt; Dec
</span><a href="Language.Haskell.TH.Desugar.Reify.html#stripInstanceDec"><span class="hs-identifier hs-var hs-var">stripInstanceDec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">InstanceD</span></span><span> </span><span id="local-6989586621679507698"><span class="annot"><span class="annottext">Maybe Overlap
</span><a href="#local-6989586621679507698"><span class="hs-identifier hs-var">over</span></a></span></span><span> </span><span id="local-6989586621679507697"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507697"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621679507696"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507696"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap -&gt; Cxt -&gt; Kind -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
</span><a href="#local-6989586621679507698"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507697"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507696"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">stripInstanceDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">cxt</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#stripInstanceDec"><span class="hs-identifier hs-var">stripInstanceDec</span></a></span><span> </span><span id="local-6989586621679507695"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507695"><span class="hs-identifier hs-var">dec</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507695"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-type">mkArrows</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-691"></span><span id="mkArrows"><span class="annot"><span class="annottext">mkArrows :: Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var hs-var">mkArrows</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span id="local-6989586621679507694"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507694"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507694"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-692"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507693"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507693"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679507692"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507692"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679507691"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507691"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507693"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkArrows"><span class="hs-identifier hs-var">mkArrows</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507692"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507691"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#maybeForallT"><span class="hs-identifier hs-type">maybeForallT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-695"></span><span id="maybeForallT"><span class="annot"><span class="annottext">maybeForallT :: [TyVarBndrUnit] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#maybeForallT"><span class="hs-identifier hs-var hs-var">maybeForallT</span></a></span></span><span> </span><span id="local-6989586621679507689"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507689"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507688"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507688"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span id="local-6989586621679507687"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507687"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507689"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507688"><span class="hs-identifier hs-var">cxt</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507687"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ForallT</span></span><span> </span><span id="local-6989586621679507685"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507685"><span class="hs-identifier hs-var">tvbs2</span></a></span></span><span> </span><span id="local-6989586621679507684"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507684"><span class="hs-identifier hs-var">cxt2</span></a></span></span><span> </span><span id="local-6989586621679507683"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507683"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507687"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507682"><span class="hs-identifier hs-var">tvbs_spec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507685"><span class="hs-identifier hs-var">tvbs2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507688"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507684"><span class="hs-identifier hs-var">cxt2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507683"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; Cxt -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679507682"><span class="hs-identifier hs-var">tvbs_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679507688"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507687"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-700"></span><span>    </span><span id="local-6989586621679507682"><span class="annot"><span class="annottext">tvbs_spec :: [TyVarBndr Specificity]
</span><a href="#local-6989586621679507682"><span class="hs-identifier hs-var hs-var">tvbs_spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall newFlag oldFlag.
newFlag -&gt; [TyVarBndr_ oldFlag] -&gt; [TyVarBndr_ newFlag]
</span><span class="hs-identifier hs-var">changeTVFlags</span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><span class="hs-identifier hs-var">SpecifiedSpec</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507689"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#findCon"><span class="hs-identifier hs-type">findCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span id="findCon"><span class="annot"><span class="annottext">findCon :: Name -&gt; [Con] -&gt; Maybe (Named Con)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findCon"><span class="hs-identifier hs-var hs-var">findCon</span></a></span></span><span> </span><span id="local-6989586621679507681"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507681"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Con -&gt; Maybe (Named Con)
</span><a href="#local-6989586621679507680"><span class="hs-identifier hs-var">match_con</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-705"></span><span>    </span><span class="annot"><a href="#local-6989586621679507680"><span class="hs-identifier hs-type">match_con</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>    </span><span id="local-6989586621679507680"><span class="annot"><span class="annottext">match_con :: Con -&gt; Maybe (Named Con)
</span><a href="#local-6989586621679507680"><span class="hs-identifier hs-var hs-var">match_con</span></a></span></span><span> </span><span id="local-6989586621679507679"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-707"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-708"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">NormalC</span></span><span> </span><span id="local-6989586621679507678"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507678"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[BangType]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507681"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507678"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507678"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">RecC</span></span><span> </span><span id="local-6989586621679507677"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507677"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507681"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507677"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507677"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">InfixC</span></span><span> </span><span class="annot"><span class="annottext">BangType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507676"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507676"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">BangType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507681"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507676"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507676"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ForallC</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507675"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507675"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Con -&gt; Maybe (Named Con)
</span><a href="#local-6989586621679507680"><span class="hs-identifier hs-var">match_con</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507675"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-712"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507674"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507674"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Con
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507674"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>                           </span><span class="annot"><span class="annottext">Maybe (Named Con)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt; 710
</span><span>        </span><span class="annot"><span class="hs-identifier hs-type">GadtC</span></span><span> </span><span id="local-6989586621679507673"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679507673"><span class="hs-identifier hs-var">nms</span></a></span></span><span> </span><span class="annot"><span class="annottext">[BangType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; [Name] -&gt; Maybe (Named Con)
</span><a href="#local-6989586621679507672"><span class="hs-identifier hs-var">gadt_case</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679507673"><span class="hs-identifier hs-var">nms</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">RecGadtC</span></span><span> </span><span id="local-6989586621679507671"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679507671"><span class="hs-identifier hs-var">nms</span></a></span></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; [Name] -&gt; Maybe (Named Con)
</span><a href="#local-6989586621679507672"><span class="hs-identifier hs-var">gadt_case</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507679"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679507671"><span class="hs-identifier hs-var">nms</span></a></span><span class="hs-cpp">
#endif
</span><span>        </span><span class="annot"><span class="annottext">Con
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &gt; 710
</span><span>    </span><span class="annot"><a href="#local-6989586621679507672"><span class="hs-identifier hs-type">gadt_case</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621679507672"><span class="annot"><span class="annottext">gadt_case :: Con -&gt; [Name] -&gt; Maybe (Named Con)
</span><a href="#local-6989586621679507672"><span class="hs-identifier hs-var hs-var">gadt_case</span></a></span></span><span> </span><span id="local-6989586621679507670"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507670"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621679507669"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679507669"><span class="hs-identifier hs-var">nms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507681"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679507669"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-723"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507668"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507668"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507668"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507670"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-727"></span><span class="hs-keyword">data</span><span> </span><span id="RecSelInfo"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelInfo"><span class="hs-identifier hs-var">RecSelInfo</span></a></span></span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RecSelH98"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelH98"><span class="hs-identifier hs-var">RecSelH98</span></a></span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">-- The record field's type</span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RecSelGADT"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelGADT"><span class="hs-identifier hs-var">RecSelGADT</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">-- The record field's type</span><span>
</span><span id="line-730"></span><span>               </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">-- The GADT return type</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#findRecSelector"><span class="hs-identifier hs-type">findRecSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelInfo"><span class="hs-identifier hs-type">RecSelInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span id="findRecSelector"><span class="annot"><span class="annottext">findRecSelector :: Name -&gt; [Con] -&gt; Maybe (Named RecSelInfo)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findRecSelector"><span class="hs-identifier hs-var hs-var">findRecSelector</span></a></span></span><span> </span><span id="local-6989586621679507667"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507667"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Con -&gt; Maybe (Named RecSelInfo)
</span><a href="#local-6989586621679507666"><span class="hs-identifier hs-var">match_con</span></a></span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-735"></span><span>    </span><span class="annot"><a href="#local-6989586621679507666"><span class="hs-identifier hs-type">match_con</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelInfo"><span class="hs-identifier hs-type">RecSelInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>    </span><span id="local-6989586621679507666"><span class="annot"><span class="annottext">match_con :: Con -&gt; Maybe (Named RecSelInfo)
</span><a href="#local-6989586621679507666"><span class="hs-identifier hs-var hs-var">match_con</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507665"><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507665"><span class="hs-identifier hs-var">vstys</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b) -&gt; (c, a) -&gt; (c, b)
</span><a href="Language.Haskell.TH.Desugar.Util.html#liftSnd"><span class="hs-identifier hs-var">liftSnd</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; RecSelInfo
</span><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelH98"><span class="hs-identifier hs-var">RecSelH98</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-737"></span><span>                                          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b} {b}. (Name, b, b) -&gt; Maybe (Name, b)
</span><a href="#local-6989586621679507664"><span class="hs-identifier hs-var">match_rec_sel</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507665"><span class="hs-identifier hs-var">vstys</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>    </span><span class="annot"><a href="#local-6989586621679507666"><span class="hs-identifier hs-var">match_con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RecGadtC</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507663"><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507663"><span class="hs-identifier hs-var">vstys</span></a></span></span><span> </span><span id="local-6989586621679507662"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507662"><span class="hs-identifier hs-var">ret_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b) -&gt; (c, a) -&gt; (c, b)
</span><a href="Language.Haskell.TH.Desugar.Util.html#liftSnd"><span class="hs-identifier hs-var">liftSnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; RecSelInfo
</span><a href="Language.Haskell.TH.Desugar.Reify.html#RecSelGADT"><span class="hs-operator hs-var">`RecSelGADT`</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507662"><span class="hs-identifier hs-var">ret_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-740"></span><span>                                          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b} {b}. (Name, b, b) -&gt; Maybe (Name, b)
</span><a href="#local-6989586621679507664"><span class="hs-identifier hs-var">match_rec_sel</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679507663"><span class="hs-identifier hs-var">vstys</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="#local-6989586621679507666"><span class="hs-identifier hs-var">match_con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ForallC</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507661"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507661"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Con -&gt; Maybe (Named RecSelInfo)
</span><a href="#local-6989586621679507666"><span class="hs-identifier hs-var">match_con</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679507661"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-743"></span><span>    </span><span class="annot"><a href="#local-6989586621679507666"><span class="hs-identifier hs-var">match_con</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span>    </span><span id="local-6989586621679507664"><span class="annot"><span class="annottext">match_rec_sel :: (Name, b, b) -&gt; Maybe (Name, b)
</span><a href="#local-6989586621679507664"><span class="hs-identifier hs-var hs-var">match_rec_sel</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507660"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507660"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507659"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679507659"><span class="hs-identifier hs-var">sel_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507667"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507660"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507660"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679507659"><span class="hs-identifier hs-var">sel_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>    </span><span class="annot"><a href="#local-6989586621679507664"><span class="hs-identifier hs-var">match_rec_sel</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, b, b)
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-750"></span><span class="hs-comment">-- Reifying fixities</span><span>
</span><span id="line-751"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-752"></span><span class="hs-comment">--</span><span>
</span><span id="line-753"></span><span class="hs-comment">-- This section allows GHC 7.x to call reifyFixity</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt; 711
</span><span class="hs-identifier">qReifyFixity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Quasi</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Fixity</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span class="hs-identifier">qReifyFixity</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">qReify</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-identifier">ClassOpI</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">fixity</span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-identifier">DataConI</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">fixity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">fixity</span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-identifier">VarI</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">fixity</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">fixity</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="hs-comment">{- | @reifyFixity nm@ attempts to find a fixity declaration for @nm@. For
example, if the function @foo@ has the fixity declaration @infixr 7 foo@, then
@reifyFixity 'foo@ would return @'Just' ('Fixity' 7 'InfixR')@. If the function
@bar@ does not have a fixity declaration, then @reifyFixity 'bar@ returns
'Nothing', so you may assume @bar@ has 'defaultFixity'.
-}</span><span>
</span><span id="line-771"></span><span class="hs-identifier">reifyFixity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Fixity</span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span class="hs-identifier">reifyFixity</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">qReifyFixity</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-775"></span><span class="hs-comment">-- | Like 'reifyWithLocals_maybe', but for fixities. Note that a return value</span><span>
</span><span id="line-776"></span><span class="hs-comment">-- of @Nothing@ might mean that the name is not in scope, or it might mean</span><span>
</span><span id="line-777"></span><span class="hs-comment">-- that the name has no assigned fixity. (Use 'reifyWithLocals_maybe' if</span><span>
</span><span id="line-778"></span><span class="hs-comment">-- you really need to tell the difference.)</span><span>
</span><span id="line-779"></span><span id="local-6989586621679508624"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityWithLocals"><span class="hs-identifier hs-type">reifyFixityWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508624"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508624"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fixity</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-780"></span><span id="reifyFixityWithLocals"><span class="annot"><span class="annottext">reifyFixityWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe Fixity)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityWithLocals"><span class="hs-identifier hs-var hs-var">reifyFixityWithLocals</span></a></span></span><span> </span><span id="local-6989586621679507649"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507649"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Quasi m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">qRecover</span></span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Maybe Fixity
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFixityInDecs"><span class="hs-identifier hs-var">reifyFixityInDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507649"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m (Maybe Fixity)
</span><span class="hs-identifier hs-var">qReifyFixity</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507649"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-785"></span><span class="hs-comment">-- Reifying types</span><span>
</span><span id="line-786"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-787"></span><span class="hs-comment">--</span><span>
</span><span id="line-788"></span><span class="hs-comment">-- This section allows GHC &lt;8.9 to call reifyFixity</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt; 809
</span><span class="hs-identifier">qReifyType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">m</span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Quasi</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">Type</span><span>
</span><span id="line-792"></span><span class="hs-identifier">qReifyType</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">qReify</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">infoType</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-operator">&lt;|&gt;</span><span> </span><span class="hs-identifier">info_kind</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-795"></span><span>    </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">t</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">t</span><span>
</span><span id="line-796"></span><span>    </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Could not reify the full type of &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">nameBase</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-798"></span><span>    </span><span class="hs-identifier">info_kind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Info</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Kind</span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-identifier">info_kind</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>      </span><span class="hs-identifier">dec</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">info</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-801"></span><span>               </span><span class="hs-identifier">ClassI</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">d</span><span>
</span><span id="line-802"></span><span>               </span><span class="hs-identifier">TyConI</span><span> </span><span class="hs-identifier">d</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">d</span><span>
</span><span id="line-803"></span><span>               </span><span class="hs-identifier">FamilyI</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">d</span><span>
</span><span id="line-804"></span><span>               </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-805"></span><span>      </span><span class="hs-identifier">match_cusk</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">dec</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span class="hs-comment">{- | @reifyType nm@ attempts to find the type or kind of @nm@. For example,
@reifyType 'not@   returns @Bool -&gt; Bool@, and
@reifyType ''Bool@ returns @Type@.
This works even if there's no explicit signature and the type or kind is inferred.
-}</span><span>
</span><span id="line-812"></span><span class="hs-identifier">reifyType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Q</span><span> </span><span class="hs-identifier">Type</span><span>
</span><span id="line-813"></span><span class="hs-identifier">reifyType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">qReifyType</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-816"></span><span class="hs-comment">-- | Like 'reifyTypeWithLocals_maybe', but throws an exception upon failure,</span><span>
</span><span id="line-817"></span><span class="hs-comment">-- warning the user about separating splices.</span><span>
</span><span id="line-818"></span><span id="local-6989586621679508622"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals"><span class="hs-identifier hs-type">reifyTypeWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508622"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508622"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span></span><span>
</span><span id="line-819"></span><span id="reifyTypeWithLocals"><span class="annot"><span class="annottext">reifyTypeWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals"><span class="hs-identifier hs-var hs-var">reifyTypeWithLocals</span></a></span></span><span> </span><span id="local-6989586621679507641"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507641"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-820"></span><span>  </span><span id="local-6989586621679507640"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507640"><span class="hs-identifier hs-var">m_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe Kind)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals_maybe"><span class="hs-identifier hs-var">reifyTypeWithLocals_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507641"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507640"><span class="hs-identifier hs-var">m_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; Name -&gt; m a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyFail"><span class="hs-identifier hs-var">reifyFail</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507641"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507639"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507639"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507639"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span class="hs-comment">-- | Like 'reifyWithLocals_maybe' but for types and kinds. Note that a return</span><span>
</span><span id="line-826"></span><span class="hs-comment">-- value of @Nothing@ might mean that the name is not in scope, or it might</span><span>
</span><span id="line-827"></span><span class="hs-comment">-- mean that the full type of the name cannot be determined. (Use</span><span>
</span><span id="line-828"></span><span class="hs-comment">-- 'reifyWithLocals_maybe' if you really need to tell the difference.)</span><span>
</span><span id="line-829"></span><span id="local-6989586621679508620"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals_maybe"><span class="hs-identifier hs-type">reifyTypeWithLocals_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508620"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508620"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-830"></span><span id="reifyTypeWithLocals_maybe"><span class="annot"><span class="annottext">reifyTypeWithLocals_maybe :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe Kind)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeWithLocals_maybe"><span class="hs-identifier hs-var hs-var">reifyTypeWithLocals_maybe</span></a></span></span><span> </span><span id="local-6989586621679507624"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507624"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 809
</span><span>  </span><span id="local-6989586621679507623"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507623"><span class="hs-identifier hs-var">cusks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; Extension -&gt; m Bool
</span><span class="hs-identifier hs-var">qIsExtEnabled</span></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">CUSKs</span></span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-comment">-- On earlier GHCs, the behavior of -XCUSKs was the norm.</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">cusks</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Quasi m =&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">qRecover</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Name -&gt; [Dec] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeInDecs"><span class="hs-identifier hs-var">reifyTypeInDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507623"><span class="hs-identifier hs-var">cusks</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507624"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">`fmap`</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Kind
</span><span class="hs-identifier hs-var">qReifyType</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507624"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="hs-comment">-- | Look through a list of declarations and return its full type, if</span><span>
</span><span id="line-841"></span><span class="hs-comment">-- available.</span><span>
</span><span id="line-842"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeInDecs"><span class="hs-identifier hs-type">reifyTypeInDecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-843"></span><span id="reifyTypeInDecs"><span class="annot"><span class="annottext">reifyTypeInDecs :: Bool -&gt; Name -&gt; [Dec] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyTypeInDecs"><span class="hs-identifier hs-var hs-var">reifyTypeInDecs</span></a></span></span><span> </span><span id="local-6989586621679507620"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507620"><span class="hs-identifier hs-var">cusks</span></a></span></span><span> </span><span id="local-6989586621679507619"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507619"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679507618"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507618"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Maybe Info
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDecs"><span class="hs-identifier hs-var">reifyInDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507619"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507618"><span class="hs-identifier hs-var">decs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#infoType"><span class="hs-identifier hs-var">infoType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Name -&gt; [Dec] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findKind"><span class="hs-identifier hs-var">findKind</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507620"><span class="hs-identifier hs-var">cusks</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507619"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507618"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="hs-comment">-- Extract the type information (if any) contained in an Info.</span><span>
</span><span id="line-847"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#infoType"><span class="hs-identifier hs-type">infoType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-848"></span><span id="infoType"><span class="annot"><span class="annottext">infoType :: Info -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#infoType"><span class="hs-identifier hs-var hs-var">infoType</span></a></span></span><span> </span><span id="local-6989586621679507614"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507614"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507614"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-850"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ClassOpI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507613"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507613"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 800
</span><span>             </span><span class="hs-identifier">_</span><span class="hs-cpp">
#endif
</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507613"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-855"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">DataConI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507612"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507612"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 800
</span><span>             </span><span class="hs-identifier">_</span><span class="hs-cpp">
#endif
</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507612"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-860"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">VarI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507611"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507611"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
</span><span class="hs-identifier">_</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 800
</span><span>         </span><span class="hs-identifier">_</span><span class="hs-cpp">
#endif
</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507611"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-865"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TyVarI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507609"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507609"><span class="hs-identifier hs-var">t</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507609"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 802
</span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PatSynI</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507608"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507608"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507608"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span class="hs-comment">-- Like findType, but instead searching for kind signatures.</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- This mostly searches through `KiSigD`s, but if the -XCUSKs extension is</span><span>
</span><span id="line-873"></span><span class="hs-comment">-- enabled, this also retrieves kinds for declarations with CUSKs.</span><span>
</span><span id="line-874"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#findKind"><span class="hs-identifier hs-type">findKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- Is -XCUSKs enabled?</span><span>
</span><span id="line-875"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-876"></span><span id="findKind"><span class="annot"><span class="annottext">findKind :: Bool -&gt; Name -&gt; [Dec] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#findKind"><span class="hs-identifier hs-var hs-var">findKind</span></a></span></span><span> </span><span id="local-6989586621679507607"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507607"><span class="hs-identifier hs-var">cusks</span></a></span></span><span> </span><span id="local-6989586621679507606"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507606"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679507605"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507605"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-877"></span><span>      </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#match_kind_sig"><span class="hs-identifier hs-var">match_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507606"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507605"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507605"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-878"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; Bool -&gt; f a -&gt; f a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-var">whenAlt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507607"><span class="hs-identifier hs-var">cusks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507606"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507605"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span class="hs-comment">-- Look for a declaration's kind by searching for its standalone kind</span><span>
</span><span id="line-881"></span><span class="hs-comment">-- signature, if available.</span><span>
</span><span id="line-882"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_kind_sig"><span class="hs-identifier hs-type">match_kind_sig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-883"></span><span id="match_kind_sig"><span class="annot"><span class="annottext">match_kind_sig :: Name -&gt; [Dec] -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#match_kind_sig"><span class="hs-identifier hs-var hs-var">match_kind_sig</span></a></span></span><span> </span><span id="local-6989586621679507601"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507601"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507600"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507600"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507599"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507599"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507598"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507598"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507597"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507597"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-comment">-- If a class has a standalone kind signature, then we can determine the</span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-comment">-- full kind of its associated types in 99% of cases.</span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-comment">-- See Note [The limitations of standalone kind signatures] for what</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-comment">-- happens in the other 1% of cases.</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507596"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507596"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#find_kind_sig"><span class="hs-identifier hs-var">find_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507599"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507600"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507594"><span class="annot"><span class="annottext">FunArgs
</span><a href="#local-6989586621679507594"><span class="hs-identifier hs-var">arg_kis</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507593"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507593"><span class="hs-identifier hs-var">_res_ki</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind -&gt; (FunArgs, Kind)
</span><a href="Language.Haskell.TH.Desugar.Util.html#unravelType"><span class="hs-identifier hs-var">unravelType</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507596"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-890"></span><span>        </span><span id="local-6989586621679507592"><span class="annot"><span class="annottext">mb_vis_arg_kis :: [Maybe Kind]
</span><a href="#local-6989586621679507592"><span class="hs-identifier hs-var hs-var">mb_vis_arg_kis</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">VisFunArg -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#vis_arg_kind_maybe"><span class="hs-identifier hs-var">vis_arg_kind_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FunArgs -&gt; [VisFunArg]
</span><a href="Language.Haskell.TH.Desugar.Util.html#filterVisFunArgs"><span class="hs-identifier hs-var">filterVisFunArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FunArgs
</span><a href="#local-6989586621679507594"><span class="hs-identifier hs-var">arg_kis</span></a></span><span>
</span><span id="line-891"></span><span>        </span><span id="local-6989586621679507588"><span class="annot"><span class="annottext">cls_tvb_kind_map :: Map Name Kind
</span><a href="#local-6989586621679507588"><span class="hs-identifier hs-var hs-var">cls_tvb_kind_map</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-892"></span><span>          </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507586"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507585"><span class="hs-identifier hs-var">tvb_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507586"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507586"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507584"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507584"><span class="hs-identifier hs-var">mb_vis_arg_ki</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507598"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Kind]
</span><a href="#local-6989586621679507592"><span class="hs-identifier hs-var">mb_vis_arg_kis</span></a></span><span>
</span><span id="line-894"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507585"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507585"><span class="hs-identifier hs-var">tvb_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507584"><span class="hs-identifier hs-var">mb_vis_arg_ki</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-var">tvb_kind_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507586"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-895"></span><span>                       </span><span class="hs-special">]</span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Map Name Kind -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#find_assoc_type_kind"><span class="hs-identifier hs-var">find_assoc_type_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507601"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Kind
</span><a href="#local-6989586621679507588"><span class="hs-identifier hs-var">cls_tvb_kind_map</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507597"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-897"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_kind_sig"><span class="hs-identifier hs-var">match_kind_sig</span></a></span><span> </span><span id="local-6989586621679507581"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507581"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507580"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507580"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#find_kind_sig"><span class="hs-identifier hs-var">find_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507581"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507580"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#find_kind_sig"><span class="hs-identifier hs-type">find_kind_sig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 809
</span><span id="find_kind_sig"><span class="annot"><span class="annottext">find_kind_sig :: Name -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#find_kind_sig"><span class="hs-identifier hs-var hs-var">find_kind_sig</span></a></span></span><span> </span><span id="local-6989586621679507579"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507579"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KiSigD</span></span><span> </span><span id="local-6989586621679507577"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507577"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507576"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507576"><span class="hs-identifier hs-var">ki</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507579"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507577"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507576"><span class="hs-identifier hs-var">ki</span></a></span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#find_kind_sig"><span class="hs-identifier hs-var">find_kind_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span class="hs-comment">-- Compute a declaration's kind by retrieving its CUSK, if it has one.</span><span>
</span><span id="line-907"></span><span class="hs-comment">-- This is only done when -XCUSKs is enabled, or on older GHCs where</span><span>
</span><span id="line-908"></span><span class="hs-comment">-- CUSKs were the only means of specifying this information.</span><span>
</span><span id="line-909"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-type">match_cusk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 800
</span><span id="match_cusk"><span class="annot"><span class="annottext">match_cusk :: Name -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var hs-var">match_cusk</span></a></span></span><span> </span><span id="local-6989586621679507575"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507575"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507574"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507574"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507573"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507573"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507572"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507572"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507575"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507574"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#datatype_kind"><span class="hs-identifier hs-var">datatype_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507573"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507572"><span class="hs-identifier hs-var">m_ki</span></a></span><span>
</span><span id="line-914"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span id="local-6989586621679507570"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507570"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NewtypeD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507569"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507569"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507568"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507568"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507567"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507567"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span> </span><span class="annot"><span class="annottext">Con
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507570"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507569"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#datatype_kind"><span class="hs-identifier hs-var">datatype_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507568"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507567"><span class="hs-identifier hs-var">m_ki</span></a></span><span>
</span><span id="line-917"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span id="local-6989586621679507566"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507566"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DataFamilyD</span></span><span> </span><span id="local-6989586621679507565"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507565"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507564"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507564"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507563"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507563"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507566"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507565"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#open_ty_fam_kind"><span class="hs-identifier hs-var">open_ty_fam_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507564"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507563"><span class="hs-identifier hs-var">m_ki</span></a></span><span>
</span><span id="line-920"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span id="local-6989586621679507561"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507561"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OpenTypeFamilyD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeFamilyHead</span></span><span> </span><span id="local-6989586621679507560"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507560"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507559"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507559"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507558"><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621679507558"><span class="hs-identifier hs-var">res_sig</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507561"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507560"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#open_ty_fam_kind"><span class="hs-identifier hs-var">open_ty_fam_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507559"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-var">res_sig_to_kind</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621679507558"><span class="hs-identifier hs-var">res_sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span id="local-6989586621679507556"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507556"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClosedTypeFamilyD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeFamilyHead</span></span><span> </span><span id="local-6989586621679507555"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507555"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507554"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507554"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507553"><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621679507553"><span class="hs-identifier hs-var">res_sig</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TySynEqn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507556"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507555"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-925"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#closed_ty_fam_kind"><span class="hs-identifier hs-var">closed_ty_fam_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507554"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-var">res_sig_to_kind</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621679507553"><span class="hs-identifier hs-var">res_sig</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">match_cusk</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-929"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">datatype_kind</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-930"></span><span class="hs-identifier">match_cusk</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-932"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">datatype_kind</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-933"></span><span class="hs-identifier">match_cusk</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_ki</span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-935"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">open_ty_fam_kind</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_ki</span><span>
</span><span id="line-936"></span><span class="hs-identifier">match_cusk</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClosedTypeFamilyD</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_ki</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">closed_ty_fam_kind</span><span> </span><span class="hs-identifier">tvbs</span><span> </span><span class="hs-identifier">m_ki</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span id="local-6989586621679507551"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507551"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TySynD</span></span><span> </span><span id="local-6989586621679507550"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507550"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507549"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507549"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507548"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507548"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507551"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507550"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-942"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#ty_syn_kind"><span class="hs-identifier hs-var">ty_syn_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507549"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507548"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-943"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span id="local-6989586621679507546"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507546"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassD</span></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507545"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507545"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507544"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507544"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507543"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507543"><span class="hs-identifier hs-var">sub_decs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507546"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507545"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-945"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#class_kind"><span class="hs-identifier hs-var">class_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507544"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- An associated type family can only have a CUSK if its parent class</span><span>
</span><span id="line-947"></span><span>    </span><span class="hs-comment">-- also has a CUSK.</span><span>
</span><span id="line-948"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-var">tvb_is_kinded</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507544"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679507538"><span class="annot"><span class="annottext">cls_tvb_kind_map :: Map Name Kind
</span><a href="#local-6989586621679507538"><span class="hs-identifier hs-var hs-var">cls_tvb_kind_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Name
</span><span class="hs-identifier hs-var">tvName</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507537"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507536"><span class="hs-identifier hs-var">tvb_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>                                        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679507537"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507537"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507544"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-951"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507536"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507536"><span class="hs-identifier hs-var">tvb_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-var">tvb_kind_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507537"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-952"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Map Name Kind -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#find_assoc_type_kind"><span class="hs-identifier hs-var">find_assoc_type_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507546"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Kind
</span><a href="#local-6989586621679507538"><span class="hs-identifier hs-var">cls_tvb_kind_map</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507543"><span class="hs-identifier hs-var">sub_decs</span></a></span><span>
</span><span id="line-954"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#match_cusk"><span class="hs-identifier hs-var">match_cusk</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span class="hs-comment">-- Uncover the kind of an associated type family. There is an invariant</span><span>
</span><span id="line-957"></span><span class="hs-comment">-- that this function should only ever be called when the kind of the</span><span>
</span><span id="line-958"></span><span class="hs-comment">-- parent class is known (i.e., if it has a standalone kind signature or a</span><span>
</span><span id="line-959"></span><span class="hs-comment">-- CUSK). Despite this, it is possible for this function to return Nothing.</span><span>
</span><span id="line-960"></span><span class="hs-comment">-- See Note [The limitations of standalone kind signatures].</span><span>
</span><span id="line-961"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#find_assoc_type_kind"><span class="hs-identifier hs-type">find_assoc_type_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-962"></span><span id="find_assoc_type_kind"><span class="annot"><span class="annottext">find_assoc_type_kind :: Name -&gt; Map Name Kind -&gt; Dec -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#find_assoc_type_kind"><span class="hs-identifier hs-var hs-var">find_assoc_type_kind</span></a></span></span><span> </span><span id="local-6989586621679507535"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507535"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507534"><span class="annot"><span class="annottext">Map Name Kind
</span><a href="#local-6989586621679507534"><span class="hs-identifier hs-var">cls_tvb_kind_map</span></a></span></span><span> </span><span id="local-6989586621679507533"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507533"><span class="hs-identifier hs-var">sub_dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679507533"><span class="hs-identifier hs-var">sub_dec</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 800
</span><span>    </span><span class="annot"><span class="hs-identifier hs-type">DataFamilyD</span></span><span> </span><span id="local-6989586621679507532"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507532"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507531"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507531"><span class="hs-identifier hs-var">tf_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507530"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507530"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span>
</span><span id="line-966"></span><span>      </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507535"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507532"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-967"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; TyVarBndrUnit
</span><a href="#local-6989586621679507528"><span class="hs-identifier hs-var">ascribe_tf_tvb_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507531"><span class="hs-identifier hs-var">tf_tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_res_ki"><span class="hs-identifier hs-var">default_res_ki</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507530"><span class="hs-identifier hs-var">m_ki</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">OpenTypeFamilyD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeFamilyHead</span></span><span> </span><span id="local-6989586621679507526"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507526"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679507525"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507525"><span class="hs-identifier hs-var">tf_tvbs</span></a></span></span><span> </span><span id="local-6989586621679507524"><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621679507524"><span class="hs-identifier hs-var">res_sig</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>      </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507535"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Util.html#nameMatches"><span class="hs-operator hs-var">`nameMatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507526"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-970"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; TyVarBndrUnit
</span><a href="#local-6989586621679507528"><span class="hs-identifier hs-var">ascribe_tf_tvb_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507525"><span class="hs-identifier hs-var">tf_tvbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_res_ki"><span class="hs-identifier hs-var">default_res_ki</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-var">res_sig_to_kind</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621679507524"><span class="hs-identifier hs-var">res_sig</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">FamilyD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">tf_tvbs</span><span> </span><span class="hs-identifier">m_ki</span><span>
</span><span id="line-974"></span><span>      </span><span class="hs-glyph">|</span><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nameMatches</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n'</span><span>
</span><span id="line-975"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">build_kind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">ascribe_tf_tvb_kind</span><span> </span><span class="hs-identifier">tf_tvbs</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">default_res_ki</span><span> </span><span class="hs-identifier">m_ki</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-978"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-979"></span><span>    </span><span class="annot"><a href="#local-6989586621679507528"><span class="hs-identifier hs-type">ascribe_tf_tvb_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span>
</span><span id="line-980"></span><span>    </span><span id="local-6989586621679507528"><span class="annot"><span class="annottext">ascribe_tf_tvb_kind :: TyVarBndrUnit -&gt; TyVarBndrUnit
</span><a href="#local-6989586621679507528"><span class="hs-identifier hs-var hs-var">ascribe_tf_tvb_kind</span></a></span></span><span> </span><span id="local-6989586621679507523"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507523"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-981"></span><span>      </span><span class="annot"><span class="annottext">forall r flag.
(Name -&gt; r) -&gt; (Name -&gt; Kind -&gt; r) -&gt; TyVarBndr_ flag -&gt; r
</span><span class="hs-identifier hs-var">elimTV</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679507521"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507521"><span class="hs-identifier hs-var">tvn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; TyVarBndrUnit
</span><span class="hs-identifier hs-var">kindedTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507521"><span class="hs-identifier hs-var">tvn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507521"><span class="hs-identifier hs-var">tvn</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Kind
</span><a href="#local-6989586621679507534"><span class="hs-identifier hs-var">cls_tvb_kind_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span>             </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507523"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>             </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507523"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span class="hs-comment">-- Data types have CUSKs when:</span><span>
</span><span id="line-986"></span><span class="hs-comment">--</span><span>
</span><span id="line-987"></span><span class="hs-comment">-- 1. All of their type variables have explicit kinds.</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- 2. All kind variables in the result kind are explicitly quantified.</span><span>
</span><span id="line-989"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#datatype_kind"><span class="hs-identifier hs-type">datatype_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-990"></span><span id="datatype_kind"><span class="annot"><span class="annottext">datatype_kind :: [TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#datatype_kind"><span class="hs-identifier hs-var hs-var">datatype_kind</span></a></span></span><span> </span><span id="local-6989586621679507518"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507518"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507517"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507517"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-991"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; Bool -&gt; f a -&gt; f a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-var">whenAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-var">tvb_is_kinded</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507518"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507516"><span class="hs-identifier hs-var">ki_fvs_are_bound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-992"></span><span>  </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507518"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_res_ki"><span class="hs-identifier hs-var">default_res_ki</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507517"><span class="hs-identifier hs-var">m_ki</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-994"></span><span>    </span><span class="annot"><a href="#local-6989586621679507516"><span class="hs-identifier hs-type">ki_fvs_are_bound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-995"></span><span>    </span><span id="local-6989586621679507516"><span class="annot"><span class="annottext">ki_fvs_are_bound :: Bool
</span><a href="#local-6989586621679507516"><span class="hs-identifier hs-var hs-var">ki_fvs_are_bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679507509"><span class="annot"><span class="annottext">ki_fvs :: Set Name
</span><a href="#local-6989586621679507509"><span class="hs-identifier hs-var hs-var">ki_fvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><span class="hs-identifier hs-var">freeVariables</span></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507517"><span class="hs-identifier hs-var">m_ki</span></a></span><span>
</span><span id="line-997"></span><span>          </span><span id="local-6989586621679507501"><span class="annot"><span class="annottext">tvb_vars :: Set Name
</span><a href="#local-6989586621679507501"><span class="hs-identifier hs-var hs-var">tvb_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><span class="hs-identifier hs-var">freeVariables</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Util.html#tvbToTypeWithSig"><span class="hs-identifier hs-var">tvbToTypeWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507518"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-998"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507509"><span class="hs-identifier hs-var">ki_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.isSubsetOf`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507501"><span class="hs-identifier hs-var">tvb_vars</span></a></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- Classes have CUSKs when all of their type variables have explicit kinds.</span><span>
</span><span id="line-1001"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#class_kind"><span class="hs-identifier hs-type">class_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1002"></span><span id="class_kind"><span class="annot"><span class="annottext">class_kind :: [TyVarBndrUnit] -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#class_kind"><span class="hs-identifier hs-var hs-var">class_kind</span></a></span></span><span> </span><span id="local-6989586621679507499"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507499"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; Bool -&gt; f a -&gt; f a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-var">whenAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-var">tvb_is_kinded</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507499"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1003"></span><span>                  </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507499"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ConstraintT</span></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- Open type families and data families always have CUSKs. Type variables</span><span>
</span><span id="line-1006"></span><span class="hs-comment">-- without explicit kinds default to Type, as does the return kind if it</span><span>
</span><span id="line-1007"></span><span class="hs-comment">-- is not specified.</span><span>
</span><span id="line-1008"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#open_ty_fam_kind"><span class="hs-identifier hs-type">open_ty_fam_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1009"></span><span id="open_ty_fam_kind"><span class="annot"><span class="annottext">open_ty_fam_kind :: [TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#open_ty_fam_kind"><span class="hs-identifier hs-var hs-var">open_ty_fam_kind</span></a></span></span><span> </span><span id="local-6989586621679507497"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507497"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507496"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507496"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1010"></span><span>  </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; TyVarBndrUnit
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_tvb"><span class="hs-identifier hs-var">default_tvb</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507497"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_res_ki"><span class="hs-identifier hs-var">default_res_ki</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507496"><span class="hs-identifier hs-var">m_ki</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span class="hs-comment">-- Closed type families have CUSKs when:</span><span>
</span><span id="line-1013"></span><span class="hs-comment">--</span><span>
</span><span id="line-1014"></span><span class="hs-comment">-- 1. All of their type variables have explicit kinds.</span><span>
</span><span id="line-1015"></span><span class="hs-comment">-- 2. An explicit return kind is supplied.</span><span>
</span><span id="line-1016"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#closed_ty_fam_kind"><span class="hs-identifier hs-type">closed_ty_fam_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1017"></span><span id="closed_ty_fam_kind"><span class="annot"><span class="annottext">closed_ty_fam_kind :: [TyVarBndrUnit] -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#closed_ty_fam_kind"><span class="hs-identifier hs-var hs-var">closed_ty_fam_kind</span></a></span></span><span> </span><span id="local-6989586621679507494"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507494"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507493"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507493"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1018"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507493"><span class="hs-identifier hs-var">m_ki</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1019"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679507492"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507492"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; Bool -&gt; f a -&gt; f a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-var">whenAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-var">tvb_is_kinded</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507494"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1020"></span><span>               </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507494"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507492"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-1021"></span><span>    </span><span class="annot"><span class="annottext">Maybe Kind
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- Type synonyms have CUSKs when:</span><span>
</span><span id="line-1024"></span><span class="hs-comment">--</span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- 1. All of their type variables have explicit kinds.</span><span>
</span><span id="line-1026"></span><span class="hs-comment">-- 2. The right-hand-side type is annotated with an explicit kind.</span><span>
</span><span id="line-1027"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#ty_syn_kind"><span class="hs-identifier hs-type">ty_syn_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1028"></span><span id="ty_syn_kind"><span class="annot"><span class="annottext">ty_syn_kind :: [TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#ty_syn_kind"><span class="hs-identifier hs-var hs-var">ty_syn_kind</span></a></span></span><span> </span><span id="local-6989586621679507491"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507491"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679507490"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507490"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1029"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507490"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1030"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">SigT</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507488"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507488"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; Bool -&gt; f a -&gt; f a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-var">whenAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-var">tvb_is_kinded</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507491"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1031"></span><span>                 </span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var">build_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507491"><span class="hs-identifier hs-var">tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507488"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-1032"></span><span>    </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- Attempt to construct the full kind of a type-level declaration from its</span><span>
</span><span id="line-1035"></span><span class="hs-comment">-- type variable binders and return kind. Do note that the result type of</span><span>
</span><span id="line-1036"></span><span class="hs-comment">-- this function is `Maybe Kind` because there are situations where even</span><span>
</span><span id="line-1037"></span><span class="hs-comment">-- this amount of information is not sufficient to determine the full kind.</span><span>
</span><span id="line-1038"></span><span class="hs-comment">-- See Note [The limitations of standalone kind signatures].</span><span>
</span><span id="line-1039"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-type">build_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1040"></span><span id="build_kind"><span class="annot"><span class="annottext">build_kind :: [TyVarBndrUnit] -&gt; Kind -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#build_kind"><span class="hs-identifier hs-var hs-var">build_kind</span></a></span></span><span> </span><span id="local-6989586621679507487"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507487"><span class="hs-identifier hs-var">arg_kinds</span></a></span></span><span> </span><span id="local-6989586621679507486"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507486"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1041"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind
</span><span class="hs-identifier hs-var">quantifyType</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1042"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; (Maybe Kind, Set Name) -&gt; (Maybe Kind, Set Name)
</span><a href="#local-6989586621679507483"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507486"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><span class="hs-identifier hs-var">freeVariables</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507486"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679507487"><span class="hs-identifier hs-var">arg_kinds</span></a></span><span>
</span><span id="line-1043"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1044"></span><span>    </span><span class="annot"><a href="#local-6989586621679507483"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>    </span><span id="local-6989586621679507483"><span class="annot"><span class="annottext">go :: TyVarBndrUnit -&gt; (Maybe Kind, Set Name) -&gt; (Maybe Kind, Set Name)
</span><a href="#local-6989586621679507483"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679507482"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507482"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507481"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507481"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507480"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507480"><span class="hs-identifier hs-var">res_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1046"></span><span>      </span><span class="annot"><span class="annottext">forall r flag.
(Name -&gt; r) -&gt; (Name -&gt; Kind -&gt; r) -&gt; TyVarBndr_ flag -&gt; r
</span><span class="hs-identifier hs-var">elimTV</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679507479"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507479"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1047"></span><span>               </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507479"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507480"><span class="hs-identifier hs-var">res_fvs</span></a></span><span>
</span><span id="line-1048"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="#local-6989586621679507477"><span class="hs-identifier hs-var">forall_vis</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507482"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507481"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1049"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- We have a type variable binder without an</span><span>
</span><span id="line-1050"></span><span>                              </span><span class="hs-comment">-- explicit kind that is not used dependently, so</span><span>
</span><span id="line-1051"></span><span>                              </span><span class="hs-comment">-- we cannot build a kind from it. This is the</span><span>
</span><span id="line-1052"></span><span>                              </span><span class="hs-comment">-- only case where we return Nothing.</span><span>
</span><span id="line-1053"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507480"><span class="hs-identifier hs-var">res_fvs</span></a></span><span>
</span><span id="line-1054"></span><span>               </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>             </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679507476"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507476"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679507475"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507475"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1056"></span><span>               </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507476"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507480"><span class="hs-identifier hs-var">res_fvs</span></a></span><span>
</span><span id="line-1057"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="#local-6989586621679507477"><span class="hs-identifier hs-var">forall_vis</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507482"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507481"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1058"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507475"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Kind -&gt; Kind -&gt; Kind
</span><span class="hs-operator hs-var">`AppT`</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507481"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1059"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><span class="hs-identifier hs-var">freeVariables</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507475"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.union`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679507480"><span class="hs-identifier hs-var">res_fvs</span></a></span><span>
</span><span id="line-1060"></span><span>               </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>             </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507482"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>    </span><span class="annot"><a href="#local-6989586621679507477"><span class="hs-identifier hs-type">forall_vis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 809
</span><span>    </span><span id="local-6989586621679507477"><span class="annot"><span class="annottext">forall_vis :: TyVarBndrUnit -&gt; Maybe Kind -&gt; Maybe Kind
</span><a href="#local-6989586621679507477"><span class="hs-identifier hs-var hs-var">forall_vis</span></a></span></span><span> </span><span id="local-6989586621679507473"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507473"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span id="local-6989586621679507472"><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507472"><span class="hs-identifier hs-var">m_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrUnit] -&gt; Kind -&gt; Kind
</span><span class="hs-identifier hs-var">ForallVisT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507473"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Kind
</span><a href="#local-6989586621679507472"><span class="hs-identifier hs-var">m_ki</span></a></span><span>
</span><span id="line-1066"></span><span>      </span><span class="hs-comment">-- One downside of this approach is that we generate kinds like this:</span><span>
</span><span id="line-1067"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1068"></span><span>      </span><span class="hs-comment">--   forall a -&gt; forall b -&gt; forall c -&gt; (a, b, c)</span><span>
</span><span id="line-1069"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1070"></span><span>      </span><span class="hs-comment">-- Instead of this more compact kind:</span><span>
</span><span id="line-1071"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1072"></span><span>      </span><span class="hs-comment">--   forall a b c -&gt; (a, b, c)</span><span>
</span><span id="line-1073"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1074"></span><span>      </span><span class="hs-comment">-- Thankfully, the difference is only cosmetic.</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">forall_vis</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1079"></span><span id="local-6989586621679508608"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-type">tvb_is_kinded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndr_</span></span><span> </span><span class="annot"><a href="#local-6989586621679508608"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1080"></span><span id="tvb_is_kinded"><span class="annot"><span class="annottext">tvb_is_kinded :: forall flag. TyVarBndr_ flag -&gt; Bool
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_is_kinded"><span class="hs-identifier hs-var hs-var">tvb_is_kinded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-var">tvb_kind_maybe</span></a></span><span>
</span><span id="line-1081"></span><span>
</span><span id="line-1082"></span><span id="local-6989586621679508609"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-type">tvb_kind_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndr_</span></span><span> </span><span class="annot"><a href="#local-6989586621679508609"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span></span><span>
</span><span id="line-1083"></span><span id="tvb_kind_maybe"><span class="annot"><span class="annottext">tvb_kind_maybe :: forall flag. TyVarBndr_ flag -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-var hs-var">tvb_kind_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r flag.
(Name -&gt; r) -&gt; (Name -&gt; Kind -&gt; r) -&gt; TyVarBndr_ flag -&gt; r
</span><span class="hs-identifier hs-var">elimTV</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507469"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507469"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507469"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#vis_arg_kind_maybe"><span class="hs-identifier hs-type">vis_arg_kind_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#VisFunArg"><span class="hs-identifier hs-type">VisFunArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1086"></span><span id="vis_arg_kind_maybe"><span class="annot"><span class="annottext">vis_arg_kind_maybe :: VisFunArg -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#vis_arg_kind_maybe"><span class="hs-identifier hs-var hs-var">vis_arg_kind_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#VisFADep"><span class="hs-identifier hs-type">VisFADep</span></a></span><span> </span><span id="local-6989586621679507468"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507468"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-var">tvb_kind_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507468"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-1087"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#vis_arg_kind_maybe"><span class="hs-identifier hs-var">vis_arg_kind_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Util.html#VisFAAnon"><span class="hs-identifier hs-type">VisFAAnon</span></a></span><span> </span><span id="local-6989586621679507467"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507467"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507467"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#default_tvb"><span class="hs-identifier hs-type">default_tvb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndrUnit</span></span><span>
</span><span id="line-1090"></span><span id="default_tvb"><span class="annot"><span class="annottext">default_tvb :: TyVarBndrUnit -&gt; TyVarBndrUnit
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_tvb"><span class="hs-identifier hs-var hs-var">default_tvb</span></a></span></span><span> </span><span id="local-6989586621679507466"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507466"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r flag.
(Name -&gt; r) -&gt; (Name -&gt; Kind -&gt; r) -&gt; TyVarBndr_ flag -&gt; r
</span><span class="hs-identifier hs-var">elimTV</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679507465"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507465"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Kind -&gt; TyVarBndrUnit
</span><span class="hs-identifier hs-var">kindedTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507465"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507466"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507466"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#default_res_ki"><span class="hs-identifier hs-type">default_res_ki</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1093"></span><span id="default_res_ki"><span class="annot"><span class="annottext">default_res_ki :: Maybe Kind -&gt; Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#default_res_ki"><span class="hs-identifier hs-var hs-var">default_res_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><span class="hs-identifier hs-var">StarT</span></span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &gt;= 800
</span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-type">res_sig_to_kind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FamilyResultSig</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-1097"></span><span id="res_sig_to_kind"><span class="annot"><span class="annottext">res_sig_to_kind :: FamilyResultSig -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-var hs-var">res_sig_to_kind</span></a></span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><span class="hs-identifier hs-var">NoSig</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1098"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-var">res_sig_to_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KindSig</span></span><span> </span><span id="local-6989586621679507462"><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507462"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Kind
</span><a href="#local-6989586621679507462"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1099"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#res_sig_to_kind"><span class="hs-identifier hs-var">res_sig_to_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyVarSig</span></span><span> </span><span id="local-6989586621679507460"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507460"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Maybe Kind
</span><a href="Language.Haskell.TH.Desugar.Reify.html#tvb_kind_maybe"><span class="hs-identifier hs-var">tvb_kind_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679507460"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1102"></span><span id="local-6989586621679508615"><span id="local-6989586621679508616"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-type">whenAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679508616"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508616"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508615"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508616"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508615"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1103"></span><span id="whenAlt"><span class="annot"><span class="annottext">whenAlt :: forall (f :: * -&gt; *) a. Alternative f =&gt; Bool -&gt; f a -&gt; f a
</span><a href="Language.Haskell.TH.Desugar.Reify.html#whenAlt"><span class="hs-identifier hs-var hs-var">whenAlt</span></a></span></span><span> </span><span id="local-6989586621679507457"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507457"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679507456"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679507456"><span class="hs-identifier hs-var">fa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507457"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679507456"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span class="hs-comment">{-
Note [The limitations of standalone kind signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A current limitation of StandaloneKindSignatures is that they cannot be applied
to associated type families. This can have some surprising consequences.
Consider the following code, taken from
https://gitlab.haskell.org/ghc/ghc/issues/17072#note_221324:

  type C :: forall a -&gt; a -&gt; Constraint
  class C a b where
    type T a :: Type

The parent class C has a standalone kind signature, so GHC treats its
associated types as if they had CUSKs. Can th-desugar figure out the kind
that GHC gives to T?

Unfortunately, the answer is &quot;not easily&quot;. This is because `type T a` says
nothing about the kind of `a`, so th-desugar's only other option is to inspect
the kind signature for C. Even this is for naught, as the `forall a -&gt; ...`
part doesn't state the kind of `a` either! The only way to know that the kind
of `a` should be Type is to infer that from the rest of the kind
(`a -&gt; Constraint`), but this gets perilously close to requiring full kind
inference, which is rather unwieldy in Template Haskell.

In cases like T, we simply give up and return Nothing when trying to reify
its kind. It's not ideal, but them's the breaks when you try to extract kinds
from syntax. There is a rather simple workaround available: just write
`type C :: forall (a :: Type) -&gt; a -&gt; Constraint` instead.
-}</span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-1136"></span><span class="hs-comment">-- Looking up name value and type names</span><span>
</span><span id="line-1137"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span class="hs-comment">-- | Like 'lookupValueName' from Template Haskell, but looks also in 'Names' of</span><span>
</span><span id="line-1140"></span><span class="hs-comment">-- not-yet-typechecked declarations. To establish this list of not-yet-typechecked</span><span>
</span><span id="line-1141"></span><span class="hs-comment">-- declarations, use 'withLocalDeclarations'. Returns 'Nothing' if no value</span><span>
</span><span id="line-1142"></span><span class="hs-comment">-- with the same name can be found.</span><span>
</span><span id="line-1143"></span><span id="local-6989586621679508586"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#lookupValueNameWithLocals"><span class="hs-identifier hs-type">lookupValueNameWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508586"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508586"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1144"></span><span id="lookupValueNameWithLocals"><span class="annot"><span class="annottext">lookupValueNameWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupValueNameWithLocals"><span class="hs-identifier hs-var hs-var">lookupValueNameWithLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Bool -&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupNameWithLocals"><span class="hs-identifier hs-var">lookupNameWithLocals</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span class="hs-comment">-- | Like 'lookupTypeName' from Template Haskell, but looks also in 'Names' of</span><span>
</span><span id="line-1147"></span><span class="hs-comment">-- not-yet-typechecked declarations. To establish this list of not-yet-typechecked</span><span>
</span><span id="line-1148"></span><span class="hs-comment">-- declarations, use 'withLocalDeclarations'. Returns 'Nothing' if no type</span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- with the same name can be found.</span><span>
</span><span id="line-1150"></span><span id="local-6989586621679507451"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#lookupTypeNameWithLocals"><span class="hs-identifier hs-type">lookupTypeNameWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679507451"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679507451"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1151"></span><span id="lookupTypeNameWithLocals"><span class="annot"><span class="annottext">lookupTypeNameWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupTypeNameWithLocals"><span class="hs-identifier hs-var hs-var">lookupTypeNameWithLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Bool -&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupNameWithLocals"><span class="hs-identifier hs-var">lookupNameWithLocals</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span id="local-6989586621679508584"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#lookupNameWithLocals"><span class="hs-identifier hs-type">lookupNameWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508584"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508584"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1154"></span><span id="lookupNameWithLocals"><span class="annot"><span class="annottext">lookupNameWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; Bool -&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupNameWithLocals"><span class="hs-identifier hs-var hs-var">lookupNameWithLocals</span></a></span></span><span> </span><span id="local-6989586621679507441"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507441"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679507440"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679507440"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1155"></span><span>    </span><span id="local-6989586621679507439"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679507439"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; Bool -&gt; String -&gt; m (Maybe Name)
</span><span class="hs-identifier hs-var">qLookupName</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507441"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679507440"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1156"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679507439"><span class="hs-identifier hs-var">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1157"></span><span>      </span><span id="local-6989586621679507437"><span class="annot"><span class="annottext">j_name :: Maybe Name
</span><a href="#local-6989586621679507437"><span class="hs-identifier hs-var">j_name</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679507437"><span class="hs-identifier hs-var">j_name</span></a></span><span>
</span><span id="line-1158"></span><span>      </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">q (Maybe Name)
</span><a href="#local-6989586621679507436"><span class="hs-identifier hs-var">consult_locals</span></a></span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1160"></span><span>    </span><span id="local-6989586621679507435"><span class="annot"><span class="annottext">built_name :: Name
</span><a href="#local-6989586621679507435"><span class="hs-identifier hs-var hs-var">built_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679507440"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>    </span><span id="local-6989586621679507436"><span class="annot"><span class="annottext">consult_locals :: q (Maybe Name)
</span><a href="#local-6989586621679507436"><span class="hs-identifier hs-var hs-var">consult_locals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1163"></span><span>      </span><span id="local-6989586621679507431"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507431"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). DsMonad m =&gt; m [Dec]
</span><a href="Language.Haskell.TH.Desugar.Reify.html#localDeclarations"><span class="hs-identifier hs-var">localDeclarations</span></a></span><span>
</span><span id="line-1164"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679507430"><span class="annot"><span class="annottext">mb_infos :: [Maybe (Named Info)]
</span><a href="#local-6989586621679507430"><span class="hs-identifier hs-var hs-var">mb_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Dec] -&gt; Dec -&gt; Maybe (Named Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyInDec"><span class="hs-identifier hs-var">reifyInDec</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507435"><span class="hs-identifier hs-var">built_name</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507431"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679507431"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-1165"></span><span>          </span><span id="local-6989586621679507429"><span class="annot"><span class="annottext">infos :: [Named Info]
</span><a href="#local-6989586621679507429"><span class="hs-identifier hs-var hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Named Info)]
</span><a href="#local-6989586621679507430"><span class="hs-identifier hs-var">mb_infos</span></a></span><span>
</span><span id="line-1166"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Language.Haskell.TH.Desugar.Util.html#firstMatch"><span class="hs-identifier hs-var">firstMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679507441"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Named Info -&gt; Maybe Name
</span><a href="#local-6989586621679507427"><span class="hs-identifier hs-var">find_type_name</span></a></span><span>
</span><span id="line-1167"></span><span>                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Named Info -&gt; Maybe Name
</span><a href="#local-6989586621679507426"><span class="hs-identifier hs-var">find_value_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Named Info]
</span><a href="#local-6989586621679507429"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span>    </span><span class="hs-comment">-- These functions work over Named Infos so we can avoid performing</span><span>
</span><span id="line-1170"></span><span>    </span><span class="hs-comment">-- tiresome pattern-matching to retrieve the name associated with each Info.</span><span>
</span><span id="line-1171"></span><span>    </span><span class="annot"><a href="#local-6989586621679507427"><span class="hs-identifier hs-type">find_type_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679507426"><span class="hs-identifier hs-type">find_value_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-1172"></span><span>    </span><span id="local-6989586621679507427"><span class="annot"><span class="annottext">find_type_name :: Named Info -&gt; Maybe Name
</span><a href="#local-6989586621679507427"><span class="hs-identifier hs-var hs-var">find_type_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507425"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507425"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507424"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507424"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1173"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info -&gt; NameSpace
</span><a href="Language.Haskell.TH.Desugar.Reify.html#infoNameSpace"><span class="hs-identifier hs-var">infoNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507424"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1174"></span><span>        </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507425"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1175"></span><span>        </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">VarName</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1176"></span><span>        </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">DataName</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1177"></span><span>
</span><span id="line-1178"></span><span>    </span><span id="local-6989586621679507426"><span class="annot"><span class="annottext">find_value_name :: Named Info -&gt; Maybe Name
</span><a href="#local-6989586621679507426"><span class="hs-identifier hs-var hs-var">find_value_name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679507419"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507419"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679507418"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507418"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1179"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info -&gt; NameSpace
</span><a href="Language.Haskell.TH.Desugar.Reify.html#infoNameSpace"><span class="hs-identifier hs-var">infoNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507418"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1180"></span><span>        </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">VarName</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507419"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1181"></span><span>        </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">DataName</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507419"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1182"></span><span>        </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span class="hs-comment">-- | Like TH's @lookupValueName@, but if this name is not bound, then we assume</span><span>
</span><span id="line-1185"></span><span class="hs-comment">-- it is declared in the current module.</span><span>
</span><span id="line-1186"></span><span class="hs-comment">--</span><span>
</span><span id="line-1187"></span><span class="hs-comment">-- Unlike 'mkDataName', this also consults the local declarations in scope when</span><span>
</span><span id="line-1188"></span><span class="hs-comment">-- determining if the name is currently bound.</span><span>
</span><span id="line-1189"></span><span id="local-6989586621679508579"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkDataNameWithLocals"><span class="hs-identifier hs-type">mkDataNameWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508579"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508579"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span><span>
</span><span id="line-1190"></span><span id="mkDataNameWithLocals"><span class="annot"><span class="annottext">mkDataNameWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; String -&gt; q Name
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkDataNameWithLocals"><span class="hs-identifier hs-var hs-var">mkDataNameWithLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *).
Quasi q =&gt;
(String -&gt; q (Maybe Name))
-&gt; (String -&gt; String -&gt; String -&gt; Name) -&gt; String -&gt; q Name
</span><a href="Language.Haskell.TH.Desugar.Util.html#mkNameWith"><span class="hs-identifier hs-var">mkNameWith</span></a></span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupValueNameWithLocals"><span class="hs-identifier hs-var">lookupValueNameWithLocals</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><span class="hs-identifier hs-var">mkNameG_d</span></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- | Like TH's @lookupTypeName@, but if this name is not bound, then we assume</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- it is declared in the current module.</span><span>
</span><span id="line-1194"></span><span class="hs-comment">--</span><span>
</span><span id="line-1195"></span><span class="hs-comment">-- Unlike 'mkTypeName', this also consults the local declarations in scope when</span><span>
</span><span id="line-1196"></span><span class="hs-comment">-- determining if the name is currently bound.</span><span>
</span><span id="line-1197"></span><span id="local-6989586621679507412"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#mkTypeNameWithLocals"><span class="hs-identifier hs-type">mkTypeNameWithLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679507412"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679507412"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span></span><span>
</span><span id="line-1198"></span><span id="mkTypeNameWithLocals"><span class="annot"><span class="annottext">mkTypeNameWithLocals :: forall (q :: * -&gt; *). DsMonad q =&gt; String -&gt; q Name
</span><a href="Language.Haskell.TH.Desugar.Reify.html#mkTypeNameWithLocals"><span class="hs-identifier hs-var hs-var">mkTypeNameWithLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *).
Quasi q =&gt;
(String -&gt; q (Maybe Name))
-&gt; (String -&gt; String -&gt; String -&gt; Name) -&gt; String -&gt; q Name
</span><a href="Language.Haskell.TH.Desugar.Util.html#mkNameWith"><span class="hs-identifier hs-var">mkNameWith</span></a></span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; String -&gt; q (Maybe Name)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#lookupTypeNameWithLocals"><span class="hs-identifier hs-var">lookupTypeNameWithLocals</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><span class="hs-identifier hs-var">mkNameG_tc</span></span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span class="hs-comment">-- | Determines a `Name`'s 'NameSpace'. If the 'NameSpace' is attached to</span><span>
</span><span id="line-1201"></span><span class="hs-comment">-- the 'Name' itself (i.e., it is unambiguous), then that 'NameSpace' is</span><span>
</span><span id="line-1202"></span><span class="hs-comment">-- immediately returned. Otherwise, reification is used to lookup up the</span><span>
</span><span id="line-1203"></span><span class="hs-comment">-- 'NameSpace' (consulting local declarations if necessary).</span><span>
</span><span id="line-1204"></span><span class="hs-comment">--</span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- Note that if a 'Name' lives in two different 'NameSpaces' (which can</span><span>
</span><span id="line-1206"></span><span class="hs-comment">-- genuinely happen--for instance, @'mkName' \&quot;==\&quot;@, where @==@ is both</span><span>
</span><span id="line-1207"></span><span class="hs-comment">-- a function and a type family), then this function will simply return</span><span>
</span><span id="line-1208"></span><span class="hs-comment">-- whichever 'NameSpace' is discovered first via reification. If you wish</span><span>
</span><span id="line-1209"></span><span class="hs-comment">-- to find a 'Name' in a particular 'NameSpace', use the</span><span>
</span><span id="line-1210"></span><span class="hs-comment">-- 'lookupValueNameWithLocals' or 'lookupTypeNameWithLocals' functions.</span><span>
</span><span id="line-1211"></span><span id="local-6989586621679508575"><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#reifyNameSpace"><span class="hs-identifier hs-type">reifyNameSpace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#DsMonad"><span class="hs-identifier hs-type">DsMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679508575"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679508575"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSpace</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1212"></span><span id="reifyNameSpace"><span class="annot"><span class="annottext">reifyNameSpace :: forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe NameSpace)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyNameSpace"><span class="hs-identifier hs-var hs-var">reifyNameSpace</span></a></span></span><span> </span><span id="local-6989586621679507398"><span class="annot"><span class="annottext">n :: Name
</span><a href="#local-6989586621679507398"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679507396"><span class="annot"><span class="annottext">NameFlavour
</span><a href="#local-6989586621679507396"><span class="hs-identifier hs-var">nf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1213"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameFlavour
</span><a href="#local-6989586621679507396"><span class="hs-identifier hs-var">nf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1214"></span><span>    </span><span class="hs-comment">-- NameGs are simple, as they have a NameSpace attached.</span><span>
</span><span id="line-1215"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">NameG</span></span><span> </span><span id="local-6989586621679507394"><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621679507394"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="annot"><span class="annottext">PkgName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="#local-6989586621679507394"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span>    </span><span class="hs-comment">-- For other names, we must use reification to determine what NameSpace</span><span>
</span><span id="line-1218"></span><span>    </span><span class="hs-comment">-- it lives in (if any).</span><span>
</span><span id="line-1219"></span><span>    </span><span class="annot"><span class="annottext">NameFlavour
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679507393"><span class="annot"><span class="annottext">Maybe Info
</span><a href="#local-6989586621679507393"><span class="hs-identifier hs-var">mb_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (q :: * -&gt; *). DsMonad q =&gt; Name -&gt; q (Maybe Info)
</span><a href="Language.Haskell.TH.Desugar.Reify.html#reifyWithLocals_maybe"><span class="hs-identifier hs-var">reifyWithLocals_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679507398"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1220"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Info -&gt; NameSpace
</span><a href="Language.Haskell.TH.Desugar.Reify.html#infoNameSpace"><span class="hs-identifier hs-var">infoNameSpace</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Info
</span><a href="#local-6989586621679507393"><span class="hs-identifier hs-var">mb_info</span></a></span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span class="hs-comment">-- | Determine a name's 'NameSpace' from its 'Info'.</span><span>
</span><span id="line-1223"></span><span class="annot"><a href="Language.Haskell.TH.Desugar.Reify.html#infoNameSpace"><span class="hs-identifier hs-type">infoNameSpace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Info</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSpace</span></span><span>
</span><span id="line-1224"></span><span id="infoNameSpace"><span class="annot"><span class="annottext">infoNameSpace :: Info -&gt; NameSpace
</span><a href="Language.Haskell.TH.Desugar.Reify.html#infoNameSpace"><span class="hs-identifier hs-var hs-var">infoNameSpace</span></a></span></span><span> </span><span id="local-6989586621679507392"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507392"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1225"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679507392"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1226"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ClassI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span>
</span><span id="line-1227"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TyConI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span>
</span><span id="line-1228"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">FamilyI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span>
</span><span id="line-1229"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PrimTyConI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span>
</span><span id="line-1230"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TyVarI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">TcClsName</span></span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ClassOpI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">VarName</span></span><span>
</span><span id="line-1233"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">VarI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">VarName</span></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">DataConI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">DataName</span></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 801
</span><span>    </span><span class="annot"><span class="hs-identifier hs-type">PatSynI</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><span class="hs-identifier hs-var">DataName</span></span><span class="hs-cpp">
#endif
</span></pre></body></html>