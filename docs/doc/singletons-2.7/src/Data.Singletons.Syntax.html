<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- Data/Singletons/Syntax.hs

(c) Richard Eisenberg 2014
rae@cs.brynmawr.edu

Converts a list of DLetDecs into a LetDecEnv for easier processing,
and contains various other AST definitions.
-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE DataKinds, TypeFamilies, PolyKinds, DeriveDataTypeable,
             FlexibleInstances, ConstraintKinds #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Singletons.Syntax</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">exp</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Constraint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Desugar</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Desugar.OMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OMap</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Desugar.OMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Desugar.OSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">type</span><span> </span><span id="VarPromotions"><span class="annot"><a href="Data.Singletons.Syntax.html#VarPromotions"><span class="hs-identifier hs-var">VarPromotions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- from term-level name to type-level name</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Information that is accumulated when promoting patterns.</span><span>
</span><span id="line-26"></span><span class="hs-keyword">data</span><span> </span><span id="PromDPatInfos"><span class="annot"><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-var">PromDPatInfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PromDPatInfos"><span class="annot"><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-var">PromDPatInfos</span></a></span></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="prom_dpat_vars"><span class="annot"><span class="annottext">PromDPatInfos -&gt; VarPromotions
</span><a href="Data.Singletons.Syntax.html#prom_dpat_vars"><span class="hs-identifier hs-var hs-var">prom_dpat_vars</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#VarPromotions"><span class="hs-identifier hs-type">VarPromotions</span></a></span><span>
</span><span id="line-28"></span><span>      </span><span class="hs-comment">-- Maps term-level pattern variables to their promoted, type-level counterparts.</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="prom_dpat_sig_kvs"><span class="annot"><span class="annottext">PromDPatInfos -&gt; OSet Name
</span><a href="Data.Singletons.Syntax.html#prom_dpat_sig_kvs"><span class="hs-identifier hs-var hs-var">prom_dpat_sig_kvs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-30"></span><span>      </span><span class="hs-comment">-- Kind variables bound by DSigPas.</span><span>
</span><span id="line-31"></span><span>      </span><span class="hs-comment">-- See Note [Explicitly binding kind variables] in Data.Singletons.Promote.Monad</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681355539"><span id="local-6989586621681355541"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-type">PromDPatInfos</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-type">PromDPatInfos</span></a></span><span> </span><span id="local-6989586621681355537"><span class="annot"><span class="annottext">VarPromotions
</span><a href="#local-6989586621681355537"><span class="hs-identifier hs-var">vars1</span></a></span></span><span> </span><span id="local-6989586621681355536"><span class="annot"><span class="annottext">OSet Name
</span><a href="#local-6989586621681355536"><span class="hs-identifier hs-var">sig_kvs1</span></a></span></span><span> </span><span id="local-6989586621681355535"><span class="annot"><span class="annottext">&lt;&gt; :: PromDPatInfos -&gt; PromDPatInfos -&gt; PromDPatInfos
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-type">PromDPatInfos</span></a></span><span> </span><span id="local-6989586621681355534"><span class="annot"><span class="annottext">VarPromotions
</span><a href="#local-6989586621681355534"><span class="hs-identifier hs-var">vars2</span></a></span></span><span> </span><span id="local-6989586621681355533"><span class="annot"><span class="annottext">OSet Name
</span><a href="#local-6989586621681355533"><span class="hs-identifier hs-var">sig_kvs2</span></a></span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarPromotions -&gt; OSet Name -&gt; PromDPatInfos
</span><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-var">PromDPatInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarPromotions
</span><a href="#local-6989586621681355537"><span class="hs-identifier hs-var">vars1</span></a></span><span> </span><span class="annot"><span class="annottext">VarPromotions -&gt; VarPromotions -&gt; VarPromotions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">VarPromotions
</span><a href="#local-6989586621681355534"><span class="hs-identifier hs-var">vars2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OSet Name
</span><a href="#local-6989586621681355536"><span class="hs-identifier hs-var">sig_kvs1</span></a></span><span> </span><span class="annot"><span class="annottext">OSet Name -&gt; OSet Name -&gt; OSet Name
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">OSet Name
</span><a href="#local-6989586621681355533"><span class="hs-identifier hs-var">sig_kvs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681355527"><span id="local-6989586621681355529"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-type">PromDPatInfos</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>  </span><span id="local-6989586621681355525"><span class="annot"><span class="annottext">mempty :: PromDPatInfos
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarPromotions -&gt; OSet Name -&gt; PromDPatInfos
</span><a href="Data.Singletons.Syntax.html#PromDPatInfos"><span class="hs-identifier hs-var">PromDPatInfos</span></a></span><span> </span><span class="annot"><span class="annottext">VarPromotions
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">OSet Name
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- A list of 'SingDSigPaInfos' is produced when singling pattern signatures, as we</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- must case on the 'DExp's and match on them using the supplied 'DType's to</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- bring the necessary singleton equality constraints into scope.</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- See @Note [Singling pattern signatures]@.</span><span>
</span><span id="line-45"></span><span class="hs-keyword">type</span><span> </span><span id="SingDSigPaInfos"><span class="annot"><a href="Data.Singletons.Syntax.html#SingDSigPaInfos"><span class="hs-identifier hs-var">SingDSigPaInfos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DExp</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- The parts of data declarations that are relevant to singletons.</span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="DataDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DataDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#DataDecl"><span class="hs-identifier hs-var">DataDecl</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DTyVarBndr</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DCon</span></span><span class="hs-special">]</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- The parts of type synonyms that are relevant to singletons.</span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="TySynDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#TySynDecl"><span class="hs-identifier hs-var">TySynDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TySynDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#TySynDecl"><span class="hs-identifier hs-var">TySynDecl</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DTyVarBndr</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- The parts of open type families that are relevant to singletons.</span><span>
</span><span id="line-54"></span><span class="hs-keyword">type</span><span> </span><span id="OpenTypeFamilyDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#OpenTypeFamilyDecl"><span class="hs-identifier hs-var">OpenTypeFamilyDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#TypeFamilyDecl"><span class="hs-identifier hs-type">TypeFamilyDecl</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Singletons.Syntax.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- The parts of closed type families that are relevant to singletons.</span><span>
</span><span id="line-57"></span><span class="hs-keyword">type</span><span> </span><span id="ClosedTypeFamilyDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#ClosedTypeFamilyDecl"><span class="hs-identifier hs-var">ClosedTypeFamilyDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#TypeFamilyDecl"><span class="hs-identifier hs-type">TypeFamilyDecl</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Singletons.Syntax.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- The parts of type families that are relevant to singletons.</span><span>
</span><span id="line-60"></span><span class="hs-keyword">newtype</span><span> </span><span id="TypeFamilyDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#TypeFamilyDecl"><span class="hs-identifier hs-var">TypeFamilyDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681355516"><span class="annot"><a href="#local-6989586621681355516"><span class="hs-identifier hs-type">info</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#FamilyInfo"><span class="hs-identifier hs-type">FamilyInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TypeFamilyDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#TypeFamilyDecl"><span class="hs-identifier hs-var">TypeFamilyDecl</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getTypeFamilyDecl"><span class="annot"><span class="annottext">TypeFamilyDecl info -&gt; DTypeFamilyHead
</span><a href="Data.Singletons.Syntax.html#getTypeFamilyDecl"><span class="hs-identifier hs-var hs-var">getTypeFamilyDecl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DTypeFamilyHead</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Whether a type family is open or closed.</span><span>
</span><span id="line-63"></span><span class="hs-keyword">data</span><span> </span><span id="FamilyInfo"><span class="annot"><a href="Data.Singletons.Syntax.html#FamilyInfo"><span class="hs-identifier hs-var">FamilyInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Open"><span class="annot"><a href="Data.Singletons.Syntax.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Closed"><span class="annot"><a href="Data.Singletons.Syntax.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="ClassDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a></span></span><span> </span><span id="local-6989586621681355512"><span class="annot"><a href="#local-6989586621681355512"><span class="hs-identifier hs-type">ann</span></a></span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ClassDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#ClassDecl"><span class="hs-identifier hs-var">ClassDecl</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="cd_cxt"><span class="annot"><span class="annottext">ClassDecl ann -&gt; DCxt
</span><a href="Data.Singletons.Syntax.html#cd_cxt"><span class="hs-identifier hs-var hs-var">cd_cxt</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DCxt</span></span><span>
</span><span id="line-67"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="cd_name"><span class="annot"><span class="annottext">ClassDecl ann -&gt; Name
</span><a href="Data.Singletons.Syntax.html#cd_name"><span class="hs-identifier hs-var hs-var">cd_name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-68"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="cd_tvbs"><span class="annot"><span class="annottext">ClassDecl ann -&gt; [DTyVarBndr]
</span><a href="Data.Singletons.Syntax.html#cd_tvbs"><span class="hs-identifier hs-var hs-var">cd_tvbs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DTyVarBndr</span></span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="cd_fds"><span class="annot"><span class="annottext">ClassDecl ann -&gt; [FunDep]
</span><a href="Data.Singletons.Syntax.html#cd_fds"><span class="hs-identifier hs-var hs-var">cd_fds</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FunDep</span></span><span class="hs-special">]</span><span>
</span><span id="line-70"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="cd_lde"><span class="annot"><span class="annottext">ClassDecl ann -&gt; LetDecEnv ann
</span><a href="Data.Singletons.Syntax.html#cd_lde"><span class="hs-identifier hs-var hs-var">cd_lde</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-type">LetDecEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681355512"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-71"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="cd_atfs"><span class="annot"><span class="annottext">ClassDecl ann -&gt; [OpenTypeFamilyDecl]
</span><a href="Data.Singletons.Syntax.html#cd_atfs"><span class="hs-identifier hs-var hs-var">cd_atfs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Singletons.Syntax.html#OpenTypeFamilyDecl"><span class="hs-identifier hs-type">OpenTypeFamilyDecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>                  </span><span class="hs-comment">-- Associated type families. Only recorded for</span><span>
</span><span id="line-73"></span><span>                  </span><span class="hs-comment">-- defunctionalization purposes.</span><span>
</span><span id="line-74"></span><span>                  </span><span class="hs-comment">-- See Note [Partitioning, type synonyms, and type families]</span><span>
</span><span id="line-75"></span><span>                  </span><span class="hs-comment">-- in D.S.Partition.</span><span>
</span><span id="line-76"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">data</span><span> </span><span id="InstDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#InstDecl"><span class="hs-identifier hs-var">InstDecl</span></a></span></span><span>  </span><span id="local-6989586621681355504"><span class="annot"><a href="#local-6989586621681355504"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InstDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#InstDecl"><span class="hs-identifier hs-var">InstDecl</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="id_cxt"><span class="annot"><span class="annottext">InstDecl ann -&gt; DCxt
</span><a href="Data.Singletons.Syntax.html#id_cxt"><span class="hs-identifier hs-var hs-var">id_cxt</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DCxt</span></span><span>
</span><span id="line-79"></span><span>                              </span><span class="hs-special">,</span><span> </span><span id="id_name"><span class="annot"><span class="annottext">InstDecl ann -&gt; Name
</span><a href="Data.Singletons.Syntax.html#id_name"><span class="hs-identifier hs-var hs-var">id_name</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-80"></span><span>                              </span><span class="hs-special">,</span><span> </span><span id="id_arg_tys"><span class="annot"><span class="annottext">InstDecl ann -&gt; DCxt
</span><a href="Data.Singletons.Syntax.html#id_arg_tys"><span class="hs-identifier hs-var hs-var">id_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span class="hs-special">]</span><span>
</span><span id="line-81"></span><span>                              </span><span class="hs-special">,</span><span> </span><span id="id_sigs"><span class="annot"><span class="annottext">InstDecl ann -&gt; OMap Name DType
</span><a href="Data.Singletons.Syntax.html#id_sigs"><span class="hs-identifier hs-var hs-var">id_sigs</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>
</span><span id="line-82"></span><span>                              </span><span class="hs-special">,</span><span> </span><span id="id_meths"><span class="annot"><span class="annottext">InstDecl ann -&gt; [(Name, LetDecRHS ann)]
</span><a href="Data.Singletons.Syntax.html#id_meths"><span class="hs-identifier hs-var hs-var">id_meths</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-type">LetDecRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681355504"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">type</span><span> </span><span id="UClassDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#UClassDecl"><span class="hs-identifier hs-var">UClassDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">type</span><span> </span><span id="UInstDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#UInstDecl"><span class="hs-identifier hs-var">UInstDecl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#InstDecl"><span class="hs-identifier hs-type">InstDecl</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">type</span><span> </span><span id="AClassDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#AClassDecl"><span class="hs-identifier hs-var">AClassDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">type</span><span> </span><span id="AInstDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#AInstDecl"><span class="hs-identifier hs-var">AInstDecl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#InstDecl"><span class="hs-identifier hs-type">InstDecl</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">{-
We see below several datatypes beginning with &quot;A&quot;. These are annotated structures,
necessary for Promote to communicate key things to Single. In particular, promotion
of expressions is *not* deterministic, due to the necessity to create unique names
for lets, cases, and lambdas. So, we put these promotions into an annotated AST
so that Single can use the right promotions.
-}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- A DExp with let, lambda, and type-signature nodes annotated with their</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- type-level equivalents</span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="ADExp"><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-var">ADExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ADVarE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADVarE"><span class="hs-identifier hs-var">ADVarE</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-101"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADConE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADConE"><span class="hs-identifier hs-var">ADConE</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-102"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADLitE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADLitE"><span class="hs-identifier hs-var">ADLitE</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lit</span></span><span>
</span><span id="line-103"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADAppE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADAppE"><span class="hs-identifier hs-var">ADAppE</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span>
</span><span id="line-104"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADLamE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADLamE"><span class="hs-identifier hs-var">ADLamE</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- type-level names corresponding to term-level ones</span><span>
</span><span id="line-105"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>          </span><span class="hs-comment">-- the promoted lambda</span><span>
</span><span id="line-106"></span><span>                    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span>
</span><span id="line-107"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADCaseE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADCaseE"><span class="hs-identifier hs-var">ADCaseE</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Singletons.Syntax.html#ADMatch"><span class="hs-identifier hs-type">ADMatch</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>
</span><span id="line-108"></span><span>               </span><span class="hs-comment">-- the type is the return type</span><span>
</span><span id="line-109"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADLetE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADLetE"><span class="hs-identifier hs-var">ADLetE</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ALetDecEnv"><span class="hs-identifier hs-type">ALetDecEnv</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span>
</span><span id="line-110"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADSigE"><span class="annot"><a href="Data.Singletons.Syntax.html#ADSigE"><span class="hs-identifier hs-var">ADSigE</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>          </span><span class="hs-comment">-- the promoted expression</span><span>
</span><span id="line-111"></span><span>                    </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- A DPat with a pattern-signature node annotated with its type-level equivalent</span><span>
</span><span id="line-114"></span><span class="hs-keyword">data</span><span> </span><span id="ADPat"><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-var">ADPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ADLitP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADLitP"><span class="hs-identifier hs-var">ADLitP</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lit</span></span><span>
</span><span id="line-115"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADVarP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADVarP"><span class="hs-identifier hs-var">ADVarP</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-116"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADConP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADConP"><span class="hs-identifier hs-var">ADConP</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-type">ADPat</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADTildeP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADTildeP"><span class="hs-identifier hs-var">ADTildeP</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-type">ADPat</span></a></span><span>
</span><span id="line-118"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADBangP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADBangP"><span class="hs-identifier hs-var">ADBangP</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-type">ADPat</span></a></span><span>
</span><span id="line-119"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADSigP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADSigP"><span class="hs-identifier hs-var">ADSigP</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span> </span><span class="hs-comment">-- The promoted pattern. Will not contain any wildcards,</span><span>
</span><span id="line-120"></span><span>                          </span><span class="hs-comment">-- as per Note [Singling pattern signatures]</span><span>
</span><span id="line-121"></span><span>                    </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-type">ADPat</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>
</span><span id="line-122"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="ADWildP"><span class="annot"><a href="Data.Singletons.Syntax.html#ADWildP"><span class="hs-identifier hs-var">ADWildP</span></a></span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">data</span><span> </span><span id="ADMatch"><span class="annot"><a href="Data.Singletons.Syntax.html#ADMatch"><span class="hs-identifier hs-var">ADMatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ADMatch"><span class="annot"><a href="Data.Singletons.Syntax.html#ADMatch"><span class="hs-identifier hs-var">ADMatch</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#VarPromotions"><span class="hs-identifier hs-type">VarPromotions</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-type">ADPat</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">data</span><span> </span><span id="ADClause"><span class="annot"><a href="Data.Singletons.Syntax.html#ADClause"><span class="hs-identifier hs-var">ADClause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ADClause"><span class="annot"><a href="Data.Singletons.Syntax.html#ADClause"><span class="hs-identifier hs-var">ADClause</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#VarPromotions"><span class="hs-identifier hs-type">VarPromotions</span></a></span><span>
</span><span id="line-126"></span><span>                         </span><span class="hs-special">[</span><span class="annot"><a href="Data.Singletons.Syntax.html#ADPat"><span class="hs-identifier hs-type">ADPat</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">data</span><span> </span><span id="AnnotationFlag"><span class="annot"><a href="Data.Singletons.Syntax.html#AnnotationFlag"><span class="hs-identifier hs-var">AnnotationFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Annotated"><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-var">Annotated</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Unannotated"><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-var">Unannotated</span></a></span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- These are used at the type-level exclusively</span><span>
</span><span id="line-131"></span><span class="hs-keyword">type</span><span> </span><span id="Annotated"><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-var">Annotated</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">type</span><span> </span><span id="Unannotated"><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-var">Unannotated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="IfAnn"><span class="annot"><a href="Data.Singletons.Syntax.html#IfAnn"><span class="hs-identifier hs-var">IfAnn</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681355467"><span class="annot"><a href="#local-6989586621681355467"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#AnnotationFlag"><span class="hs-identifier hs-type">AnnotationFlag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681355466"><span class="annot"><a href="#local-6989586621681355466"><span class="hs-identifier hs-type">yes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621681355465"><span class="annot"><a href="#local-6989586621681355465"><span class="hs-identifier hs-type hs-type">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681355464"><span class="annot"><a href="#local-6989586621681355464"><span class="hs-identifier hs-type">no</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681355465"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681355465"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>  </span><span id="IfAnn"><span class="annot"><a href="Data.Singletons.Syntax.html#IfAnn"><span class="hs-identifier hs-var">IfAnn</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>   </span><span id="local-6989586621681355463"><span class="annot"><a href="#local-6989586621681355463"><span class="hs-identifier hs-type hs-type">yes</span></a></span></span><span> </span><span id="local-6989586621681355462"><span class="annot"><a href="#local-6989586621681355462"><span class="hs-identifier hs-type hs-type">no</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681355463"><span class="hs-identifier hs-type">yes</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span id="IfAnn"><span class="annot"><a href="Data.Singletons.Syntax.html#IfAnn"><span class="hs-identifier hs-var">IfAnn</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span> </span><span id="local-6989586621681355461"><span class="annot"><a href="#local-6989586621681355461"><span class="hs-identifier hs-type hs-type">yes</span></a></span></span><span> </span><span id="local-6989586621681355460"><span class="annot"><a href="#local-6989586621681355460"><span class="hs-identifier hs-type hs-type">no</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681355460"><span class="hs-identifier hs-type">no</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="LetDecRHS"><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-var">LetDecRHS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#AnnotationFlag"><span class="hs-identifier hs-type">AnnotationFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="LetDecRHS"><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-var">LetDecRHS</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="AFunction"><span class="annot"><a href="Data.Singletons.Syntax.html#AFunction"><span class="hs-identifier hs-var">AFunction</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>  </span><span class="hs-comment">-- promote function (unapplied)</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="hs-comment">-- number of arrows in type</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Data.Singletons.Syntax.html#ADClause"><span class="hs-identifier hs-type">ADClause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AValue"><span class="annot"><a href="Data.Singletons.Syntax.html#AValue"><span class="hs-identifier hs-var">AValue</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span> </span><span class="hs-comment">-- promoted exp</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>   </span><span class="hs-comment">-- number of arrows in type</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="Data.Singletons.Syntax.html#ADExp"><span class="hs-identifier hs-type">ADExp</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="LetDecRHS"><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-var">LetDecRHS</span></a></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UFunction"><span class="annot"><a href="Data.Singletons.Syntax.html#UFunction"><span class="hs-identifier hs-var">UFunction</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DClause</span></span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>                                    </span><span class="hs-glyph">|</span><span> </span><span id="UValue"><span class="annot"><a href="Data.Singletons.Syntax.html#UValue"><span class="hs-identifier hs-var">UValue</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DExp</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">type</span><span> </span><span id="ALetDecRHS"><span class="annot"><a href="Data.Singletons.Syntax.html#ALetDecRHS"><span class="hs-identifier hs-var">ALetDecRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-type">LetDecRHS</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">type</span><span> </span><span id="ULetDecRHS"><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecRHS"><span class="hs-identifier hs-var">ULetDecRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-type">LetDecRHS</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">data</span><span> </span><span id="LetDecEnv"><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-var">LetDecEnv</span></a></span></span><span> </span><span id="local-6989586621681355569"><span class="annot"><a href="#local-6989586621681355569"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LetDecEnv"><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-var">LetDecEnv</span></a></span></span><span>
</span><span id="line-153"></span><span>                   </span><span class="hs-special">{</span><span> </span><span id="lde_defns"><span class="annot"><span class="annottext">LetDecEnv ann -&gt; OMap Name (LetDecRHS ann)
</span><a href="Data.Singletons.Syntax.html#lde_defns"><span class="hs-identifier hs-var hs-var">lde_defns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecRHS"><span class="hs-identifier hs-type">LetDecRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681355569"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>                   </span><span class="hs-special">,</span><span> </span><span id="lde_types"><span class="annot"><span class="annottext">LetDecEnv ann -&gt; OMap Name DType
</span><a href="Data.Singletons.Syntax.html#lde_types"><span class="hs-identifier hs-var hs-var">lde_types</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>  </span><span class="hs-comment">-- type signatures</span><span>
</span><span id="line-155"></span><span>                   </span><span class="hs-special">,</span><span> </span><span id="lde_infix"><span class="annot"><span class="annottext">LetDecEnv ann -&gt; OMap Name Fixity
</span><a href="Data.Singletons.Syntax.html#lde_infix"><span class="hs-identifier hs-var hs-var">lde_infix</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fixity</span></span><span> </span><span class="hs-comment">-- infix declarations</span><span>
</span><span id="line-156"></span><span>                   </span><span class="hs-special">,</span><span> </span><span id="lde_proms"><span class="annot"><span class="annottext">LetDecEnv ann -&gt; IfAnn ann (OMap Name DType) ()
</span><a href="Data.Singletons.Syntax.html#lde_proms"><span class="hs-identifier hs-var hs-var">lde_proms</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#IfAnn"><span class="hs-identifier hs-type">IfAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681355569"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- possibly, promotions</span><span>
</span><span id="line-157"></span><span>                   </span><span class="hs-special">,</span><span> </span><span id="lde_bound_kvs"><span class="annot"><span class="annottext">LetDecEnv ann -&gt; IfAnn ann (OMap Name (OSet Name)) ()
</span><a href="Data.Singletons.Syntax.html#lde_bound_kvs"><span class="hs-identifier hs-var hs-var">lde_bound_kvs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#IfAnn"><span class="hs-identifier hs-type">IfAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681355569"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>                     </span><span class="hs-comment">-- The set of bound variables in scope.</span><span>
</span><span id="line-159"></span><span>                     </span><span class="hs-comment">-- See Note [Explicitly binding kind variables]</span><span>
</span><span id="line-160"></span><span>                     </span><span class="hs-comment">-- in Data.Singletons.Promote.Monad</span><span>
</span><span id="line-161"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span class="hs-keyword">type</span><span> </span><span id="ALetDecEnv"><span class="annot"><a href="Data.Singletons.Syntax.html#ALetDecEnv"><span class="hs-identifier hs-var">ALetDecEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-type">LetDecEnv</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">type</span><span> </span><span id="ULetDecEnv"><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-var">ULetDecEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-type">LetDecEnv</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#Unannotated"><span class="hs-identifier hs-type">Unannotated</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681355443"><span id="local-6989586621681355445"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-type">LetDecEnv</span></a></span><span> </span><span id="local-6989586621681355442"><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
</span><a href="#local-6989586621681355442"><span class="hs-identifier hs-var">defns1</span></a></span></span><span> </span><span id="local-6989586621681355441"><span class="annot"><span class="annottext">OMap Name DType
</span><a href="#local-6989586621681355441"><span class="hs-identifier hs-var">types1</span></a></span></span><span> </span><span id="local-6989586621681355440"><span class="annot"><span class="annottext">OMap Name Fixity
</span><a href="#local-6989586621681355440"><span class="hs-identifier hs-var">infx1</span></a></span></span><span> </span><span class="annot"><span class="annottext">IfAnn Unannotated (OMap Name DType) ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IfAnn Unannotated (OMap Name (OSet Name)) ()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681355439"><span class="annot"><span class="annottext">&lt;&gt; :: ULetDecEnv -&gt; ULetDecEnv -&gt; ULetDecEnv
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-type">LetDecEnv</span></a></span><span> </span><span id="local-6989586621681355438"><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
</span><a href="#local-6989586621681355438"><span class="hs-identifier hs-var">defns2</span></a></span></span><span> </span><span id="local-6989586621681355437"><span class="annot"><span class="annottext">OMap Name DType
</span><a href="#local-6989586621681355437"><span class="hs-identifier hs-var">types2</span></a></span></span><span> </span><span id="local-6989586621681355436"><span class="annot"><span class="annottext">OMap Name Fixity
</span><a href="#local-6989586621681355436"><span class="hs-identifier hs-var">infx2</span></a></span></span><span> </span><span class="annot"><span class="annottext">IfAnn Unannotated (OMap Name DType) ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IfAnn Unannotated (OMap Name (OSet Name)) ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
-&gt; OMap Name DType
-&gt; OMap Name Fixity
-&gt; IfAnn Unannotated (OMap Name DType) ()
-&gt; IfAnn Unannotated (OMap Name (OSet Name)) ()
-&gt; ULetDecEnv
forall (ann :: AnnotationFlag).
OMap Name (LetDecRHS ann)
-&gt; OMap Name DType
-&gt; OMap Name Fixity
-&gt; IfAnn ann (OMap Name DType) ()
-&gt; IfAnn ann (OMap Name (OSet Name)) ()
-&gt; LetDecEnv ann
</span><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-var">LetDecEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
</span><a href="#local-6989586621681355442"><span class="hs-identifier hs-var">defns1</span></a></span><span> </span><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
-&gt; OMap Name (LetDecRHS Unannotated)
-&gt; OMap Name (LetDecRHS Unannotated)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
</span><a href="#local-6989586621681355438"><span class="hs-identifier hs-var">defns2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap Name DType
</span><a href="#local-6989586621681355441"><span class="hs-identifier hs-var">types1</span></a></span><span> </span><span class="annot"><span class="annottext">OMap Name DType -&gt; OMap Name DType -&gt; OMap Name DType
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">OMap Name DType
</span><a href="#local-6989586621681355437"><span class="hs-identifier hs-var">types2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap Name Fixity
</span><a href="#local-6989586621681355440"><span class="hs-identifier hs-var">infx1</span></a></span><span> </span><span class="annot"><span class="annottext">OMap Name Fixity -&gt; OMap Name Fixity -&gt; OMap Name Fixity
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">OMap Name Fixity
</span><a href="#local-6989586621681355436"><span class="hs-identifier hs-var">infx2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681355430"><span id="local-6989586621681355432"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621681355429"><span class="annot"><span class="annottext">mempty :: ULetDecEnv
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
-&gt; OMap Name DType
-&gt; OMap Name Fixity
-&gt; IfAnn Unannotated (OMap Name DType) ()
-&gt; IfAnn Unannotated (OMap Name (OSet Name)) ()
-&gt; ULetDecEnv
forall (ann :: AnnotationFlag).
OMap Name (LetDecRHS ann)
-&gt; OMap Name DType
-&gt; OMap Name Fixity
-&gt; IfAnn ann (OMap Name DType) ()
-&gt; IfAnn ann (OMap Name (OSet Name)) ()
-&gt; LetDecEnv ann
</span><a href="Data.Singletons.Syntax.html#LetDecEnv"><span class="hs-identifier hs-var">LetDecEnv</span></a></span><span> </span><span class="annot"><span class="annottext">OMap Name (LetDecRHS Unannotated)
forall k v. OMap k v
</span><span class="hs-identifier hs-var">OMap.empty</span></span><span> </span><span class="annot"><span class="annottext">OMap Name DType
forall k v. OMap k v
</span><span class="hs-identifier hs-var">OMap.empty</span></span><span> </span><span class="annot"><span class="annottext">OMap Name Fixity
forall k v. OMap k v
</span><span class="hs-identifier hs-var">OMap.empty</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><a href="Data.Singletons.Syntax.html#valueBinding"><span class="hs-identifier hs-type">valueBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecRHS"><span class="hs-identifier hs-type">ULetDecRHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span><span>
</span><span id="line-173"></span><span id="valueBinding"><span class="annot"><span class="annottext">valueBinding :: Name -&gt; LetDecRHS Unannotated -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#valueBinding"><span class="hs-identifier hs-var hs-var">valueBinding</span></a></span></span><span> </span><span id="local-6989586621681355426"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355426"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681355425"><span class="annot"><span class="annottext">LetDecRHS Unannotated
</span><a href="#local-6989586621681355425"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#emptyLetDecEnv"><span class="hs-identifier hs-var">emptyLetDecEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lde_defns :: OMap Name (LetDecRHS Unannotated)
</span><a href="Data.Singletons.Syntax.html#lde_defns"><span class="hs-identifier hs-var">lde_defns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; LetDecRHS Unannotated -&gt; OMap Name (LetDecRHS Unannotated)
forall k v. k -&gt; v -&gt; OMap k v
</span><span class="hs-identifier hs-var">OMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355426"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">LetDecRHS Unannotated
</span><a href="#local-6989586621681355425"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Data.Singletons.Syntax.html#typeBinding"><span class="hs-identifier hs-type">typeBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span><span>
</span><span id="line-176"></span><span id="typeBinding"><span class="annot"><span class="annottext">typeBinding :: Name -&gt; DType -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#typeBinding"><span class="hs-identifier hs-var hs-var">typeBinding</span></a></span></span><span> </span><span id="local-6989586621681355421"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355421"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681355420"><span class="annot"><span class="annottext">DType
</span><a href="#local-6989586621681355420"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#emptyLetDecEnv"><span class="hs-identifier hs-var">emptyLetDecEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lde_types :: OMap Name DType
</span><a href="Data.Singletons.Syntax.html#lde_types"><span class="hs-identifier hs-var">lde_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DType -&gt; OMap Name DType
forall k v. k -&gt; v -&gt; OMap k v
</span><span class="hs-identifier hs-var">OMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355421"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DType
</span><a href="#local-6989586621681355420"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Data.Singletons.Syntax.html#infixDecl"><span class="hs-identifier hs-type">infixDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fixity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span><span>
</span><span id="line-179"></span><span id="infixDecl"><span class="annot"><span class="annottext">infixDecl :: Fixity -&gt; Name -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#infixDecl"><span class="hs-identifier hs-var hs-var">infixDecl</span></a></span></span><span> </span><span id="local-6989586621681355418"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621681355418"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681355417"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355417"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#emptyLetDecEnv"><span class="hs-identifier hs-var">emptyLetDecEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lde_infix :: OMap Name Fixity
</span><a href="Data.Singletons.Syntax.html#lde_infix"><span class="hs-identifier hs-var">lde_infix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity -&gt; OMap Name Fixity
forall k v. k -&gt; v -&gt; OMap k v
</span><span class="hs-identifier hs-var">OMap.singleton</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355417"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621681355418"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="Data.Singletons.Syntax.html#emptyLetDecEnv"><span class="hs-identifier hs-type">emptyLetDecEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span><span>
</span><span id="line-182"></span><span id="emptyLetDecEnv"><span class="annot"><span class="annottext">emptyLetDecEnv :: ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#emptyLetDecEnv"><span class="hs-identifier hs-var hs-var">emptyLetDecEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621681355416"><span class="annot"><a href="Data.Singletons.Syntax.html#buildLetDecEnv"><span class="hs-identifier hs-type">buildLetDecEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quasi</span></span><span> </span><span class="annot"><a href="#local-6989586621681355416"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DLetDec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681355416"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#ULetDecEnv"><span class="hs-identifier hs-type">ULetDecEnv</span></a></span></span><span>
</span><span id="line-185"></span><span id="buildLetDecEnv"><span class="annot"><span class="annottext">buildLetDecEnv :: [DLetDec] -&gt; q ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#buildLetDecEnv"><span class="hs-identifier hs-var hs-var">buildLetDecEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; q ULetDecEnv
forall (m :: * -&gt; *).
Quasi m =&gt;
ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#emptyLetDecEnv"><span class="hs-identifier hs-var">emptyLetDecEnv</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621681355414"><span class="annot"><span class="annottext">go :: ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681355413"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355413"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; m ULetDecEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355413"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681355412"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355412"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DFunD</span></span><span> </span><span id="local-6989586621681355410"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355410"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681355409"><span class="annot"><span class="annottext">[DClause]
</span><a href="#local-6989586621681355409"><span class="hs-identifier hs-var">clauses</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681355408"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355408"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LetDecRHS Unannotated -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#valueBinding"><span class="hs-identifier hs-var">valueBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355410"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DClause] -&gt; LetDecRHS Unannotated
</span><a href="Data.Singletons.Syntax.html#UFunction"><span class="hs-identifier hs-var">UFunction</span></a></span><span> </span><span class="annot"><span class="annottext">[DClause]
</span><a href="#local-6989586621681355409"><span class="hs-identifier hs-var">clauses</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; ULetDecEnv -&gt; ULetDecEnv
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355412"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355408"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681355407"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355407"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DValD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DVarP</span></span><span> </span><span id="local-6989586621681355404"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355404"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681355403"><span class="annot"><span class="annottext">DExp
</span><a href="#local-6989586621681355403"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681355402"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355402"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LetDecRHS Unannotated -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#valueBinding"><span class="hs-identifier hs-var">valueBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355404"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DExp -&gt; LetDecRHS Unannotated
</span><a href="Data.Singletons.Syntax.html#UValue"><span class="hs-identifier hs-var">UValue</span></a></span><span> </span><span class="annot"><span class="annottext">DExp
</span><a href="#local-6989586621681355403"><span class="hs-identifier hs-var">exp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; ULetDecEnv -&gt; ULetDecEnv
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355407"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355402"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681355401"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355401"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681355400"><span class="annot"><span class="annottext">dec :: DLetDec
</span><a href="#local-6989586621681355400"><span class="hs-identifier hs-var">dec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DValD</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681355399"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355399"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>      </span><span id="local-6989586621681355398"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355398"><span class="hs-identifier hs-var">flattened</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DLetDec -&gt; m [DLetDec]
forall (q :: * -&gt; *). Quasi q =&gt; DLetDec -&gt; q [DLetDec]
</span><span class="hs-identifier hs-var">flattenDValD</span></span><span> </span><span class="annot"><span class="annottext">DLetDec
</span><a href="#local-6989586621681355400"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355401"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355398"><span class="hs-identifier hs-var">flattened</span></a></span><span> </span><span class="annot"><span class="annottext">[DLetDec] -&gt; [DLetDec] -&gt; [DLetDec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355399"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681355396"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355396"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DSigD</span></span><span> </span><span id="local-6989586621681355394"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355394"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681355393"><span class="annot"><span class="annottext">DType
</span><a href="#local-6989586621681355393"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681355392"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355392"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; DType -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#typeBinding"><span class="hs-identifier hs-var">typeBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355394"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">DType
</span><a href="#local-6989586621681355393"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; ULetDecEnv -&gt; ULetDecEnv
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355396"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355392"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681355391"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355391"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DInfixD</span></span><span> </span><span id="local-6989586621681355389"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621681355389"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681355388"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355388"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681355387"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355387"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>      </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fixity -&gt; Name -&gt; ULetDecEnv
</span><a href="Data.Singletons.Syntax.html#infixDecl"><span class="hs-identifier hs-var">infixDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621681355389"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681355388"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; ULetDecEnv -&gt; ULetDecEnv
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355391"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355387"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681355386"><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355386"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DPragmaD</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681355384"><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355384"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ULetDecEnv -&gt; [DLetDec] -&gt; m ULetDecEnv
</span><a href="#local-6989586621681355414"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ULetDecEnv
</span><a href="#local-6989586621681355386"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[DLetDec]
</span><a href="#local-6989586621681355384"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- See Note [DerivedDecl]</span><span>
</span><span id="line-202"></span><span class="hs-keyword">data</span><span> </span><span id="DerivedDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#DerivedDecl"><span class="hs-identifier hs-var">DerivedDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681355383"><span class="annot"><a href="#local-6989586621681355383"><span class="hs-identifier hs-type">cls</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DerivedDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#DerivedDecl"><span class="hs-identifier hs-var">DerivedDecl</span></a></span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ded_mb_cxt"><span class="annot"><span class="annottext">DerivedDecl cls -&gt; Maybe DCxt
</span><a href="Data.Singletons.Syntax.html#ded_mb_cxt"><span class="hs-identifier hs-var hs-var">ded_mb_cxt</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DCxt</span></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ded_type"><span class="annot"><span class="annottext">DerivedDecl cls -&gt; DType
</span><a href="Data.Singletons.Syntax.html#ded_type"><span class="hs-identifier hs-var hs-var">ded_type</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DType</span></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ded_type_tycon"><span class="annot"><span class="annottext">DerivedDecl cls -&gt; Name
</span><a href="Data.Singletons.Syntax.html#ded_type_tycon"><span class="hs-identifier hs-var hs-var">ded_type_tycon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ded_decl"><span class="annot"><span class="annottext">DerivedDecl cls -&gt; DataDecl
</span><a href="Data.Singletons.Syntax.html#ded_decl"><span class="hs-identifier hs-var hs-var">ded_decl</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#DataDecl"><span class="hs-identifier hs-type">DataDecl</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-keyword">type</span><span> </span><span id="DerivedEqDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#DerivedEqDecl"><span class="hs-identifier hs-var">DerivedEqDecl</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#DerivedDecl"><span class="hs-identifier hs-type">DerivedDecl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>
</span><span id="line-210"></span><span class="hs-keyword">type</span><span> </span><span id="DerivedShowDecl"><span class="annot"><a href="Data.Singletons.Syntax.html#DerivedShowDecl"><span class="hs-identifier hs-var">DerivedShowDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Singletons.Syntax.html#DerivedDecl"><span class="hs-identifier hs-type">DerivedDecl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">{- Note [DerivedDecl]
~~~~~~~~~~~~~~~~~~~~~
Most derived instances are wholly handled in
Data.Singletons.Partition.partitionDecs. There are two notable exceptions to
this rule, however:

* Eq instances (which are handled entirely outside of partitionDecs)
* Show instances (which are partially handled outside of partitionDecs)

For these instances, we use a DerivedDecl data type to encode just enough
information to recreate the derived instance:

1. Just the instance context, if it's standalone-derived, or Nothing if it's in
   a deriving clause (ded_mb_cxt)
2. The datatype, applied to some number of type arguments, as in the
   instance declaration (ded_type)
3. The datatype name (ded_type_tycon), cached for convenience
4. The datatype's constructors (ded_cons)

Why are these instances handled outside of partitionDecs?

* Deriving Eq in singletons not only derives PEq/SEq instances, but it also
  derives SDecide, TestEquality, and TestCoercion instances. This additional
  complication makes Eq difficult to integrate with the other deriving
  machinery, so we handle it specially in Data.Singletons.Promote and
  Data.Singletons.Single (depending on the task at hand).
* Deriving Show in singletons not only derives PShow/SShow instances, but it
  also derives Show instances for singletons types. To make this work,
  we let partitionDecs handle the PShow/SShow instances, but we also stick the
  relevant info into a DerivedDecl value for later use in
  Data.Singletons.Single, where we additionally generate Show
  instances.
-}</span><span>
</span><span id="line-245"></span></pre></body></html>