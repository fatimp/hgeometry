<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- The \(O((n+k)\log n)\) time line segment intersection algorithm by Bentley</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- and Ottmann.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier">intersections</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier">interiorIntersections</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html"><span class="hs-identifier">Algorithms.Geometry.LineSegmentIntersection.Types</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">contains</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Interval.html"><span class="hs-identifier">Geometry.Interval</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.LineSegment.html"><span class="hs-identifier">Geometry.LineSegment</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Point.html"><span class="hs-identifier">Geometry.Point</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Properties.html"><span class="hs-identifier">Geometry.Properties</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EQ</span></span><span> </span><span class="hs-comment">-- event queue</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SS</span></span><span> </span><span class="hs-comment">-- status struct</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vinyl.CoRec</span></span><span>
</span><span id="line-40"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | Compute all intersections</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-45"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-type">intersections</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680128969"><span class="annot"><a href="#local-6989586621680128969"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680128970"><span class="annot"><a href="#local-6989586621680128970"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680128967"><span class="annot"><a href="#local-6989586621680128967"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128970"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128970"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128969"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128970"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128967"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128969"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128970"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128967"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-47"></span><span id="intersections"><span class="annot"><span class="annottext">intersections :: forall p r e.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r :+ e] -&gt; Intersections p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var hs-var">intersections</span></a></span></span><span> </span><span id="local-6989586621680128497"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128497"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Fractional r, Ord r) =&gt;
Associated p r (e :+ Flipped) -&gt; Associated p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#unflipSegs"><span class="hs-identifier hs-var">unflipSegs</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
[IntersectionPoint p r e] -&gt; Intersections p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
EventQueue p r e
-&gt; StatusStructure p r e -&gt; [IntersectionPoint p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Event p r (e :+ Flipped))
</span><a href="#local-6989586621680128492"><span class="hs-identifier hs-var">pts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a
</span><span class="hs-identifier hs-var">SS.empty</span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>    </span><span id="local-6989586621680128492"><span class="annot"><span class="annottext">pts :: Set (Event p r (e :+ Flipped))
</span><a href="#local-6989586621680128492"><span class="hs-identifier hs-var hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.fromAscList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall r p e. Eq r =&gt; [Event p r e] -&gt; [Event p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sort</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p r e. (LineSegment 2 p r :+ e) -&gt; [Event p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var">asEventPts</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall r p e.
Ord r =&gt;
(LineSegment 2 p r :+ e) -&gt; LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#tagFlipped"><span class="hs-identifier hs-var">tagFlipped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128497"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Computes all intersection points p s.t. p lies in the interior of at least</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- one of the segments.</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">--  \(O((n+k)\log n)\), where \(k\) is the number of intersections.</span><span>
</span><span id="line-55"></span><span id="local-6989586621680128911"><span id="local-6989586621680128912"><span id="local-6989586621680128913"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-type">interiorIntersections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128913"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128913"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128912"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128913"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128911"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128912"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128913"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128911"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-57"></span><span id="interiorIntersections"><span class="annot"><span class="annottext">interiorIntersections :: forall r p e.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r :+ e] -&gt; Intersections p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#interiorIntersections"><span class="hs-identifier hs-var hs-var">interiorIntersections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filter</span></span><span> </span><span class="annot"><span class="annottext">forall p r e. Associated p r e -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#isInteriorIntersection"><span class="hs-identifier hs-var">isInteriorIntersection</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall p r e.
(Ord r, Fractional r) =&gt;
[LineSegment 2 p r :+ e] -&gt; Intersections p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#intersections"><span class="hs-identifier hs-var">intersections</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- * Flipping and unflipping</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">data</span><span> </span><span id="Flipped"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NotFlipped"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-var">NotFlipped</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Flipped"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128471"><span id="local-6989586621680128473"><span id="local-6989586621680128475"><span class="annot"><span class="annottext">Int -&gt; Flipped -&gt; ShowS
[Flipped] -&gt; ShowS
Flipped -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Flipped] -&gt; ShowS
$cshowList :: [Flipped] -&gt; ShowS
show :: Flipped -&gt; String
$cshow :: Flipped -&gt; String
showsPrec :: Int -&gt; Flipped -&gt; ShowS
$cshowsPrec :: Int -&gt; Flipped -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680128466"><span id="local-6989586621680128468"><span class="annot"><span class="annottext">Flipped -&gt; Flipped -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Flipped -&gt; Flipped -&gt; Bool
$c/= :: Flipped -&gt; Flipped -&gt; Bool
== :: Flipped -&gt; Flipped -&gt; Bool
$c== :: Flipped -&gt; Flipped -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Make sure the 'start' endpoint occurs before the end-endpoints in</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- terms of the sweep order.</span><span>
</span><span id="line-66"></span><span id="local-6989586621680128914"><span id="local-6989586621680128915"><span id="local-6989586621680128916"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#tagFlipped"><span class="hs-identifier hs-type">tagFlipped</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128916"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128915"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128916"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128914"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128915"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128916"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128914"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-67"></span><span id="tagFlipped"><span class="annot"><span class="annottext">tagFlipped :: forall r p e.
Ord r =&gt;
(LineSegment 2 p r :+ e) -&gt; LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#tagFlipped"><span class="hs-identifier hs-var hs-var">tagFlipped</span></a></span></span><span> </span><span id="local-6989586621680128447"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128447"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128447"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-operator hs-var">`ordPoints`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128447"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-68"></span><span>                 </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128447"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>  </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r. LineSegment d p r -&gt; LineSegment d p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-var">flipSeg</span></a></span><span>
</span><span id="line-69"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">Flipped
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>                 </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128447"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">Flipped
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#NotFlipped"><span class="hs-identifier hs-var">NotFlipped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Flips the segment</span><span>
</span><span id="line-73"></span><span id="local-6989586621680128860"><span id="local-6989586621680128861"><span id="local-6989586621680128862"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-type">flipSeg</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128862"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128861"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128860"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128862"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128861"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128860"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-74"></span><span id="flipSeg"><span class="annot"><span class="annottext">flipSeg :: forall (d :: Nat) p r. LineSegment d p r -&gt; LineSegment d p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-var hs-var">flipSeg</span></a></span></span><span> </span><span id="local-6989586621680128428"><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680128428"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680128428"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680128428"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>                 </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span>   </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680128428"><span class="hs-identifier hs-var">seg</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Unflips the segments in an associated.</span><span>
</span><span id="line-78"></span><span id="local-6989586621680128945"><span id="local-6989586621680128946"><span id="local-6989586621680128947"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#unflipSegs"><span class="hs-identifier hs-type">unflipSegs</span></a></span><span>                       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128947"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128947"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Associated"><span class="hs-identifier hs-type">Associated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128946"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128947"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128945"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Associated"><span class="hs-identifier hs-type">Associated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128946"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128947"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128945"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-80"></span><span id="unflipSegs"><span class="annot"><span class="annottext">unflipSegs :: forall r p e.
(Fractional r, Ord r) =&gt;
Associated p r (e :+ Flipped) -&gt; Associated p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#unflipSegs"><span class="hs-identifier hs-var hs-var">unflipSegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Associated"><span class="hs-identifier hs-type">Associated</span></a></span><span> </span><span id="local-6989586621680128399"><span class="annot"><span class="annottext">Set (AroundEnd (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128399"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span id="local-6989586621680128398"><span class="annot"><span class="annottext">Set (AroundStart (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128398"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621680128397"><span class="annot"><span class="annottext">Set (AroundIntersection (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128397"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">forall p r e.
Set (AroundEnd (LineSegment 2 p r :+ e))
-&gt; Set (AroundStart (LineSegment 2 p r :+ e))
-&gt; Set (AroundIntersection (LineSegment 2 p r :+ e))
-&gt; Associated p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Associated"><span class="hs-identifier hs-var">Associated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p r e.
Functor f =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (f (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128396"><span class="hs-identifier hs-var">dropFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128395"><span class="hs-identifier hs-var">ss1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p r e (g :: * -&gt; *).
(Functor f,
 Coercible
   (f (LineSegment 2 p r :+ e)) (g (LineSegment 2 p r :+ e))) =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (g (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128394"><span class="hs-identifier hs-var">unflipSegs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundStart (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128393"><span class="hs-identifier hs-var">es'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p r e.
Functor f =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (f (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128396"><span class="hs-identifier hs-var">dropFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundStart (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128392"><span class="hs-identifier hs-var">es1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p r e (g :: * -&gt; *).
(Functor f,
 Coercible
   (f (LineSegment 2 p r :+ e)) (g (LineSegment 2 p r :+ e))) =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (g (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128394"><span class="hs-identifier hs-var">unflipSegs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128391"><span class="hs-identifier hs-var">ss'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p r e.
Functor f =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (f (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128396"><span class="hs-identifier hs-var">dropFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128390"><span class="hs-identifier hs-var">is1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) p r e (g :: * -&gt; *).
(Functor f,
 Coercible
   (f (LineSegment 2 p r :+ e)) (g (LineSegment 2 p r :+ e))) =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (g (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128394"><span class="hs-identifier hs-var">unflipSegs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128389"><span class="hs-identifier hs-var">is'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680128391"><span class="annot"><span class="annottext">Set (AroundEnd (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128391"><span class="hs-identifier hs-var">ss'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128395"><span class="annot"><span class="annottext">Set (AroundEnd (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128395"><span class="hs-identifier hs-var">ss1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">Set.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#AroundEnd"><span class="hs-identifier hs-type">AroundEnd</span></a></span><span>          </span><span id="local-6989586621680128386"><span class="annot"><span class="annottext">LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="#local-6989586621680128386"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {core} {core}. (core :+ (core :+ Flipped)) -&gt; Bool
</span><a href="#local-6989586621680128385"><span class="hs-identifier hs-var">isFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="#local-6989586621680128386"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (AroundEnd (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128399"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680128393"><span class="annot"><span class="annottext">Set (AroundStart (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128393"><span class="hs-identifier hs-var">es'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128392"><span class="annot"><span class="annottext">Set (AroundStart (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128392"><span class="hs-identifier hs-var">es1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">Set.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#AroundStart"><span class="hs-identifier hs-type">AroundStart</span></a></span><span>        </span><span id="local-6989586621680128383"><span class="annot"><span class="annottext">LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="#local-6989586621680128383"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {core} {core}. (core :+ (core :+ Flipped)) -&gt; Bool
</span><a href="#local-6989586621680128385"><span class="hs-identifier hs-var">isFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="#local-6989586621680128383"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (AroundStart (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128398"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680128389"><span class="annot"><span class="annottext">Set (AroundIntersection (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128389"><span class="hs-identifier hs-var">is'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128390"><span class="annot"><span class="annottext">Set (AroundIntersection (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128390"><span class="hs-identifier hs-var">is1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">Set.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#AroundIntersection"><span class="hs-identifier hs-type">AroundIntersection</span></a></span><span> </span><span id="local-6989586621680128381"><span class="annot"><span class="annottext">LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="#local-6989586621680128381"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {core} {core}. (core :+ (core :+ Flipped)) -&gt; Bool
</span><a href="#local-6989586621680128385"><span class="hs-identifier hs-var">isFlipped</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ (e :+ Flipped)
</span><a href="#local-6989586621680128381"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (AroundIntersection (LineSegment 2 p r :+ (e :+ Flipped)))
</span><a href="#local-6989586621680128397"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621680128385"><span class="annot"><span class="annottext">isFlipped :: (core :+ (core :+ Flipped)) -&gt; Bool
</span><a href="#local-6989586621680128385"><span class="hs-identifier hs-var hs-var">isFlipped</span></a></span></span><span> </span><span id="local-6989586621680128377"><span class="annot"><span class="annottext">core :+ (core :+ Flipped)
</span><a href="#local-6989586621680128377"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flipped
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-var">Flipped</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">core :+ (core :+ Flipped)
</span><a href="#local-6989586621680128377"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra extra'.
Lens (core :+ extra) (core :+ extra') extra extra'
</span><span class="hs-identifier hs-var">extra</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-comment">-- | For segments that are not acutally flipped, we can just drop the flipped bit</span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621680128824"><span id="local-6989586621680128825"><span id="local-6989586621680128826"><span id="local-6989586621680128827"><span class="annot"><a href="#local-6989586621680128396"><span class="hs-identifier hs-type">dropFlipped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621680128827"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-93"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128827"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128826"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128825"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128824"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128827"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128826"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128825"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128824"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621680128396"><span class="annot"><span class="annottext">dropFlipped :: forall (f :: * -&gt; *) p r e.
Functor f =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (f (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128396"><span class="hs-identifier hs-var hs-var">dropFlipped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall {core} {extra} {extra}.
(core :+ (extra :+ extra)) -&gt; core :+ extra
</span><a href="#local-6989586621680128373"><span class="hs-identifier hs-var">dropFlip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-comment">-- For flipped segs we unflip them (and appropriately coerce the</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- so that they remain in the same order. I.e. if they were sorted</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-comment">-- around the start point they are now sorted around the endpoint.</span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621680128818"><span id="local-6989586621680128819"><span id="local-6989586621680128820"><span id="local-6989586621680128821"><span id="local-6989586621680128822"><span class="annot"><a href="#local-6989586621680128394"><span class="hs-identifier hs-type">unflipSegs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621680128822"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-101"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Coercible</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128822"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128821"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128820"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128819"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128818"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128821"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128820"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128819"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>                   </span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128822"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128821"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128820"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128819"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Flipped"><span class="hs-identifier hs-type">Flipped</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128818"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128821"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128820"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128819"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621680128394"><span class="annot"><span class="annottext">unflipSegs' :: forall (f :: * -&gt; *) p r e (g :: * -&gt; *).
(Functor f,
 Coercible
   (f (LineSegment 2 p r :+ e)) (g (LineSegment 2 p r :+ e))) =&gt;
Set (f (LineSegment 2 p r :+ (e :+ Flipped)))
-&gt; Set (g (LineSegment 2 p r :+ e))
</span><a href="#local-6989586621680128394"><span class="hs-identifier hs-var hs-var">unflipSegs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">coerce :: forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-type">coerce</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall {d :: Nat} {p} {r} {extra} {extra}.
(LineSegment d p r :+ (extra :+ extra))
-&gt; LineSegment d p r :+ extra
</span><a href="#local-6989586621680128368"><span class="hs-identifier hs-var">unflip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621680128368"><span class="annot"><span class="annottext">unflip :: (LineSegment d p r :+ (extra :+ extra))
-&gt; LineSegment d p r :+ extra
</span><a href="#local-6989586621680128368"><span class="hs-identifier hs-var hs-var">unflip</span></a></span></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621680128367"><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680128367"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128366"><span class="annot"><span class="annottext">extra
</span><a href="#local-6989586621680128366"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">extra
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r. LineSegment d p r -&gt; LineSegment d p r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#flipSeg"><span class="hs-identifier hs-var">flipSeg</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680128367"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">extra
</span><a href="#local-6989586621680128366"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621680128373"><span class="annot"><span class="annottext">dropFlip :: (core :+ (extra :+ extra)) -&gt; core :+ extra
</span><a href="#local-6989586621680128373"><span class="hs-identifier hs-var hs-var">dropFlip</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128365"><span class="annot"><span class="annottext">core
</span><a href="#local-6989586621680128365"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128364"><span class="annot"><span class="annottext">extra
</span><a href="#local-6989586621680128364"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">extra
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">core
</span><a href="#local-6989586621680128365"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall core extra. core -&gt; extra -&gt; core :+ extra
</span><span class="hs-operator hs-var">:+</span></span><span> </span><span class="annot"><span class="annottext">extra
</span><a href="#local-6989586621680128364"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Computes the event points for a given line segment</span><span>
</span><span id="line-113"></span><span id="local-6989586621680128917"><span id="local-6989586621680128918"><span id="local-6989586621680128919"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-type">asEventPts</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128919"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128918"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128917"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128919"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128918"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128917"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-114"></span><span id="asEventPts"><span class="annot"><span class="annottext">asEventPts :: forall p r e. (LineSegment 2 p r :+ e) -&gt; [Event p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#asEventPts"><span class="hs-identifier hs-var hs-var">asEventPts</span></a></span></span><span> </span><span id="local-6989586621680128355"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128355"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall p r e.
Point 2 r -&gt; EventType (LineSegment 2 p r :+ e) -&gt; Event p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128355"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. NonEmpty s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128355"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall p r e.
Point 2 r -&gt; EventType (LineSegment 2 p r :+ e) -&gt; Event p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128355"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128355"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | Group the segments with the intersection points</span><span>
</span><span id="line-119"></span><span id="local-6989586621680128938"><span id="local-6989586621680128939"><span id="local-6989586621680128940"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-type">merge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128940"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128940"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128939"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128940"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128938"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#Intersections"><span class="hs-identifier hs-type">Intersections</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128939"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128940"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128938"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-120"></span><span id="merge"><span class="annot"><span class="annottext">merge :: forall r p e.
(Ord r, Fractional r) =&gt;
[IntersectionPoint p r e] -&gt; Intersections p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#merge"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span id="local-6989586621680128322"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128322"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680128321"><span class="annot"><span class="annottext">Associated p r e
</span><a href="#local-6989586621680128321"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insertWith</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128322"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Associated p r e
</span><a href="#local-6989586621680128321"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Group the startpoints such that segments with the same start point</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- correspond to one event.</span><span>
</span><span id="line-124"></span><span id="local-6989586621680128924"><span id="local-6989586621680128925"><span id="local-6989586621680128926"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-type">groupStarts</span></a></span><span>                          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680128926"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128925"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128926"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128924"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128925"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128926"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128924"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-125"></span><span id="groupStarts"><span class="annot"><span class="annottext">groupStarts :: forall r p e. Eq r =&gt; [Event p r e] -&gt; [Event p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var hs-var">groupStarts</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680128298"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128298"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621680128297"><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128297"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680128296"><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128296"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p r e.
Point 2 r -&gt; EventType (LineSegment 2 p r :+ e) -&gt; Event p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128298"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. NonEmpty s -&gt; EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128295"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall r p e. Eq r =&gt; [Event p r e] -&gt; [Event p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128294"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680128293"><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128293"><span class="hs-identifier hs-var">ss'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128294"><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128294"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.span</span></span><span> </span><span class="annot"><span class="annottext">Event p r e -&gt; Bool
</span><a href="#local-6989586621680128291"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128296"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">-- FIXME: this seems to keep the segments on decreasing y, increasing x. shouldn't we</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">-- sort them cyclically around p instead?</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621680128295"><span class="annot"><span class="annottext">ss :: NonEmpty (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128295"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128290"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128290"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span id="local-6989586621680128289"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128289"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128297"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-132"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680128290"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128289"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">forall p r e. Event p r e -&gt; [LineSegment 2 p r :+ e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128293"><span class="hs-identifier hs-var">ss'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621680128291"><span class="annot"><span class="annottext">sameStart :: Event p r e -&gt; Bool
</span><a href="#local-6989586621680128291"><span class="hs-identifier hs-var hs-var">sameStart</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680128287"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128287"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r :+ e)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128298"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128287"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621680128291"><span class="hs-identifier hs-var">sameStart</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r e
</span><span class="hs-identifier">_</span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128286"><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128286"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680128285"><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128285"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128286"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall r p e. Eq r =&gt; [Event p r e] -&gt; [Event p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#groupStarts"><span class="hs-identifier hs-var">groupStarts</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128285"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- * Data type for Events</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Type of segment</span><span>
</span><span id="line-142"></span><span class="hs-keyword">data</span><span> </span><span id="EventType"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-var">EventType</span></a></span></span><span> </span><span id="local-6989586621680128792"><span class="annot"><a href="#local-6989586621680128792"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Start"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680128792"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-glyph">|</span><span> </span><span id="Intersection"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="End"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-var">End</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621680128792"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128272"><span id="local-6989586621680128274"><span id="local-6989586621680128282"><span class="annot"><span class="annottext">Int -&gt; EventType s -&gt; ShowS
forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
forall s. Show s =&gt; [EventType s] -&gt; ShowS
forall s. Show s =&gt; EventType s -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EventType s] -&gt; ShowS
$cshowList :: forall s. Show s =&gt; [EventType s] -&gt; ShowS
show :: EventType s -&gt; String
$cshow :: forall s. Show s =&gt; EventType s -&gt; String
showsPrec :: Int -&gt; EventType s -&gt; ShowS
$cshowsPrec :: forall s. Show s =&gt; Int -&gt; EventType s -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680128269"><span id="local-6989586621680128751"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128751"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621680128265"><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621680128265"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680128264"><span class="annot"><span class="annottext">== :: EventType s -&gt; EventType s -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621680128263"><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621680128263"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621680128265"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="#local-6989586621680128263"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680128247"><span id="local-6989586621680128249"><span id="local-6989586621680128251"><span id="local-6989586621680128253"><span id="local-6989586621680128255"><span id="local-6989586621680128257"><span id="local-6989586621680128750"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128750"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621680128245"><span class="annot"><span class="annottext">compare :: EventType s -&gt; EventType s -&gt; Ordering
</span><a href="#local-6989586621680128245"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#End"><span class="hs-identifier hs-type">End</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType s
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | The actual event consists of a point and its type</span><span>
</span><span id="line-157"></span><span class="hs-keyword">data</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span id="local-6989586621680128953"><span class="annot"><a href="#local-6989586621680128953"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680128954"><span class="annot"><a href="#local-6989586621680128954"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680128952"><span class="annot"><a href="#local-6989586621680128952"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Event"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="eventPoint"><span class="annot"><span class="annottext">forall p r e. Event p r e -&gt; Point 2 r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var hs-var">eventPoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128954"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>                         </span><span class="hs-special">,</span><span> </span><span id="eventType"><span class="annot"><span class="annottext">forall p r e. Event p r e -&gt; EventType (LineSegment 2 p r :+ e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var hs-var">eventType</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventType"><span class="hs-identifier hs-type">EventType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128953"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128954"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128952"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>                         </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128231"><span id="local-6989586621680128233"><span id="local-6989586621680128241"><span class="annot"><span class="annottext">Int -&gt; Event p r e -&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall p r e.
(Show r, Show p, Show e) =&gt;
Int -&gt; Event p r e -&gt; ShowS
forall p r e. (Show r, Show p, Show e) =&gt; [Event p r e] -&gt; ShowS
forall p r e. (Show r, Show p, Show e) =&gt; Event p r e -&gt; String
showList :: [Event p r e] -&gt; ShowS
$cshowList :: forall p r e. (Show r, Show p, Show e) =&gt; [Event p r e] -&gt; ShowS
show :: Event p r e -&gt; String
$cshow :: forall p r e. (Show r, Show p, Show e) =&gt; Event p r e -&gt; String
showsPrec :: Int -&gt; Event p r e -&gt; ShowS
$cshowsPrec :: forall p r e.
(Show r, Show p, Show e) =&gt;
Int -&gt; Event p r e -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621680128208"><span id="local-6989586621680128213"><span class="annot"><span class="annottext">Event p r e -&gt; Event p r e -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall p r e. Eq r =&gt; Event p r e -&gt; Event p r e -&gt; Bool
/= :: Event p r e -&gt; Event p r e -&gt; Bool
$c/= :: forall p r e. Eq r =&gt; Event p r e -&gt; Event p r e -&gt; Bool
== :: Event p r e -&gt; Event p r e -&gt; Bool
$c== :: forall p r e. Eq r =&gt; Event p r e -&gt; Event p r e -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680128180"><span id="local-6989586621680128182"><span id="local-6989586621680128184"><span id="local-6989586621680128186"><span id="local-6989586621680128188"><span id="local-6989586621680128190"><span id="local-6989586621680128955"><span id="local-6989586621680128956"><span id="local-6989586621680128957"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128957"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128956"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128957"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128955"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-comment">-- decreasing on the y-coord, then increasing on x-coord, and increasing on event-type</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680128177"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128177"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680128176"><span class="annot"><span class="annottext">EventType (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128176"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680128175"><span class="annot"><span class="annottext">compare :: Event p r e -&gt; Event p r e -&gt; Ordering
</span><a href="#local-6989586621680128175"><span class="hs-operator hs-var hs-var hs-var hs-var">`compare`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span id="local-6989586621680128174"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128174"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680128173"><span class="annot"><span class="annottext">EventType (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128173"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128177"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128174"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>                                        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128176"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128173"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-165"></span><span>                                        </span><span id="local-6989586621680128172"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621680128172"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621680128172"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Get the segments that start at the given event point</span><span>
</span><span id="line-168"></span><span id="local-6989586621680128753"><span id="local-6989586621680128754"><span id="local-6989586621680128755"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-type">startSegs</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128755"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128754"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128753"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128755"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128754"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128753"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-169"></span><span id="startSegs"><span class="annot"><span class="annottext">startSegs :: forall p r e. Event p r e -&gt; [LineSegment 2 p r :+ e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var hs-var">startSegs</span></a></span></span><span> </span><span id="local-6989586621680128171"><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128171"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall p r e. Event p r e -&gt; EventType (LineSegment 2 p r :+ e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventType"><span class="hs-identifier hs-var">eventType</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128171"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span> </span><span id="local-6989586621680128170"><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128170"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NonEmpty.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128170"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-171"></span><span>                </span><span class="annot"><span class="annottext">EventType (LineSegment 2 p r :+ e)
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- * The Main Sweep</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">type</span><span> </span><span id="EventQueue"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-var">EventQueue</span></a></span></span><span>      </span><span id="local-6989586621680128168"><span class="annot"><a href="#local-6989586621680128168"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680128167"><span class="annot"><a href="#local-6989586621680128167"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680128166"><span class="annot"><a href="#local-6989586621680128166"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EQ.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128168"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128167"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128166"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">type</span><span> </span><span id="StatusStructure"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-var">StatusStructure</span></a></span></span><span> </span><span id="local-6989586621680128165"><span class="annot"><a href="#local-6989586621680128165"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680128164"><span class="annot"><a href="#local-6989586621680128164"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680128163"><span class="annot"><a href="#local-6989586621680128163"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SS.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128165"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128164"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128163"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | Run the sweep handling all events</span><span>
</span><span id="line-183"></span><span id="local-6989586621680128932"><span id="local-6989586621680128933"><span id="local-6989586621680128934"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-type">sweep</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128934"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128934"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128933"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128934"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128932"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128933"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128934"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128932"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128933"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128934"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128932"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-185"></span><span id="sweep"><span class="annot"><span class="annottext">sweep :: forall r p e.
(Ord r, Fractional r) =&gt;
EventQueue p r e
-&gt; StatusStructure p r e -&gt; [IntersectionPoint p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var hs-var">sweep</span></a></span></span><span> </span><span id="local-6989586621680128158"><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128158"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621680128157"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128157"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe (a, Set a)
</span><span class="hs-identifier hs-var">EQ.minView</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128158"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Event p r e, EventQueue p r e)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128155"><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128155"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128154"><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128154"><span class="hs-identifier hs-var">eq'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
Event p r e
-&gt; EventQueue p r e
-&gt; StatusStructure p r e
-&gt; [IntersectionPoint p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128155"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128154"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128157"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Handle an event point</span><span>
</span><span id="line-190"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-type">handle</span></a></span><span>                           </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680128728"><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680128727"><span class="annot"><a href="#local-6989586621680128727"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680128726"><span class="annot"><a href="#local-6989586621680128726"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>                                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128727"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128726"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#EventQueue"><span class="hs-identifier hs-type">EventQueue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128727"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128726"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128727"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128726"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-192"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#IntersectionPoint"><span class="hs-identifier hs-type">IntersectionPoint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128727"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128726"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-193"></span><span id="handle"><span class="annot"><span class="annottext">handle :: forall r p e.
(Ord r, Fractional r) =&gt;
Event p r e
-&gt; EventQueue p r e
-&gt; StatusStructure p r e
-&gt; [IntersectionPoint p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#handle"><span class="hs-identifier hs-var hs-var">handle</span></a></span></span><span> </span><span id="local-6989586621680128101"><span class="annot"><span class="annottext">e :: Event p r e
</span><a href="#local-6989586621680128101"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p r e. Event p r e -&gt; Point 2 r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#eventPoint"><span class="hs-identifier hs-var">eventPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680128100"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680128099"><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128099"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621680128098"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128098"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IntersectionPoint p r e]
</span><a href="#local-6989586621680128097"><span class="hs-identifier hs-var">toReport</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
EventQueue p r e
-&gt; StatusStructure p r e -&gt; [IntersectionPoint p r e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#sweep"><span class="hs-identifier hs-var">sweep</span></a></span><span> </span><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128096"><span class="hs-identifier hs-var">eq'</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128095"><span class="hs-identifier hs-var">ss'</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621680128094"><span class="annot"><span class="annottext">starts :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128094"><span class="hs-identifier hs-var hs-var">starts</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p r e. Event p r e -&gt; [LineSegment 2 p r :+ e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#startSegs"><span class="hs-identifier hs-var">startSegs</span></a></span><span> </span><span class="annot"><span class="annottext">Event p r e
</span><a href="#local-6989586621680128101"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680128093"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128093"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128092"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128092"><span class="hs-identifier hs-var">contains'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128091"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128091"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; StatusStructure p r e
-&gt; (StatusStructure p r e, [LineSegment 2 p r :+ e],
    StatusStructure p r e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var">extractContains</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128098"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680128089"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128089"><span class="hs-identifier hs-var">ends</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680128088"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128088"><span class="hs-identifier hs-var">contains</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r p e. Eq r =&gt; Point 2 r -&gt; (LineSegment 2 p r :+ e) -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var">endsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128092"><span class="hs-identifier hs-var">contains'</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- starting segments, exluding those that have an open starting point</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">-- starts' = filter (isClosedStart p) starts</span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621680128085"><span class="annot"><span class="annottext">starts' :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128085"><span class="hs-identifier hs-var hs-var">starts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Num r) =&gt;
Point 2 r -&gt; [LineSegment 2 p r :+ e] -&gt; [LineSegment 2 p r :+ e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldReport"><span class="hs-identifier hs-var">shouldReport</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">SS.toAscList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128082"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- If we just inserted open-ended segments that start here, then</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- don't consider them to be &quot;contained&quot; segments.</span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621680128081"><span class="annot"><span class="annottext">pureContains :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128081"><span class="hs-identifier hs-var hs-var">pureContains</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span id="local-6989586621680128079"><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128079"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-205"></span><span>                              </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isOpen</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128079"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128079"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall a b. Lens (EndPoint a) (EndPoint b) a b
</span><span class="hs-identifier hs-var">unEndPoint</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128088"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- any (closed) ending segments at this event point.</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621680128074"><span class="annot"><span class="annottext">closedEnds :: [LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128074"><span class="hs-identifier hs-var hs-var">closedEnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680128073"><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128073"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isClosed</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128073"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128089"><span class="hs-identifier hs-var">ends</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621680128097"><span class="annot"><span class="annottext">toReport :: [IntersectionPoint p r e]
</span><a href="#local-6989586621680128097"><span class="hs-identifier hs-var hs-var">toReport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128085"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128074"><span class="hs-identifier hs-var">closedEnds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128081"><span class="hs-identifier hs-var">pureContains</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; [LineSegment 2 p r :+ e]
-&gt; [LineSegment 2 p r :+ e]
-&gt; IntersectionPoint p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#mkIntersectionPoint"><span class="hs-identifier hs-var">mkIntersectionPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128085"><span class="hs-identifier hs-var">starts'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128074"><span class="hs-identifier hs-var">closedEnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128081"><span class="hs-identifier hs-var">pureContains</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>                 </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- new status structure</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621680128095"><span class="annot"><span class="annottext">ss' :: StatusStructure p r e
</span><a href="#local-6989586621680128095"><span class="hs-identifier hs-var hs-var">ss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128093"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128082"><span class="hs-identifier hs-var">newSegs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128091"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621680128082"><span class="annot"><span class="annottext">newSegs :: StatusStructure p r e
</span><a href="#local-6989586621680128082"><span class="hs-identifier hs-var hs-var">newSegs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r p e.
(Fractional r, Ord r) =&gt;
Point 2 r -&gt; [LineSegment 2 p r :+ e] -&gt; StatusStructure p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var">toStatusStruct</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128094"><span class="hs-identifier hs-var">starts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680128088"><span class="hs-identifier hs-var">contains</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-comment">-- the new eeventqueue</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621680128096"><span class="annot"><span class="annottext">eq' :: EventQueue p r e
</span><a href="#local-6989586621680128096"><span class="hs-identifier hs-var hs-var">eq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">EQ.insert</span></span><span> </span><span class="annot"><span class="annottext">EventQueue p r e
</span><a href="#local-6989586621680128099"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">[Event p r e]
</span><a href="#local-6989586621680128067"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- the new events:</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621680128067"><span class="annot"><span class="annottext">es :: [Event p r e]
</span><a href="#local-6989586621680128067"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">F.null</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128082"><span class="hs-identifier hs-var">newSegs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {t} {t} {b}.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680128064"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Maybe (Event p r e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128062"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128061"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-223"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680128060"><span class="annot"><span class="annottext">s' :: Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128060"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128082"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-224"></span><span>                               </span><span id="local-6989586621680128058"><span class="annot"><span class="annottext">s'' :: Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128058"><span class="hs-identifier hs-var hs-var">s''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128082"><span class="hs-identifier hs-var">newSegs</span></a></span><span>
</span><span id="line-225"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {t} {t} {b}.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680128064"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Maybe (Event p r e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128062"><span class="hs-identifier hs-var">sl</span></a></span><span>  </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128060"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-226"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {t} {t} {b}.
Monad m =&gt;
(t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680128064"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Maybe (Event p r e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var">findNewEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128100"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128058"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128061"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-227"></span><span>                                        </span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621680128062"><span class="annot"><span class="annottext">sl :: Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128062"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMax</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128093"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621680128061"><span class="annot"><span class="annottext">sr :: Maybe (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680128061"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">SS.lookupMin</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680128091"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621680128064"><span class="annot"><span class="annottext">app :: (t -&gt; t -&gt; m b) -&gt; m t -&gt; m t -&gt; m b
</span><a href="#local-6989586621680128064"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span id="local-6989586621680128052"><span class="annot"><span class="annottext">t -&gt; t -&gt; m b
</span><a href="#local-6989586621680128052"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680128051"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680128051"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680128050"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680128050"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680128049"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680128049"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680128051"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span id="local-6989586621680128048"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680128048"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680128050"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m b
</span><a href="#local-6989586621680128052"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680128049"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680128048"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">-- | given the starting point p, and the segments that either start in</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- p, or continue in p, in left to right order along a line just</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- epsilon below p, figure out which segments we should report as</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- intersecting at p.</span><span>
</span><span id="line-237"></span><span class="hs-comment">--</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- in partcular; those that:</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- - have a closed endpoint at p</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- - those that have an open endpoint at p and have an intersection</span><span>
</span><span id="line-241"></span><span class="hs-comment">--   with a segment eps below p. Those segments thus overlap wtih</span><span>
</span><span id="line-242"></span><span class="hs-comment">--   their predecessor or successor in the cyclic order.</span><span>
</span><span id="line-243"></span><span id="local-6989586621680128713"><span id="local-6989586621680128714"><span id="local-6989586621680128715"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldReport"><span class="hs-identifier hs-type">shouldReport</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128715"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680128715"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128715"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128714"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128715"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128713"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128714"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128715"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128713"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-245"></span><span id="shouldReport"><span class="annot"><span class="annottext">shouldReport :: forall r p e.
(Ord r, Num r) =&gt;
Point 2 r -&gt; [LineSegment 2 p r :+ e] -&gt; [LineSegment 2 p r :+ e]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldReport"><span class="hs-identifier hs-var hs-var">shouldReport</span></a></span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-var">overlapsOr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span id="local-6989586621680128042"><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128042"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. EndPoint a -&gt; Bool
</span><span class="hs-identifier hs-var">isClosed</span></span><span> </span><span class="annot"><span class="annottext">EndPoint (Point 2 r :+ p)
</span><a href="#local-6989586621680128042"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680128041"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680128041"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680128040"><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680128040"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680128041"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">LineSegment 2 p r
</span><a href="#local-6989586621680128040"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- | split the status structure, extracting the segments that contain p.</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- the result is (before,contains,after)</span><span>
</span><span id="line-250"></span><span id="local-6989586621680128719"><span id="local-6989586621680128720"><span id="local-6989586621680128721"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-type">extractContains</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128720"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128719"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-252"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128720"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128719"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128720"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128719"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128720"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128719"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-253"></span><span id="extractContains"><span class="annot"><span class="annottext">extractContains :: forall r p e.
(Fractional r, Ord r) =&gt;
Point 2 r
-&gt; StatusStructure p r e
-&gt; (StatusStructure p r e, [LineSegment 2 p r :+ e],
    StatusStructure p r e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#extractContains"><span class="hs-identifier hs-var hs-var">extractContains</span></a></span></span><span> </span><span id="local-6989586621680128000"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128000"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680127999"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127999"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127998"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127996"><span class="hs-identifier hs-var">mid1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127995"><span class="hs-identifier hs-var">mid2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127994"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680127998"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127998"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680127996"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127996"><span class="hs-identifier hs-var">mid1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680127993"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127993"><span class="hs-identifier hs-var">after'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a.
Ord b =&gt;
(a -&gt; b) -&gt; b -&gt; Set a -&gt; (Set a, Set a, Set a)
</span><span class="hs-identifier hs-var">SS.splitOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {r} {p} {extra}.
(Fractional r, Ord r) =&gt;
r -&gt; (LineSegment 2 p r :+ extra) -&gt; r
</span><a href="#local-6989586621680127991"><span class="hs-identifier hs-var">xCoordAt'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128000"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128000"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127999"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-comment">-- Make sure to also select the horizontal segments containing p</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680127995"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127995"><span class="hs-identifier hs-var">mid2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680127994"><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127994"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; Set a -&gt; (Set a, Set a)
</span><span class="hs-identifier hs-var">SS.spanAntitone</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-identifier hs-var">intersects</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680128000"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StatusStructure p r e
</span><a href="#local-6989586621680127993"><span class="hs-identifier hs-var">after'</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621680127991"><span class="annot"><span class="annottext">xCoordAt' :: r -&gt; (LineSegment 2 p r :+ extra) -&gt; r
</span><a href="#local-6989586621680127991"><span class="hs-identifier hs-var hs-var">xCoordAt'</span></a></span></span><span> </span><span id="local-6989586621680127981"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680127981"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621680127980"><span class="annot"><span class="annottext">LineSegment 2 p r :+ extra
</span><a href="#local-6989586621680127980"><span class="hs-identifier hs-var">sa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r p. (Fractional r, Ord r) =&gt; r -&gt; LineSegment 2 p r -&gt; r
</span><a href="Geometry.LineSegment.Internal.html#xCoordAt"><span class="hs-identifier hs-var">xCoordAt</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680127981"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ extra
</span><a href="#local-6989586621680127980"><span class="hs-identifier hs-var">sa</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | Given a point and the linesegements that contain it. Create a piece of</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- status structure for it.</span><span>
</span><span id="line-262"></span><span id="local-6989586621680128700"><span id="local-6989586621680128701"><span id="local-6989586621680128702"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-type">toStatusStruct</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128702"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128702"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128702"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128701"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128702"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128700"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#StatusStructure"><span class="hs-identifier hs-type">StatusStructure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128701"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128702"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128700"><span class="hs-identifier hs-type">e</span></a></span></span></span></span><span>
</span><span id="line-264"></span><span id="toStatusStruct"><span class="annot"><span class="annottext">toStatusStruct :: forall r p e.
(Fractional r, Ord r) =&gt;
Point 2 r -&gt; [LineSegment 2 p r :+ e] -&gt; StatusStructure p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#toStatusStruct"><span class="hs-identifier hs-var hs-var">toStatusStruct</span></a></span></span><span> </span><span id="local-6989586621680127906"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127906"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680127905"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127905"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680127904"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`SS.join`</span></span><span> </span><span class="annot"><span class="annottext">Set (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680127903"><span class="hs-identifier hs-var">hors</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-comment">-- ss { SS.nav = ordAtNav $ p^.yCoord } `SS.join` hors</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680127902"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127902"><span class="hs-identifier hs-var">hors'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680127901"><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127901"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="annot"><span class="annottext">forall {core} {point :: Nat -&gt; * -&gt; *} {d :: Nat} {a}
       {point :: Nat -&gt; * -&gt; *} {d :: Nat} {extra}.
(EndCore core ~ point d a, StartCore core ~ point d a,
 OrdCond (CmpNat 2 d) 'True 'True 'False ~ 'True,
 OrdCond (CmpNat 2 d) 'True 'True 'False ~ 'True,
 Peano (FromPeano (Peano d) + 1) ~ 'S (Peano (FromPeano (Peano d))),
 Peano (FromPeano (Peano d) + 1) ~ 'S (Peano (FromPeano (Peano d))),
 ImplicitPeano (Peano d), ImplicitPeano (Peano d), HasEnd core,
 Eq a, HasStart core, ArityPeano (Peano (FromPeano (Peano d))),
 ArityPeano (Peano (FromPeano (Peano d))), KnownNat d, KnownNat d,
 KnownNat (FromPeano (Peano d)), KnownNat (FromPeano (Peano d)),
 AsAPoint point, AsAPoint point) =&gt;
(core :+ extra) -&gt; Bool
</span><a href="#local-6989586621680127900"><span class="hs-identifier hs-var">isHorizontal</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127905"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621680127904"><span class="annot"><span class="annottext">ss :: Set (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680127904"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">SS.fromListBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {r} {p} {extra} {extra}.
(Fractional r, Ord r) =&gt;
r
-&gt; (LineSegment 2 p r :+ extra)
-&gt; (LineSegment 2 p r :+ extra)
-&gt; Ordering
</span><a href="#local-6989586621680127898"><span class="hs-identifier hs-var">ordAtY'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e] -&gt; r
</span><a href="#local-6989586621680127897"><span class="hs-identifier hs-var">maxY</span></a></span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127905"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127901"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621680127903"><span class="annot"><span class="annottext">hors :: Set (LineSegment 2 p r :+ e)
</span><a href="#local-6989586621680127903"><span class="hs-identifier hs-var hs-var">hors</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">SS.fromListBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">forall r p e. Ord r =&gt; (LineSegment 2 p r :+ e) -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var">rightEndpoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LineSegment 2 p r :+ e]
</span><a href="#local-6989586621680127902"><span class="hs-identifier hs-var">hors'</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621680127900"><span class="annot"><span class="annottext">isHorizontal :: (core :+ extra) -&gt; Bool
</span><a href="#local-6989586621680127900"><span class="hs-identifier hs-var hs-var">isHorizontal</span></a></span></span><span> </span><span id="local-6989586621680127837"><span class="annot"><span class="annottext">core :+ extra
</span><a href="#local-6989586621680127837"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">core :+ extra
</span><a href="#local-6989586621680127837"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">core :+ extra
</span><a href="#local-6989586621680127837"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>    </span><span id="local-6989586621680127898"><span class="annot"><span class="annottext">ordAtY' :: r
-&gt; (LineSegment 2 p r :+ extra)
-&gt; (LineSegment 2 p r :+ extra)
-&gt; Ordering
</span><a href="#local-6989586621680127898"><span class="hs-identifier hs-var hs-var">ordAtY'</span></a></span></span><span> </span><span id="local-6989586621680127830"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680127830"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621680127829"><span class="annot"><span class="annottext">LineSegment 2 p r :+ extra
</span><a href="#local-6989586621680127829"><span class="hs-identifier hs-var">sa</span></a></span></span><span> </span><span id="local-6989586621680127828"><span class="annot"><span class="annottext">LineSegment 2 p r :+ extra
</span><a href="#local-6989586621680127828"><span class="hs-identifier hs-var">sb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r p.
(Fractional r, Ord r) =&gt;
r -&gt; LineSegment 2 p r -&gt; LineSegment 2 p r -&gt; Ordering
</span><a href="Geometry.LineSegment.Internal.html#ordAtY"><span class="hs-identifier hs-var">ordAtY</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680127830"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ extra
</span><a href="#local-6989586621680127829"><span class="hs-identifier hs-var">sa</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ extra
</span><a href="#local-6989586621680127828"><span class="hs-identifier hs-var">sb</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- find the y coord of the first interesting thing below the sweep at y</span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621680127897"><span class="annot"><span class="annottext">maxY :: [LineSegment 2 p r :+ e] -&gt; r
</span><a href="#local-6989586621680127897"><span class="hs-identifier hs-var hs-var">maxY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127906"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>         </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680127824"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127824"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127824"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127824"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(2 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#yCoord"><span class="hs-identifier hs-var">yCoord</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- | Get the right endpoint of a segment</span><span>
</span><span id="line-280"></span><span id="local-6989586621680128631"><span id="local-6989586621680128632"><span id="local-6989586621680128633"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-type">rightEndpoint</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128633"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128632"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128633"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128631"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680128633"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-281"></span><span id="rightEndpoint"><span class="annot"><span class="annottext">rightEndpoint :: forall r p e. Ord r =&gt; (LineSegment 2 p r :+ e) -&gt; r
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#rightEndpoint"><span class="hs-identifier hs-var hs-var">rightEndpoint</span></a></span></span><span> </span><span id="local-6989586621680127790"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127790"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127790"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasStart t =&gt; Lens' t (StartCore t :+ StartExtra t)
</span><a href="Geometry.Interval.html#start"><span class="hs-identifier hs-var">start</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`max`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127790"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall t. HasEnd t =&gt; Lens' t (EndCore t :+ EndExtra t)
</span><a href="Geometry.Interval.html#end"><span class="hs-identifier hs-var">end</span></a></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (point :: Nat -&gt; * -&gt; *) r.
(1 &lt;= d, Arity d, AsAPoint point) =&gt;
Lens' (point d r) r
</span><a href="Geometry.Point.Class.html#xCoord"><span class="hs-identifier hs-var">xCoord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- | Test if a segment ends at p</span><span>
</span><span id="line-284"></span><span id="local-6989586621680128716"><span id="local-6989586621680128717"><span id="local-6989586621680128718"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-type">endsAt</span></a></span><span>                                  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680128718"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128718"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128717"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128718"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128716"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-285"></span><span id="endsAt"><span class="annot"><span class="annottext">endsAt :: forall r p e. Eq r =&gt; Point 2 r -&gt; (LineSegment 2 p r :+ e) -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#endsAt"><span class="hs-identifier hs-var hs-var">endsAt</span></a></span></span><span> </span><span id="local-6989586621680127772"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127772"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment%27"><span class="hs-identifier hs-type">LineSegment'</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680127770"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127770"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127772"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127770"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-comment">-- all (\q -&gt; ordPoints (q^.core) p /= GT) [a,b]</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- * Finding New events</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- | Find all events</span><span>
</span><span id="line-292"></span><span id="local-6989586621680128690"><span id="local-6989586621680128691"><span id="local-6989586621680128692"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-type">findNewEvent</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680128692"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680128692"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128692"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128691"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128692"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128690"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680128691"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128692"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680128690"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-294"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128691"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128692"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680128690"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-295"></span><span id="findNewEvent"><span class="annot"><span class="annottext">findNewEvent :: forall r p e.
(Ord r, Fractional r) =&gt;
Point 2 r
-&gt; (LineSegment 2 p r :+ e)
-&gt; (LineSegment 2 p r :+ e)
-&gt; Maybe (Event p r e)
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#findNewEvent"><span class="hs-identifier hs-var hs-var">findNewEvent</span></a></span></span><span> </span><span id="local-6989586621680127761"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127761"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680127760"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127760"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680127759"><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127759"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (ts :: [*]) b. CoRec Identity ts -&gt; Handlers ts b -&gt; b
</span><span class="hs-identifier hs-var">match</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127760"><span class="hs-identifier hs-var">l</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall g h. IsIntersectableWith g h =&gt; g -&gt; h -&gt; Intersection g h
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LineSegment 2 p r :+ e
</span><a href="#local-6989586621680127759"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-296"></span><span>     </span><span class="annot"><span class="annottext">forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NoIntersection</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="annottext">forall {u} (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680127753"><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127753"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall r. Ord r =&gt; Point 2 r -&gt; Point 2 r -&gt; Ordering
</span><a href="Algorithms.Geometry.LineSegmentIntersection.Types.html#ordPoints"><span class="hs-identifier hs-var">ordPoints</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127753"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127761"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p r e.
Point 2 r -&gt; EventType (LineSegment 2 p r :+ e) -&gt; Event p r e
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Event"><span class="hs-identifier hs-var">Event</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680127753"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. EventType s
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#Intersection"><span class="hs-identifier hs-var">Intersection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><span class="annottext">forall {u} (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall b a. (a -&gt; b) -&gt; Handler b a
</span><span class="hs-identifier hs-var">H</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- full segment intersectsions are handled</span><span>
</span><span id="line-300"></span><span>                       </span><span class="hs-comment">-- at insertion time</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="annottext">forall {u} (a :: u -&gt; *) (r :: u) (rs :: [u]).
a r -&gt; Rec a rs -&gt; Rec a (r : rs)
</span><span class="hs-operator hs-var">:&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall {u} (a :: u -&gt; *). Rec a '[]
</span><span class="hs-identifier hs-var">RNil</span></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-keyword">type</span><span> </span><span id="R"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#R"><span class="hs-identifier hs-var">R</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg1"><span class="hs-identifier hs-type">seg1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg2"><span class="hs-identifier hs-type">seg2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#R"><span class="hs-identifier hs-type">R</span></a></span><span>
</span><span id="line-308"></span><span id="seg1"><span class="annot"><span class="annottext">seg1 :: LineSegment 2 () R
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg1"><span class="hs-identifier hs-var hs-var">seg1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Geometry.LineSegment.Internal.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span id="seg2"><span class="annot"><span class="annottext">seg2 :: LineSegment 2 () R
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#seg2"><span class="hs-identifier hs-var hs-var">seg2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Geometry.LineSegment.Internal.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; a :+ ()
</span><span class="hs-identifier hs-var">ext</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall r. r -&gt; r -&gt; Point 2 r
</span><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-var">Point2</span></a></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">R
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- *</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-comment">-- | Given a predicate p on elements, and a predicate q on</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- (neighbouring) pairs of elements, filter the elements that satisfy</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- p, or together with one of their neighbours satisfy q.</span><span>
</span><span id="line-319"></span><span id="local-6989586621680128681"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-type">overlapsOr</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128681"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128681"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680128681"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680128681"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-322"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680128681"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-323"></span><span id="overlapsOr"><span class="annot"><span class="annottext">overlapsOr :: forall a. (a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsOr"><span class="hs-identifier hs-var hs-var">overlapsOr</span></a></span></span><span> </span><span id="local-6989586621680127746"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680127746"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680127745"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127745"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680127744"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127744"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680127743"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127743"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680127742"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127742"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127744"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127743"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127742"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>               </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127745"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>               </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680127739"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127739"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127739"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621680127746"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127739"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | Given a predicate, test and a list, annotate each element whether</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- it, together with one of its neighbors satisifies the predicate.</span><span>
</span><span id="line-329"></span><span id="local-6989586621680128583"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-type">overlapsWithNeighbour</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128583"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680128583"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680128583"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680128583"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-330"></span><span id="overlapsWithNeighbour"><span class="annot"><span class="annottext">overlapsWithNeighbour :: forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var hs-var">overlapsWithNeighbour</span></a></span></span><span> </span><span id="local-6989586621680127738"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127738"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127737"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-332"></span><span>    </span><span id="local-6989586621680127737"><span class="annot"><span class="annottext">go0 :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127737"><span class="hs-identifier hs-var hs-var">go0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680127736"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127736"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680127735"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127735"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127734"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127736"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127735"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621680127734"><span class="annot"><span class="annottext">go :: a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127734"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680127733"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127733"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680127732"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127732"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680127731"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127731"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680127730"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127730"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680127729"><span class="annot"><span class="annottext">b' :: Bool
</span><a href="#local-6989586621680127729"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127738"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127733"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127731"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-339"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127733"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127732"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127729"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127734"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127731"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127729"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127730"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-comment">-- annotateReport   :: (a -&gt; Bool) -&gt; [a] -&gt; [(a,Bool)]</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- annotateReport p = map (\x -&gt; (x, p x))</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span id="local-6989586621680127728"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNext%27"><span class="hs-identifier hs-type">overlapsWithNext'</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680127728"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680127728"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680127728"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680127728"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-345"></span><span id="overlapsWithNext%27"><span class="annot"><span class="annottext">overlapsWithNext' :: forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNext%27"><span class="hs-identifier hs-var hs-var">overlapsWithNext'</span></a></span></span><span> </span><span id="local-6989586621680127726"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127726"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127725"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621680127725"><span class="annot"><span class="annottext">go :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127725"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621680127724"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127724"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127724"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680127723"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127723"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680127722"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621680127722"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680127721"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127721"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127723"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127726"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127723"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127721"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127725"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127722"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span id="local-6989586621680127720"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithPrev%27"><span class="hs-identifier hs-type">overlapsWithPrev'</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680127720"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680127720"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680127720"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680127720"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-353"></span><span id="overlapsWithPrev%27"><span class="annot"><span class="annottext">overlapsWithPrev' :: forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithPrev%27"><span class="hs-identifier hs-var hs-var">overlapsWithPrev'</span></a></span></span><span> </span><span id="local-6989586621680127718"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127718"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127717"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621680127717"><span class="annot"><span class="annottext">go0 :: [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127717"><span class="hs-identifier hs-var hs-var">go0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680127716"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127716"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680127715"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127715"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127716"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127714"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127716"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127715"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621680127714"><span class="annot"><span class="annottext">go :: a -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127714"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680127713"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127713"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680127712"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127712"><span class="hs-identifier hs-var">y</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680127711"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127711"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127712"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127718"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127713"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127712"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [(a, Bool)]
</span><a href="#local-6989586621680127714"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680127712"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127711"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span id="overlapsWithNeighbour2"><span class="annot"><span class="annottext">overlapsWithNeighbour2 :: (b -&gt; b -&gt; Bool) -&gt; [b] -&gt; [(b, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour2"><span class="hs-identifier hs-var hs-var">overlapsWithNeighbour2</span></a></span></span><span> </span><span id="local-6989586621680127709"><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
</span><a href="#local-6989586621680127709"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680127708"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680127708"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680127707"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127707"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621680127706"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127706"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680127708"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127707"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680127706"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                         </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNext%27"><span class="hs-identifier hs-var">overlapsWithNext'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
</span><a href="#local-6989586621680127709"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                         </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithPrev%27"><span class="hs-identifier hs-var">overlapsWithPrev'</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
</span><a href="#local-6989586621680127709"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span id="local-6989586621680127705"><span class="annot"><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldBe"><span class="hs-identifier hs-type">shouldBe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680127705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680127705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680127705"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-369"></span><span id="shouldBe"><span class="annot"><span class="annottext">shouldBe :: forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldBe"><span class="hs-identifier hs-var hs-var">shouldBe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span id="propSameAsSeparate"><span class="annot"><span class="annottext">propSameAsSeparate :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#propSameAsSeparate"><span class="hs-identifier hs-var hs-var">propSameAsSeparate</span></a></span></span><span> </span><span id="local-6989586621680127692"><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127692"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680127691"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127691"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127692"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127691"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#shouldBe"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour2"><span class="hs-identifier hs-var">overlapsWithNeighbour2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
</span><a href="#local-6989586621680127692"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680127691"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span id="test%27"><span class="annot"><span class="annottext">test' :: [(Integer, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#test%27"><span class="hs-identifier hs-var hs-var">test'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [(a, Bool)]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#overlapsWithNeighbour"><span class="hs-identifier hs-var">overlapsWithNeighbour</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">[Integer]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#testOverlapNext"><span class="hs-identifier hs-var">testOverlapNext</span></a></span><span>
</span><span id="line-374"></span><span id="testOverlapNext"><span class="annot"><span class="annottext">testOverlapNext :: [Integer]
</span><a href="Algorithms.Geometry.LineSegmentIntersection.BentleyOttmann.html#testOverlapNext"><span class="hs-identifier hs-var hs-var">testOverlapNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">6</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">8</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">11</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">34</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-375"></span></pre></body></html>