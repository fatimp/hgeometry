<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-name-shadowing #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.PolygonTriangulation.EarClip</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  (C) David Himmelstrup</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Maintainer  :  David Himmelstrup</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Ear clipping triangulation algorithms. The baseline algorithm runs in \( O(n^2) \)</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- but has a low constant factor overhead. The z-order hashed variant runs in</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- \( O(n \log n) \) time.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- References:</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">--  1. https://en.wikipedia.org/wiki/Polygon_triangulation#Ear_clipping_method</span><span>
</span><span id="line-17"></span><span class="hs-comment">--  2. https://en.wikipedia.org/wiki/Z-order_curve</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.PolygonTriangulation.EarClip</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClip"><span class="hs-identifier">earClip</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipRandom"><span class="hs-identifier">earClipRandom</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipHashed"><span class="hs-identifier">earClipHashed</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipRandomHashed"><span class="hs-identifier">earClipRandomHashed</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHash"><span class="hs-identifier">zHash</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHash"><span class="hs-identifier">zUnHash</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Identity</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runST</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Unsafe</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeInterleaveST</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Boundary.html"><span class="hs-identifier">Geometry.Boundary</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Boundary.html#PointLocationResult"><span class="hs-identifier">PointLocationResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Boundary.html#Outside"><span class="hs-identifier">Outside</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Point.html"><span class="hs-identifier">Geometry.Point</span></a></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier">Point</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier">Point2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Point.Orientation.Degenerate.html#ccw"><span class="hs-identifier">ccw</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Geometry.Point.Orientation.Degenerate.html#CCW"><span class="hs-identifier">CCW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Polygon.html"><span class="hs-identifier">Geometry.Polygon</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Box.html"><span class="hs-identifier">Geometry.Box</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Triangle.html"><span class="hs-identifier">Geometry.Triangle</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Triangle.html#Triangle"><span class="hs-identifier">Triangle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Triangle.html#Triangle"><span class="hs-identifier">Triangle</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Triangle.html#inTriangle"><span class="hs-identifier">inTriangle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Algorithms.Intro</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Algo</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Circular</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CV</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.NonEmpty</span></span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">U</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Unboxed.Mutable</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MU</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">build</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Linear.V2</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkStdGen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">randomR</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">{-
  We can check if a vertex is an ear in O(n) time. Checking all vertices will definitely
  yield at least one ear in O(n^2) time. So, finding N ears will take O(n^3) if done naively.

  Keeping a separate list of possible ears will improve matters. For each possible ear,
  we check if the vertex really is an ear or not. If it isn't, it is deleted from the
  list of possible ears. If it /is/ an ear, the vertex is cut and the neighbours are
  added back to the list of possible ears (if they aren't in the list already).

  So, start with a list of N possible ears, and we might add two vertices to the list
  ever time we find an ear. Since there are only N ears to be found, only 2*N vertices
  can be added to the list of possible ears in the worst case scenario. The list is
  therefore bounded to 3*N and finding all ears is therefore O(n^2).

  Note: When checking if a vertex is an ear, it is sufficient to check against
        reflex vertices. Some implementations keep a separate list of reflex
        vertices for this reason but it does increase the constant factor
        overhead. I think it's better to keep the constant factor low for small values
        of N and use the hashed algorithm for larger values of N.
-}</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | \( O(n^2) \)</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">--   Returns triangular faces using absolute polygon point indices.</span><span>
</span><span id="line-75"></span><span id="local-6989586621680060116"><span id="local-6989586621680060117"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClip"><span class="hs-identifier hs-type">earClip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680060117"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680060117"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060116"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060117"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-76"></span><span id="earClip"><span class="annot"><span class="annottext">earClip :: SimplePolygon p r -&gt; [(Int, Int, Int)]
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClip"><span class="hs-identifier hs-var hs-var">earClip</span></a></span></span><span> </span><span id="local-6989586621680060115"><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060115"><span class="hs-identifier hs-var">poly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b)
-&gt; [(Int, Int, Int)]
forall a. (forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [a]
</span><span class="hs-identifier hs-var">build</span></span><span> </span><span class="annot"><span class="annottext">forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060114"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621680060113"><span class="annot"><span class="annottext">vs :: Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060113"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a. NonEmptyVector a -&gt; Vector a
</span><span class="hs-identifier hs-var">NE.toVector</span></span><span> </span><span class="annot"><span class="annottext">(NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p))
-&gt; NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p) -&gt; NonEmptyVector (Point 2 r :+ p)
forall a. CircularVector a -&gt; NonEmptyVector a
</span><span class="hs-identifier hs-var hs-var">CV.vector</span></span><span> </span><span class="annot"><span class="annottext">(CircularVector (Point 2 r :+ p)
 -&gt; NonEmptyVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
-&gt; NonEmptyVector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060115"><span class="hs-identifier hs-var">poly</span></a></span><span class="annot"><span class="annottext">SimplePolygon p r
-&gt; Getting
     (CircularVector (Point 2 r :+ p))
     (SimplePolygon p r)
     (CircularVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (CircularVector (Point 2 r :+ p))
  (SimplePolygon p r)
  (CircularVector (Point 2 r :+ p))
forall (t :: PolygonType) p r.
Getter (Polygon t p r) (CircularVector (Point 2 r :+ p))
</span><a href="Geometry.Polygon.Core.html#outerBoundaryVector"><span class="hs-identifier hs-var">outerBoundaryVector</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621680060109"><span class="annot"><a href="#local-6989586621680060114"><span class="hs-identifier hs-type">gen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060109"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060109"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060109"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060109"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-80"></span><span>    </span><span id="local-6989586621680060114"><span class="annot"><span class="annottext">gen :: ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060114"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621680060108"><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060108"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621680060107"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060107"><span class="hs-identifier hs-var">nil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s b) -&gt; b
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s b) -&gt; b) -&gt; (forall s. ST s b) -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>      </span><span id="local-6989586621680060106"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060106"><span class="hs-identifier hs-var">vertices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall a s. Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListFromVector"><span class="hs-identifier hs-var">mutListFromVector</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060113"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-82"></span><span>      </span><span id="local-6989586621680060104"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall s a. MutList s a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListClone"><span class="hs-identifier hs-var">mutListClone</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060106"><span class="hs-identifier hs-var">vertices</span></a></span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060102"><span class="annot"><span class="annottext">worker :: Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060102"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621680060101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060101"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621680060100"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>            </span><span id="local-6989586621680060099"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060106"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-85"></span><span>            </span><span id="local-6989586621680060097"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060106"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-86"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060101"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-87"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-88"></span><span>                </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ST s b) -&gt; b -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060108"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060107"><span class="hs-identifier hs-var">nil</span></a></span><span>
</span><span id="line-89"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>                </span><span id="local-6989586621680060095"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-91"></span><span>                </span><span id="local-6989586621680060094"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-92"></span><span>                </span><span id="local-6989586621680060093"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060093"><span class="hs-identifier hs-var">isEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s Bool
forall r s p.
(Num r, Ord r) =&gt;
MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheck"><span class="hs-identifier hs-var">earCheck</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060106"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-93"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060093"><span class="hs-identifier hs-var">isEar</span></a></span><span>
</span><span id="line-94"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span>
</span><span id="line-96"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060106"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-comment">-- remove ear</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-99"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-100"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-101"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-102"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-104"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-105"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-106"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>                    </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060108"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>                      </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; ST s b -&gt; ST s b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ST s b -&gt; ST s b
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">unsafeInterleaveST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060102"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060101"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- not an ear</span><span>
</span><span id="line-111"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060104"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="hs-comment">-- remove vertex</span><span>
</span><span id="line-112"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060102"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060101"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">nextEar</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060102"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060113"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | \( O(n^2) \)</span><span>
</span><span id="line-116"></span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span class="hs-comment">--   Returns triangular faces using absolute polygon point indices.</span><span>
</span><span id="line-118"></span><span id="local-6989586621680060085"><span id="local-6989586621680060086"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipRandom"><span class="hs-identifier hs-type">earClipRandom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680060086"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680060086"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060085"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060086"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-119"></span><span id="earClipRandom"><span class="annot"><span class="annottext">earClipRandom :: SimplePolygon p r -&gt; [(Int, Int, Int)]
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipRandom"><span class="hs-identifier hs-var hs-var">earClipRandom</span></a></span></span><span> </span><span id="local-6989586621680060084"><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060084"><span class="hs-identifier hs-var">poly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b)
-&gt; [(Int, Int, Int)]
forall a. (forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [a]
</span><span class="hs-identifier hs-var">build</span></span><span> </span><span class="annot"><span class="annottext">forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060083"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621680060082"><span class="annot"><span class="annottext">vs :: Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060082"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a. NonEmptyVector a -&gt; Vector a
</span><span class="hs-identifier hs-var">NE.toVector</span></span><span> </span><span class="annot"><span class="annottext">(NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p))
-&gt; NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p) -&gt; NonEmptyVector (Point 2 r :+ p)
forall a. CircularVector a -&gt; NonEmptyVector a
</span><span class="hs-identifier hs-var hs-var">CV.vector</span></span><span> </span><span class="annot"><span class="annottext">(CircularVector (Point 2 r :+ p)
 -&gt; NonEmptyVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
-&gt; NonEmptyVector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060084"><span class="hs-identifier hs-var">poly</span></a></span><span class="annot"><span class="annottext">SimplePolygon p r
-&gt; Getting
     (CircularVector (Point 2 r :+ p))
     (SimplePolygon p r)
     (CircularVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (CircularVector (Point 2 r :+ p))
  (SimplePolygon p r)
  (CircularVector (Point 2 r :+ p))
forall (t :: PolygonType) p r.
Getter (Polygon t p r) (CircularVector (Point 2 r :+ p))
</span><a href="Geometry.Polygon.Core.html#outerBoundaryVector"><span class="hs-identifier hs-var">outerBoundaryVector</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621680060081"><span class="annot"><a href="#local-6989586621680060083"><span class="hs-identifier hs-type">gen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060081"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060081"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060081"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060081"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621680060083"><span class="annot"><span class="annottext">gen :: ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060083"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621680060080"><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060080"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621680060079"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060079"><span class="hs-identifier hs-var">nil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s b) -&gt; b
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s b) -&gt; b) -&gt; (forall s. ST s b) -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>      </span><span id="local-6989586621680060078"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060078"><span class="hs-identifier hs-var">vertices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall a s. Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListFromVector"><span class="hs-identifier hs-var">mutListFromVector</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060082"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-125"></span><span>      </span><span id="local-6989586621680060077"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall s a. MutList s a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListClone"><span class="hs-identifier hs-var">mutListClone</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060078"><span class="hs-identifier hs-var">vertices</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span id="local-6989586621680060076"><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060076"><span class="hs-identifier hs-var">shuffled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Shuffled s)
forall s. Int -&gt; ST s (Shuffled s)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#newShuffled"><span class="hs-identifier hs-var">newShuffled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060082"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060074"><span class="annot"><span class="annottext">worker :: Int -&gt; ST s b
</span><a href="#local-6989586621680060074"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621680060073"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060073"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>            </span><span id="local-6989586621680060072"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Shuffled s -&gt; ST s Int
forall s. Shuffled s -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#popShuffled"><span class="hs-identifier hs-var">popShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060076"><span class="hs-identifier hs-var">shuffled</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span id="local-6989586621680060070"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060078"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-130"></span><span>            </span><span id="local-6989586621680060069"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060078"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060073"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-132"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-133"></span><span>                </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ST s b) -&gt; b -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060080"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060079"><span class="hs-identifier hs-var">nil</span></a></span><span>
</span><span id="line-134"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>                </span><span id="local-6989586621680060068"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-136"></span><span>                </span><span id="local-6989586621680060067"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-137"></span><span>                </span><span id="local-6989586621680060066"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060066"><span class="hs-identifier hs-var">isEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s Bool
forall r s p.
(Num r, Ord r) =&gt;
MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheck"><span class="hs-identifier hs-var">earCheck</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060078"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-138"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060066"><span class="hs-identifier hs-var">isEar</span></a></span><span>
</span><span id="line-139"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span>
</span><span id="line-141"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060078"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-comment">-- remove ear</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060076"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-146"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060076"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-147"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-148"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-149"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060076"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-151"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-152"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060076"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-154"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-155"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>                    </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060080"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060070"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060072"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060069"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>                      </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; ST s b -&gt; ST s b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ST s b -&gt; ST s b
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">unsafeInterleaveST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ST s b
</span><a href="#local-6989586621680060074"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060073"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- not an ear</span><span>
</span><span id="line-160"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060077"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060068"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060067"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="hs-comment">-- remove vertex</span><span>
</span><span id="line-161"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; ST s b
</span><a href="#local-6989586621680060074"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060073"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; ST s b
</span><a href="#local-6989586621680060074"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060082"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | \( O(n \log n) \) expected time.</span><span>
</span><span id="line-165"></span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span class="hs-comment">--   Returns triangular faces using absolute polygon point indices.</span><span>
</span><span id="line-167"></span><span id="local-6989586621680060063"><span id="local-6989586621680060064"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipHashed"><span class="hs-identifier hs-type">earClipHashed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span> </span><span class="annot"><a href="#local-6989586621680060064"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060063"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060064"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-168"></span><span id="earClipHashed"><span class="annot"><span class="annottext">earClipHashed :: SimplePolygon p r -&gt; [(Int, Int, Int)]
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipHashed"><span class="hs-identifier hs-var hs-var">earClipHashed</span></a></span></span><span> </span><span id="local-6989586621680060062"><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060062"><span class="hs-identifier hs-var">poly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b)
-&gt; [(Int, Int, Int)]
forall a. (forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [a]
</span><span class="hs-identifier hs-var">build</span></span><span> </span><span class="annot"><span class="annottext">forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060061"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621680060060"><span class="annot"><span class="annottext">vs :: Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060060"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a. NonEmptyVector a -&gt; Vector a
</span><span class="hs-identifier hs-var">NE.toVector</span></span><span> </span><span class="annot"><span class="annottext">(NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p))
-&gt; NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p) -&gt; NonEmptyVector (Point 2 r :+ p)
forall a. CircularVector a -&gt; NonEmptyVector a
</span><span class="hs-identifier hs-var hs-var">CV.vector</span></span><span> </span><span class="annot"><span class="annottext">(CircularVector (Point 2 r :+ p)
 -&gt; NonEmptyVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
-&gt; NonEmptyVector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060062"><span class="hs-identifier hs-var">poly</span></a></span><span class="annot"><span class="annottext">SimplePolygon p r
-&gt; Getting
     (CircularVector (Point 2 r :+ p))
     (SimplePolygon p r)
     (CircularVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (CircularVector (Point 2 r :+ p))
  (SimplePolygon p r)
  (CircularVector (Point 2 r :+ p))
forall (t :: PolygonType) p r.
Getter (Polygon t p r) (CircularVector (Point 2 r :+ p))
</span><a href="Geometry.Polygon.Core.html#outerBoundaryVector"><span class="hs-identifier hs-var">outerBoundaryVector</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621680060059"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621680060059"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060060"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621680060058"><span class="annot"><span class="annottext">hasher :: Point 2 r -&gt; Word
</span><a href="#local-6989586621680060058"><span class="hs-identifier hs-var hs-var">hasher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Point 2 r -&gt; Word
forall r p. Real r =&gt; Vector (Point 2 r :+ p) -&gt; Point 2 r -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashGen"><span class="hs-identifier hs-var">zHashGen</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060060"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621680060056"><span class="annot"><span class="annottext">zHashVec :: Vector Word
</span><a href="#local-6989586621680060056"><span class="hs-identifier hs-var hs-var">zHashVec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Word) -&gt; Vector Word
forall a. Unbox a =&gt; Int -&gt; (Int -&gt; a) -&gt; Vector a
</span><span class="hs-identifier hs-var">U.generate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060059"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Word) -&gt; Vector Word) -&gt; (Int -&gt; Word) -&gt; Vector Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680060054"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060054"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680060058"><span class="hs-identifier hs-var">hasher</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060060"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060054"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621680060051"><span class="annot"><a href="#local-6989586621680060061"><span class="hs-identifier hs-type">gen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060051"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060051"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060051"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621680060061"><span class="annot"><span class="annottext">gen :: ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060061"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621680060050"><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060050"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621680060049"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060049"><span class="hs-identifier hs-var">nil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s b) -&gt; b
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s b) -&gt; b) -&gt; (forall s. ST s b) -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>      </span><span id="local-6989586621680060048"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060048"><span class="hs-identifier hs-var">vertices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall a s. Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListFromVector"><span class="hs-identifier hs-var">mutListFromVector</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060060"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-177"></span><span>      </span><span id="local-6989586621680060047"><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680060047"><span class="hs-identifier hs-var">zHashes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector Word -&gt; ST s (MutList s Word)
forall a s. (Ord a, Unbox a) =&gt; Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListSort"><span class="hs-identifier hs-var">mutListSort</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Word
</span><a href="#local-6989586621680060056"><span class="hs-identifier hs-var">zHashVec</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span id="local-6989586621680060045"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall s a. MutList s a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListClone"><span class="hs-identifier hs-var">mutListClone</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060048"><span class="hs-identifier hs-var">vertices</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060044"><span class="annot"><span class="annottext">worker :: Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060044"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621680060043"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060043"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621680060042"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>            </span><span id="local-6989586621680060041"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060048"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span id="local-6989586621680060040"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060048"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060043"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-183"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-184"></span><span>                </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ST s b) -&gt; b -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060050"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060049"><span class="hs-identifier hs-var">nil</span></a></span><span>
</span><span id="line-185"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>                </span><span id="local-6989586621680060039"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-187"></span><span>                </span><span id="local-6989586621680060038"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-188"></span><span>                </span><span id="local-6989586621680060037"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060037"><span class="hs-identifier hs-var">isEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Word)
-&gt; MutList s (Point 2 r :+ p)
-&gt; MutList s Word
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; ST s Bool
forall r s p.
Real r =&gt;
(Point 2 r -&gt; Word)
-&gt; MutList s (Point 2 r :+ p)
-&gt; MutList s Word
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; ST s Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheckHashed"><span class="hs-identifier hs-var">earCheckHashed</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680060058"><span class="hs-identifier hs-var">hasher</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060048"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680060047"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-189"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060037"><span class="hs-identifier hs-var">isEar</span></a></span><span>
</span><span id="line-190"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span>
</span><span id="line-192"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060048"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-comment">-- remove ear</span><span>
</span><span id="line-193"></span><span>                    </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDeleteFocus"><span class="hs-identifier hs-var">mutListDeleteFocus</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680060047"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-196"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-198"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-199"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-201"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-203"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>                    </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060050"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060040"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>                      </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; ST s b -&gt; ST s b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ST s b -&gt; ST s b
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">unsafeInterleaveST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060044"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060043"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- not an ear</span><span>
</span><span id="line-208"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060045"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060039"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="hs-comment">-- remove vertex</span><span>
</span><span id="line-209"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060044"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060043"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060038"><span class="hs-identifier hs-var">nextEar</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s b
</span><a href="#local-6989586621680060044"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060059"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | \( O(n \log n) \) expected time.</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   Returns triangular faces using absolute polygon point indices.</span><span>
</span><span id="line-215"></span><span id="local-6989586621680060033"><span id="local-6989586621680060034"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipRandomHashed"><span class="hs-identifier hs-type">earClipRandomHashed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span> </span><span class="annot"><a href="#local-6989586621680060034"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Polygon.Core.html#SimplePolygon"><span class="hs-identifier hs-type">SimplePolygon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060033"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060034"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-216"></span><span id="earClipRandomHashed"><span class="annot"><span class="annottext">earClipRandomHashed :: SimplePolygon p r -&gt; [(Int, Int, Int)]
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earClipRandomHashed"><span class="hs-identifier hs-var hs-var">earClipRandomHashed</span></a></span></span><span> </span><span id="local-6989586621680060032"><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060032"><span class="hs-identifier hs-var">poly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b)
-&gt; [(Int, Int, Int)]
forall a. (forall b. (a -&gt; b -&gt; b) -&gt; b -&gt; b) -&gt; [a]
</span><span class="hs-identifier hs-var">build</span></span><span> </span><span class="annot"><span class="annottext">forall b. ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060031"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621680060030"><span class="annot"><span class="annottext">vs :: Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060030"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a. NonEmptyVector a -&gt; Vector a
</span><span class="hs-identifier hs-var">NE.toVector</span></span><span> </span><span class="annot"><span class="annottext">(NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p))
-&gt; NonEmptyVector (Point 2 r :+ p) -&gt; Vector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CircularVector (Point 2 r :+ p) -&gt; NonEmptyVector (Point 2 r :+ p)
forall a. CircularVector a -&gt; NonEmptyVector a
</span><span class="hs-identifier hs-var hs-var">CV.vector</span></span><span> </span><span class="annot"><span class="annottext">(CircularVector (Point 2 r :+ p)
 -&gt; NonEmptyVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
-&gt; NonEmptyVector (Point 2 r :+ p)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimplePolygon p r
</span><a href="#local-6989586621680060032"><span class="hs-identifier hs-var">poly</span></a></span><span class="annot"><span class="annottext">SimplePolygon p r
-&gt; Getting
     (CircularVector (Point 2 r :+ p))
     (SimplePolygon p r)
     (CircularVector (Point 2 r :+ p))
-&gt; CircularVector (Point 2 r :+ p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting
  (CircularVector (Point 2 r :+ p))
  (SimplePolygon p r)
  (CircularVector (Point 2 r :+ p))
forall (t :: PolygonType) p r.
Getter (Polygon t p r) (CircularVector (Point 2 r :+ p))
</span><a href="Geometry.Polygon.Core.html#outerBoundaryVector"><span class="hs-identifier hs-var">outerBoundaryVector</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621680060029"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621680060029"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060030"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621680060028"><span class="annot"><span class="annottext">hasher :: Point 2 r -&gt; Word
</span><a href="#local-6989586621680060028"><span class="hs-identifier hs-var hs-var">hasher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Point 2 r -&gt; Word
forall r p. Real r =&gt; Vector (Point 2 r :+ p) -&gt; Point 2 r -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashGen"><span class="hs-identifier hs-var">zHashGen</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060030"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621680060027"><span class="annot"><span class="annottext">zHashVec :: Vector Word
</span><a href="#local-6989586621680060027"><span class="hs-identifier hs-var hs-var">zHashVec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Int -&gt; Word) -&gt; Vector Word
forall a. Unbox a =&gt; Int -&gt; (Int -&gt; a) -&gt; Vector a
</span><span class="hs-identifier hs-var">U.generate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060029"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Word) -&gt; Vector Word) -&gt; (Int -&gt; Word) -&gt; Vector Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680060026"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060026"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680060028"><span class="hs-identifier hs-var">hasher</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060030"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060026"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621680060025"><span class="annot"><a href="#local-6989586621680060031"><span class="hs-identifier hs-type">gen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060025"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060025"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060025"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060025"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621680060031"><span class="annot"><span class="annottext">gen :: ((Int, Int, Int) -&gt; b -&gt; b) -&gt; b -&gt; b
</span><a href="#local-6989586621680060031"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621680060024"><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060024"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span id="local-6989586621680060023"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060023"><span class="hs-identifier hs-var">nil</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s b) -&gt; b
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s b) -&gt; b) -&gt; (forall s. ST s b) -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>      </span><span id="local-6989586621680060022"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060022"><span class="hs-identifier hs-var">vertices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall a s. Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListFromVector"><span class="hs-identifier hs-var">mutListFromVector</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060030"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-225"></span><span>      </span><span id="local-6989586621680060021"><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680060021"><span class="hs-identifier hs-var">zHashes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector Word -&gt; ST s (MutList s Word)
forall a s. (Ord a, Unbox a) =&gt; Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListSort"><span class="hs-identifier hs-var">mutListSort</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Word
</span><a href="#local-6989586621680060027"><span class="hs-identifier hs-var">zHashVec</span></a></span><span>
</span><span id="line-226"></span><span>      </span><span id="local-6989586621680060020"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; ST s (MutList s (Point 2 r :+ p))
forall s a. MutList s a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListClone"><span class="hs-identifier hs-var">mutListClone</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060022"><span class="hs-identifier hs-var">vertices</span></a></span><span>
</span><span id="line-227"></span><span>      </span><span id="local-6989586621680060019"><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060019"><span class="hs-identifier hs-var">shuffled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Shuffled s)
forall s. Int -&gt; ST s (Shuffled s)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#newShuffled"><span class="hs-identifier hs-var">newShuffled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p) -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060030"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060018"><span class="annot"><span class="annottext">worker :: Int -&gt; ST s b
</span><a href="#local-6989586621680060018"><span class="hs-identifier hs-var hs-var">worker</span></a></span></span><span> </span><span id="local-6989586621680060017"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060017"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>            </span><span id="local-6989586621680060016"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Shuffled s -&gt; ST s Int
forall s. Shuffled s -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#popShuffled"><span class="hs-identifier hs-var">popShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060019"><span class="hs-identifier hs-var">shuffled</span></a></span><span>
</span><span id="line-230"></span><span>            </span><span id="local-6989586621680060015"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060022"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-231"></span><span>            </span><span id="local-6989586621680060014"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060022"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060017"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-233"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-234"></span><span>                </span><span class="annot"><span class="annottext">b -&gt; ST s b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ST s b) -&gt; b -&gt; ST s b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060024"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680060023"><span class="hs-identifier hs-var">nil</span></a></span><span>
</span><span id="line-235"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>                </span><span id="local-6989586621680060013"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-237"></span><span>                </span><span id="local-6989586621680060012"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-238"></span><span>                </span><span id="local-6989586621680060011"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060011"><span class="hs-identifier hs-var">isEar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Point 2 r -&gt; Word)
-&gt; MutList s (Point 2 r :+ p)
-&gt; MutList s Word
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; ST s Bool
forall r s p.
Real r =&gt;
(Point 2 r -&gt; Word)
-&gt; MutList s (Point 2 r :+ p)
-&gt; MutList s Word
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; ST s Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheckHashed"><span class="hs-identifier hs-var">earCheckHashed</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680060028"><span class="hs-identifier hs-var">hasher</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060022"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680060021"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-239"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680060011"><span class="hs-identifier hs-var">isEar</span></a></span><span>
</span><span id="line-240"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span>
</span><span id="line-242"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060022"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-comment">-- remove ear</span><span>
</span><span id="line-243"></span><span>                    </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDeleteFocus"><span class="hs-identifier hs-var">mutListDeleteFocus</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680060021"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060019"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-248"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060019"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-249"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-250"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-251"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060019"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-253"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-254"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>                        </span><span class="annot"><span class="annottext">Shuffled s -&gt; Int -&gt; ST s ()
forall s. Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var">pushShuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Shuffled s
</span><a href="#local-6989586621680060019"><span class="hs-identifier hs-var">shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-256"></span><span>                        </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var">mutListInsert</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-257"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>                    </span><span class="annot"><span class="annottext">(Int, Int, Int) -&gt; b -&gt; b
</span><a href="#local-6989586621680060024"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060015"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060016"><span class="hs-identifier hs-var">focus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060014"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>                      </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; ST s b -&gt; ST s b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ST s b -&gt; ST s b
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">unsafeInterleaveST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ST s b
</span><a href="#local-6989586621680060018"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060017"><span class="hs-identifier hs-var">len</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- not an ear</span><span>
</span><span id="line-262"></span><span>                    </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; ST s ()
forall s a. MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var">mutListDelete</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680060020"><span class="hs-identifier hs-var">possibleEars</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060013"><span class="hs-identifier hs-var">prevEar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060012"><span class="hs-identifier hs-var">nextEar</span></a></span><span> </span><span class="hs-comment">-- remove vertex</span><span>
</span><span id="line-263"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; ST s b
</span><a href="#local-6989586621680060018"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060017"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; ST s b
</span><a href="#local-6989586621680060018"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680060029"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- Bounding box</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- Returns (minX, widthX, minY, heightY)</span><span>
</span><span id="line-270"></span><span id="local-6989586621680060289"><span id="local-6989586621680060290"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashGen"><span class="hs-identifier hs-type">zHashGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span> </span><span class="annot"><a href="#local-6989586621680060290"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680060290"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680060289"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680060290"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-271"></span><span id="zHashGen"><span class="annot"><span class="annottext">zHashGen :: Vector (Point 2 r :+ p) -&gt; Point 2 r -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashGen"><span class="hs-identifier hs-var hs-var">zHashGen</span></a></span></span><span> </span><span id="local-6989586621680060010"><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060010"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(r, Double, r, Double) -&gt; Point 2 r -&gt; Word
forall r. Real r =&gt; (r, Double, r, Double) -&gt; Point 2 r -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashPoint"><span class="hs-identifier hs-var">zHashPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(r, Double, r, Double)
</span><a href="#local-6989586621680060008"><span class="hs-identifier hs-var">bounds</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-273"></span><span>    </span><span id="local-6989586621680060008"><span class="annot"><span class="annottext">bounds :: (r, Double, r, Double)
</span><a href="#local-6989586621680060008"><span class="hs-identifier hs-var hs-var">bounds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060007"><span class="hs-identifier hs-var">minX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r -&gt; Double
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060006"><span class="hs-identifier hs-var">maxX</span></a></span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060007"><span class="hs-identifier hs-var">minX</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060005"><span class="hs-identifier hs-var">minY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r -&gt; Double
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060004"><span class="hs-identifier hs-var">maxY</span></a></span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060005"><span class="hs-identifier hs-var">minY</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621680060003"><span class="annot"><span class="annottext">bb :: Box 2 () r
</span><a href="#local-6989586621680060003"><span class="hs-identifier hs-var hs-var">bb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Box 2 () r -&gt; Box 2 () r -&gt; Box 2 () r)
-&gt; Vector (Box 2 () r) -&gt; Box 2 () r
forall a. (a -&gt; a -&gt; a) -&gt; Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.foldl1'</span></span><span> </span><span class="annot"><span class="annottext">Box 2 () r -&gt; Box 2 () r -&gt; Box 2 () r
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(Vector (Box 2 () r) -&gt; Box 2 () r)
-&gt; Vector (Box 2 () r) -&gt; Box 2 () r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Point 2 r :+ p) -&gt; Box 2 () r)
-&gt; Vector (Point 2 r :+ p) -&gt; Vector (Box 2 () r)
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p) -&gt; Box 2 () r
forall g.
(IsBoxable g, Ord (NumType g)) =&gt;
g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBox"><span class="hs-identifier hs-var">boundingBox</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Point 2 r :+ p)
</span><a href="#local-6989586621680060010"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-type">Point2</span></a></span><span> </span><span id="local-6989586621680060007"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060007"><span class="hs-identifier hs-var">minX</span></a></span></span><span> </span><span id="local-6989586621680060005"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060005"><span class="hs-identifier hs-var">minY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Box 2 () r
</span><a href="#local-6989586621680060003"><span class="hs-identifier hs-var">bb</span></a></span><span class="annot"><span class="annottext">Box 2 () r
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r)
forall (d :: Nat) p r. Lens' (Box d p r) (Point d r :+ p)
</span><a href="Geometry.Box.Internal.html#minPoint"><span class="hs-identifier hs-var">minPoint</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
 -&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ())
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-type">Point2</span></a></span><span> </span><span id="local-6989586621680060006"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060006"><span class="hs-identifier hs-var">maxX</span></a></span></span><span> </span><span id="local-6989586621680060004"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680060004"><span class="hs-identifier hs-var">maxY</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Box 2 () r
</span><a href="#local-6989586621680060003"><span class="hs-identifier hs-var">bb</span></a></span><span class="annot"><span class="annottext">Box 2 () r
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r)
forall (d :: Nat) p r. Lens' (Box d p r) (Point d r :+ p)
</span><a href="Geometry.Box.Internal.html#minPoint"><span class="hs-identifier hs-var">minPoint</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
 -&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ())
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- Z-Order</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- https://en.wikipedia.org/wiki/Z-order_curve</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span id="local-6989586621680060265"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashPoint"><span class="hs-identifier hs-type">zHashPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span> </span><span class="annot"><a href="#local-6989586621680060265"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680060265"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680060265"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680060265"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span></span><span>
</span><span id="line-283"></span><span id="zHashPoint"><span class="annot"><span class="annottext">zHashPoint :: (r, Double, r, Double) -&gt; Point 2 r -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashPoint"><span class="hs-identifier hs-var hs-var">zHashPoint</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680059997"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059997"><span class="hs-identifier hs-var">minX</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059996"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059996"><span class="hs-identifier hs-var">widthX</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059995"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059995"><span class="hs-identifier hs-var">minY</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059994"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059994"><span class="hs-identifier hs-var">heightY</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point2"><span class="hs-identifier hs-type">Point2</span></a></span><span> </span><span id="local-6989586621680059993"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059993"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680059992"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059992"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">V2 Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHash"><span class="hs-identifier hs-var">zHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; V2 Word
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059990"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059989"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621680059990"><span class="annot"><span class="annottext">x' :: Word
</span><a href="#local-6989586621680059990"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Word
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Double
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059993"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059997"><span class="hs-identifier hs-var">minX</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059996"><span class="hs-identifier hs-var">widthX</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMax"><span class="hs-identifier hs-var">zHashMax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621680059989"><span class="annot"><span class="annottext">y' :: Word
</span><a href="#local-6989586621680059989"><span class="hs-identifier hs-var hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Word
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Double
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059992"><span class="hs-identifier hs-var">y</span></a></span><span class="annot"><span class="annottext">r -&gt; r -&gt; r
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680059995"><span class="hs-identifier hs-var">minY</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059994"><span class="hs-identifier hs-var">heightY</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMax"><span class="hs-identifier hs-var">zHashMax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMax"><span class="hs-identifier hs-type">zHashMax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-290"></span><span id="zHashMax"><span class="annot"><span class="annottext">zHashMax :: Double
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMax"><span class="hs-identifier hs-var hs-var">zHashMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Double
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMaxW"><span class="hs-identifier hs-var">zHashMaxW</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMaxW"><span class="hs-identifier hs-type">zHashMaxW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-293"></span><span id="zHashMaxW"><span class="annot"><span class="annottext">zHashMaxW :: Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMaxW"><span class="hs-identifier hs-var hs-var">zHashMaxW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashMaxW"><span class="hs-identifier hs-var">zHashMaxW</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0xFFFF</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0xFFFFFFFF</span></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | O(1) Z-Order hash the first half-world of each coordinate.</span><span>
</span><span id="line-296"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHash"><span class="hs-identifier hs-type">zHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-297"></span><span id="zHash"><span class="annot"><span class="annottext">zHash :: V2 Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHash"><span class="hs-identifier hs-var hs-var">zHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span id="local-6989586621680059982"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059982"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680059981"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059981"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle"><span class="hs-identifier hs-var">zHashSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059982"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle"><span class="hs-identifier hs-var">zHashSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059981"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | O(1) Reverse z-order hash.</span><span>
</span><span id="line-300"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHash"><span class="hs-identifier hs-type">zUnHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-301"></span><span id="zUnHash"><span class="annot"><span class="annottext">zUnHash :: Word -&gt; V2 Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHash"><span class="hs-identifier hs-var hs-var">zUnHash</span></a></span></span><span> </span><span id="local-6989586621680059977"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059977"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; V2 Word
forall a. a -&gt; a -&gt; V2 a
</span><span class="hs-identifier hs-var">V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle"><span class="hs-identifier hs-var">zUnHashSingle</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059977"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle"><span class="hs-identifier hs-var">zUnHashSingle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059977"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle"><span class="hs-identifier hs-type">zHashSingle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-305"></span><span id="zHashSingle"><span class="annot"><span class="annottext">zHashSingle :: Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle"><span class="hs-identifier hs-var hs-var">zHashSingle</span></a></span></span><span> </span><span id="local-6989586621680059974"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059974"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059974"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle32"><span class="hs-identifier hs-var">zHashSingle32</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059974"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle64"><span class="hs-identifier hs-var">zHashSingle64</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059974"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle"><span class="hs-identifier hs-type">zUnHashSingle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-310"></span><span id="zUnHashSingle"><span class="annot"><span class="annottext">zUnHashSingle :: Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle"><span class="hs-identifier hs-var hs-var">zUnHashSingle</span></a></span></span><span> </span><span id="local-6989586621680059971"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059971"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall b. FiniteBits b =&gt; b -&gt; Int
</span><span class="hs-identifier hs-var">finiteBitSize</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059971"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle32"><span class="hs-identifier hs-var">zUnHashSingle32</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059971"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle64"><span class="hs-identifier hs-var">zUnHashSingle64</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059971"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle32"><span class="hs-identifier hs-type">zHashSingle32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-315"></span><span id="zHashSingle32"><span class="annot"><span class="annottext">zHashSingle32 :: Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle32"><span class="hs-identifier hs-var hs-var">zHashSingle32</span></a></span></span><span> </span><span id="local-6989586621680059968"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059968"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity Word -&gt; Word
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Word -&gt; Word) -&gt; Identity Word -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621680059966"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059966"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059968"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0000FFFF</span></span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621680059964"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059964"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059966"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059966"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x00FF00FF</span></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621680059963"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059963"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059964"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059964"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0F0F0F0F</span></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621680059962"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059962"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059963"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059963"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x33333333</span></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621680059961"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059961"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059962"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059962"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x55555555</span></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059961"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle32"><span class="hs-identifier hs-type">zUnHashSingle32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-324"></span><span id="zUnHashSingle32"><span class="annot"><span class="annottext">zUnHashSingle32 :: Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle32"><span class="hs-identifier hs-var hs-var">zUnHashSingle32</span></a></span></span><span> </span><span id="local-6989586621680059960"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059960"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity Word -&gt; Word
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Word -&gt; Word) -&gt; Identity Word -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621680059959"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059959"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059960"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x55555555</span></span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621680059958"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059958"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059959"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059959"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x33333333</span></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621680059957"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059957"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059958"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059958"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0F0F0F0F</span></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621680059956"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059956"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059957"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x00FF00FF</span></span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621680059955"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059955"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059956"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059956"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0000FFFF</span></span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059955"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle64"><span class="hs-identifier hs-type">zHashSingle64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-333"></span><span id="zHashSingle64"><span class="annot"><span class="annottext">zHashSingle64 :: Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zHashSingle64"><span class="hs-identifier hs-var hs-var">zHashSingle64</span></a></span></span><span> </span><span id="local-6989586621680059954"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059954"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity Word -&gt; Word
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Word -&gt; Word) -&gt; Identity Word -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621680059953"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059953"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059954"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x00000000FFFFFFFF</span></span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621680059952"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059952"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059953"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059953"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0000FFFF0000FFFF</span></span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621680059951"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059951"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059952"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059952"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x00FF00FF00FF00FF</span></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621680059950"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059950"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059951"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059951"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0F0F0F0F0F0F0F0F</span></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621680059949"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059949"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059950"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059950"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x3333333333333333</span></span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621680059948"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059948"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059949"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftL</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059949"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x5555555555555555</span></span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059948"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle64"><span class="hs-identifier hs-type">zUnHashSingle64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-343"></span><span id="zUnHashSingle64"><span class="annot"><span class="annottext">zUnHashSingle64 :: Word -&gt; Word
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#zUnHashSingle64"><span class="hs-identifier hs-var hs-var">zUnHashSingle64</span></a></span></span><span> </span><span id="local-6989586621680059947"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059947"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity Word -&gt; Word
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity Word -&gt; Word) -&gt; Identity Word -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621680059946"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059946"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059947"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x5555555555555555</span></span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621680059945"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059945"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059946"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059946"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x3333333333333333</span></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621680059944"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059944"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059945"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059945"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0F0F0F0F0F0F0F0F</span></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621680059943"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059943"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059944"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059944"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x00FF00FF00FF00FF</span></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621680059942"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059942"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059943"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059943"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x0000FFFF0000FFFF</span></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621680059941"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059941"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Identity Word) -&gt; Word -&gt; Identity Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059942"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int -&gt; Word
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">unsafeShiftR</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059942"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0x00000000FFFFFFFF</span></span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Identity Word
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059941"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- Shuffled</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="hs-keyword">data</span><span> </span><span id="Shuffled"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-var">Shuffled</span></a></span></span><span> </span><span id="local-6989586621680060226"><span class="annot"><a href="#local-6989586621680060226"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Shuffled"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-var">Shuffled</span></a></span></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="shuffleCount"><span class="annot"><span class="annottext">Shuffled s -&gt; STRef s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#shuffleCount"><span class="hs-identifier hs-var hs-var">shuffleCount</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621680060226"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="shuffleVector"><span class="annot"><span class="annottext">Shuffled s -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#shuffleVector"><span class="hs-identifier hs-var hs-var">shuffleVector</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MU.MVector</span></span><span> </span><span class="annot"><a href="#local-6989586621680060226"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span id="local-6989586621680060295"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#newShuffled"><span class="hs-identifier hs-type">newShuffled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060295"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-type">Shuffled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060295"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-360"></span><span id="newShuffled"><span class="annot"><span class="annottext">newShuffled :: Int -&gt; ST s (Shuffled s)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#newShuffled"><span class="hs-identifier hs-var hs-var">newShuffled</span></a></span></span><span> </span><span id="local-6989586621680059937"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059937"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; MVector s Int -&gt; Shuffled s
forall s. STRef s Int -&gt; MVector s Int -&gt; Shuffled s
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-var">Shuffled</span></a></span><span> </span><span class="annot"><span class="annottext">(STRef s Int -&gt; MVector s Int -&gt; Shuffled s)
-&gt; ST s (STRef s Int) -&gt; ST s (MVector s Int -&gt; Shuffled s)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (STRef s Int)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059937"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">ST s (MVector s Int -&gt; Shuffled s)
-&gt; ST s (MVector s Int) -&gt; ST s (Shuffled s)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall a (m :: * -&gt; *).
(Unbox a, PrimMonad m) =&gt;
Vector a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">U.unsafeThaw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">U.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059937"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span id="local-6989586621680060294"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#popShuffled"><span class="hs-identifier hs-type">popShuffled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-type">Shuffled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060294"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060294"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-363"></span><span id="popShuffled"><span class="annot"><span class="annottext">popShuffled :: Shuffled s -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#popShuffled"><span class="hs-identifier hs-var hs-var">popShuffled</span></a></span></span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-type">Shuffled</span></a></span><span class="hs-special">{</span><span id="local-6989586621680059932"><span id="local-6989586621680059933"><span class="annot"><span class="annottext">STRef s Int
MVector s Int
shuffleVector :: MVector s Int
shuffleCount :: STRef s Int
shuffleVector :: forall s. Shuffled s -&gt; MVector s Int
shuffleCount :: forall s. Shuffled s -&gt; STRef s Int
</span><a href="#local-6989586621680059932"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>  </span><span id="local-6989586621680059931"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059931"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; ST s Int
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621680059933"><span class="hs-identifier hs-var">shuffleCount</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621680059933"><span class="hs-identifier hs-var">shuffleCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059931"><span class="hs-identifier hs-var">count</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059928"><span class="annot"><span class="annottext">idx :: Int
</span><a href="#local-6989586621680059928"><span class="hs-identifier hs-var hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, StdGen) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Int, StdGen) -&gt; Int) -&gt; (Int, StdGen) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; StdGen -&gt; (Int, StdGen)
forall a g. (Random a, RandomGen g) =&gt; (a, a) -&gt; g -&gt; (a, g)
</span><span class="hs-identifier hs-var">randomR</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059931"><span class="hs-identifier hs-var">count</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; StdGen
</span><span class="hs-identifier hs-var">mkStdGen</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059931"><span class="hs-identifier hs-var">count</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>  </span><span id="local-6989586621680059927"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059927"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MU.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059932"><span class="hs-identifier hs-var">shuffleVector</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059928"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059932"><span class="hs-identifier hs-var">shuffleVector</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059928"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; ST s Int -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MU.unsafeRead</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059932"><span class="hs-identifier hs-var">shuffleVector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059931"><span class="hs-identifier hs-var">count</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; ST s Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059927"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span id="local-6989586621680060293"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-type">pushShuffled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-type">Shuffled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060293"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060293"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-372"></span><span id="pushShuffled"><span class="annot"><span class="annottext">pushShuffled :: Shuffled s -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#pushShuffled"><span class="hs-identifier hs-var hs-var">pushShuffled</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#Shuffled"><span class="hs-identifier hs-type">Shuffled</span></a></span><span> </span><span id="local-6989586621680059923"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621680059923"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621680059922"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059922"><span class="hs-identifier hs-var">vector</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680059921"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059921"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>  </span><span id="local-6989586621680059920"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059920"><span class="hs-identifier hs-var">count</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; ST s Int
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621680059923"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621680059923"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059920"><span class="hs-identifier hs-var">count</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059922"><span class="hs-identifier hs-var">vector</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059920"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059921"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- MutList</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-keyword">data</span><span> </span><span id="MutList"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-var">MutList</span></a></span></span><span> </span><span id="local-6989586621680060187"><span class="annot"><a href="#local-6989586621680060187"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680060188"><span class="annot"><a href="#local-6989586621680060188"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MutList"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-var">MutList</span></a></span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="mutListIndex"><span class="annot"><span class="annottext">MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680060188"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mutListNextVec"><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNextVec"><span class="hs-identifier hs-var hs-var">mutListNextVec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MU.MVector</span></span><span> </span><span class="annot"><a href="#local-6989586621680060187"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="mutListPrevVec"><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrevVec"><span class="hs-identifier hs-var hs-var">mutListPrevVec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MU.MVector</span></span><span> </span><span class="annot"><a href="#local-6989586621680060187"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- O(n)</span><span>
</span><span id="line-387"></span><span id="local-6989586621680060322"><span id="local-6989586621680060323"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListFromVector"><span class="hs-identifier hs-type">mutListFromVector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621680060323"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060322"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060322"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060323"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-388"></span><span id="mutListFromVector"><span class="annot"><span class="annottext">mutListFromVector :: Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListFromVector"><span class="hs-identifier hs-var hs-var">mutListFromVector</span></a></span></span><span> </span><span id="local-6989586621680059914"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059914"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; MVector s Int -&gt; MVector s Int -&gt; MutList s a
forall s a.
(Int -&gt; a) -&gt; MVector s Int -&gt; MVector s Int -&gt; MutList s a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-var">MutList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">V.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059914"><span class="hs-identifier hs-var">vec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="annottext">(MVector s Int -&gt; MVector s Int -&gt; MutList s a)
-&gt; ST s (MVector s Int) -&gt; ST s (MVector s Int -&gt; MutList s a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621680059913"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059913"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall a (m :: * -&gt; *).
(Unbox a, PrimMonad m) =&gt;
Vector a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">U.unsafeThaw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">U.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059914"><span class="hs-identifier hs-var">vec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059913"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059914"><span class="hs-identifier hs-var">vec</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><span class="annottext">MVector s Int -&gt; ST s (MVector s Int)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059913"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="annottext">ST s (MVector s Int -&gt; MutList s a)
-&gt; ST s (MVector s Int) -&gt; ST s (MutList s a)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621680059912"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059912"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall a (m :: * -&gt; *).
(Unbox a, PrimMonad m) =&gt;
Vector a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">U.unsafeThaw</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">U.enumFromN</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059914"><span class="hs-identifier hs-var">vec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059912"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059914"><span class="hs-identifier hs-var">vec</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="annottext">MVector s Int -&gt; ST s (MVector s Int)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059912"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span id="local-6989586621680060320"><span id="local-6989586621680060321"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListClone"><span class="hs-identifier hs-type">mutListClone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060321"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060320"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060321"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060321"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-399"></span><span id="mutListClone"><span class="annot"><span class="annottext">mutListClone :: MutList s a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListClone"><span class="hs-identifier hs-var hs-var">mutListClone</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span id="local-6989586621680059911"><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621680059911"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span id="local-6989586621680059910"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059910"><span class="hs-identifier hs-var">nextVec</span></a></span></span><span> </span><span id="local-6989586621680059909"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059909"><span class="hs-identifier hs-var">prevVec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; MVector s Int -&gt; MVector s Int -&gt; MutList s a
forall s a.
(Int -&gt; a) -&gt; MVector s Int -&gt; MVector s Int -&gt; MutList s a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-var">MutList</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
</span><a href="#local-6989586621680059911"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">(MVector s Int -&gt; MVector s Int -&gt; MutList s a)
-&gt; ST s (MVector s Int) -&gt; ST s (MVector s Int -&gt; MutList s a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int
-&gt; ST s (MVector (PrimState (ST s)) Int)
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MU.clone</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059910"><span class="hs-identifier hs-var">nextVec</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="annottext">ST s (MVector s Int -&gt; MutList s a)
-&gt; ST s (MVector s Int) -&gt; ST s (MutList s a)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int
-&gt; ST s (MVector (PrimState (ST s)) Int)
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MU.clone</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059909"><span class="hs-identifier hs-var">prevVec</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span id="local-6989586621680059906"><span id="local-6989586621680059907"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-type">mutListNext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059907"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059906"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680059907"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-404"></span><span id="mutListNext"><span class="annot"><span class="annottext">mutListNext :: MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var hs-var">mutListNext</span></a></span></span><span> </span><span id="local-6989586621680059905"><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059905"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680059904"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059904"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MU.unsafeRead</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNextVec"><span class="hs-identifier hs-var hs-var">mutListNextVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059905"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059904"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span id="local-6989586621680060318"><span id="local-6989586621680060319"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-type">mutListPrev</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060319"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060318"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060319"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-407"></span><span id="mutListPrev"><span class="annot"><span class="annottext">mutListPrev :: MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var hs-var">mutListPrev</span></a></span></span><span> </span><span id="local-6989586621680059903"><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059903"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680059902"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059902"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; ST s Int
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; m a
</span><span class="hs-identifier hs-var">MU.unsafeRead</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrevVec"><span class="hs-identifier hs-var hs-var">mutListPrevVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059903"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059902"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span id="local-6989586621680060310"><span id="local-6989586621680060311"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-type">mutListDelete</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060311"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060310"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060311"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-410"></span><span id="mutListDelete"><span class="annot"><span class="annottext">mutListDelete :: MutList s a -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDelete"><span class="hs-identifier hs-var hs-var">mutListDelete</span></a></span></span><span> </span><span id="local-6989586621680059901"><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059901"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680059900"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059900"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span id="local-6989586621680059899"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059899"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNextVec"><span class="hs-identifier hs-var hs-var">mutListNextVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059901"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059900"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059899"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrevVec"><span class="hs-identifier hs-var hs-var">mutListPrevVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059901"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059899"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059900"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span id="local-6989586621680060272"><span id="local-6989586621680060273"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDeleteFocus"><span class="hs-identifier hs-type">mutListDeleteFocus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060273"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060272"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060273"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-415"></span><span id="mutListDeleteFocus"><span class="annot"><span class="annottext">mutListDeleteFocus :: MutList s a -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListDeleteFocus"><span class="hs-identifier hs-var hs-var">mutListDeleteFocus</span></a></span></span><span> </span><span id="local-6989586621680059898"><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059898"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680059897"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059897"><span class="hs-identifier hs-var">focus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-416"></span><span>  </span><span id="local-6989586621680059896"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059896"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s a -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059898"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059897"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span id="local-6989586621680059895"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059895"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s a -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059898"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059897"><span class="hs-identifier hs-var">focus</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059896"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-419"></span><span>    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNextVec"><span class="hs-identifier hs-var hs-var">mutListNextVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059898"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059896"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059895"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059895"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrevVec"><span class="hs-identifier hs-var hs-var">mutListPrevVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059898"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059895"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059896"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span id="local-6989586621680060308"><span id="local-6989586621680060309"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-type">mutListInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060308"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060309"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-424"></span><span id="mutListInsert"><span class="annot"><span class="annottext">mutListInsert :: MutList s a -&gt; Int -&gt; Int -&gt; Int -&gt; ST s ()
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListInsert"><span class="hs-identifier hs-var hs-var">mutListInsert</span></a></span></span><span> </span><span id="local-6989586621680059893"><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059893"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680059892"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059892"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621680059891"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059891"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span id="local-6989586621680059890"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">elt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNextVec"><span class="hs-identifier hs-var hs-var">mutListNextVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059893"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059892"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">elt</span></a></span><span>  </span><span class="hs-comment">-- before.next = elt</span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNextVec"><span class="hs-identifier hs-var hs-var">mutListNextVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059893"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">elt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059891"><span class="hs-identifier hs-var">after</span></a></span><span>   </span><span class="hs-comment">-- elt.next = after</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrevVec"><span class="hs-identifier hs-var hs-var">mutListPrevVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059893"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059891"><span class="hs-identifier hs-var">after</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">elt</span></a></span><span>   </span><span class="hs-comment">-- after.prev = elt</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.unsafeWrite</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutList s a -&gt; MVector s Int
forall s a. MutList s a -&gt; MVector s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrevVec"><span class="hs-identifier hs-var hs-var">mutListPrevVec</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s a
</span><a href="#local-6989586621680059893"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">elt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059892"><span class="hs-identifier hs-var">before</span></a></span><span>  </span><span class="hs-comment">-- elt.prev = before</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span id="local-6989586621680060277"><span id="local-6989586621680060278"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListSort"><span class="hs-identifier hs-type">mutListSort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680060278"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MU.Unbox</span></span><span> </span><span class="annot"><a href="#local-6989586621680060278"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">U.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621680060278"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060277"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060277"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060278"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-431"></span><span id="mutListSort"><span class="annot"><span class="annottext">mutListSort :: Vector a -&gt; ST s (MutList s a)
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListSort"><span class="hs-identifier hs-var hs-var">mutListSort</span></a></span></span><span> </span><span id="local-6989586621680059889"><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059889"><span class="hs-identifier hs-var">vec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621680059888"><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>      </span><span id="local-6989586621680059887"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059887"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Vector Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall a (m :: * -&gt; *).
(Unbox a, PrimMonad m) =&gt;
Vector a -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">U.unsafeThaw</span></span><span> </span><span class="annot"><span class="annottext">(Vector Int -&gt; ST s (MVector (PrimState (ST s)) Int))
-&gt; Vector Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Vector Int
forall a. (Unbox a, Num a) =&gt; a -&gt; Int -&gt; Vector a
</span><span class="hs-identifier hs-var">U.enumFromN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">U.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>      </span><span class="annot"><span class="annottext">Comparison Int -&gt; MVector (PrimState (ST s)) Int -&gt; ST s ()
forall (m :: * -&gt; *) (v :: * -&gt; * -&gt; *) e.
(PrimMonad m, MVector v e) =&gt;
Comparison e -&gt; v (PrimState m) e -&gt; m ()
</span><span class="hs-identifier hs-var">Algo.sortBy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680059884"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059884"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680059883"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059883"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059889"><span class="hs-identifier hs-var">vec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059884"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059889"><span class="hs-identifier hs-var">vec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059883"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059887"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; ST s (Vector Int)
forall a (m :: * -&gt; *).
(Unbox a, PrimMonad m) =&gt;
MVector (PrimState m) a -&gt; m (Vector a)
</span><span class="hs-identifier hs-var">U.unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059887"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621680059879"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059879"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
Int -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MU.new</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-438"></span><span>    </span><span id="local-6989586621680059877"><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059877"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MVector (PrimState (ST s)) Int)
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
Int -&gt; m (MVector (PrimState m) a)
</span><span class="hs-identifier hs-var">MU.new</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.write</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059879"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-440"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680059874"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059874"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>      </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.write</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059879"><span class="hs-identifier hs-var">next</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059874"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059874"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.write</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059877"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-447"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680059873"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059873"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">MVector (PrimState (ST s)) Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *) a.
(PrimMonad m, Unbox a) =&gt;
MVector (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">MU.write</span></span><span> </span><span class="annot"><span class="annottext">MVector s Int
MVector (PrimState (ST s)) Int
</span><a href="#local-6989586621680059877"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059873"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Int -&gt; Int -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector Int
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059873"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>    </span><span class="annot"><span class="annottext">MutList s a -&gt; ST s (MutList s a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(MutList s a -&gt; ST s (MutList s a))
-&gt; MutList s a -&gt; ST s (MutList s a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; MVector s Int -&gt; MVector s Int -&gt; MutList s a
forall s a.
(Int -&gt; a) -&gt; MVector s Int -&gt; MVector s Int -&gt; MutList s a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-var">MutList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector a -&gt; Int -&gt; a
forall a. Unbox a =&gt; Vector a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">U.unsafeIndex</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059889"><span class="hs-identifier hs-var">vec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059879"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">MVector s Int
</span><a href="#local-6989586621680059877"><span class="hs-identifier hs-var">prev</span></a></span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-455"></span><span>    </span><span id="local-6989586621680059886"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Unbox a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">U.length</span></span><span> </span><span class="annot"><span class="annottext">Vector a
</span><a href="#local-6989586621680059889"><span class="hs-identifier hs-var">vec</span></a></span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- Ear checking</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-comment">-- O(n)</span><span>
</span><span id="line-461"></span><span id="local-6989586621680060312"><span id="local-6989586621680060313"><span id="local-6989586621680060314"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheck"><span class="hs-identifier hs-type">earCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680060314"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680060314"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060313"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680060314"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680060312"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060313"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-462"></span><span id="earCheck"><span class="annot"><span class="annottext">earCheck :: MutList s (Point 2 r :+ p) -&gt; Int -&gt; Int -&gt; Int -&gt; ST s Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheck"><span class="hs-identifier hs-var hs-var">earCheck</span></a></span></span><span> </span><span id="local-6989586621680059871"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span></span><span> </span><span id="local-6989586621680059870"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680059869"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059869"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680059868"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059868"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059867"><span class="annot"><span class="annottext">pointA :: Point 2 r :+ p
</span><a href="#local-6989586621680059867"><span class="hs-identifier hs-var hs-var">pointA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span id="local-6989586621680059866"><span class="annot"><span class="annottext">pointB :: Point 2 r :+ p
</span><a href="#local-6989586621680059866"><span class="hs-identifier hs-var hs-var">pointB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059869"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-465"></span><span>      </span><span id="local-6989586621680059865"><span class="annot"><span class="annottext">pointC :: Point 2 r :+ p
</span><a href="#local-6989586621680059865"><span class="hs-identifier hs-var hs-var">pointC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059868"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-466"></span><span>      </span><span id="local-6989586621680059864"><span class="annot"><span class="annottext">trig :: Triangle 2 p r
</span><a href="#local-6989586621680059864"><span class="hs-identifier hs-var hs-var">trig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Triangle 2 p r
forall (d :: Nat) p r.
(Point d r :+ p)
-&gt; (Point d r :+ p) -&gt; (Point d r :+ p) -&gt; Triangle d p r
</span><a href="Geometry.Triangle.html#Triangle"><span class="hs-identifier hs-var">Triangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059867"><span class="hs-identifier hs-var">pointA</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059866"><span class="hs-identifier hs-var">pointB</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059865"><span class="hs-identifier hs-var">pointC</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059863"><span class="annot"><span class="annottext">loop :: Int -&gt; ST s Bool
</span><a href="#local-6989586621680059863"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680059862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059862"><span class="hs-identifier hs-var">elt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059862"><span class="hs-identifier hs-var">elt</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><a href="#local-6989586621680059863"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621680059861"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059861"><span class="hs-identifier hs-var">elt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059860"><span class="annot"><span class="annottext">point :: Point 2 r
</span><a href="#local-6989586621680059860"><span class="hs-identifier hs-var hs-var">point</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059861"><span class="hs-identifier hs-var">elt</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-471"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
forall r p.
(Num r, Ord r) =&gt;
Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
</span><a href="Geometry.Triangle.html#inTriangle"><span class="hs-identifier hs-var">inTriangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059860"><span class="hs-identifier hs-var">point</span></a></span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
</span><a href="#local-6989586621680059864"><span class="hs-identifier hs-var">trig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-472"></span><span>          </span><span class="annot"><span class="annottext">PointLocationResult
</span><a href="Geometry.Boundary.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621680059863"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s Bool) -&gt; ST s Int -&gt; ST s Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059861"><span class="hs-identifier hs-var">elt</span></a></span><span>
</span><span id="line-473"></span><span>          </span><span class="annot"><span class="annottext">PointLocationResult
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; CCW
forall r pointP pointQ pointR.
(Ord r, Num r, ToAPoint pointP 2 r, ToAPoint pointQ 2 r,
 ToAPoint pointR 2 r) =&gt;
pointP -&gt; pointQ -&gt; pointR -&gt; CCW
</span><a href="Geometry.Point.Orientation.Degenerate.html#ccw"><span class="hs-identifier hs-var">ccw</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059867"><span class="hs-identifier hs-var">pointA</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059866"><span class="hs-identifier hs-var">pointB</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059865"><span class="hs-identifier hs-var">pointC</span></a></span><span> </span><span class="annot"><span class="annottext">CCW -&gt; CCW -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CCW
</span><a href="Geometry.Point.Orientation.Degenerate.html#CCW"><span class="hs-identifier hs-var">CCW</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621680059863"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s Bool) -&gt; ST s Int -&gt; ST s Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059871"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059868"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- showBinary :: (Integral a, Show a) =&gt; a -&gt; String</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- showBinary i = showIntAtBase 2 intToDigit i &quot;&quot;</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span id="local-6989586621680060274"><span id="local-6989586621680060275"><span id="local-6989586621680060276"><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheckHashed"><span class="hs-identifier hs-type">earCheckHashed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Real</span></span><span> </span><span class="annot"><a href="#local-6989586621680060276"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680060276"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060275"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="#local-6989586621680060276"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680060274"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#MutList"><span class="hs-identifier hs-type">MutList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060275"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621680060275"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-482"></span><span id="earCheckHashed"><span class="annot"><span class="annottext">earCheckHashed :: (Point 2 r -&gt; Word)
-&gt; MutList s (Point 2 r :+ p)
-&gt; MutList s Word
-&gt; Int
-&gt; Int
-&gt; Int
-&gt; ST s Bool
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#earCheckHashed"><span class="hs-identifier hs-var hs-var">earCheckHashed</span></a></span></span><span> </span><span id="local-6989586621680059859"><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680059859"><span class="hs-identifier hs-var">hasher</span></a></span></span><span> </span><span id="local-6989586621680059858"><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span></span><span> </span><span id="local-6989586621680059857"><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span></span><span> </span><span id="local-6989586621680059856"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059856"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680059855"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059855"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680059854"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059854"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059853"><span class="annot"><span class="annottext">pointA :: Point 2 r :+ p
</span><a href="#local-6989586621680059853"><span class="hs-identifier hs-var hs-var">pointA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059856"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-484"></span><span>      </span><span id="local-6989586621680059852"><span class="annot"><span class="annottext">pointB :: Point 2 r :+ p
</span><a href="#local-6989586621680059852"><span class="hs-identifier hs-var hs-var">pointB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059855"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span id="local-6989586621680059851"><span class="annot"><span class="annottext">pointC :: Point 2 r :+ p
</span><a href="#local-6989586621680059851"><span class="hs-identifier hs-var hs-var">pointC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059854"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-486"></span><span>      </span><span id="local-6989586621680059850"><span class="annot"><span class="annottext">trig :: Triangle 2 p r
</span><a href="#local-6989586621680059850"><span class="hs-identifier hs-var hs-var">trig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; Triangle 2 p r
forall (d :: Nat) p r.
(Point d r :+ p)
-&gt; (Point d r :+ p) -&gt; (Point d r :+ p) -&gt; Triangle d p r
</span><a href="Geometry.Triangle.html#Triangle"><span class="hs-identifier hs-var">Triangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059853"><span class="hs-identifier hs-var">pointA</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059852"><span class="hs-identifier hs-var">pointB</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059851"><span class="hs-identifier hs-var">pointC</span></a></span><span>
</span><span id="line-487"></span><span>      </span><span id="local-6989586621680059849"><span class="annot"><span class="annottext">trigBB :: Box (Dimension (Triangle 2 p r)) () (NumType (Triangle 2 p r))
</span><a href="#local-6989586621680059849"><span class="hs-identifier hs-var hs-var">trigBB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
-&gt; Box (Dimension (Triangle 2 p r)) () (NumType (Triangle 2 p r))
forall g.
(IsBoxable g, Ord (NumType g)) =&gt;
g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBox"><span class="hs-identifier hs-var">boundingBox</span></a></span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
</span><a href="#local-6989586621680059850"><span class="hs-identifier hs-var">trig</span></a></span><span>
</span><span id="line-488"></span><span>      </span><span id="local-6989586621680059848"><span class="annot"><span class="annottext">lowPt :: Point 2 r
</span><a href="#local-6989586621680059848"><span class="hs-identifier hs-var hs-var">lowPt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Box 2 () r
Box (Dimension (Triangle 2 p r)) () (NumType (Triangle 2 p r))
</span><a href="#local-6989586621680059849"><span class="hs-identifier hs-var">trigBB</span></a></span><span class="annot"><span class="annottext">Box 2 () r
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r)
forall (d :: Nat) p r. Lens' (Box d p r) (Point d r :+ p)
</span><a href="Geometry.Box.Internal.html#minPoint"><span class="hs-identifier hs-var">minPoint</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
 -&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ())
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-489"></span><span>      </span><span id="local-6989586621680059847"><span class="annot"><span class="annottext">highPt :: Point 2 r
</span><a href="#local-6989586621680059847"><span class="hs-identifier hs-var hs-var">highPt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Box 2 () r
Box (Dimension (Triangle 2 p r)) () (NumType (Triangle 2 p r))
</span><a href="#local-6989586621680059849"><span class="hs-identifier hs-var">trigBB</span></a></span><span class="annot"><span class="annottext">Box 2 () r
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r)
forall (d :: Nat) p r. Lens' (Box d p r) (Point d r :+ p)
</span><a href="Geometry.Box.Internal.html#maxPoint"><span class="hs-identifier hs-var">maxPoint</span></a></span><span class="annot"><span class="annottext">(((Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
 -&gt; Box 2 () r -&gt; Const (Point 2 r) (Box 2 () r))
-&gt; ((Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
    -&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ()))
-&gt; Getting (Point 2 r) (Box 2 () r) (Point 2 r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Point 2 r -&gt; Const (Point 2 r) (Point 2 r))
-&gt; (Point 2 r :+ ()) -&gt; Const (Point 2 r) (Point 2 r :+ ())
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-490"></span><span>      </span><span class="hs-comment">-- (lowPt, highPt) = triangleBoundingBox trig</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>      </span><span id="local-6989586621680059845"><span class="annot"><span class="annottext">minZ :: Word
</span><a href="#local-6989586621680059845"><span class="hs-identifier hs-var hs-var">minZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680059859"><span class="hs-identifier hs-var">hasher</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059848"><span class="hs-identifier hs-var">lowPt</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span id="local-6989586621680059844"><span class="annot"><span class="annottext">maxZ :: Word
</span><a href="#local-6989586621680059844"><span class="hs-identifier hs-var hs-var">maxZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Word
</span><a href="#local-6989586621680059859"><span class="hs-identifier hs-var">hasher</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059847"><span class="hs-identifier hs-var">highPt</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059843"><span class="annot"><span class="annottext">upwards :: Int -&gt; ST s Bool
</span><a href="#local-6989586621680059843"><span class="hs-identifier hs-var hs-var">upwards</span></a></span></span><span> </span><span id="local-6989586621680059842"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059842"><span class="hs-identifier hs-var">up</span></a></span></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059842"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059840"><span class="hs-identifier hs-var">upZ</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059844"><span class="hs-identifier hs-var">maxZ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
forall r p.
(Num r, Ord r) =&gt;
Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
</span><a href="Geometry.Triangle.html#inTriangle"><span class="hs-identifier hs-var">inTriangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059838"><span class="hs-identifier hs-var">pointUp</span></a></span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
</span><a href="#local-6989586621680059850"><span class="hs-identifier hs-var">trig</span></a></span><span> </span><span class="annot"><span class="annottext">PointLocationResult -&gt; PointLocationResult -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PointLocationResult
</span><a href="Geometry.Boundary.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621680059843"><span class="hs-identifier hs-var">upwards</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s Bool) -&gt; ST s Int -&gt; ST s Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059842"><span class="hs-identifier hs-var">up</span></a></span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-500"></span><span>          </span><span id="local-6989586621680059840"><span class="annot"><span class="annottext">upZ :: Word
</span><a href="#local-6989586621680059840"><span class="hs-identifier hs-var hs-var">upZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; Word
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059842"><span class="hs-identifier hs-var">up</span></a></span><span>
</span><span id="line-501"></span><span>          </span><span id="local-6989586621680059838"><span class="annot"><span class="annottext">pointUp :: Point 2 r
</span><a href="#local-6989586621680059838"><span class="hs-identifier hs-var hs-var">pointUp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059842"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-502"></span><span>      </span><span id="local-6989586621680059837"><span class="annot"><span class="annottext">downwards :: Int -&gt; ST s Bool
</span><a href="#local-6989586621680059837"><span class="hs-identifier hs-var hs-var">downwards</span></a></span></span><span> </span><span id="local-6989586621680059836"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059836"><span class="hs-identifier hs-var">down</span></a></span></span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059836"><span class="hs-identifier hs-var">down</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059835"><span class="hs-identifier hs-var">downZ</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059845"><span class="hs-identifier hs-var">minZ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-504"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
forall r p.
(Num r, Ord r) =&gt;
Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
</span><a href="Geometry.Triangle.html#inTriangle"><span class="hs-identifier hs-var">inTriangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059833"><span class="hs-identifier hs-var">pointDown</span></a></span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
</span><a href="#local-6989586621680059850"><span class="hs-identifier hs-var">trig</span></a></span><span> </span><span class="annot"><span class="annottext">PointLocationResult -&gt; PointLocationResult -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PointLocationResult
</span><a href="Geometry.Boundary.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621680059837"><span class="hs-identifier hs-var">downwards</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s Bool) -&gt; ST s Int -&gt; ST s Bool
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059836"><span class="hs-identifier hs-var">down</span></a></span><span>
</span><span id="line-506"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>          </span><span id="local-6989586621680059835"><span class="annot"><span class="annottext">downZ :: Word
</span><a href="#local-6989586621680059835"><span class="hs-identifier hs-var hs-var">downZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; Word
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059836"><span class="hs-identifier hs-var">down</span></a></span><span>
</span><span id="line-508"></span><span>          </span><span id="local-6989586621680059833"><span class="annot"><span class="annottext">pointDown :: Point 2 r
</span><a href="#local-6989586621680059833"><span class="hs-identifier hs-var hs-var">pointDown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059836"><span class="hs-identifier hs-var">down</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-509"></span><span>      </span><span id="local-6989586621680059832"><span class="annot"><span class="annottext">bidirectional :: Int -&gt; Int -&gt; ST s Bool
</span><a href="#local-6989586621680059832"><span class="hs-identifier hs-var hs-var">bidirectional</span></a></span></span><span> </span><span id="local-6989586621680059831"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span></span><span> </span><span id="local-6989586621680059830"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span></span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059829"><span class="hs-identifier hs-var">upZ</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059844"><span class="hs-identifier hs-var">maxZ</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621680059837"><span class="hs-identifier hs-var">downwards</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059828"><span class="hs-identifier hs-var">downZ</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680059845"><span class="hs-identifier hs-var">minZ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621680059843"><span class="hs-identifier hs-var">upwards</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059856"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059855"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
forall r p.
(Num r, Ord r) =&gt;
Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
</span><a href="Geometry.Triangle.html#inTriangle"><span class="hs-identifier hs-var">inTriangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059826"><span class="hs-identifier hs-var">pointUp</span></a></span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
</span><a href="#local-6989586621680059850"><span class="hs-identifier hs-var">trig</span></a></span><span> </span><span class="annot"><span class="annottext">PointLocationResult -&gt; PointLocationResult -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PointLocationResult
</span><a href="Geometry.Boundary.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-513"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059856"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059855"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
forall r p.
(Num r, Ord r) =&gt;
Point 2 r -&gt; Triangle 2 p r -&gt; PointLocationResult
</span><a href="Geometry.Triangle.html#inTriangle"><span class="hs-identifier hs-var">inTriangle</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r
</span><a href="#local-6989586621680059825"><span class="hs-identifier hs-var">pointDown</span></a></span><span> </span><span class="annot"><span class="annottext">Triangle 2 p r
</span><a href="#local-6989586621680059850"><span class="hs-identifier hs-var">trig</span></a></span><span> </span><span class="annot"><span class="annottext">PointLocationResult -&gt; PointLocationResult -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PointLocationResult
</span><a href="Geometry.Boundary.html#Outside"><span class="hs-identifier hs-var">Outside</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-515"></span><span>          </span><span id="local-6989586621680059824"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059824"><span class="hs-identifier hs-var">up'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListNext"><span class="hs-identifier hs-var">mutListNext</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span>
</span><span id="line-516"></span><span>          </span><span id="local-6989586621680059823"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059823"><span class="hs-identifier hs-var">down'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; ST s Int
forall s a. MutList s a -&gt; Int -&gt; ST s Int
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListPrev"><span class="hs-identifier hs-var">mutListPrev</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span>
</span><span id="line-517"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s Bool
</span><a href="#local-6989586621680059832"><span class="hs-identifier hs-var">bidirectional</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059824"><span class="hs-identifier hs-var">up'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059823"><span class="hs-identifier hs-var">down'</span></a></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-519"></span><span>          </span><span id="local-6989586621680059829"><span class="annot"><span class="annottext">upZ :: Word
</span><a href="#local-6989586621680059829"><span class="hs-identifier hs-var hs-var">upZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; Word
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span>
</span><span id="line-520"></span><span>          </span><span id="local-6989586621680059828"><span class="annot"><span class="annottext">downZ :: Word
</span><a href="#local-6989586621680059828"><span class="hs-identifier hs-var hs-var">downZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s Word -&gt; Int -&gt; Word
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s Word
</span><a href="#local-6989586621680059857"><span class="hs-identifier hs-var">zHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span>
</span><span id="line-521"></span><span>          </span><span id="local-6989586621680059826"><span class="annot"><span class="annottext">pointUp :: Point 2 r
</span><a href="#local-6989586621680059826"><span class="hs-identifier hs-var hs-var">pointUp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059831"><span class="hs-identifier hs-var">up</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-522"></span><span>          </span><span id="local-6989586621680059825"><span class="annot"><span class="annottext">pointDown :: Point 2 r
</span><a href="#local-6989586621680059825"><span class="hs-identifier hs-var hs-var">pointDown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p) -&gt; Int -&gt; Point 2 r :+ p
forall s a. MutList s a -&gt; Int -&gt; a
</span><a href="Algorithms.Geometry.PolygonTriangulation.EarClip.html#mutListIndex"><span class="hs-identifier hs-var hs-var">mutListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MutList s (Point 2 r :+ p)
</span><a href="#local-6989586621680059858"><span class="hs-identifier hs-var">vertices</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059830"><span class="hs-identifier hs-var">down</span></a></span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p)
-&gt; Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r) -&gt; Point 2 r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (Point 2 r) (Point 2 r :+ p) (Point 2 r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; (Point 2 r :+ p) -&gt; CCW
forall r pointP pointQ pointR.
(Ord r, Num r, ToAPoint pointP 2 r, ToAPoint pointQ 2 r,
 ToAPoint pointR 2 r) =&gt;
pointP -&gt; pointQ -&gt; pointR -&gt; CCW
</span><a href="Geometry.Point.Orientation.Degenerate.html#ccw"><span class="hs-identifier hs-var">ccw</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059853"><span class="hs-identifier hs-var">pointA</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059852"><span class="hs-identifier hs-var">pointB</span></a></span><span> </span><span class="annot"><span class="annottext">Point 2 r :+ p
</span><a href="#local-6989586621680059851"><span class="hs-identifier hs-var">pointC</span></a></span><span> </span><span class="annot"><span class="annottext">CCW -&gt; CCW -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CCW
</span><a href="Geometry.Point.Orientation.Degenerate.html#CCW"><span class="hs-identifier hs-var">CCW</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ST s Bool
</span><a href="#local-6989586621680059832"><span class="hs-identifier hs-var">bidirectional</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059855"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680059855"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-526"></span></pre></body></html>