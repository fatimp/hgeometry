<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module      :  Algorithms.Geometry.PolyLineSimplification.DouglasPeucker</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-7"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Algorithms.Geometry.PolyLineSimplification.DouglasPeucker</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">only</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.LineSegment.html"><span class="hs-identifier">Geometry.LineSegment</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Point.html"><span class="hs-identifier">Geometry.Point</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.PolyLine.html"><span class="hs-identifier">Geometry.PolyLine</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Vector.html"><span class="hs-identifier">Geometry.Vector</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.LSeq</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSeq</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.LSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LSeq</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- | Line simplification with the well-known Douglas Peucker alogrithm. Given a distance</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- value eps and a polyline pl, constructs a simplification of pl (i.e. with</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- vertices from pl) s.t. all other vertices are within dist eps to the</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- original polyline.</span><span>
</span><span id="line-27"></span><span class="hs-comment">--</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- Running time: \( O(n^2) \) worst case, \( O(n log n) \) on average.</span><span>
</span><span id="line-29"></span><span id="local-6989586621680151177"><span id="local-6989586621680151179"><span id="local-6989586621680151180"><span class="annot"><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#douglasPeucker"><span class="hs-identifier hs-type">douglasPeucker</span></a></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680151180"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680151180"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151179"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680151180"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151179"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151177"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151180"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151179"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151177"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151180"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-31"></span><span id="douglasPeucker"><span class="annot"><span class="annottext">douglasPeucker :: forall r (d :: Nat) p.
(Ord r, Fractional r, Arity d) =&gt;
r -&gt; PolyLine d p r -&gt; PolyLine d p r
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#douglasPeucker"><span class="hs-identifier hs-var hs-var">douglasPeucker</span></a></span></span><span> </span><span id="local-6989586621680151044"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151044"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span id="local-6989586621680151043"><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151043"><span class="hs-identifier hs-var">pl</span></a></span></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151042"><span class="hs-identifier hs-var">dst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151044"><span class="hs-identifier hs-var">eps</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151044"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p. [Point d r :+ p] -&gt; PolyLine d p r
</span><a href="Geometry.PolyLine.html#fromPointsUnsafe"><span class="hs-identifier hs-var">fromPointsUnsafe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680151038"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680151037"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- at least two points, so we are fine.</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (d :: Nat) p.
(Ord r, Fractional r, Arity d) =&gt;
r -&gt; PolyLine d p r -&gt; PolyLine d p r
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#douglasPeucker"><span class="hs-identifier hs-var">douglasPeucker</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151044"><span class="hs-identifier hs-var">eps</span></a></span><span> </span><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151036"><span class="hs-identifier hs-var">pref</span></a></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r.
PolyLine d p r -&gt; PolyLine d p r -&gt; PolyLine d p r
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#merge"><span class="hs-operator hs-var">`merge`</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (d :: Nat) p.
(Ord r, Fractional r, Arity d) =&gt;
r -&gt; PolyLine d p r -&gt; PolyLine d p r
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#douglasPeucker"><span class="hs-identifier hs-var">douglasPeucker</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151044"><span class="hs-identifier hs-var">eps</span></a></span><span> </span><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151034"><span class="hs-identifier hs-var">subf</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621680151033"><span class="annot"><span class="annottext">pts :: LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151033"><span class="hs-identifier hs-var hs-var">pts</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151043"><span class="hs-identifier hs-var">pl</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d1 :: Nat) p1 r1 (d2 :: Nat) p2 r2.
Iso
  (PolyLine d1 p1 r1)
  (PolyLine d2 p2 r2)
  (LSeq 2 (Point d1 r1 :+ p1))
  (LSeq 2 (Point d2 r2 :+ p2))
</span><a href="Geometry.PolyLine.html#points"><span class="hs-identifier hs-var">points</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span id="local-6989586621680151038"><span class="annot"><span class="annottext">a :: Point d r :+ p
</span><a href="#local-6989586621680151038"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a. LSeq (1 + n) a -&gt; a
</span><span class="hs-identifier hs-var">LSeq.head</span></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151033"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span id="local-6989586621680151037"><span class="annot"><span class="annottext">b :: Point d r :+ p
</span><a href="#local-6989586621680151037"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a. LSeq (1 + n) a -&gt; a
</span><span class="hs-identifier hs-var">LSeq.last</span></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151033"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680151028"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680151028"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680151042"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621680151042"><span class="hs-identifier hs-var">dst</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (d :: Nat) (n :: Nat) p.
(Ord r, Fractional r, Arity d) =&gt;
LSeq n (Point d r :+ p) -&gt; LineSegment d p r -&gt; (Int, r)
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#maxDist"><span class="hs-identifier hs-var">maxDist</span></a></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151033"><span class="hs-identifier hs-var">pts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Point d r :+ p) -&gt; (Point d r :+ p) -&gt; LineSegment d p r
</span><a href="Geometry.LineSegment.Internal.html#ClosedLineSegment"><span class="hs-identifier hs-var">ClosedLineSegment</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680151038"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680151037"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680151036"><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151036"><span class="hs-identifier hs-var">pref</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680151034"><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151034"><span class="hs-identifier hs-var">subf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r.
Int -&gt; PolyLine d p r -&gt; (PolyLine d p r, PolyLine d p r)
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#split"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680151028"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151043"><span class="hs-identifier hs-var">pl</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- * Internal functions</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | Concatenate the two polylines, dropping their shared vertex</span><span>
</span><span id="line-46"></span><span id="local-6989586621680151158"><span id="local-6989586621680151159"><span id="local-6989586621680151160"><span class="annot"><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#merge"><span class="hs-identifier hs-type">merge</span></a></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151160"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151159"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151158"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151160"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151159"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151158"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151160"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151159"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151158"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-47"></span><span id="merge"><span class="annot"><span class="annottext">merge :: forall (d :: Nat) p r.
PolyLine d p r -&gt; PolyLine d p r -&gt; PolyLine d p r
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#merge"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621680151020"><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151020"><span class="hs-identifier hs-var">pref</span></a></span></span><span> </span><span id="local-6989586621680151019"><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151019"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r. LSeq 2 (Point d r :+ p) -&gt; PolyLine d p r
</span><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-var">PolyLine</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LSeq 1 (Point d r :+ p)
</span><a href="#local-6989586621680151017"><span class="hs-identifier hs-var">pref'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a (m :: Nat). LSeq n a -&gt; LSeq m a -&gt; LSeq m a
</span><a href="#local-6989586621680151016"><span class="hs-operator hs-var">`append`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151019"><span class="hs-identifier hs-var">sub</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d1 :: Nat) p1 r1 (d2 :: Nat) p2 r2.
Iso
  (PolyLine d1 p1 r1)
  (PolyLine d2 p2 r2)
  (LSeq 2 (Point d1 r1 :+ p1))
  (LSeq 2 (Point d2 r2 :+ p2))
</span><a href="Geometry.PolyLine.html#points"><span class="hs-identifier hs-var">points</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680151017"><span class="annot"><span class="annottext">LSeq 1 (Point d r :+ p)
</span><a href="#local-6989586621680151017"><span class="hs-identifier hs-var">pref'</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolyLine d p r
</span><a href="#local-6989586621680151020"><span class="hs-identifier hs-var">pref</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d1 :: Nat) p1 r1 (d2 :: Nat) p2 r2.
Iso
  (PolyLine d1 p1 r1)
  (PolyLine d2 p2 r2)
  (LSeq 2 (Point d1 r1 :+ p1))
  (LSeq 2 (Point d2 r2 :+ p2))
</span><a href="Geometry.PolyLine.html#points"><span class="hs-identifier hs-var">points</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621680151123"><span id="local-6989586621680151124"><span id="local-6989586621680151125"><span class="annot"><a href="#local-6989586621680151016"><span class="hs-identifier hs-type">append</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LSeq.LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680151125"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151124"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">LSeq.LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680151123"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151124"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LSeq.LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680151123"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151124"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621680151016"><span class="annot"><span class="annottext">append :: forall (n :: Nat) a (m :: Nat). LSeq n a -&gt; LSeq m a -&gt; LSeq m a
</span><a href="#local-6989586621680151016"><span class="hs-identifier hs-var hs-var">append</span></a></span></span><span> </span><span id="local-6989586621680151015"><span class="annot"><span class="annottext">LSeq n a
</span><a href="#local-6989586621680151015"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680151014"><span class="annot"><span class="annottext">LSeq m a
</span><a href="#local-6989586621680151014"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (m :: Nat) a. LSeq m a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.promise</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a (m :: Nat).
LSeq n a -&gt; LSeq m a -&gt; LSeq (n + m) a
</span><span class="hs-identifier hs-var">LSeq.append</span></span><span> </span><span class="annot"><span class="annottext">LSeq n a
</span><a href="#local-6989586621680151015"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">LSeq m a
</span><a href="#local-6989586621680151014"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-comment">-- our seq is actually even longer</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | Split the polyline at the given vertex. Both polylines contain this vertex</span><span>
</span><span id="line-56"></span><span id="local-6989586621680151135"><span id="local-6989586621680151136"><span id="local-6989586621680151137"><span class="annot"><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#split"><span class="hs-identifier hs-type">split</span></a></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151137"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151136"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151135"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-57"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151137"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151136"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151135"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151137"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151136"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151135"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-58"></span><span id="split"><span class="annot"><span class="annottext">split :: forall (d :: Nat) p r.
Int -&gt; PolyLine d p r -&gt; (PolyLine d p r, PolyLine d p r)
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#split"><span class="hs-identifier hs-var hs-var">split</span></a></span></span><span> </span><span id="local-6989586621680151006"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680151006"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-type">PolyLine</span></a></span><span> </span><span id="local-6989586621680151005"><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151005"><span class="hs-identifier hs-var">pts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: Nat} {d :: Nat} {r} {p}.
LSeq m (Point d r :+ p) -&gt; PolyLine d p r
</span><a href="#local-6989586621680151003"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall {m :: Nat} {d :: Nat} {r} {p}.
LSeq m (Point d r :+ p) -&gt; PolyLine d p r
</span><a href="#local-6989586621680151003"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680151002"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680151001"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span id="local-6989586621680151003"><span class="annot"><span class="annottext">f :: LSeq m (Point d r :+ p) -&gt; PolyLine d p r
</span><a href="#local-6989586621680151003"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r. LSeq 2 (Point d r :+ p) -&gt; PolyLine d p r
</span><a href="Geometry.PolyLine.html#PolyLine"><span class="hs-identifier hs-var">PolyLine</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (proxy :: Nat -&gt; *) (m :: Nat) a.
KnownNat n =&gt;
proxy n -&gt; LSeq m a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.forceLSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (n :: Nat). C n
</span><a href="Geometry.Vector.VectorFixed.html#C"><span class="hs-identifier hs-var">C</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFixed.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621680151002"><span class="annot"><span class="annottext">as :: LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680151002"><span class="hs-keyword hs-var hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a. Int -&gt; LSeq n a -&gt; LSeq 0 a
</span><span class="hs-identifier hs-var">LSeq.take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680151006"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151005"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621680151001"><span class="annot"><span class="annottext">bs :: LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680151001"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a. Int -&gt; LSeq n a -&gt; LSeq 0 a
</span><span class="hs-identifier hs-var">LSeq.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680151006"><span class="hs-identifier hs-var">i</span></a></span><span>     </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680151005"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Given a sequence of points, find the index of the point that has the</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- Furthest distance to the LineSegment. The result is the index of the point</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- and this distance.</span><span>
</span><span id="line-67"></span><span id="local-6989586621680151142"><span id="local-6989586621680151143"><span id="local-6989586621680151144"><span id="local-6989586621680151145"><span class="annot"><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#maxDist"><span class="hs-identifier hs-type">maxDist</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680151145"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621680151145"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151144"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680151143"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151144"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151145"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680151142"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.LineSegment.Internal.html#LineSegment"><span class="hs-identifier hs-type">LineSegment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151144"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151142"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680151145"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621680151145"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-69"></span><span id="maxDist"><span class="annot"><span class="annottext">maxDist :: forall r (d :: Nat) (n :: Nat) p.
(Ord r, Fractional r, Arity d) =&gt;
LSeq n (Point d r :+ p) -&gt; LineSegment d p r -&gt; (Int, r)
</span><a href="Algorithms.Geometry.PolyLineSimplification.DouglasPeucker.html#maxDist"><span class="hs-identifier hs-var hs-var">maxDist</span></a></span></span><span> </span><span id="local-6989586621680150982"><span class="annot"><span class="annottext">LSeq n (Point d r :+ p)
</span><a href="#local-6989586621680150982"><span class="hs-identifier hs-var">pts</span></a></span></span><span> </span><span id="local-6989586621680150981"><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680150981"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">F.maximumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b (n :: Nat). (Int -&gt; a -&gt; b) -&gt; LSeq n a -&gt; LSeq n b
</span><span class="hs-identifier hs-var">LSeq.mapWithIndex</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680150978"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680150978"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680150977"><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680150977"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>                                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680150978"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">forall g.
(HasSquaredEuclideanDistance g, Num (NumType g),
 Arity (Dimension g)) =&gt;
Point (Dimension g) (NumType g) -&gt; g -&gt; NumType g
</span><a href="Geometry.Point.Internal.html#squaredEuclideanDistTo"><span class="hs-identifier hs-var">squaredEuclideanDistTo</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680150977"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LineSegment d p r
</span><a href="#local-6989586621680150981"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LSeq n (Point d r :+ p)
</span><a href="#local-6989586621680150982"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-71"></span></pre></body></html>