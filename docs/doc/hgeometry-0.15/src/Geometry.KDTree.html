<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Geometry.KDTree</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Static, d-dimensional KD-Trees.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Geometry.KDTree</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier">KDTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier">KDTree'</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#buildKDTree"><span class="hs-identifier">buildKDTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier">buildKDTree'</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#reportSubTree"><span class="hs-identifier">reportSubTree</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#searchKDTree"><span class="hs-identifier">searchKDTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier">searchKDTree'</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier">toPointSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier">splitOn</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>             </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">element</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">imap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.BinaryTree</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Box.html"><span class="hs-identifier">Geometry.Box</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Point.html"><span class="hs-identifier">Geometry.Point</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Properties.html"><span class="hs-identifier">Geometry.Properties</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Vector.html"><span class="hs-identifier">Geometry.Vector</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.LSeq</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LSeq</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|)</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.LSeq</span></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSeq</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Util</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Fixed</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FV</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>                  </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">replicate</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Unsafe.Coerce</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeCoerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">newtype</span><span> </span><span id="Coord"><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680136316"><span class="annot"><a href="#local-6989586621680136316"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Coord"><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unCoord"><span class="annot"><span class="annottext">forall (d :: Nat). Coord d -&gt; Int
</span><a href="Geometry.KDTree.html#unCoord"><span class="hs-identifier hs-var hs-var">unCoord</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">}</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680135940"><span id="local-6989586621680136313"><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136313"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136313"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680135930"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135930"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680135929"><span class="annot"><span class="annottext">== :: Coord d -&gt; Coord d -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680135928"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135928"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135930"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135926"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135928"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135926"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>      </span><span id="local-6989586621680135926"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621680135926"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680136313"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680135918"><span id="local-6989586621680135921"><span id="local-6989586621680136297"><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136297"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136297"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>  </span><span id="local-6989586621680135909"><span class="annot"><span class="annottext">show :: Coord d -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680135907"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135907"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135907"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135905"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>      </span><span id="local-6989586621680135905"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621680135905"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680136297"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680135891"><span id="local-6989586621680135893"><span id="local-6989586621680135895"><span id="local-6989586621680135897"><span id="local-6989586621680135901"><span id="local-6989586621680135903"><span id="local-6989586621680136295"><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136295"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136295"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621680135884"><span class="annot"><span class="annottext">toEnum :: Int -&gt; Coord d
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toEnum</span></span></span><span> </span><span id="local-6989586621680135882"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135882"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat). Int -&gt; Coord d
</span><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135882"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135881"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>      </span><span id="local-6989586621680135881"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621680135881"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680136295"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span id="local-6989586621680135878"><span class="annot"><span class="annottext">fromEnum :: Coord d -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fromEnum</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat). Coord d -&gt; Int
</span><a href="Geometry.KDTree.html#unCoord"><span class="hs-identifier hs-var">unCoord</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">data</span><span> </span><span id="Split"><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-var">Split</span></a></span></span><span> </span><span id="local-6989586621680136162"><span class="annot"><a href="#local-6989586621680136162"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680136161"><span class="annot"><a href="#local-6989586621680136161"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Split"><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-var">Split</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136162"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621680136161"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136162"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136161"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span id="local-6989586621680135862"><span id="local-6989586621680135864"><span id="local-6989586621680135873"><span id="local-6989586621680136289"><span id="local-6989586621680136290"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680136290"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136289"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136289"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136289"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136290"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-67"></span><span id="local-6989586621680135852"><span id="local-6989586621680135859"><span id="local-6989586621680136284"><span id="local-6989586621680136285"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136285"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136284"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136284"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136284"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136285"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">type</span><span> </span><span id="Split%27"><span class="annot"><a href="Geometry.KDTree.html#Split%27"><span class="hs-identifier hs-var">Split'</span></a></span></span><span> </span><span id="local-6989586621680135850"><span class="annot"><a href="#local-6989586621680135850"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680135849"><span class="annot"><a href="#local-6989586621680135849"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680135850"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680135849"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | A non-empty KD-tree</span><span>
</span><span id="line-73"></span><span class="hs-keyword">newtype</span><span> </span><span id="KDTree%27"><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-var">KDTree'</span></a></span></span><span> </span><span id="local-6989586621680136283"><span class="annot"><a href="#local-6989586621680136283"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680136282"><span class="annot"><a href="#local-6989586621680136282"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680136281"><span class="annot"><a href="#local-6989586621680136281"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="KDT"><span class="annot"><a href="Geometry.KDTree.html#KDT"><span class="hs-identifier hs-var">KDT</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unKDT"><span class="annot"><span class="annottext">forall (d :: Nat) p r.
KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#unKDT"><span class="hs-identifier hs-var hs-var">unKDT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BinLeafTree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136283"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136281"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136283"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136281"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136282"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span id="local-6989586621680135836"><span id="local-6989586621680135838"><span id="local-6989586621680135845"><span id="local-6989586621680136266"><span id="local-6989586621680136267"><span id="local-6989586621680136268"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680136268"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680136267"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136266"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136266"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136266"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136268"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136267"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-76"></span><span id="local-6989586621680135820"><span id="local-6989586621680135827"><span id="local-6989586621680136254"><span id="local-6989586621680136255"><span id="local-6989586621680136256"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136256"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136255"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136254"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136254"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136254"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136256"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136255"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | A d-dimensional KD-Tree.</span><span>
</span><span id="line-79"></span><span class="hs-keyword">data</span><span> </span><span id="KDTree"><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-var">KDTree</span></a></span></span><span> </span><span id="local-6989586621680136229"><span class="annot"><a href="#local-6989586621680136229"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680136228"><span class="annot"><a href="#local-6989586621680136228"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680136227"><span class="annot"><a href="#local-6989586621680136227"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Empty"><span class="annot"><a href="Geometry.KDTree.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>
</span><span id="line-80"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="Tree"><span class="annot"><a href="Geometry.KDTree.html#Tree"><span class="hs-identifier hs-var">Tree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136229"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136228"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136227"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621680135801"><span id="local-6989586621680135803"><span id="local-6989586621680135807"><span id="local-6989586621680136251"><span id="local-6989586621680136252"><span id="local-6989586621680136253"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680136253"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680136252"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136251"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136251"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136251"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136253"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136252"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-83"></span><span id="local-6989586621680135796"><span id="local-6989586621680135799"><span id="local-6989586621680136248"><span id="local-6989586621680136249"><span id="local-6989586621680136250"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136250"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136249"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136248"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136248"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136248"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136250"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136249"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="local-6989586621680136245"><span id="local-6989586621680136246"><span id="local-6989586621680136247"><span class="annot"><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-type">toMaybe</span></a></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136247"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136246"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136245"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136247"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136246"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136245"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-87"></span><span id="toMaybe"><span class="annot"><span class="annottext">toMaybe :: forall (d :: Nat) p r. KDTree d p r -&gt; Maybe (KDTree' d p r)
</span><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-var hs-var">toMaybe</span></a></span></span><span> </span><span class="annot"><span class="annottext">KDTree d p r
</span><a href="Geometry.KDTree.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-var">toMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span> </span><span id="local-6989586621680135794"><span class="annot"><span class="annottext">KDTree' d p r
</span><a href="#local-6989586621680135794"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">KDTree' d p r
</span><a href="#local-6989586621680135794"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Expects the input to be a set, i.e. no duplicates</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- running time: \(O(n \log n)\)</span><span>
</span><span id="line-94"></span><span id="local-6989586621680136237"><span id="local-6989586621680136238"><span id="local-6989586621680136240"><span class="annot"><a href="Geometry.KDTree.html#buildKDTree"><span class="hs-identifier hs-type">buildKDTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136240"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680136240"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136238"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136240"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136238"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136237"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136240"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136237"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136238"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-96"></span><span id="buildKDTree"><span class="annot"><span class="annottext">buildKDTree :: forall (d :: Nat) r p.
(Arity d, 1 &lt;= d, Ord r) =&gt;
[Point d r :+ p] -&gt; KDTree d p r
</span><a href="Geometry.KDTree.html#buildKDTree"><span class="hs-identifier hs-var hs-var">buildKDTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r. KDTree d p r
</span><a href="Geometry.KDTree.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (d :: Nat) p r. KDTree' d p r -&gt; KDTree d p r
</span><a href="Geometry.KDTree.html#Tree"><span class="hs-identifier hs-var">Tree</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Arity d, 1 &lt;= d, Ord r) =&gt;
NonEmpty (Point d r :+ p) -&gt; KDTree' d p r
</span><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier hs-var">buildKDTree'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">NonEmpty.nonEmpty</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621680136224"><span id="local-6989586621680136225"><span id="local-6989586621680136226"><span class="annot"><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier hs-type">buildKDTree'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136226"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680136226"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136225"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136226"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136225"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136224"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136226"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136224"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136225"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-100"></span><span id="buildKDTree%27"><span class="annot"><span class="annottext">buildKDTree' :: forall (d :: Nat) r p.
(Arity d, 1 &lt;= d, Ord r) =&gt;
NonEmpty (Point d r :+ p) -&gt; KDTree' d p r
</span><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier hs-var hs-var">buildKDTree'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r.
BinLeafTree (Split d r) (Point d r :+ p) -&gt; KDTree' d p r
</span><a href="Geometry.KDTree.html#KDT"><span class="hs-identifier hs-var">KDT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall {b} {extra}.
(Peano (FromPeano (Peano (Dimension b)) + 1)
 ~ 'S (Peano (FromPeano (Peano (Dimension b)))),
 ImplicitPeano (Peano (Dimension b)), Ord (NumType b),
 ArityPeano (Peano (FromPeano (Peano (Dimension b)))),
 KnownNat (FromPeano (Peano (Dimension b))), KnownNat (Dimension b),
 IsBoxable b) =&gt;
BinLeafTree (SP (Coord (Dimension b)) (NumType b)) (b :+ extra)
-&gt; BinLeafTree (Split (Dimension b) (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135748"><span class="hs-identifier hs-var">addBoxes</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (d :: Nat). Int -&gt; Coord d
</span><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r (n :: Nat) p.
(Arity d, Ord r) =&gt;
LSeq n (Point d r :+ p) -&gt; PointSet (LSeq n) d p r
</span><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier hs-var">toPointSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; LSeq 1 a
</span><span class="hs-identifier hs-var">LSeq.fromNonEmpty</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">where</span><span>     </span><span class="hs-comment">-- compute one tree with bounding boxes, then merge them together</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621680135748"><span class="annot"><span class="annottext">addBoxes :: BinLeafTree (SP (Coord (Dimension b)) (NumType b)) (b :+ extra)
-&gt; BinLeafTree (Split (Dimension b) (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135748"><span class="hs-identifier hs-var hs-var">addBoxes</span></a></span></span><span> </span><span id="local-6989586621680135716"><span class="annot"><span class="annottext">BinLeafTree (SP (Coord (Dimension b)) (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135716"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680135715"><span class="annot"><span class="annottext">bbt :: BinLeafTree (Box (Dimension b) () (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135715"><span class="hs-identifier hs-var hs-var">bbt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall w v a.
(w -&gt; v -&gt; w -&gt; w)
-&gt; (a -&gt; w) -&gt; BinLeafTree v a -&gt; BinLeafTree w a
</span><span class="hs-identifier hs-var">foldUpData</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680135713"><span class="annot"><span class="annottext">Box (Dimension b) () (NumType b)
</span><a href="#local-6989586621680135713"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">SP (Coord (Dimension b)) (NumType b)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680135712"><span class="annot"><span class="annottext">Box (Dimension b) () (NumType b)
</span><a href="#local-6989586621680135712"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall g (c :: * -&gt; *).
(IsBoxable g, Foldable c, Ord (NumType g), Arity (Dimension g)) =&gt;
c g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBoxList%27"><span class="hs-identifier hs-var">boundingBoxList'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Box (Dimension b) () (NumType b)
</span><a href="#local-6989586621680135713"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Box (Dimension b) () (NumType b)
</span><a href="#local-6989586621680135712"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall g.
(IsBoxable g, Ord (NumType g)) =&gt;
g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBox"><span class="hs-identifier hs-var">boundingBox</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (SP (Coord (Dimension b)) (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135716"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-104"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall u v w a b c.
(u -&gt; v -&gt; w)
-&gt; (a -&gt; b -&gt; c)
-&gt; BinLeafTree u a
-&gt; BinLeafTree v b
-&gt; BinLeafTree w c
</span><span class="hs-identifier hs-var">zipExactWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span id="local-6989586621680135705"><span class="annot"><span class="annottext">Coord (Dimension b)
</span><a href="#local-6989586621680135705"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680135704"><span class="annot"><span class="annottext">NumType b
</span><a href="#local-6989586621680135704"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680135703"><span class="annot"><span class="annottext">Box (Dimension b) () (NumType b)
</span><a href="#local-6989586621680135703"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r. Coord d -&gt; r -&gt; Box d () r -&gt; Split d r
</span><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-var">Split</span></a></span><span> </span><span class="annot"><span class="annottext">Coord (Dimension b)
</span><a href="#local-6989586621680135705"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">NumType b
</span><a href="#local-6989586621680135704"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Box (Dimension b) () (NumType b)
</span><a href="#local-6989586621680135703"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (SP (Coord (Dimension b)) (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135716"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Box (Dimension b) () (NumType b)) (b :+ extra)
</span><a href="#local-6989586621680135715"><span class="hs-identifier hs-var">bbt</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Nub by sorting first</span><span>
</span><span id="line-108"></span><span id="local-6989586621680136158"><span class="annot"><a href="Geometry.KDTree.html#ordNub"><span class="hs-identifier hs-type">ordNub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136158"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680136158"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680136158"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-109"></span><span id="ordNub"><span class="annot"><span class="annottext">ordNub :: forall a. Ord a =&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="Geometry.KDTree.html#ordNub"><span class="hs-identifier hs-var hs-var">ordNub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">NonEmpty.head</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; NonEmpty a -&gt; NonEmpty (NonEmpty a)
</span><span class="hs-identifier hs-var">NonEmpty.group1</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NonEmpty.sort</span></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span id="local-6989586621680136190"><span id="local-6989586621680136191"><span id="local-6989586621680136192"><span id="local-6989586621680136193"><span class="annot"><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier hs-type">toPointSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136193"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136192"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136191"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136193"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136192"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136190"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680136191"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136193"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136190"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136192"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-115"></span><span id="toPointSet"><span class="annot"><span class="annottext">toPointSet :: forall (d :: Nat) r (n :: Nat) p.
(Arity d, Ord r) =&gt;
LSeq n (Point d r :+ p) -&gt; PointSet (LSeq n) d p r
</span><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier hs-var hs-var">toPointSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (v :: * -&gt; *) a b.
(Vector v a, Vector v b) =&gt;
(Int -&gt; a -&gt; b) -&gt; v a -&gt; v b
</span><span class="hs-identifier hs-var">FV.imap</span></span><span> </span><span class="annot"><span class="annottext">forall {d :: Nat} {r} {n :: Nat} {e}.
(Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d))),
 ImplicitPeano (Peano d), Ord r,
 ArityPeano (Peano (FromPeano (Peano d))), KnownNat d,
 KnownNat (FromPeano (Peano d))) =&gt;
Int -&gt; LSeq n (Point d r :+ e) -&gt; LSeq n (Point d r :+ e)
</span><a href="#local-6989586621680135668"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (v :: * -&gt; *) a. Vector v a =&gt; a -&gt; v a
</span><span class="hs-identifier hs-var">FV.replicate</span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621680135668"><span class="annot"><span class="annottext">sort :: Int -&gt; LSeq n (Point d r :+ e) -&gt; LSeq n (Point d r :+ e)
</span><a href="#local-6989586621680135668"><span class="hs-identifier hs-var hs-var">sort</span></a></span></span><span> </span><span id="local-6989586621680135648"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135648"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (n :: Nat). (a -&gt; a -&gt; Ordering) -&gt; LSeq n a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.unstableSortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall r (d :: Nat) e.
(Ord r, Arity d) =&gt;
Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
</span><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-var">compareOn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135648"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621680136129"><span id="local-6989586621680136130"><span id="local-6989586621680136131"><span class="annot"><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-type">compareOn</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136131"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136130"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136130"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136131"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136129"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136130"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136131"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136129"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span></span></span><span>
</span><span id="line-122"></span><span id="compareOn"><span class="annot"><span class="annottext">compareOn :: forall r (d :: Nat) e.
(Ord r, Arity d) =&gt;
Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
</span><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-var hs-var">compareOn</span></a></span></span><span> </span><span id="local-6989586621680135632"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135632"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680135631"><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680135631"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680135630"><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680135630"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680135629"><span class="annot"><span class="annottext">f :: (Point d r :+ e) -&gt; r
</span><a href="#local-6989586621680135629"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (p :: Nat -&gt; * -&gt; *) r.
(Arity d, AsAPoint p) =&gt;
Int -&gt; Lens' (p d r) r
</span><a href="Geometry.Point.Class.html#unsafeCoord"><span class="hs-identifier hs-var">unsafeCoord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135632"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point d r :+ e) -&gt; r
</span><a href="#local-6989586621680135629"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680135631"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680135631"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point d r :+ e) -&gt; r
</span><a href="#local-6989586621680135629"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680135630"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680135630"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Constructs the tree</span><span>
</span><span id="line-127"></span><span id="local-6989586621680136195"><span id="local-6989586621680136197"><span id="local-6989586621680136198"><span class="annot"><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-type">build</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680136198"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136198"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136197"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136198"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-129"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136198"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136195"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136197"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-130"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BinLeafTree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split%27"><span class="hs-identifier hs-type">Split'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136198"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136197"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136198"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136197"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136195"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-131"></span><span id="build"><span class="annot"><span class="annottext">build :: forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621680135606"><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680135606"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680135605"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135605"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r.
(1 &lt;= d, Arity d) =&gt;
PointSet (LSeq 1) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
</span><a href="Geometry.KDTree.html#asSingleton"><span class="hs-identifier hs-var">asSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135605"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680135603"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135603"><span class="hs-identifier hs-var">p</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall v a. a -&gt; BinLeafTree v a
</span><span class="hs-identifier hs-var">Leaf</span></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135603"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680135601"><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680135601"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680135600"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135600"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680135599"><span class="annot"><span class="annottext">Split' d r
</span><a href="#local-6989586621680135599"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680135598"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135598"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Arity d, KnownNat d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, Split' d r, PointSet (LSeq 1) d p r)
</span><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier hs-var">splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680135606"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680135601"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-134"></span><span>                     </span><span id="local-6989586621680135597"><span class="annot"><span class="annottext">j :: Coord d
</span><a href="#local-6989586621680135597"><span class="hs-identifier hs-var hs-var">j</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680135606"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-135"></span><span>                   </span><span class="hs-comment">-- the pattern match proves tha tthe seq has &gt;= 2 elements</span><span>
</span><span id="line-136"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall v a.
BinLeafTree v a -&gt; v -&gt; BinLeafTree v a -&gt; BinLeafTree v a
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680135597"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135600"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Split' d r
</span><a href="#local-6989586621680135599"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680135597"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135598"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621680136103"><span id="local-6989586621680136104"><span id="local-6989586621680136105"><span class="annot"><a href="Geometry.KDTree.html#reportSubTree"><span class="hs-identifier hs-type">reportSubTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136105"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136104"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136103"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136105"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136103"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136104"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-142"></span><span id="reportSubTree"><span class="annot"><span class="annottext">reportSubTree :: forall (d :: Nat) p r. KDTree' d p r -&gt; NonEmpty (Point d r :+ p)
</span><a href="Geometry.KDTree.html#reportSubTree"><span class="hs-identifier hs-var hs-var">reportSubTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NonEmpty.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r.
KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#unKDT"><span class="hs-identifier hs-var">unKDT</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- | Searches in a KDTree</span><span>
</span><span id="line-145"></span><span class="hs-comment">--</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- running time: \(O(n^{(d-1)/d} + k)\)</span><span>
</span><span id="line-147"></span><span id="local-6989586621680136092"><span id="local-6989586621680136093"><span id="local-6989586621680136094"><span id="local-6989586621680136095"><span class="annot"><a href="Geometry.KDTree.html#searchKDTree"><span class="hs-identifier hs-type">searchKDTree</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136095"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136094"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136095"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136093"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136094"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136095"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136092"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136094"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136095"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136094"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136092"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-149"></span><span id="searchKDTree"><span class="annot"><span class="annottext">searchKDTree :: forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; KDTree d p r -&gt; [Point d r :+ p]
</span><a href="Geometry.KDTree.html#searchKDTree"><span class="hs-identifier hs-var hs-var">searchKDTree</span></a></span></span><span> </span><span id="local-6989586621680135586"><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135586"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; KDTree' d p r -&gt; [Point d r :+ p]
</span><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier hs-var">searchKDTree'</span></a></span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135586"><span class="hs-identifier hs-var">qr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r. KDTree d p r -&gt; Maybe (KDTree' d p r)
</span><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-var">toMaybe</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621680136084"><span id="local-6989586621680136085"><span id="local-6989586621680136086"><span id="local-6989586621680136087"><span class="annot"><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier hs-type">searchKDTree'</span></a></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136087"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136086"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136087"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136085"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136086"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136087"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136084"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136086"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136087"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136086"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136084"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-153"></span><span id="searchKDTree%27"><span class="annot"><span class="annottext">searchKDTree' :: forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; KDTree' d p r -&gt; [Point d r :+ p]
</span><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier hs-var hs-var">searchKDTree'</span></a></span></span><span> </span><span id="local-6989586621680135570"><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135570"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680135569"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) p r.
KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#unKDT"><span class="hs-identifier hs-var">unKDT</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621680135569"><span class="annot"><span class="annottext">search :: BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680135569"><span class="hs-identifier hs-var hs-var">search</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Leaf</span></span><span> </span><span id="local-6989586621680135568"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135568"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135568"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135570"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135568"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="#local-6989586621680135569"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span id="local-6989586621680135566"><span class="annot"><span class="annottext">t :: BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135566"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span id="local-6989586621680135565"><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135565"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680135564"><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680135564"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680135563"><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135563"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680135564"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; Box d p r -&gt; Bool
</span><a href="Geometry.KDTree.html#containedIn"><span class="hs-operator hs-var">`containedIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135570"><span class="hs-identifier hs-var">qr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135566"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p]
</span><a href="#local-6989586621680135561"><span class="hs-identifier hs-var">l'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p]
</span><a href="#local-6989586621680135560"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>        </span><span id="local-6989586621680135561"><span class="annot"><span class="annottext">l' :: [Point d r :+ p]
</span><a href="#local-6989586621680135561"><span class="hs-identifier hs-var hs-var">l'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135570"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Arity d, Ord r) =&gt;
BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
</span><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var">boxOf</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135565"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680135569"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135565"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621680135560"><span class="annot"><span class="annottext">r' :: [Point d r :+ p]
</span><a href="#local-6989586621680135560"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680135570"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r p.
(Arity d, Ord r) =&gt;
BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
</span><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var">boxOf</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135563"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680135569"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680135563"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621680136062"><span id="local-6989586621680136063"><span id="local-6989586621680136064"><span class="annot"><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-type">boxOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136064"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136063"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BinLeafTree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136064"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136063"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136064"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136063"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136062"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136064"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136063"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-167"></span><span id="boxOf"><span class="annot"><span class="annottext">boxOf :: forall (d :: Nat) r p.
(Arity d, Ord r) =&gt;
BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
</span><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var hs-var">boxOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Leaf</span></span><span> </span><span id="local-6989586621680135553"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135553"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall g.
(IsBoxable g, Ord (NumType g)) =&gt;
g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBox"><span class="hs-identifier hs-var">boundingBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135553"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="annot"><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var">boxOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680135552"><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680135552"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680135552"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621680136066"><span id="local-6989586621680136067"><span id="local-6989586621680136068"><span id="local-6989586621680136069"><span class="annot"><a href="Geometry.KDTree.html#containedIn"><span class="hs-identifier hs-type">containedIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136069"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136068"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136069"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136067"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136068"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136069"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136066"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136068"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span></span><span>
</span><span id="line-171"></span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680135546"><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680135546"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">q
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680135544"><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680135544"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">q
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="containedIn"><span class="annot"><span class="annottext">containedIn :: forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; Box d p r -&gt; Bool
</span><a href="Geometry.KDTree.html#containedIn"><span class="hs-operator hs-var hs-var">`containedIn`</span></a></span></span><span> </span><span id="local-6989586621680135543"><span class="annot"><span class="annottext">Box d p r
</span><a href="#local-6989586621680135543"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">Box d p r
</span><a href="#local-6989586621680135543"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680135546"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680135544"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-keyword">type</span><span> </span><span id="PointSet"><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-var">PointSet</span></a></span></span><span> </span><span id="local-6989586621680135541"><span class="annot"><a href="#local-6989586621680135541"><span class="hs-identifier hs-type">seq</span></a></span></span><span> </span><span id="local-6989586621680135540"><span class="annot"><a href="#local-6989586621680135540"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680135539"><span class="annot"><a href="#local-6989586621680135539"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680135538"><span class="annot"><a href="#local-6989586621680135538"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680135540"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680135541"><span class="hs-identifier hs-type">seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680135540"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680135538"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680135539"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | running time: \(O(n)\)</span><span>
</span><span id="line-179"></span><span id="local-6989586621680136106"><span id="local-6989586621680136107"><span id="local-6989586621680136108"><span class="annot"><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier hs-type">splitOn</span></a></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680136107"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-181"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136106"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136107"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-182"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136106"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136107"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-183"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#Split%27"><span class="hs-identifier hs-type">Split'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136107"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-184"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136108"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136106"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136107"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-185"></span><span id="splitOn"><span class="annot"><span class="annottext">splitOn :: forall (d :: Nat) r p.
(Arity d, KnownNat d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, Split' d r, PointSet (LSeq 1) d p r)
</span><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier hs-var hs-var">splitOn</span></a></span></span><span> </span><span id="local-6989586621680135502"><span class="annot"><span class="annottext">c :: Coord d
</span><a href="#local-6989586621680135502"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680135501"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135501"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680135500"><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680135500"><span class="hs-identifier hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector d (LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680135499"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; SP a b
</span><span class="hs-identifier hs-var">SP</span></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680135502"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135498"><span class="hs-identifier hs-var">m</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) (p :: Nat -&gt; * -&gt; *) r.
(Arity d, AsAPoint p) =&gt;
Int -&gt; Lens' (p d r) r
</span><a href="Geometry.Point.Class.html#unsafeCoord"><span class="hs-identifier hs-var">unsafeCoord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135501"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vector d (LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680135497"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- i = traceShow (c,j) j</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621680135498"><span class="annot"><span class="annottext">m :: Point d r :+ p
</span><a href="#local-6989586621680135498"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680135496"><span class="annot"><span class="annottext">xs :: LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680135496"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680135500"><span class="hs-identifier hs-var">pts</span></a></span><span class="annot"><span class="annottext">forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span class="annot"><span class="annottext">forall (d :: Nat) r. Arity d =&gt; Int -&gt; Traversal' (Vector d r) r
</span><a href="Geometry.Vector.VectorFamily.html#element%27"><span class="hs-identifier hs-var">element'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135501"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680135496"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) a. LSeq n a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`LSeq.index`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">F.length</span></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680135496"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- Since the input seq has &gt;= 2 elems, F.length xs / 2 &gt;= 1. It follows</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- that the both sets thus have at least one elemnt.</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- f :: LSeq 2 _ -&gt; (LSeq 1 _, LSeq 1 _)</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621680135490"><span class="annot"><span class="annottext">f :: LSeq 2 (Point d r :+ p)
-&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680135490"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (m :: Nat) a. LSeq m a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.promise</span></span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat) (m :: Nat) a. LSeq m a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.promise</span></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a (n :: Nat).
(a -&gt; Bool) -&gt; LSeq n a -&gt; (LSeq 0 a, LSeq 0 a)
</span><span class="hs-identifier hs-var">LSeq.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680135486"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135486"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall r (d :: Nat) e.
(Ord r, Arity d) =&gt;
Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
</span><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-var">compareOn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680135501"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135486"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135498"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680135499"><span class="annot"><span class="annottext">Vector d (LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680135499"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680135497"><span class="annot"><span class="annottext">Vector d (LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680135497"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {r} {r}. Vector d (r, r) -&gt; (Vector d r, Vector d r)
</span><a href="#local-6989586621680135485"><span class="hs-identifier hs-var">unzip'</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
-&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680135490"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680135500"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">-- unzip' :: Vector d (a,b) -&gt; (Vector d a, Vector d b)</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621680135485"><span class="annot"><span class="annottext">unzip' :: Vector d (r, r) -&gt; (Vector d r, Vector d r)
</span><a href="#local-6989586621680135485"><span class="hs-identifier hs-var hs-var">unzip'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r. Arity d =&gt; [r] -&gt; Vector d r
</span><a href="Geometry.Vector.VectorFamily.html#vectorFromListUnsafe"><span class="hs-identifier hs-var">vectorFromListUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) r. Arity d =&gt; [r] -&gt; Vector d r
</span><a href="Geometry.Vector.VectorFamily.html#vectorFromListUnsafe"><span class="hs-identifier hs-var">vectorFromListUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621680136111"><span id="local-6989586621680136112"><span id="local-6989586621680136113"><span class="annot"><a href="Geometry.KDTree.html#asSingleton"><span class="hs-identifier hs-type">asSingleton</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680136113"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136113"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136113"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136112"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136111"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-206"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136113"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136111"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680136112"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680136113"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136112"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680136111"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-207"></span><span id="asSingleton"><span class="annot"><span class="annottext">asSingleton :: forall (d :: Nat) p r.
(1 &lt;= d, Arity d) =&gt;
PointSet (LSeq 1) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
</span><a href="Geometry.KDTree.html#asSingleton"><span class="hs-identifier hs-var hs-var">asSingleton</span></a></span></span><span> </span><span id="local-6989586621680135452"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135452"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135452"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (i :: Nat) (d :: Nat) r.
(Arity d, KnownNat i, (i + 1) &lt;= d) =&gt;
Lens' (Vector d r) r
</span><a href="Geometry.Vector.VectorFamily.html#element"><span class="hs-identifier hs-var">element</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-208"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621680135450"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135450"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|</span></span><span> </span><span id="local-6989586621680135449"><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680135449"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680135449"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680135450"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-comment">-- only one lement</span><span>
</span><span id="line-209"></span><span>                  </span><span class="annot"><span class="annottext">LSeq 1 (Point d r :+ p)
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce</span></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680135452"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-210"></span></pre></body></html>