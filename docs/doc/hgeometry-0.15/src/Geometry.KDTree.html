<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Geometry.KDTree</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  (C) Frank Staals</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  see the LICENSE file</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Maintainer  :  Frank Staals</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Static, d-dimensional KD-Trees.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Geometry.KDTree</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier">KDTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier">KDTree'</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#buildKDTree"><span class="hs-identifier">buildKDTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier">buildKDTree'</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#reportSubTree"><span class="hs-identifier">reportSubTree</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#searchKDTree"><span class="hs-identifier">searchKDTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier">searchKDTree'</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier">toPointSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier">splitOn</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>             </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">element</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">imap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.BinaryTree</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Ext</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Box.html"><span class="hs-identifier">Geometry.Box</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Point.html"><span class="hs-identifier">Geometry.Point</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Properties.html"><span class="hs-identifier">Geometry.Properties</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Geometry.Vector.html"><span class="hs-identifier">Geometry.Vector</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.LSeq</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LSeq</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|)</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.LSeq</span></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LSeq</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Util</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Fixed</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FV</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>                  </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">replicate</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Unsafe.Coerce</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeCoerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">newtype</span><span> </span><span id="Coord"><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680032763"><span class="annot"><a href="#local-6989586621680032763"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Coord"><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unCoord"><span class="annot"><span class="annottext">Coord d -&gt; Int
</span><a href="Geometry.KDTree.html#unCoord"><span class="hs-identifier hs-var hs-var">unCoord</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">}</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span id="local-6989586621680032517"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680032514"><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032517"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032517"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680032512"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032512"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680032511"><span class="annot"><span class="annottext">== :: Coord d -&gt; Coord d -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680032510"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032510"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032512"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032508"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032510"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032508"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>      </span><span id="local-6989586621680032508"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621680032508"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int) -&gt; (Proxy d -&gt; Integer) -&gt; Proxy d -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proxy d -&gt; Integer
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="annot"><span class="annottext">(Proxy d -&gt; Int) -&gt; Proxy d -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy d
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680032517"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621680032504"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680032499"><span id="local-6989586621680032502"><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032504"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032504"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>  </span><span id="local-6989586621680032497"><span class="annot"><span class="annottext">show :: Coord d -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680032495"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032495"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032495"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032493"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>      </span><span id="local-6989586621680032493"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621680032493"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int) -&gt; (Proxy d -&gt; Integer) -&gt; Proxy d -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proxy d -&gt; Integer
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="annot"><span class="annottext">(Proxy d -&gt; Int) -&gt; Proxy d -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy d
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680032504"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span id="local-6989586621680032492"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680032478"><span id="local-6989586621680032480"><span id="local-6989586621680032482"><span id="local-6989586621680032484"><span id="local-6989586621680032488"><span id="local-6989586621680032490"><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032492"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032492"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621680032476"><span class="annot"><span class="annottext">toEnum :: Int -&gt; Coord d
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toEnum</span></span></span><span> </span><span id="local-6989586621680032474"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032474"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Coord d
forall (d :: Nat). Int -&gt; Coord d
</span><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Coord d) -&gt; Int -&gt; Coord d
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032474"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032473"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>      </span><span id="local-6989586621680032473"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621680032473"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int) -&gt; (Proxy d -&gt; Integer) -&gt; Proxy d -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proxy d -&gt; Integer
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="annot"><span class="annottext">(Proxy d -&gt; Int) -&gt; Proxy d -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy d
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621680032492"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span id="local-6989586621680032472"><span class="annot"><span class="annottext">fromEnum :: Coord d -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fromEnum</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (Coord d -&gt; Int) -&gt; Coord d -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Coord d -&gt; Int
forall (d :: Nat). Coord d -&gt; Int
</span><a href="Geometry.KDTree.html#unCoord"><span class="hs-identifier hs-var hs-var">unCoord</span></a></span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">data</span><span> </span><span id="Split"><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-var">Split</span></a></span></span><span> </span><span id="local-6989586621680032669"><span class="annot"><a href="#local-6989586621680032669"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680032668"><span class="annot"><a href="#local-6989586621680032668"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Split"><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-var">Split</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032669"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621680032668"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032669"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032668"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span id="local-6989586621680032461"><span id="local-6989586621680032463"><span id="local-6989586621680032465"><span id="local-6989586621680032467"><span id="local-6989586621680032468"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680032468"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032467"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032467"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032467"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032468"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-67"></span><span id="local-6989586621680032455"><span id="local-6989586621680032457"><span id="local-6989586621680032459"><span id="local-6989586621680032460"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032460"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032459"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032459"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032459"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032460"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">type</span><span> </span><span id="Split%27"><span class="annot"><a href="Geometry.KDTree.html#Split%27"><span class="hs-identifier hs-var">Split'</span></a></span></span><span> </span><span id="local-6989586621680032454"><span class="annot"><a href="#local-6989586621680032454"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680032453"><span class="annot"><a href="#local-6989586621680032453"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032454"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032453"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | A non-empty KD-tree</span><span>
</span><span id="line-73"></span><span class="hs-keyword">newtype</span><span> </span><span id="KDTree%27"><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-var">KDTree'</span></a></span></span><span> </span><span id="local-6989586621680032715"><span class="annot"><a href="#local-6989586621680032715"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680032713"><span class="annot"><a href="#local-6989586621680032713"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680032714"><span class="annot"><a href="#local-6989586621680032714"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="KDT"><span class="annot"><a href="Geometry.KDTree.html#KDT"><span class="hs-identifier hs-var">KDT</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unKDT"><span class="annot"><span class="annottext">KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#unKDT"><span class="hs-identifier hs-var hs-var">unKDT</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BinLeafTree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032715"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032714"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032715"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032714"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032713"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span id="local-6989586621680032442"><span id="local-6989586621680032444"><span id="local-6989586621680032446"><span id="local-6989586621680032448"><span id="local-6989586621680032449"><span id="local-6989586621680032450"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680032450"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680032449"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032448"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032448"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032448"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032450"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032449"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-76"></span><span id="local-6989586621680032435"><span id="local-6989586621680032437"><span id="local-6989586621680032439"><span id="local-6989586621680032440"><span id="local-6989586621680032441"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032441"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032440"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032439"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032439"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032439"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032441"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032440"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | A d-dimensional KD-Tree.</span><span>
</span><span id="line-79"></span><span class="hs-keyword">data</span><span> </span><span id="KDTree"><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-var">KDTree</span></a></span></span><span> </span><span id="local-6989586621680032726"><span class="annot"><a href="#local-6989586621680032726"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680032725"><span class="annot"><a href="#local-6989586621680032725"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680032724"><span class="annot"><a href="#local-6989586621680032724"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Empty"><span class="annot"><a href="Geometry.KDTree.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>
</span><span id="line-80"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="Tree"><span class="annot"><a href="Geometry.KDTree.html#Tree"><span class="hs-identifier hs-var">Tree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032726"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032725"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032724"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621680032424"><span id="local-6989586621680032426"><span id="local-6989586621680032428"><span id="local-6989586621680032430"><span id="local-6989586621680032431"><span id="local-6989586621680032432"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680032432"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680032431"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032430"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032430"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032430"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032432"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032431"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-83"></span><span id="local-6989586621680032417"><span id="local-6989586621680032419"><span id="local-6989586621680032421"><span id="local-6989586621680032422"><span id="local-6989586621680032423"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032423"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032422"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032421"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032421"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032421"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032423"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032422"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="local-6989586621680032602"><span id="local-6989586621680032603"><span id="local-6989586621680032604"><span class="annot"><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-type">toMaybe</span></a></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032604"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032603"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032602"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032604"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032603"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032602"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-87"></span><span id="toMaybe"><span class="annot"><span class="annottext">toMaybe :: KDTree d p r -&gt; Maybe (KDTree' d p r)
</span><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-var hs-var">toMaybe</span></a></span></span><span> </span><span class="annot"><span class="annottext">KDTree d p r
</span><a href="Geometry.KDTree.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (KDTree' d p r)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-var">toMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span> </span><span id="local-6989586621680032415"><span class="annot"><span class="annottext">KDTree' d p r
</span><a href="#local-6989586621680032415"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KDTree' d p r -&gt; Maybe (KDTree' d p r)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">KDTree' d p r
</span><a href="#local-6989586621680032415"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Expects the input to be a set, i.e. no duplicates</span><span>
</span><span id="line-92"></span><span class="hs-comment">--</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- running time: \(O(n \log n)\)</span><span>
</span><span id="line-94"></span><span id="local-6989586621680032412"><span id="local-6989586621680032413"><span id="local-6989586621680032414"><span class="annot"><a href="Geometry.KDTree.html#buildKDTree"><span class="hs-identifier hs-type">buildKDTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032414"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680032414"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032413"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032414"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032413"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032412"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032414"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032412"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032413"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-96"></span><span id="buildKDTree"><span class="annot"><span class="annottext">buildKDTree :: [Point d r :+ p] -&gt; KDTree d p r
</span><a href="Geometry.KDTree.html#buildKDTree"><span class="hs-identifier hs-var hs-var">buildKDTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KDTree d p r
-&gt; (NonEmpty (Point d r :+ p) -&gt; KDTree d p r)
-&gt; Maybe (NonEmpty (Point d r :+ p))
-&gt; KDTree d p r
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">KDTree d p r
forall (d :: Nat) p r. KDTree d p r
</span><a href="Geometry.KDTree.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KDTree' d p r -&gt; KDTree d p r
forall (d :: Nat) p r. KDTree' d p r -&gt; KDTree d p r
</span><a href="Geometry.KDTree.html#Tree"><span class="hs-identifier hs-var">Tree</span></a></span><span> </span><span class="annot"><span class="annottext">(KDTree' d p r -&gt; KDTree d p r)
-&gt; (NonEmpty (Point d r :+ p) -&gt; KDTree' d p r)
-&gt; NonEmpty (Point d r :+ p)
-&gt; KDTree d p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Point d r :+ p) -&gt; KDTree' d p r
forall (d :: Nat) r p.
(Arity d, 1 &lt;= d, Ord r) =&gt;
NonEmpty (Point d r :+ p) -&gt; KDTree' d p r
</span><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier hs-var">buildKDTree'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty (Point d r :+ p)) -&gt; KDTree d p r)
-&gt; ([Point d r :+ p] -&gt; Maybe (NonEmpty (Point d r :+ p)))
-&gt; [Point d r :+ p]
-&gt; KDTree d p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p] -&gt; Maybe (NonEmpty (Point d r :+ p))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">NonEmpty.nonEmpty</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621680032720"><span id="local-6989586621680032721"><span id="local-6989586621680032723"><span class="annot"><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier hs-type">buildKDTree'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032723"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680032723"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032721"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032723"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032720"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032723"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032720"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032721"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-100"></span><span id="buildKDTree%27"><span class="annot"><span class="annottext">buildKDTree' :: NonEmpty (Point d r :+ p) -&gt; KDTree' d p r
</span><a href="Geometry.KDTree.html#buildKDTree%27"><span class="hs-identifier hs-var hs-var">buildKDTree'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; KDTree' d p r
forall (d :: Nat) p r.
BinLeafTree (Split d r) (Point d r :+ p) -&gt; KDTree' d p r
</span><a href="Geometry.KDTree.html#KDT"><span class="hs-identifier hs-var">KDT</span></a></span><span> </span><span class="annot"><span class="annottext">(BinLeafTree (Split d r) (Point d r :+ p) -&gt; KDTree' d p r)
-&gt; (NonEmpty (Point d r :+ p)
    -&gt; BinLeafTree (Split d r) (Point d r :+ p))
-&gt; NonEmpty (Point d r :+ p)
-&gt; KDTree' d p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (SP (Coord d) r) (Point d r :+ p)
-&gt; BinLeafTree (Split d r) (Point d r :+ p)
forall core extra.
(ImplicitPeano (Peano (Dimension core)),
 ArityPeano (Peano (FromPeano (Peano (Dimension core)))),
 KnownNat (FromPeano (Peano (Dimension core))),
 KnownNat (Dimension core), IsBoxable core, Ord (NumType core),
 Peano (FromPeano (Peano (Dimension core)) + 1)
 ~ 'S (Peano (FromPeano (Peano (Dimension core))))) =&gt;
BinLeafTree
  (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
-&gt; BinLeafTree
     (Split (Dimension core) (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032409"><span class="hs-identifier hs-var">addBoxes</span></a></span><span> </span><span class="annot"><span class="annottext">(BinLeafTree (SP (Coord d) r) (Point d r :+ p)
 -&gt; BinLeafTree (Split d r) (Point d r :+ p))
-&gt; (NonEmpty (Point d r :+ p)
    -&gt; BinLeafTree (SP (Coord d) r) (Point d r :+ p))
-&gt; NonEmpty (Point d r :+ p)
-&gt; BinLeafTree (Split d r) (Point d r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (SP (Coord d) r) (Point d r :+ p)
forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Coord d
forall (d :: Nat). Int -&gt; Coord d
</span><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-var">Coord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PointSet (LSeq 1) d p r
 -&gt; BinLeafTree (SP (Coord d) r) (Point d r :+ p))
-&gt; (NonEmpty (Point d r :+ p) -&gt; PointSet (LSeq 1) d p r)
-&gt; NonEmpty (Point d r :+ p)
-&gt; BinLeafTree (SP (Coord d) r) (Point d r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LSeq 1 (Point d r :+ p) -&gt; PointSet (LSeq 1) d p r
forall (d :: Nat) r (n :: Nat) p.
(Arity d, Ord r) =&gt;
LSeq n (Point d r :+ p) -&gt; PointSet (LSeq n) d p r
</span><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier hs-var">toPointSet</span></a></span><span> </span><span class="annot"><span class="annottext">(LSeq 1 (Point d r :+ p) -&gt; PointSet (LSeq 1) d p r)
-&gt; (NonEmpty (Point d r :+ p) -&gt; LSeq 1 (Point d r :+ p))
-&gt; NonEmpty (Point d r :+ p)
-&gt; PointSet (LSeq 1) d p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Point d r :+ p) -&gt; LSeq 1 (Point d r :+ p)
forall a. NonEmpty a -&gt; LSeq 1 a
</span><span class="hs-identifier hs-var">LSeq.fromNonEmpty</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">where</span><span>     </span><span class="hs-comment">-- compute one tree with bounding boxes, then merge them together</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621680032409"><span class="annot"><span class="annottext">addBoxes :: BinLeafTree
  (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
-&gt; BinLeafTree
     (Split (Dimension core) (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032409"><span class="hs-identifier hs-var hs-var">addBoxes</span></a></span></span><span> </span><span id="local-6989586621680032406"><span class="annot"><span class="annottext">BinLeafTree
  (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032406"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680032405"><span class="annot"><span class="annottext">bbt :: BinLeafTree
  (Box (Dimension core) () (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032405"><span class="hs-identifier hs-var hs-var">bbt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Box (Dimension core) () (NumType core)
 -&gt; SP (Coord (Dimension core)) (NumType core)
 -&gt; Box (Dimension core) () (NumType core)
 -&gt; Box (Dimension core) () (NumType core))
-&gt; ((core :+ extra) -&gt; Box (Dimension core) () (NumType core))
-&gt; BinLeafTree
     (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
-&gt; BinLeafTree
     (Box (Dimension core) () (NumType core)) (core :+ extra)
forall w v a.
(w -&gt; v -&gt; w -&gt; w)
-&gt; (a -&gt; w) -&gt; BinLeafTree v a -&gt; BinLeafTree w a
</span><span class="hs-identifier hs-var">foldUpData</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680032403"><span class="annot"><span class="annottext">Box (Dimension core) () (NumType core)
</span><a href="#local-6989586621680032403"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">SP (Coord (Dimension core)) (NumType core)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680032402"><span class="annot"><span class="annottext">Box (Dimension core) () (NumType core)
</span><a href="#local-6989586621680032402"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Box (Dimension core) () (NumType core)]
-&gt; Box
     (Dimension (Box (Dimension core) () (NumType core)))
     ()
     (NumType (Box (Dimension core) () (NumType core)))
forall g (c :: * -&gt; *).
(IsBoxable g, Foldable c, Ord (NumType g), Arity (Dimension g)) =&gt;
c g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBoxList%27"><span class="hs-identifier hs-var">boundingBoxList'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Box (Dimension core) () (NumType core)
</span><a href="#local-6989586621680032403"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Box (Dimension core) () (NumType core)
</span><a href="#local-6989586621680032402"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">core -&gt; Box (Dimension core) () (NumType core)
forall g.
(IsBoxable g, Ord (NumType g)) =&gt;
g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBox"><span class="hs-identifier hs-var">boundingBox</span></a></span><span> </span><span class="annot"><span class="annottext">(core -&gt; Box (Dimension core) () (NumType core))
-&gt; ((core :+ extra) -&gt; core)
-&gt; (core :+ extra)
-&gt; Box (Dimension core) () (NumType core)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(core :+ extra) -&gt; Getting core (core :+ extra) core -&gt; core
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting core (core :+ extra) core
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BinLeafTree
  (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032406"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-104"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(SP (Coord (Dimension core)) (NumType core)
 -&gt; Box (Dimension core) () (NumType core)
 -&gt; Split (Dimension core) (NumType core))
-&gt; ((core :+ extra) -&gt; (core :+ extra) -&gt; core :+ extra)
-&gt; BinLeafTree
     (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
-&gt; BinLeafTree
     (Box (Dimension core) () (NumType core)) (core :+ extra)
-&gt; BinLeafTree
     (Split (Dimension core) (NumType core)) (core :+ extra)
forall u v w a b c.
(u -&gt; v -&gt; w)
-&gt; (a -&gt; b -&gt; c)
-&gt; BinLeafTree u a
-&gt; BinLeafTree v b
-&gt; BinLeafTree w c
</span><span class="hs-identifier hs-var">zipExactWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SP</span></span><span> </span><span id="local-6989586621680032395"><span class="annot"><span class="annottext">Coord (Dimension core)
</span><a href="#local-6989586621680032395"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680032394"><span class="annot"><span class="annottext">NumType core
</span><a href="#local-6989586621680032394"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680032393"><span class="annot"><span class="annottext">Box (Dimension core) () (NumType core)
</span><a href="#local-6989586621680032393"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coord (Dimension core)
-&gt; NumType core
-&gt; Box (Dimension core) () (NumType core)
-&gt; Split (Dimension core) (NumType core)
forall (d :: Nat) r. Coord d -&gt; r -&gt; Box d () r -&gt; Split d r
</span><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-var">Split</span></a></span><span> </span><span class="annot"><span class="annottext">Coord (Dimension core)
</span><a href="#local-6989586621680032395"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">NumType core
</span><a href="#local-6989586621680032394"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Box (Dimension core) () (NumType core)
</span><a href="#local-6989586621680032393"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(core :+ extra) -&gt; (core :+ extra) -&gt; core :+ extra
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree
  (SP (Coord (Dimension core)) (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032406"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree
  (Box (Dimension core) () (NumType core)) (core :+ extra)
</span><a href="#local-6989586621680032405"><span class="hs-identifier hs-var">bbt</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Nub by sorting first</span><span>
</span><span id="line-108"></span><span id="local-6989586621680032391"><span class="annot"><a href="Geometry.KDTree.html#ordNub"><span class="hs-identifier hs-type">ordNub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032391"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680032391"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680032391"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-109"></span><span id="ordNub"><span class="annot"><span class="annottext">ordNub :: NonEmpty a -&gt; NonEmpty a
</span><a href="Geometry.KDTree.html#ordNub"><span class="hs-identifier hs-var hs-var">ordNub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty a -&gt; a) -&gt; NonEmpty (NonEmpty a) -&gt; NonEmpty a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; a
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">NonEmpty.head</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (NonEmpty a) -&gt; NonEmpty a)
-&gt; (NonEmpty a -&gt; NonEmpty (NonEmpty a))
-&gt; NonEmpty a
-&gt; NonEmpty a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; NonEmpty (NonEmpty a)
forall a. Eq a =&gt; NonEmpty a -&gt; NonEmpty (NonEmpty a)
</span><span class="hs-identifier hs-var">NonEmpty.group1</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty a -&gt; NonEmpty (NonEmpty a))
-&gt; (NonEmpty a -&gt; NonEmpty a)
-&gt; NonEmpty a
-&gt; NonEmpty (NonEmpty a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; NonEmpty a
forall a. Ord a =&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NonEmpty.sort</span></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span id="local-6989586621680032691"><span id="local-6989586621680032692"><span id="local-6989586621680032693"><span id="local-6989586621680032694"><span class="annot"><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier hs-type">toPointSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032694"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032693"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032692"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032694"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032693"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032691"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><a href="#local-6989586621680032692"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032694"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032691"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032693"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-115"></span><span id="toPointSet"><span class="annot"><span class="annottext">toPointSet :: LSeq n (Point d r :+ p) -&gt; PointSet (LSeq n) d p r
</span><a href="Geometry.KDTree.html#toPointSet"><span class="hs-identifier hs-var hs-var">toPointSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LSeq n (Point d r :+ p) -&gt; LSeq n (Point d r :+ p))
-&gt; PointSet (LSeq n) d p r -&gt; PointSet (LSeq n) d p r
forall (v :: * -&gt; *) a b.
(Vector v a, Vector v b) =&gt;
(Int -&gt; a -&gt; b) -&gt; v a -&gt; v b
</span><span class="hs-identifier hs-var">FV.imap</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; LSeq n (Point d r :+ p) -&gt; LSeq n (Point d r :+ p)
forall (d :: Nat) r (n :: Nat) e.
(ImplicitPeano (Peano d), Ord r,
 ArityPeano (Peano (FromPeano (Peano d))),
 KnownNat (FromPeano (Peano d)), KnownNat d,
 Peano (FromPeano (Peano d) + 1)
 ~ 'S (Peano (FromPeano (Peano d)))) =&gt;
Int -&gt; LSeq n (Point d r :+ e) -&gt; LSeq n (Point d r :+ e)
</span><a href="#local-6989586621680032385"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">(PointSet (LSeq n) d p r -&gt; PointSet (LSeq n) d p r)
-&gt; (LSeq n (Point d r :+ p) -&gt; PointSet (LSeq n) d p r)
-&gt; LSeq n (Point d r :+ p)
-&gt; PointSet (LSeq n) d p r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LSeq n (Point d r :+ p) -&gt; PointSet (LSeq n) d p r
forall (v :: * -&gt; *) a. Vector v a =&gt; a -&gt; v a
</span><span class="hs-identifier hs-var">FV.replicate</span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621680032385"><span class="annot"><span class="annottext">sort :: Int -&gt; LSeq n (Point d r :+ e) -&gt; LSeq n (Point d r :+ e)
</span><a href="#local-6989586621680032385"><span class="hs-identifier hs-var hs-var">sort</span></a></span></span><span> </span><span id="local-6989586621680032383"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032383"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering)
-&gt; LSeq n (Point d r :+ e) -&gt; LSeq n (Point d r :+ e)
forall a (n :: Nat). (a -&gt; a -&gt; Ordering) -&gt; LSeq n a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.unstableSortBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
forall r (d :: Nat) e.
(Ord r, Arity d) =&gt;
Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
</span><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-var">compareOn</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering)
-&gt; Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032383"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621680032640"><span id="local-6989586621680032641"><span id="local-6989586621680032642"><span class="annot"><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-type">compareOn</span></a></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032642"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032641"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032641"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032642"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032640"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032641"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032642"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032640"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span></span></span><span>
</span><span id="line-122"></span><span id="compareOn"><span class="annot"><span class="annottext">compareOn :: Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
</span><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-var hs-var">compareOn</span></a></span></span><span> </span><span id="local-6989586621680032380"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032380"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680032379"><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680032379"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680032378"><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680032378"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680032377"><span class="annot"><span class="annottext">f :: (Point d r :+ e) -&gt; r
</span><a href="#local-6989586621680032377"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point d r :+ e) -&gt; Getting r (Point d r :+ e) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(Point d r -&gt; Const r (Point d r))
-&gt; (Point d r :+ e) -&gt; Const r (Point d r :+ e)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point d r -&gt; Const r (Point d r))
 -&gt; (Point d r :+ e) -&gt; Const r (Point d r :+ e))
-&gt; ((r -&gt; Const r r) -&gt; Point d r -&gt; Const r (Point d r))
-&gt; Getting r (Point d r :+ e) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Int -&gt; Lens' (Point d r) r
forall (d :: Nat) (p :: Nat -&gt; * -&gt; *) r.
(Arity d, AsAPoint p) =&gt;
Int -&gt; Lens' (p d r) r
</span><a href="Geometry.Point.Class.html#unsafeCoord"><span class="hs-identifier hs-var">unsafeCoord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032380"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point d r :+ e) -&gt; r
</span><a href="#local-6989586621680032377"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680032379"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680032379"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">(Point d r :+ e)
-&gt; Getting (Point d r) (Point d r :+ e) (Point d r) -&gt; Point d r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point d r) (Point d r :+ e) (Point d r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(r, Point d r) -&gt; (r, Point d r) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Point d r :+ e) -&gt; r
</span><a href="#local-6989586621680032377"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680032378"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Point d r :+ e
</span><a href="#local-6989586621680032378"><span class="hs-identifier hs-var">q</span></a></span><span class="annot"><span class="annottext">(Point d r :+ e)
-&gt; Getting (Point d r) (Point d r :+ e) (Point d r) -&gt; Point d r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point d r) (Point d r :+ e) (Point d r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Constructs the tree</span><span>
</span><span id="line-127"></span><span id="local-6989586621680032696"><span id="local-6989586621680032697"><span id="local-6989586621680032698"><span class="annot"><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-type">build</span></a></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680032698"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032698"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032697"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032698"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-129"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032698"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032696"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032697"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-130"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BinLeafTree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split%27"><span class="hs-identifier hs-type">Split'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032698"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032697"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032698"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032697"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032696"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-131"></span><span id="build"><span class="annot"><span class="annottext">build :: Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var hs-var">build</span></a></span></span><span> </span><span id="local-6989586621680032374"><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680032374"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680032373"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032373"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
forall (d :: Nat) p r.
(1 &lt;= d, Arity d) =&gt;
PointSet (LSeq 1) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
</span><a href="Geometry.KDTree.html#asSingleton"><span class="hs-identifier hs-var">asSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032373"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680032371"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032371"><span class="hs-identifier hs-var">p</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Point d r :+ p) -&gt; BinLeafTree (Split' d r) (Point d r :+ p)
forall v a. a -&gt; BinLeafTree v a
</span><span class="hs-identifier hs-var">Leaf</span></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032371"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680032369"><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680032369"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680032368"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032368"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680032367"><span class="annot"><span class="annottext">Split' d r
</span><a href="#local-6989586621680032367"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680032366"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032366"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coord d
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, Split' d r, PointSet (LSeq 1) d p r)
forall (d :: Nat) r p.
(Arity d, KnownNat d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, Split' d r, PointSet (LSeq 1) d p r)
</span><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier hs-var">splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680032374"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680032369"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-134"></span><span>                     </span><span id="local-6989586621680032365"><span class="annot"><span class="annottext">j :: Coord d
</span><a href="#local-6989586621680032365"><span class="hs-identifier hs-var hs-var">j</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coord d -&gt; Coord d
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680032374"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-135"></span><span>                   </span><span class="hs-comment">-- the pattern match proves tha tthe seq has &gt;= 2 elements</span><span>
</span><span id="line-136"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split' d r) (Point d r :+ p)
-&gt; Split' d r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
forall v a.
BinLeafTree v a -&gt; v -&gt; BinLeafTree v a -&gt; BinLeafTree v a
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680032365"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032368"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Split' d r
</span><a href="#local-6989586621680032367"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
forall (d :: Nat) r p.
(1 &lt;= d, Arity d, Ord r) =&gt;
Coord d
-&gt; PointSet (LSeq 1) d p r
-&gt; BinLeafTree (Split' d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#build"><span class="hs-identifier hs-var">build</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680032365"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032366"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621680032360"><span id="local-6989586621680032361"><span id="local-6989586621680032362"><span class="annot"><a href="Geometry.KDTree.html#reportSubTree"><span class="hs-identifier hs-type">reportSubTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032362"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032361"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032360"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032362"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032360"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032361"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-142"></span><span id="reportSubTree"><span class="annot"><span class="annottext">reportSubTree :: KDTree' d p r -&gt; NonEmpty (Point d r :+ p)
</span><a href="Geometry.KDTree.html#reportSubTree"><span class="hs-identifier hs-var hs-var">reportSubTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p] -&gt; NonEmpty (Point d r :+ p)
forall a. [a] -&gt; NonEmpty a
</span><span class="hs-identifier hs-var">NonEmpty.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Point d r :+ p] -&gt; NonEmpty (Point d r :+ p))
-&gt; (KDTree' d p r -&gt; [Point d r :+ p])
-&gt; KDTree' d p r
-&gt; NonEmpty (Point d r :+ p)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">(BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p])
-&gt; (KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p))
-&gt; KDTree' d p r
-&gt; [Point d r :+ p]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
forall (d :: Nat) p r.
KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#unKDT"><span class="hs-identifier hs-var hs-var">unKDT</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- | Searches in a KDTree</span><span>
</span><span id="line-145"></span><span class="hs-comment">--</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- running time: \(O(n^{(d-1)/d} + k)\)</span><span>
</span><span id="line-147"></span><span id="local-6989586621680032354"><span id="local-6989586621680032355"><span id="local-6989586621680032356"><span id="local-6989586621680032357"><span class="annot"><a href="Geometry.KDTree.html#searchKDTree"><span class="hs-identifier hs-type">searchKDTree</span></a></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032357"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032356"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032357"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032355"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032356"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree"><span class="hs-identifier hs-type">KDTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032357"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032354"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032356"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032357"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032356"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032354"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-149"></span><span id="searchKDTree"><span class="annot"><span class="annottext">searchKDTree :: Box d q r -&gt; KDTree d p r -&gt; [Point d r :+ p]
</span><a href="Geometry.KDTree.html#searchKDTree"><span class="hs-identifier hs-var hs-var">searchKDTree</span></a></span></span><span> </span><span id="local-6989586621680032353"><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032353"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p]
-&gt; (KDTree' d p r -&gt; [Point d r :+ p])
-&gt; Maybe (KDTree' d p r)
-&gt; [Point d r :+ p]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Box d q r -&gt; KDTree' d p r -&gt; [Point d r :+ p]
forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; KDTree' d p r -&gt; [Point d r :+ p]
</span><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier hs-var">searchKDTree'</span></a></span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032353"><span class="hs-identifier hs-var">qr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (KDTree' d p r) -&gt; [Point d r :+ p])
-&gt; (KDTree d p r -&gt; Maybe (KDTree' d p r))
-&gt; KDTree d p r
-&gt; [Point d r :+ p]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KDTree d p r -&gt; Maybe (KDTree' d p r)
forall (d :: Nat) p r. KDTree d p r -&gt; Maybe (KDTree' d p r)
</span><a href="Geometry.KDTree.html#toMaybe"><span class="hs-identifier hs-var">toMaybe</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span id="local-6989586621680032605"><span id="local-6989586621680032606"><span id="local-6989586621680032607"><span id="local-6989586621680032608"><span class="annot"><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier hs-type">searchKDTree'</span></a></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032608"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032607"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032608"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032606"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032607"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#KDTree%27"><span class="hs-identifier hs-type">KDTree'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032608"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032605"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032607"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032608"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032607"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032605"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-153"></span><span id="searchKDTree%27"><span class="annot"><span class="annottext">searchKDTree' :: Box d q r -&gt; KDTree' d p r -&gt; [Point d r :+ p]
</span><a href="Geometry.KDTree.html#searchKDTree%27"><span class="hs-identifier hs-var hs-var">searchKDTree'</span></a></span></span><span> </span><span id="local-6989586621680032352"><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032352"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680032351"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span class="annot"><span class="annottext">(BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p])
-&gt; (KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p))
-&gt; KDTree' d p r
-&gt; [Point d r :+ p]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
forall (d :: Nat) p r.
KDTree' d p r -&gt; BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="Geometry.KDTree.html#unKDT"><span class="hs-identifier hs-var hs-var">unKDT</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621680032351"><span class="annot"><span class="annottext">search :: BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680032351"><span class="hs-identifier hs-var hs-var">search</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Leaf</span></span><span> </span><span id="local-6989586621680032350"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032350"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032350"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">(Point d r :+ p)
-&gt; Getting (Point d r) (Point d r :+ p) (Point d r) -&gt; Point d r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point d r) (Point d r :+ p) (Point d r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point d r -&gt; Box d q r -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032352"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032350"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="#local-6989586621680032351"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span id="local-6989586621680032348"><span class="annot"><span class="annottext">t :: BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032348"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span id="local-6989586621680032347"><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032347"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680032346"><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680032346"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680032345"><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032345"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680032346"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Box d () r -&gt; Box d q r -&gt; Bool
forall (d :: Nat) r q p.
(Arity d, Ord r) =&gt;
Box d q r -&gt; Box d p r -&gt; Bool
</span><a href="Geometry.KDTree.html#containedIn"><span class="hs-operator hs-var">`containedIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032352"><span class="hs-identifier hs-var">qr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032348"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p]
</span><a href="#local-6989586621680032343"><span class="hs-identifier hs-var">l'</span></a></span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p] -&gt; [Point d r :+ p] -&gt; [Point d r :+ p]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Point d r :+ p]
</span><a href="#local-6989586621680032342"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>        </span><span id="local-6989586621680032343"><span class="annot"><span class="annottext">l' :: [Point d r :+ p]
</span><a href="#local-6989586621680032343"><span class="hs-identifier hs-var hs-var">l'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032352"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">Box d q r -&gt; Box d () r -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
forall (d :: Nat) r p.
(Arity d, Ord r) =&gt;
BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
</span><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var">boxOf</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032347"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680032351"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032347"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621680032342"><span class="annot"><span class="annottext">r' :: [Point d r :+ p]
</span><a href="#local-6989586621680032342"><span class="hs-identifier hs-var hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Box d q r
</span><a href="#local-6989586621680032352"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="annot"><span class="annottext">Box d q r -&gt; Box d () r -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
forall (d :: Nat) r p.
(Arity d, Ord r) =&gt;
BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
</span><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var">boxOf</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032345"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p) -&gt; [Point d r :+ p]
</span><a href="#local-6989586621680032351"><span class="hs-identifier hs-var">search</span></a></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><a href="#local-6989586621680032345"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="local-6989586621680032587"><span id="local-6989586621680032588"><span id="local-6989586621680032589"><span class="annot"><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-type">boxOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032589"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032588"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BinLeafTree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032589"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032588"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032589"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032588"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032587"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032589"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032588"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-167"></span><span id="boxOf"><span class="annot"><span class="annottext">boxOf :: BinLeafTree (Split d r) (Point d r :+ p) -&gt; Box d () r
</span><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var hs-var">boxOf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Leaf</span></span><span> </span><span id="local-6989586621680032340"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032340"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point d r -&gt; Box (Dimension (Point d r)) () (NumType (Point d r))
forall g.
(IsBoxable g, Ord (NumType g)) =&gt;
g -&gt; Box (Dimension g) () (NumType g)
</span><a href="Geometry.Box.Internal.html#boundingBox"><span class="hs-identifier hs-var">boundingBox</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032340"><span class="hs-identifier hs-var">p</span></a></span><span class="annot"><span class="annottext">(Point d r :+ p)
-&gt; Getting (Point d r) (Point d r :+ p) (Point d r) -&gt; Point d r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">Getting (Point d r) (Point d r :+ p) (Point d r)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="annot"><a href="Geometry.KDTree.html#boxOf"><span class="hs-identifier hs-var">boxOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680032339"><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680032339"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BinLeafTree (Split d r) (Point d r :+ p)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Box d () r
</span><a href="#local-6989586621680032339"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621680032591"><span id="local-6989586621680032592"><span id="local-6989586621680032593"><span id="local-6989586621680032594"><span class="annot"><a href="Geometry.KDTree.html#containedIn"><span class="hs-identifier hs-type">containedIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032594"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032593"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032594"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032592"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032593"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032594"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032591"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032593"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span></span><span>
</span><span id="line-171"></span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Box.Internal.html#Box"><span class="hs-identifier hs-type">Box</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680032337"><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680032337"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">q
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680032335"><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680032335"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><span class="annottext">q
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="containedIn"><span class="annot"><span class="annottext">containedIn :: Box d q r -&gt; Box d p r -&gt; Bool
</span><a href="Geometry.KDTree.html#containedIn"><span class="hs-operator hs-var hs-var">`containedIn`</span></a></span></span><span> </span><span id="local-6989586621680032334"><span class="annot"><span class="annottext">Box d p r
</span><a href="#local-6989586621680032334"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Point d r -&gt; Bool) -&gt; [Point d r] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r -&gt; Box d p r -&gt; Bool
forall g h. HasIntersectionWith g h =&gt; g -&gt; h -&gt; Bool
</span><span class="hs-operator hs-var">`intersects`</span></span><span> </span><span class="annot"><span class="annottext">Box d p r
</span><a href="#local-6989586621680032334"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680032337"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point d r
</span><a href="#local-6989586621680032335"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-keyword">type</span><span> </span><span id="PointSet"><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-var">PointSet</span></a></span></span><span> </span><span id="local-6989586621680032332"><span class="annot"><a href="#local-6989586621680032332"><span class="hs-identifier hs-type">seq</span></a></span></span><span> </span><span id="local-6989586621680032331"><span class="annot"><a href="#local-6989586621680032331"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span id="local-6989586621680032330"><span class="annot"><a href="#local-6989586621680032330"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621680032329"><span class="annot"><a href="#local-6989586621680032329"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Vector"><span class="hs-identifier hs-type">Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032331"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680032332"><span class="hs-identifier hs-type">seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032331"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032329"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032330"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | running time: \(O(n)\)</span><span>
</span><span id="line-179"></span><span id="local-6989586621680032619"><span id="local-6989586621680032620"><span id="local-6989586621680032621"><span class="annot"><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier hs-type">splitOn</span></a></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680032620"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-181"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032619"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032620"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-182"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032619"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032620"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-183"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#Split%27"><span class="hs-identifier hs-type">Split'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032620"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-184"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032621"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032619"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032620"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-185"></span><span id="splitOn"><span class="annot"><span class="annottext">splitOn :: Coord d
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, Split' d r, PointSet (LSeq 1) d p r)
</span><a href="Geometry.KDTree.html#splitOn"><span class="hs-identifier hs-var hs-var">splitOn</span></a></span></span><span> </span><span id="local-6989586621680032328"><span class="annot"><span class="annottext">c :: Coord d
</span><a href="#local-6989586621680032328"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#Coord"><span class="hs-identifier hs-type">Coord</span></a></span><span> </span><span id="local-6989586621680032327"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032327"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680032326"><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680032326"><span class="hs-identifier hs-var">pts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032325"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coord d -&gt; r -&gt; Split' d r
forall a b. a -&gt; b -&gt; SP a b
</span><span class="hs-identifier hs-var">SP</span></span><span> </span><span class="annot"><span class="annottext">Coord d
</span><a href="#local-6989586621680032328"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032324"><span class="hs-identifier hs-var">m</span></a></span><span class="annot"><span class="annottext">(Point d r :+ p) -&gt; Getting r (Point d r :+ p) r -&gt; r
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">(Point d r -&gt; Const r (Point d r))
-&gt; (Point d r :+ p) -&gt; Const r (Point d r :+ p)
forall core extra core'.
Lens (core :+ extra) (core' :+ extra) core core'
</span><span class="hs-identifier hs-var">core</span></span><span class="annot"><span class="annottext">((Point d r -&gt; Const r (Point d r))
 -&gt; (Point d r :+ p) -&gt; Const r (Point d r :+ p))
-&gt; ((r -&gt; Const r r) -&gt; Point d r -&gt; Const r (Point d r))
-&gt; Getting r (Point d r :+ p) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Int -&gt; Lens' (Point d r) r
forall (d :: Nat) (p :: Nat -&gt; * -&gt; *) r.
(Arity d, AsAPoint p) =&gt;
Int -&gt; Lens' (p d r) r
</span><a href="Geometry.Point.Class.html#unsafeCoord"><span class="hs-identifier hs-var">unsafeCoord</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032327"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032323"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- i = traceShow (c,j) j</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621680032324"><span class="annot"><span class="annottext">m :: Point d r :+ p
</span><a href="#local-6989586621680032324"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680032322"><span class="annot"><span class="annottext">xs :: LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680032322"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680032326"><span class="hs-identifier hs-var">pts</span></a></span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
-&gt; Getting
     (Endo (LSeq 2 (Point d r :+ p)))
     (PointSet (LSeq 2) d p r)
     (LSeq 2 (Point d r :+ p))
-&gt; LSeq 2 (Point d r :+ p)
forall s a. HasCallStack =&gt; s -&gt; Getting (Endo a) s a -&gt; a
</span><span class="hs-operator hs-var">^?!</span></span><span class="annot"><span class="annottext">Int
-&gt; Traversal' (PointSet (LSeq 2) d p r) (LSeq 2 (Point d r :+ p))
forall (d :: Nat) r. Arity d =&gt; Int -&gt; Traversal' (Vector d r) r
</span><a href="Geometry.Vector.VectorFamily.html#element%27"><span class="hs-identifier hs-var">element'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032327"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680032322"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p) -&gt; Int -&gt; Point d r :+ p
forall (n :: Nat) a. LSeq n a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`LSeq.index`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p) -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">F.length</span></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
</span><a href="#local-6989586621680032322"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- Since the input seq has &gt;= 2 elems, F.length xs / 2 &gt;= 1. It follows</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- that the both sets thus have at least one elemnt.</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- f :: LSeq 2 _ -&gt; (LSeq 1 _, LSeq 1 _)</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621680032316"><span class="annot"><span class="annottext">f :: LSeq 2 (Point d r :+ p)
-&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680032316"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LSeq 0 (Point d r :+ p) -&gt; LSeq 1 (Point d r :+ p))
-&gt; (LSeq 0 (Point d r :+ p) -&gt; LSeq 1 (Point d r :+ p))
-&gt; (LSeq 0 (Point d r :+ p), LSeq 0 (Point d r :+ p))
-&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p) -&gt; LSeq 1 (Point d r :+ p)
forall (n :: Nat) (m :: Nat) a. LSeq m a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.promise</span></span><span> </span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p) -&gt; LSeq 1 (Point d r :+ p)
forall (n :: Nat) (m :: Nat) a. LSeq m a -&gt; LSeq n a
</span><span class="hs-identifier hs-var">LSeq.promise</span></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">((LSeq 0 (Point d r :+ p), LSeq 0 (Point d r :+ p))
 -&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p)))
-&gt; (LSeq 2 (Point d r :+ p)
    -&gt; (LSeq 0 (Point d r :+ p), LSeq 0 (Point d r :+ p)))
-&gt; LSeq 2 (Point d r :+ p)
-&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Point d r :+ p) -&gt; Bool)
-&gt; LSeq 2 (Point d r :+ p)
-&gt; (LSeq 0 (Point d r :+ p), LSeq 0 (Point d r :+ p))
forall a (n :: Nat).
(a -&gt; Bool) -&gt; LSeq n a -&gt; (LSeq 0 a, LSeq 0 a)
</span><span class="hs-identifier hs-var">LSeq.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680032312"><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032312"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Point d r :+ p) -&gt; (Point d r :+ p) -&gt; Ordering
forall r (d :: Nat) e.
(Ord r, Arity d) =&gt;
Int -&gt; (Point d r :+ e) -&gt; (Point d r :+ e) -&gt; Ordering
</span><a href="Geometry.KDTree.html#compareOn"><span class="hs-identifier hs-var">compareOn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680032327"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032312"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032324"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680032325"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032325"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680032323"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032323"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector d (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
-&gt; (PointSet (LSeq 1) d p r, PointSet (LSeq 1) d p r)
forall r r. Vector d (r, r) -&gt; (Vector d r, Vector d r)
</span><a href="#local-6989586621680032311"><span class="hs-identifier hs-var">unzip'</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector d (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
 -&gt; (PointSet (LSeq 1) d p r, PointSet (LSeq 1) d p r))
-&gt; (PointSet (LSeq 2) d p r
    -&gt; Vector d (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p)))
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, PointSet (LSeq 1) d p r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LSeq 2 (Point d r :+ p)
 -&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p)))
-&gt; PointSet (LSeq 2) d p r
-&gt; Vector d (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">LSeq 2 (Point d r :+ p)
-&gt; (LSeq 1 (Point d r :+ p), LSeq 1 (Point d r :+ p))
</span><a href="#local-6989586621680032316"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(PointSet (LSeq 2) d p r
 -&gt; (PointSet (LSeq 1) d p r, PointSet (LSeq 1) d p r))
-&gt; PointSet (LSeq 2) d p r
-&gt; (PointSet (LSeq 1) d p r, PointSet (LSeq 1) d p r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
</span><a href="#local-6989586621680032326"><span class="hs-identifier hs-var">pts</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">-- unzip' :: Vector d (a,b) -&gt; (Vector d a, Vector d b)</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621680032311"><span class="annot"><span class="annottext">unzip' :: Vector d (r, r) -&gt; (Vector d r, Vector d r)
</span><a href="#local-6989586621680032311"><span class="hs-identifier hs-var hs-var">unzip'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([r] -&gt; Vector d r)
-&gt; ([r] -&gt; Vector d r) -&gt; ([r], [r]) -&gt; (Vector d r, Vector d r)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">[r] -&gt; Vector d r
forall (d :: Nat) r. Arity d =&gt; [r] -&gt; Vector d r
</span><a href="Geometry.Vector.VectorFamily.html#vectorFromListUnsafe"><span class="hs-identifier hs-var">vectorFromListUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">[r] -&gt; Vector d r
forall (d :: Nat) r. Arity d =&gt; [r] -&gt; Vector d r
</span><a href="Geometry.Vector.VectorFamily.html#vectorFromListUnsafe"><span class="hs-identifier hs-var">vectorFromListUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">(([r], [r]) -&gt; (Vector d r, Vector d r))
-&gt; (Vector d (r, r) -&gt; ([r], [r]))
-&gt; Vector d (r, r)
-&gt; (Vector d r, Vector d r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(r, r)] -&gt; ([r], [r])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([(r, r)] -&gt; ([r], [r]))
-&gt; (Vector d (r, r) -&gt; [(r, r)]) -&gt; Vector d (r, r) -&gt; ([r], [r])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector d (r, r) -&gt; [(r, r)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">F.toList</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span id="local-6989586621680032624"><span id="local-6989586621680032625"><span id="local-6989586621680032626"><span class="annot"><a href="Geometry.KDTree.html#asSingleton"><span class="hs-identifier hs-type">asSingleton</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621680032626"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Geometry.Vector.VectorFamily.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032626"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032626"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032625"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032624"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-206"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.Point.Internal.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032626"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032624"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+</span></span><span> </span><span class="annot"><a href="#local-6989586621680032625"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Geometry.KDTree.html#PointSet"><span class="hs-identifier hs-type">PointSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LSeq</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680032626"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032625"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680032624"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-207"></span><span id="asSingleton"><span class="annot"><span class="annottext">asSingleton :: PointSet (LSeq 1) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
</span><a href="Geometry.KDTree.html#asSingleton"><span class="hs-identifier hs-var hs-var">asSingleton</span></a></span></span><span> </span><span id="local-6989586621680032308"><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032308"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032308"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
-&gt; Getting
     (LSeq 1 (Point d r :+ p))
     (PointSet (LSeq 1) d p r)
     (LSeq 1 (Point d r :+ p))
-&gt; LSeq 1 (Point d r :+ p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span class="annot"><span class="annottext">forall (d :: Nat) r.
(Arity d, KnownNat 0, (0 + 1) &lt;= d) =&gt;
Lens' (Vector d r) r
forall (i :: Nat) (d :: Nat) r.
(Arity d, KnownNat i, (i + 1) &lt;= d) =&gt;
Lens' (Vector d r) r
</span><a href="Geometry.Vector.VectorFamily.html#element"><span class="hs-identifier hs-var">element</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-208"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621680032306"><span class="annot"><a href="#local-6989586621680032306"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|</span></span><span> </span><span id="local-6989586621680032305"><span class="annot"><a href="#local-6989586621680032305"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">LSeq 0 (Point d r :+ p)
</span><a href="#local-6989586621680032305"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Point d r :+ p)
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Point d r :+ p
</span><a href="#local-6989586621680032306"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-comment">-- only one lement</span><span>
</span><span id="line-209"></span><span>                  </span><span class="annot"><span class="annottext">LSeq 1 (Point d r :+ p)
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 2) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(PointSet (LSeq 2) d p r
 -&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r))
-&gt; PointSet (LSeq 2) d p r
-&gt; Either (Point d r :+ p) (PointSet (LSeq 2) d p r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r -&gt; PointSet (LSeq 2) d p r
forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce</span></span><span> </span><span class="annot"><span class="annottext">PointSet (LSeq 1) d p r
</span><a href="#local-6989586621680032308"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-210"></span></pre></body></html>