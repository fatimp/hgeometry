<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html"><span class="hs-identifier">GHC.Tc.Solver.InertSet</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><span class="hs-comment">-- * The work list</span></span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier">WorkList</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#isEmptyWorkList"><span class="hs-identifier">isEmptyWorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyWorkList"><span class="hs-identifier">emptyWorkList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListNonEq"><span class="hs-identifier">extendWorkListNonEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCt"><span class="hs-identifier">extendWorkListCt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCts"><span class="hs-identifier">extendWorkListCts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCtList"><span class="hs-identifier">extendWorkListCtList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEq"><span class="hs-identifier">extendWorkListEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEqs"><span class="hs-identifier">extendWorkListEqs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#appendWorkList"><span class="hs-identifier">appendWorkList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListImplic"><span class="hs-identifier">extendWorkListImplic</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#workListSize"><span class="hs-identifier">workListSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#selectWorkItem"><span class="hs-identifier">selectWorkItem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- * The inert set</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier">InertSet</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier">InertCans</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyInert"><span class="hs-identifier">emptyInert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#noMatchableGivenDicts"><span class="hs-identifier">noMatchableGivenDicts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#noGivenNewtypeReprEqs"><span class="hs-identifier">noGivenNewtypeReprEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updGivenEqs"><span class="hs-identifier">updGivenEqs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#mightEqualLater"><span class="hs-identifier">mightEqualLater</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier">prohibitedSuperClassSolve</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Inert equalities</span></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier">InertEqs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier">foldTyEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delEq"><span class="hs-identifier">delEq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#findEq"><span class="hs-identifier">findEq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partitionInertEqs"><span class="hs-identifier">partitionInertEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partitionFunEqs"><span class="hs-identifier">partitionFunEqs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier">foldFunEqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addEqToCans"><span class="hs-identifier">addEqToCans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Inert Dicts</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updDicts"><span class="hs-identifier">updDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delDict"><span class="hs-identifier">delDict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addDict"><span class="hs-identifier">addDict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#filterDicts"><span class="hs-identifier">filterDicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partitionDicts"><span class="hs-identifier">partitionDicts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addSolvedDict"><span class="hs-identifier">addSolvedDict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Inert Irreds</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier">InertIrreds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delIrred"><span class="hs-identifier">delIrred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrreds"><span class="hs-identifier">addIrreds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrred"><span class="hs-identifier">addIrred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldIrreds"><span class="hs-identifier">foldIrreds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#findMatchingIrreds"><span class="hs-identifier">findMatchingIrreds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updIrreds"><span class="hs-identifier">updIrreds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrredToCans"><span class="hs-identifier">addIrredToCans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Kick-out</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KickOutSpec"><span class="hs-identifier">KickOutSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#kickOutRewritableLHS"><span class="hs-identifier">kickOutRewritableLHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Cycle breaker vars</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-identifier">CycleBreakerVarStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#pushCycleBreakerVarStack"><span class="hs-identifier">pushCycleBreakerVarStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addCycleBreakerBindings"><span class="hs-identifier">addCycleBreakerBindings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#forAllCycleBreakerBindings_"><span class="hs-identifier">forAllCycleBreakerBindings_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Solving one from another</span></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InteractResult"><span class="hs-identifier">InteractResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#solveOneFromTheOther"><span class="hs-identifier">solveOneFromTheOther</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html"><span class="hs-identifier">GHC.Tc.Solver.Types</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier">SwapFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html"><span class="hs-identifier">GHC.Core.TyCo.FVs</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rep</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier">Class</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier">classTyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html"><span class="hs-identifier">GHC.Core.Unify</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier">partitionWith</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#%3C%7C"><span class="hs-operator">(&lt;|)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.Function.html/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.html/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                            Worklists                                *
*  Canonical and non-canonical constraints that the simplifier has to  *
*  work on. Including their simplification depths.                     *
*                                                                      *
*                                                                      *
************************************************************************

Note [WorkList priorities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
A WorkList contains canonical and non-canonical items (of all flavours).
Notice that each Ct now has a simplification depth. We may
consider using this depth for prioritization as well in the future.

As a simple form of priority queue, our worklist separates out

* equalities (wl_eqs); see Note [Prioritise equalities]
* all the rest (wl_rest)

Note [Prioritise equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's very important to process equalities over class constraints:

* (Efficiency)  The general reason to do so is that if we process a
  class constraint first, we may end up putting it into the inert set
  and then kicking it out later.  That's extra work compared to just
  doing the equality first.

* (Avoiding fundep iteration) As #14723 showed, it's possible to
  get non-termination if we
      - Emit the fundep equalities for a class constraint,
        generating some fresh unification variables.
      - That leads to some unification
      - Which kicks out the class constraint
      - Which isn't solved (because there are still some more
        equalities in the work-list), but generates yet more fundeps
  Solution: prioritise equalities over class constraints

* (Class equalities) We need to prioritise equalities even if they
  are hidden inside a class constraint; see Note [Prioritise class equalities]

* (Kick-out) We want to apply this priority scheme to kicked-out
  constraints too (see the call to extendWorkListCt in kick_out_rewritable)
  E.g. a CIrredCan can be a hetero-kinded (t1 ~ t2), which may become
  homo-kinded when kicked out, and hence we want to prioritise it.

Among the equalities we prioritise ones with an empty rewriter set;
see Note [Wanteds rewrite Wanteds] in GHC.Tc.Types.Constraint, wrinkle (W1).


Note [Prioritise class equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We prioritise equalities in the solver (see selectWorkItem). But class
constraints like (a ~ b) and (a ~~ b) are actually equalities too;
see Note [The equality types story] in GHC.Builtin.Types.Prim.

Failing to prioritise these is inefficient (more kick-outs etc).
But, worse, it can prevent us spotting a &quot;recursive knot&quot; among
Wanted constraints.  See comment:10 of #12734 for a worked-out
example.

So we arrange to put these particular class constraints in the wl_eqs.

  NB: since we do not currently apply the substitution to the
  inert_solved_dicts, the knot-tying still seems a bit fragile.
  But this makes it better.

Note [Residual implications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The wl_implics in the WorkList are the residual implication
constraints that are generated while solving or canonicalising the
current worklist.  Specifically, when canonicalising
   (forall a. t1 ~ forall a. t2)
from which we get the implication
   (forall a. t1 ~ t2)
See GHC.Tc.Solver.Monad.deferTcSForAllEq

-}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- See Note [WorkList priorities]</span><span>
</span><span id="line-170"></span><span class="hs-keyword">data</span><span> </span><span id="WorkList"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-var">WorkList</span></a></span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="WL"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-var">WL</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="wl_eqs"><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var hs-var">wl_eqs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- CEqCan, CDictCan, CIrredCan</span><span>
</span><span id="line-172"></span><span>                             </span><span class="hs-comment">-- Given and Wanted</span><span>
</span><span id="line-173"></span><span>                       </span><span class="hs-comment">-- Contains both equality constraints and their</span><span>
</span><span id="line-174"></span><span>                       </span><span class="hs-comment">-- class-level variants (a~b) and (a~~b);</span><span>
</span><span id="line-175"></span><span>                       </span><span class="hs-comment">-- See Note [Prioritise equalities]</span><span>
</span><span id="line-176"></span><span>                       </span><span class="hs-comment">-- See Note [Prioritise class equalities]</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="wl_rw_eqs"><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var hs-var">wl_rw_eqs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Like wl_eqs, but ones that have a non-empty</span><span>
</span><span id="line-179"></span><span>                             </span><span class="hs-comment">-- rewriter set; or, more precisely, did when</span><span>
</span><span id="line-180"></span><span>                             </span><span class="hs-comment">-- added to the WorkList</span><span>
</span><span id="line-181"></span><span>         </span><span class="hs-comment">-- We prioritise wl_eqs over wl_rw_eqs;</span><span>
</span><span id="line-182"></span><span>         </span><span class="hs-comment">-- see Note [Prioritise Wanteds with empty RewriterSet]</span><span>
</span><span id="line-183"></span><span>         </span><span class="hs-comment">-- in GHC.Tc.Types.Constraint for more details.</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="wl_rest"><span class="annot"><span class="annottext">WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var hs-var">wl_rest</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="wl_implics"><span class="annot"><span class="annottext">WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var hs-var">wl_implics</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span>  </span><span class="hs-comment">-- See Note [Residual implications]</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#appendWorkList"><span class="hs-identifier hs-type">appendWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-191"></span><span id="appendWorkList"><span class="annot"><span class="annottext">appendWorkList :: WorkList -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#appendWorkList"><span class="hs-identifier hs-var hs-var">appendWorkList</span></a></span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547397"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547397"><span class="hs-identifier hs-var">eqs1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547398"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547398"><span class="hs-identifier hs-var">rw_eqs1</span></a></span></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547399"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547399"><span class="hs-identifier hs-var">rest1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547400"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547400"><span class="hs-identifier hs-var">implics1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547401"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547401"><span class="hs-identifier hs-var">eqs2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547402"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547402"><span class="hs-identifier hs-var">rw_eqs2</span></a></span></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547403"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547403"><span class="hs-identifier hs-var">rest2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547404"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547404"><span class="hs-identifier hs-var">implics2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547397"><span class="hs-identifier hs-var">eqs1</span></a></span><span>     </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547401"><span class="hs-identifier hs-var">eqs2</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547398"><span class="hs-identifier hs-var">rw_eqs1</span></a></span><span>  </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547402"><span class="hs-identifier hs-var">rw_eqs2</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547399"><span class="hs-identifier hs-var">rest1</span></a></span><span>    </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547403"><span class="hs-identifier hs-var">rest2</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547400"><span class="hs-identifier hs-var">implics1</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication -&gt; Bag Implication -&gt; Bag Implication
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span>   </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547404"><span class="hs-identifier hs-var">implics2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#workListSize"><span class="hs-identifier hs-type">workListSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-202"></span><span id="workListSize"><span class="annot"><span class="annottext">workListSize :: WorkList -&gt; ScDepth
</span><a href="GHC.Tc.Solver.InertSet.html#workListSize"><span class="hs-identifier hs-var hs-var">workListSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547406"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547406"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547407"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547407"><span class="hs-identifier hs-var">rw_eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547408"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547408"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; ScDepth
forall a. [a] -&gt; ScDepth
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ScDepth
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547406"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">ScDepth -&gt; ScDepth -&gt; ScDepth
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; ScDepth
forall a. [a] -&gt; ScDepth
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ScDepth
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547407"><span class="hs-identifier hs-var">rw_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">ScDepth -&gt; ScDepth -&gt; ScDepth
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; ScDepth
forall a. [a] -&gt; ScDepth
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ScDepth
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547408"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEq"><span class="hs-identifier hs-type">extendWorkListEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-206"></span><span id="extendWorkListEq"><span class="annot"><span class="annottext">extendWorkListEq :: RewriterSet -&gt; Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEq"><span class="hs-identifier hs-var hs-var">extendWorkListEq</span></a></span></span><span> </span><span id="local-6989586621682547411"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682547411"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682547412"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547412"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621682547413"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547413"><span class="hs-identifier hs-var">wl</span></a></span></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyRewriterSet"><span class="hs-identifier hs-var">isEmptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682547411"><span class="hs-identifier hs-var">rewriters</span></a></span><span>      </span><span class="hs-comment">-- A wanted that has not been rewritten</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- isEmptyRewriterSet: see Note [Prioritise Wanteds with empty RewriterSet]</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">--                         in GHC.Tc.Types.Constraint</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547413"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547412"><span class="hs-identifier hs-type">ct</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547413"><span class="hs-identifier hs-type">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547413"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547412"><span class="hs-identifier hs-type">ct</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547413"><span class="hs-identifier hs-type">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEqs"><span class="hs-identifier hs-type">extendWorkListEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- Add [eq1,...,eqn] to the work-list</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- They all have the same rewriter set</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- The constraints will be solved in left-to-right order:</span><span>
</span><span id="line-218"></span><span class="hs-comment">--   see Note [Work-list ordering] in GHC.Tc.Solved.Equality</span><span>
</span><span id="line-219"></span><span id="extendWorkListEqs"><span class="annot"><span class="annottext">extendWorkListEqs :: RewriterSet -&gt; Bag Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEqs"><span class="hs-identifier hs-var hs-var">extendWorkListEqs</span></a></span></span><span> </span><span id="local-6989586621682547415"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682547415"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682547416"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682547416"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621682547417"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547417"><span class="hs-identifier hs-var">wl</span></a></span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyRewriterSet"><span class="hs-identifier hs-var">isEmptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682547415"><span class="hs-identifier hs-var">rewriters</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- isEmptyRewriterSet: see Note [Prioritise Wanteds with empty RewriterSet]</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-comment">--                         in GHC.Tc.Types.Constraint</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547417"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547417"><span class="hs-identifier hs-type">wl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682547416"><span class="hs-identifier hs-type">eqs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-224"></span><span>         </span><span class="hs-comment">-- The foldr just appends wl_eqs to the bag of eqs</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547417"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547417"><span class="hs-identifier hs-type">wl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682547416"><span class="hs-identifier hs-type">eqs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListNonEq"><span class="hs-identifier hs-type">extendWorkListNonEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Extension by non equality</span><span>
</span><span id="line-230"></span><span id="extendWorkListNonEq"><span class="annot"><span class="annottext">extendWorkListNonEq :: Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListNonEq"><span class="hs-identifier hs-var hs-var">extendWorkListNonEq</span></a></span></span><span> </span><span id="local-6989586621682547419"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547419"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621682547420"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547420"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547420"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547419"><span class="hs-identifier hs-type">ct</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547420"><span class="hs-identifier hs-type">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListImplic"><span class="hs-identifier hs-type">extendWorkListImplic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-233"></span><span id="extendWorkListImplic"><span class="annot"><span class="annottext">extendWorkListImplic :: Implication -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListImplic"><span class="hs-identifier hs-var hs-var">extendWorkListImplic</span></a></span></span><span> </span><span id="local-6989586621682547421"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621682547421"><span class="hs-identifier hs-var">implic</span></a></span></span><span> </span><span id="local-6989586621682547422"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547422"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547422"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547421"><span class="hs-identifier hs-type">implic</span></a></span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#consBag"><span class="hs-operator hs-type">`consBag`</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547422"><span class="hs-identifier hs-type">wl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCt"><span class="hs-identifier hs-type">extendWorkListCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- Agnostic about what kind of constraint</span><span>
</span><span id="line-237"></span><span id="extendWorkListCt"><span class="annot"><span class="annottext">extendWorkListCt :: Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCt"><span class="hs-identifier hs-var hs-var">extendWorkListCt</span></a></span></span><span> </span><span id="local-6989586621682547424"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547424"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621682547425"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547425"><span class="hs-identifier hs-var">wl</span></a></span></span><span>
</span><span id="line-238"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547428"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-239"></span><span>     </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-240"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682547430"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547424"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547425"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>     </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621682547432"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547432"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-comment">-- See Note [Prioritise class equalities]</span><span>
</span><span id="line-243"></span><span>       </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqualityClass"><span class="hs-identifier hs-var">isEqualityClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547432"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-244"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListEq"><span class="hs-identifier hs-var">extendWorkListEq</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682547430"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547424"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547425"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>     </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListNonEq"><span class="hs-identifier hs-var">extendWorkListNonEq</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547424"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547425"><span class="hs-identifier hs-var">wl</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621682547428"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621682547428"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547424"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621682547430"><span class="annot"><span class="annottext">rewriters :: RewriterSet
</span><a href="#local-6989586621682547430"><span class="hs-identifier hs-var hs-var">rewriters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRewriters"><span class="hs-identifier hs-var">ctEvRewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547428"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCtList"><span class="hs-identifier hs-type">extendWorkListCtList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-252"></span><span id="extendWorkListCtList"><span class="annot"><span class="annottext">extendWorkListCtList :: [Ct] -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCtList"><span class="hs-identifier hs-var hs-var">extendWorkListCtList</span></a></span></span><span> </span><span id="local-6989586621682547436"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547436"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621682547437"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547437"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; WorkList -&gt; WorkList) -&gt; WorkList -&gt; [Ct] -&gt; WorkList
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCt"><span class="hs-identifier hs-var">extendWorkListCt</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547437"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547436"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCts"><span class="hs-identifier hs-type">extendWorkListCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-255"></span><span id="extendWorkListCts"><span class="annot"><span class="annottext">extendWorkListCts :: Bag Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCts"><span class="hs-identifier hs-var hs-var">extendWorkListCts</span></a></span></span><span> </span><span id="local-6989586621682547439"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682547439"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621682547440"><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547440"><span class="hs-identifier hs-var">wl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; WorkList -&gt; WorkList) -&gt; WorkList -&gt; Bag Ct -&gt; WorkList
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Bag a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; WorkList -&gt; WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#extendWorkListCt"><span class="hs-identifier hs-var">extendWorkListCt</span></a></span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547440"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682547439"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#isEmptyWorkList"><span class="hs-identifier hs-type">isEmptyWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-258"></span><span id="isEmptyWorkList"><span class="annot"><span class="annottext">isEmptyWorkList :: WorkList -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#isEmptyWorkList"><span class="hs-identifier hs-var hs-var">isEmptyWorkList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547441"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547441"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547442"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547442"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547443"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547443"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547441"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547442"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bag Implication -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547443"><span class="hs-identifier hs-var">implics</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyWorkList"><span class="hs-identifier hs-type">emptyWorkList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span>
</span><span id="line-262"></span><span id="emptyWorkList"><span class="annot"><span class="annottext">emptyWorkList :: WorkList
</span><a href="GHC.Tc.Solver.InertSet.html#emptyWorkList"><span class="hs-identifier hs-var hs-var">emptyWorkList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Implication
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#selectWorkItem"><span class="hs-identifier hs-type">selectWorkItem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- See Note [Prioritise equalities]</span><span>
</span><span id="line-266"></span><span id="selectWorkItem"><span class="annot"><span class="annottext">selectWorkItem :: WorkList -&gt; Maybe (Ct, WorkList)
</span><a href="GHC.Tc.Solver.InertSet.html#selectWorkItem"><span class="hs-identifier hs-var hs-var">selectWorkItem</span></a></span></span><span> </span><span id="local-6989586621682547448"><span class="annot"><span class="annottext">wl :: WorkList
</span><a href="#local-6989586621682547448"><span class="hs-identifier hs-var">wl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547449"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547449"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547450"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547450"><span class="hs-identifier hs-var">rw_eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547451"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547451"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682547452"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547452"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682547453"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547453"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547449"><span class="hs-identifier hs-var">eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct, WorkList) -&gt; Maybe (Ct, WorkList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547452"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547448"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547453"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682547454"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547454"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682547455"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547455"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547450"><span class="hs-identifier hs-var">rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct, WorkList) -&gt; Maybe (Ct, WorkList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547454"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547448"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547455"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682547456"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547456"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682547457"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547457"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547451"><span class="hs-identifier hs-var">rest</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct, WorkList) -&gt; Maybe (Ct, WorkList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547456"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorkList
</span><a href="#local-6989586621682547448"><span class="hs-identifier hs-var">wl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547457"><span class="hs-identifier hs-type">cts</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Ct, WorkList)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- Pretty printing</span><span>
</span><span id="line-273"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WorkList"><span class="hs-identifier hs-type">WorkList</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>  </span><span id="local-6989586621682547493"><span class="annot"><span class="annottext">ppr :: WorkList -&gt; SDoc
</span><a href="#local-6989586621682547493"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#WL"><span class="hs-identifier hs-type">WL</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wl_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_eqs"><span class="hs-identifier hs-var">wl_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547495"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547495"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rw_eqs :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rw_eqs"><span class="hs-identifier hs-var">wl_rw_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547496"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547496"><span class="hs-identifier hs-var">rw_eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_rest :: WorkList -&gt; [Ct]
</span><a href="GHC.Tc.Solver.InertSet.html#wl_rest"><span class="hs-identifier hs-var">wl_rest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547497"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547497"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wl_implics :: WorkList -&gt; Bag Implication
</span><a href="GHC.Tc.Solver.InertSet.html#wl_implics"><span class="hs-identifier hs-var">wl_implics</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547498"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547498"><span class="hs-identifier hs-var">implics</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WL&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-276"></span><span>     </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547495"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Eqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct -&gt; SDoc) -&gt; [Ct] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547495"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547496"><span class="hs-identifier hs-var">rw_eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-279"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RwEqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct -&gt; SDoc) -&gt; [Ct] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547496"><span class="hs-identifier hs-var">rw_eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547497"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-281"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Non-eqs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct -&gt; SDoc) -&gt; [Ct] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547497"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Implication -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547498"><span class="hs-identifier hs-var">implics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ifPprDebug"><span class="hs-identifier hs-var">ifPprDebug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Implics =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Implication -&gt; SDoc) -&gt; [Implication] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Implication -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Implication -&gt; [Implication]
forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621682547498"><span class="hs-identifier hs-var">implics</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(Implics omitted)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                InertSet: the inert set
*                                                                      *
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="hs-keyword">type</span><span> </span><span id="CycleBreakerVarStack"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-identifier hs-var">CycleBreakerVarStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>   </span><span class="hs-comment">-- ^ a stack of (CycleBreakerTv, original family applications) lists</span><span>
</span><span id="line-296"></span><span>   </span><span class="hs-comment">-- first element in the stack corresponds to current implication;</span><span>
</span><span id="line-297"></span><span>   </span><span class="hs-comment">--   later elements correspond to outer implications</span><span>
</span><span id="line-298"></span><span>   </span><span class="hs-comment">-- used to undo the cycle-breaking needed to handle</span><span>
</span><span id="line-299"></span><span>   </span><span class="hs-comment">-- Note [Type equality cycles] in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-300"></span><span>   </span><span class="hs-comment">-- Why store the outer implications? For the use in mightEqualLater (only)</span><span>
</span><span id="line-301"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-302"></span><span>   </span><span class="hs-comment">-- Why NonEmpty? So there is always a top element to add to</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-keyword">data</span><span> </span><span id="InertSet"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-var">InertSet</span></a></span></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IS"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-var">IS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="inert_cans"><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var hs-var">inert_cans</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-306"></span><span>              </span><span class="hs-comment">-- Canonical Given, Wanted</span><span>
</span><span id="line-307"></span><span>              </span><span class="hs-comment">-- Sometimes called &quot;the inert set&quot;</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_cycle_breakers"><span class="annot"><span class="annottext">InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var hs-var">inert_cycle_breakers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_famapp_cache"><span class="annot"><span class="annottext">InertSet -&gt; FunEqMap Reduction
</span><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var hs-var">inert_famapp_cache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>
</span><span id="line-312"></span><span>              </span><span class="hs-comment">-- Just a hash-cons cache for use when reducing family applications</span><span>
</span><span id="line-313"></span><span>              </span><span class="hs-comment">-- only</span><span>
</span><span id="line-314"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-315"></span><span>              </span><span class="hs-comment">-- If    F tys :-&gt; (co, rhs, flav),</span><span>
</span><span id="line-316"></span><span>              </span><span class="hs-comment">-- then  co :: F tys ~N rhs</span><span>
</span><span id="line-317"></span><span>              </span><span class="hs-comment">-- all evidence is from instances or Givens; no coercion holes here</span><span>
</span><span id="line-318"></span><span>              </span><span class="hs-comment">-- (We have no way of &quot;kicking out&quot; from the cache, so putting</span><span>
</span><span id="line-319"></span><span>              </span><span class="hs-comment">--  wanteds here means we can end up solving a Wanted with itself. Bad)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_solved_dicts"><span class="annot"><span class="annottext">InertSet -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var hs-var">inert_solved_dicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-322"></span><span>              </span><span class="hs-comment">-- All Wanteds, of form (C t1 .. tn)</span><span>
</span><span id="line-323"></span><span>              </span><span class="hs-comment">-- Always a dictionary solved by an instance decl; never an implict parameter</span><span>
</span><span id="line-324"></span><span>              </span><span class="hs-comment">-- See Note [Solved dictionaries]</span><span>
</span><span id="line-325"></span><span>              </span><span class="hs-comment">-- and Note [Do not add superclasses of solved dictionaries]</span><span>
</span><span id="line-326"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621682547524"><span class="annot"><span class="annottext">ppr :: InertSet -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547525"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547525"><span class="hs-identifier hs-var">ics</span></a></span></span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: InertSet -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547526"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547526"><span class="hs-identifier hs-var">solved_dicts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547525"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-332"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DictCt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621682547527"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-333"></span><span>               </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Solved dicts =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DictCt -&gt; SDoc) -&gt; [DictCt] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[DictCt]
</span><a href="#local-6989586621682547527"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>         </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>           </span><span id="local-6989586621682547527"><span class="annot"><span class="annottext">dicts :: [DictCt]
</span><a href="#local-6989586621682547527"><span class="hs-identifier hs-var hs-var">dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag DictCt -&gt; [DictCt]
forall a. Bag a -&gt; [a]
</span><a href="GHC.Data.Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Bag DictCt
forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547526"><span class="hs-identifier hs-var">solved_dicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyInertCans"><span class="hs-identifier hs-type">emptyInertCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-338"></span><span id="emptyInertCans"><span class="annot"><span class="annottext">emptyInertCans :: InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#emptyInertCans"><span class="hs-identifier hs-var hs-var">emptyInertCans</span></a></span></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#emptyTyEqs"><span class="hs-identifier hs-var">emptyTyEqs</span></a></span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertFunEqs
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a></span><span>
</span><span id="line-341"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: TcLevel
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a></span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: Bool
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-343"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier hs-var">emptyDictMap</span></a></span><span>
</span><span id="line-344"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier hs-var">emptyDictMap</span></a></span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: [QCInst]
</span><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertIrreds
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyInert"><span class="hs-identifier hs-type">emptyInert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-349"></span><span id="emptyInert"><span class="annot"><span class="annottext">emptyInert :: InertSet
</span><a href="GHC.Tc.Solver.InertSet.html#emptyInert"><span class="hs-identifier hs-var hs-var">emptyInert</span></a></span></span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#emptyInertCans"><span class="hs-identifier hs-var">emptyInertCans</span></a></span><span>
</span><span id="line-351"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_cycle_breakers :: CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
-&gt; [Bag (TcTyVar, Type)] -&gt; CycleBreakerVarStack
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-352"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_famapp_cache :: FunEqMap Reduction
</span><a href="GHC.Tc.Solver.InertSet.html#inert_famapp_cache"><span class="hs-identifier hs-var">inert_famapp_cache</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunEqMap Reduction
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a></span><span>
</span><span id="line-353"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_solved_dicts :: DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_solved_dicts"><span class="hs-identifier hs-var">inert_solved_dicts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier hs-var">emptyDictMap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="hs-comment">{- Note [Solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we apply a top-level instance declaration, we add the &quot;solved&quot;
dictionary to the inert_solved_dicts.  In general, we use it to avoid
creating a new EvVar when we have a new goal that we have solved in
the past.

But in particular, we can use it to create *recursive* dictionaries.
The simplest, degenerate case is
    instance C [a] =&gt; C [a] where ...
If we have
    [W] d1 :: C [x]
then we can apply the instance to get
    d1 = $dfCList d
    [W] d2 :: C [x]
Now 'd1' goes in inert_solved_dicts, and we can solve d2 directly from d1.
    d1 = $dfCList d
    d2 = d1

See Note [Example of recursive dictionaries]

VERY IMPORTANT INVARIANT:

 (Solved Dictionary Invariant)
    Every member of the inert_solved_dicts is the result
    of applying an instance declaration that &quot;takes a step&quot;

    An instance &quot;takes a step&quot; if it has the form
        dfunDList d1 d2 = MkD (...) (...) (...)
    That is, the dfun is lazy in its arguments, and guarantees to
    immediately return a dictionary constructor.  NB: all dictionary
    data constructors are lazy in their arguments.

    This property is crucial to ensure that all dictionaries are
    non-bottom, which in turn ensures that the whole &quot;recursive
    dictionary&quot; idea works at all, even if we get something like
        rec { d = dfunDList d dx }
    See Note [Recursive superclasses] in GHC.Tc.TyCl.Instance.

 Reason:
   - All instances, except two exceptions listed below, &quot;take a step&quot;
     in the above sense

   - Exception 1: local quantified constraints have no such guarantee;
     indeed, adding a &quot;solved dictionary&quot; when applying a quantified
     constraint led to the ability to define unsafeCoerce
     in #17267.

   - Exception 2: the magic built-in instance for (~) has no
     such guarantee.  It behaves as if we had
         class    (a ~# b) =&gt; (a ~ b) where {}
         instance (a ~# b) =&gt; (a ~ b) where {}
     The &quot;dfun&quot; for the instance is strict in the coercion.
     Anyway there's no point in recording a &quot;solved dict&quot; for
     (t1 ~ t2); it's not going to allow a recursive dictionary
     to be constructed.  Ditto (~~) and Coercible.

THEREFORE we only add a &quot;solved dictionary&quot;
  - when applying an instance declaration
  - subject to Exceptions 1 and 2 above

In implementation terms
  - GHC.Tc.Solver.Monad.addSolvedDict adds a new solved dictionary,
    conditional on the kind of instance

  - It is only called when applying an instance decl,
    in GHC.Tc.Solver.Dict.tryInstances

  - ClsInst.InstanceWhat says what kind of instance was
    used to solve the constraint.  In particular
      * LocalInstance identifies quantified constraints
      * BuiltinEqInstance identifies the strange built-in
        instances for equality.

  - ClsInst.instanceReturnsDictCon says which kind of
    instance guarantees to return a dictionary constructor

Other notes about solved dictionaries

* See also Note [Do not add superclasses of solved dictionaries]

* The inert_solved_dicts field is not rewritten by equalities,
  so it may get out of date.

* The inert_solved_dicts are all Wanteds, never givens

* We only cache dictionaries from top-level instances, not from
  local quantified constraints.  Reason: if we cached the latter
  we'd need to purge the cache when bringing new quantified
  constraints into scope, because quantified constraints &quot;shadow&quot;
  top-level instances.

Note [Do not add superclasses of solved dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Every member of inert_solved_dicts is the result of applying a
dictionary function, NOT of applying superclass selection to anything.
Consider

        class Ord a =&gt; C a where
        instance Ord [a] =&gt; C [a] where ...

Suppose we are trying to solve
  [G] d1 : Ord a
  [W] d2 : C [a]

Then we'll use the instance decl to give

  [G] d1 : Ord a     Solved: d2 : C [a] = $dfCList d3
  [W] d3 : Ord [a]

We must not add d4 : Ord [a] to the 'solved' set (by taking the
superclass of d2), otherwise we'll use it to solve d3, without ever
using d1, which would be a catastrophe.

Solution: when extending the solved dictionaries, do not add superclasses.
That's why each element of the inert_solved_dicts is the result of applying
a dictionary function.

Note [Example of recursive dictionaries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
--- Example 1

    data D r = ZeroD | SuccD (r (D r));

    instance (Eq (r (D r))) =&gt; Eq (D r) where
        ZeroD     == ZeroD     = True
        (SuccD a) == (SuccD b) = a == b
        _         == _         = False;

    equalDC :: D [] -&gt; D [] -&gt; Bool;
    equalDC = (==);

We need to prove (Eq (D [])). Here's how we go:

   [W] d1 : Eq (D [])
By instance decl of Eq (D r):
   [W] d2 : Eq [D []]      where   d1 = dfEqD d2
By instance decl of Eq [a]:
   [W] d3 : Eq (D [])      where   d2 = dfEqList d3
                                   d1 = dfEqD d2
Now this wanted can interact with our &quot;solved&quot; d1 to get:
    d3 = d1

-- Example 2:
This code arises in the context of &quot;Scrap Your Boilerplate with Class&quot;

    class Sat a
    class Data ctx a
    instance  Sat (ctx Char)             =&gt; Data ctx Char       -- dfunData1
    instance (Sat (ctx [a]), Data ctx a) =&gt; Data ctx [a]        -- dfunData2

    class Data Maybe a =&gt; Foo a

    instance Foo t =&gt; Sat (Maybe t)                             -- dfunSat

    instance Data Maybe a =&gt; Foo a                              -- dfunFoo1
    instance Foo a        =&gt; Foo [a]                            -- dfunFoo2
    instance                 Foo [Char]                         -- dfunFoo3

Consider generating the superclasses of the instance declaration
         instance Foo a =&gt; Foo [a]

So our problem is this
    [G] d0 : Foo t
    [W] d1 : Data Maybe [t]   -- Desired superclass

We may add the given in the inert set, along with its superclasses
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  WorkList
    [W] d1 : Data Maybe [t]

Solve d1 using instance dfunData2; d1 := dfunData2 d2 d3
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
  WorkList:
    [W] d2 : Sat (Maybe [t])
    [W] d3 : Data Maybe t

Now, we may simplify d2 using dfunSat; d2 := dfunSat d4
  Inert:
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
  WorkList:
    [W] d3 : Data Maybe t
    [W] d4 : Foo [t]

Now, we can just solve d3 from d01; d3 := d01
  Inert
    [G] d0 : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
  WorkList
    [W] d4 : Foo [t]

Now, solve d4 using dfunFoo2;  d4 := dfunFoo2 d5
  Inert
    [G] d0  : Foo t
    [G] d01 : Data Maybe t   -- Superclass of d0
  Solved:
        d1 : Data Maybe [t]
        d2 : Sat (Maybe [t])
        d4 : Foo [t]
  WorkList:
    [W] d5 : Foo t

Now, d5 can be solved! d5 := d0

Result
   d1 := dfunData2 d2 d3
   d2 := dfunSat d4
   d3 := d01
   d4 := dfunFoo2 d5
   d5 := d0
-}</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                InertCans: the canonical inerts
*                                                                      *
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">{- Note [Tracking Given equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For reasons described in (UNTOUCHABLE) in GHC.Tc.Utils.Unify
Note [Unification preconditions], we can't unify
   alpha[2] ~ Int
under a level-4 implication if there are any Given equalities
bound by the implications at level 3 of 4.  To that end, the
InertCans tracks

  inert_given_eq_lvl :: TcLevel
     -- The TcLevel of the innermost implication that has a Given
     -- equality of the sort that make a unification variable untouchable
     -- (see Note [Unification preconditions] in GHC.Tc.Utils.Unify).

We update inert_given_eq_lvl whenever we add a Given to the
inert set, in updGivenEqs.

Then a unification variable alpha[n] is untouchable iff
    n &lt; inert_given_eq_lvl
that is, if the unification variable was born outside an
enclosing Given equality.

Exactly which constraints should trigger (UNTOUCHABLE), and hence
should update inert_given_eq_lvl?

* We do /not/ need to worry about let-bound skolems, such ast
     forall[2] a. a ~ [b] =&gt; blah
  See Note [Let-bound skolems]

* Consider an implication
      forall[2]. beta[1] =&gt; alpha[1] ~ Int
  where beta is a unification variable that has already been unified
  to () in an outer scope.  Then alpha[1] is perfectly touchable and
  we can unify alpha := Int. So when deciding whether the givens contain
  an equality, we should canonicalise first, rather than just looking at
  the /original/ givens (#8644).

 * However, we must take account of *potential* equalities. Consider the
   same example again, but this time we have /not/ yet unified beta:
      forall[2] beta[1] =&gt; ...blah...

   Because beta might turn into an equality, updGivenEqs conservatively
   treats it as a potential equality, and updates inert_give_eq_lvl

 * What about something like forall[2] a b. a ~ F b =&gt; [W] alpha[1] ~ X y z?

   That Given cannot affect the Wanted, because the Given is entirely
   *local*: it mentions only skolems bound in the very same
   implication. Such equalities need not make alpha untouchable. (Test
   case typecheck/should_compile/LocalGivenEqs has a real-life
   motivating example, with some detailed commentary.)
   Hence the 'mentionsOuterVar' test in updGivenEqs.

   However, solely to support better error messages
   (see Note [HasGivenEqs] in GHC.Tc.Types.Constraint) we also track
   these &quot;local&quot; equalities in the boolean inert_given_eqs field.
   This field is used only to set the ic_given_eqs field to LocalGivenEqs;
   see the function getHasGivenEqs.

   Here is a simpler case that triggers this behaviour:

     data T where
       MkT :: F a ~ G b =&gt; a -&gt; b -&gt; T

     f (MkT _ _) = True

   Because of this behaviour around local equality givens, we can infer the
   type of f. This is typecheck/should_compile/LocalGivenEqs2.

 * We need not look at the equality relation involved (nominal vs
   representational), because representational equalities can still
   imply nominal ones. For example, if (G a ~R G b) and G's argument's
   role is nominal, then we can deduce a ~N b.

Note [Let-bound skolems]
~~~~~~~~~~~~~~~~~~~~~~~~
If   * the inert set contains a canonical Given CEqCan (a ~ ty)
and  * 'a' is a skolem bound in this very implication,

then:
a) The Given is pretty much a let-binding, like
      f :: (a ~ b-&gt;c) =&gt; a -&gt; a
   Here the equality constraint is like saying
      let a = b-&gt;c in ...
   It is not adding any new, local equality  information,
   and hence can be ignored by has_given_eqs

b) 'a' will have been completely substituted out in the inert set,
   so we can safely discard it.

For an example, see #9211.

See also GHC.Tc.Utils.Unify Note [Deeper level on the left] for how we ensure
that the right variable is on the left of the equality when both are
tyvars.

You might wonder whether the skolem really needs to be bound &quot;in the
very same implication&quot; as the equality constraint.
Consider this (c.f. #15009):

  data S a where
    MkS :: (a ~ Int) =&gt; S a

  g :: forall a. S a -&gt; a -&gt; blah
  g x y = let h = \z. ( z :: Int
                      , case x of
                           MkS -&gt; [y,z])
          in ...

From the type signature for `g`, we get `y::a` .  Then when we
encounter the `\z`, we'll assign `z :: alpha[1]`, say.  Next, from the
body of the lambda we'll get

  [W] alpha[1] ~ Int                             -- From z::Int
  [W] forall[2]. (a ~ Int) =&gt; [W] alpha[1] ~ a   -- From [y,z]

Now, unify alpha := a.  Now we are stuck with an unsolved alpha~Int!
So we must treat alpha as untouchable under the forall[2] implication.

Note [Detailed InertCans Invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The InertCans represents a collection of constraints with the following properties:

  * All canonical

  * No two dictionaries with the same head
  * No two CIrreds with the same type

  * Family equations inert wrt top-level family axioms

  * Dictionaries have no matching top-level instance

  * Given family or dictionary constraints don't mention touchable
    unification variables

  * Non-CEqCan constraints are fully rewritten with respect
    to the CEqCan equalities (modulo eqCanRewrite of course;
    eg a wanted cannot rewrite a given)

  * CEqCan equalities: see Note [inert_eqs: the inert equalities]
    Also see documentation in Constraint.Ct for a list of invariants

Note [inert_eqs: the inert equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Definition [Can-rewrite relation]
A &quot;can-rewrite&quot; relation between flavours, written f1 &gt;= f2, is a
binary relation with the following properties

  (R1) &gt;= is transitive
  (R2) If f1 &gt;= f, and f2 &gt;= f,
       then either f1 &gt;= f2 or f2 &gt;= f1
  (See Note [Why R2?].)

Lemma (L0). If f1 &gt;= f then f1 &gt;= f1
Proof.      By property (R2), with f1=f2

Definition [Generalised substitution]
A &quot;generalised substitution&quot; S is a set of triples (lhs -f-&gt; t), where
  lhs is a type variable or an exactly-saturated type family application
    (that is, lhs is a CanEqLHS)
  t is a type
  f is a flavour
such that
  (WF1) if (lhs1 -f1-&gt; t1) in S
           (lhs2 -f2-&gt; t2) in S
        then (f1 &gt;= f2) implies that lhs1 does not appear within lhs2
  (WF2) if (lhs -f-&gt; t) is in S, then t /= lhs

Definition [Applying a generalised substitution]
If S is a generalised substitution
   S(f,t0) = t,  if (t0 -fs-&gt; t) in S, and fs &gt;= f
           = apply S to components of t0, otherwise
See also Note [Flavours with roles].

Theorem: S(f,t0) is well defined as a function.
Proof: Suppose (lhs -f1-&gt; t1) and (lhs -f2-&gt; t2) are both in S,
               and  f1 &gt;= f and f2 &gt;= f
       Then by (R2) f1 &gt;= f2 or f2 &gt;= f1, which contradicts (WF1)

Notation: repeated application.
  S^0(f,t)     = t
  S^(n+1)(f,t) = S(f, S^n(t))

Definition: terminating generalised substitution
A generalised substitution S is *terminating* iff

  (IG1) there is an n such that
        for every f,t, S^n(f,t) = S^(n+1)(f,t)

By (IG1) we define S*(f,t) to be the result of exahaustively
applying S(f,_) to t.

-----------------------------------------------------------------------------
Our main invariant:
   the EqCts in inert_eqs should be a terminating generalised substitution
-----------------------------------------------------------------------------

Note that termination is not the same as idempotence.  To apply S to a
type, you may have to apply it recursively.  But termination does
guarantee that this recursive use will terminate.

Note [Why R2?]
~~~~~~~~~~~~~~
R2 states that, if we have f1 &gt;= f and f2 &gt;= f, then either f1 &gt;= f2 or f2 &gt;=
f1. If we do not have R2, we will easily fall into a loop.

To see why, imagine we have f1 &gt;= f, f2 &gt;= f, and that's it. Then, let our
inert set S = {a -f1-&gt; b, b -f2-&gt; a}. Computing S(f,a) does not terminate. And
yet, we have a hard time noticing an occurs-check problem when building S, as
the two equalities cannot rewrite one another.

R2 actually restricts our ability to accept user-written programs. See
Note [Avoiding rewriting cycles] in GHC.Tc.Types.Constraint for an example.

Note [Rewritable]
~~~~~~~~~~~~~~~~~
This Note defines what it means for a type variable or type family application
(that is, a CanEqLHS) to be rewritable in a type. This definition is used
by the anyRewritableXXX family of functions and is meant to model the actual
behaviour in GHC.Tc.Solver.Rewrite.

Ignoring roles (for now): A CanEqLHS lhs is *rewritable* in a type t if the
lhs tree appears as a subtree within t without traversing any of the following
components of t:
  * coercions (whether they appear in casts CastTy or as arguments CoercionTy)
  * kinds of variable occurrences
The check for rewritability *does* look in kinds of the bound variable of a
ForAllTy.

Goal: If lhs is not rewritable in t, then t is a fixpoint of the generalised
substitution containing only {lhs -f*-&gt; t'}, where f* is a flavour such that f* &gt;= f
for all f.

The reason for this definition is that the rewriter does not rewrite in coercions
or variables' kinds. In turn, the rewriter does not need to rewrite there because
those places are never used for controlling the behaviour of the solver: these
places are not used in matching instances or in decomposing equalities.

There is one exception to the claim that non-rewritable parts of the tree do
not affect the solver: we sometimes do an occurs-check to decide e.g. how to
orient an equality. (See the comments on
GHC.Tc.Solver.Equality.canEqTyVarFunEq.) Accordingly, the presence of a
variable in a kind or coercion just might influence the solver. Here is an
example:

  type family Const x y where
    Const x y = x

  AxConst :: forall x y. Const x y ~# x

  alpha :: Const Type Nat
  [W] alpha ~ Int |&gt; (sym (AxConst Type alpha) ;;
                      AxConst Type alpha ;;
                      sym (AxConst Type Nat))

The cast is clearly ludicrous (it ties together a cast and its symmetric version),
but we can't quite rule it out. (See (EQ1) from
Note [Respecting definitional equality] in GHC.Core.TyCo.Rep to see why we need
the Const Type Nat bit.) And yet this cast will (quite rightly) prevent alpha
from unifying with the RHS. I (Richard E) don't have an example of where this
problem can arise from a Haskell program, but we don't have an air-tight argument
for why the definition of *rewritable* given here is correct.

Taking roles into account: we must consider a rewrite at a given role. That is,
a rewrite arises from some equality, and that equality has a role associated
with it. As we traverse a type, we track what role we are allowed to rewrite with.

For example, suppose we have an inert [G] b ~R# Int. Then b is rewritable in
Maybe b but not in F b, where F is a type function. This role-aware logic is
present in both the anyRewritableXXX functions and in the rewriter.
See also Note [anyRewritableTyVar must be role-aware] in GHC.Tc.Utils.TcType.

Note [Extending the inert equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Main Theorem [Stability under extension]
   Suppose we have a &quot;work item&quot;
       lhs -fw-&gt; t
   and a terminating generalised substitution S,
   THEN the extended substitution T = S+(lhs -fw-&gt; t)
        is a terminating generalised substitution
   PROVIDED
      (T1) S(fw,lhs) = lhs   -- LHS of work-item is a fixpoint of S(fw,_)
      (T2) S(fw,t)   = t     -- RHS of work-item is a fixpoint of S(fw,_)
      (T3) lhs not in t      -- No occurs check in the work item
          -- If lhs is a type family application, we require only that
          -- lhs is not *rewritable* in t. See Note [Rewritable] and
          -- Note [EqCt occurs check] in GHC.Tc.Types.Constraint.

      AND, for every (lhs1 -fs-&gt; s) in S:
           (K0) not (fw &gt;= fs)
                Reason: suppose we kick out (lhs1 -fs-&gt; s),
                        and add (lhs -fw-&gt; t) to the inert set.
                        The latter can't rewrite the former,
                        so the kick-out achieved nothing

              -- From here, we can assume fw &gt;= fs
           OR (K4) lhs1 is a tyvar AND fs &gt;= fw

           OR { (K1) lhs is not rewritable in lhs1. See Note [Rewritable].
                     Reason: if fw &gt;= fs, WF1 says we can't have both
                             lhs0 -fw-&gt; t  and  F lhs0 -fs-&gt; s

                AND (K2): guarantees termination of the new substitution
                    {  (K2a) not (fs &gt;= fs)
                    OR (K2b) lhs not in s }

                AND (K3) See Note [K3: completeness of solving]
                    { (K3a) If the role of fs is nominal: s /= lhs
                      (K3b) If the role of fs is representational:
                            s is not of form (lhs t1 .. tn) } }


Conditions (T1-T3) are established by the canonicaliser
Conditions (K1-K3) are established by GHC.Tc.Solver.Monad.kickOutRewritable

The idea is that
* T1 and T2 are guaranteed by exhaustively rewriting the work-item
  with S(fw,_).

* T3 is guaranteed by an occurs-check on the work item.
  This is done during canonicalisation, in checkTypeEq; invariant
  (TyEq:OC) of CEqCan. See also Note [EqCt occurs check] in GHC.Tc.Types.Constraint.

* (K1-3) are the &quot;kick-out&quot; criteria.  (As stated, they are really the
  &quot;keep&quot; criteria.) If the current inert S contains a triple that does
  not satisfy (K1-3), then we remove it from S by &quot;kicking it out&quot;,
  and re-processing it.

* Note that kicking out is a Bad Thing, because it means we have to
  re-process a constraint.  The less we kick out, the better.
  TODO: Make sure that kicking out really *is* a Bad Thing. We've assumed
  this but haven't done the empirical study to check.

* Assume we have  G&gt;=G, G&gt;=W and that's all.  Then, when performing
  a unification we add a new given  a -G-&gt; ty.  But doing so does NOT require
  us to kick out an inert wanted that mentions a, because of (K2a).  This
  is a common case, hence good not to kick out. See also (K2a) below.

* Lemma (L1): The conditions of the Main Theorem imply that there is no
              (lhs -fs-&gt; t) in S, s.t.  (fs &gt;= fw).
  Proof. Suppose the contrary (fs &gt;= fw).  Then because of (T1),
  S(fw,lhs)=lhs.  But since fs&gt;=fw, S(fw,lhs) = t, hence t=lhs.  But now we
  have (lhs -fs-&gt; lhs) in S, which contradicts (WF2).

* The extended substitution satisfies (WF1) and (WF2)
  - (K1) plus (L1) guarantee that the extended substitution satisfies (WF1).
  - (T3) guarantees (WF2).

* (K2) and (K4) are about termination.  Intuitively, any infinite chain S^0(f,t),
  S^1(f,t), S^2(f,t).... must pass through the new work item infinitely
  often, since the substitution without the work item is terminating; and must
  pass through at least one of the triples in S infinitely often.

  - (K2a): if not(fs&gt;=fs) then there is no f that fs can rewrite (fs&gt;=f)
    (this is Lemma (L0)), and hence this triple never plays a role in application S(f,t).
    It is always safe to extend S with such a triple.

    (NB: we could strengthen K1) in this way too, but see K3.

  - (K2b): if lhs not in s, we have no further opportunity to apply the
    work item

  - (K4): See Note [K4]

* Lemma (L3). Suppose we have f* such that, for all f, f* &gt;= f. Then
  if we are adding lhs -fw-&gt; t (where T1, T2, and T3 hold), we will keep a -f*-&gt; s.
  Proof. K4 holds; thus, we keep.

Key lemma to make it watertight.
  Under the conditions of the Main Theorem,
  forall f st fw &gt;= f, a is not in S^k(f,t), for any k

Also, consider roles more carefully. See Note [Flavours with roles]

Note [K4]
~~~~~~~~~
K4 is a &quot;keep&quot; condition of Note [Extending the inert equalities].
Here is the scenario:

* We are considering adding (lhs -fw-&gt; t) to the inert set S.
* S already has (lhs1 -fs-&gt; s).
* We know S(fw, lhs) = lhs, S(fw, t) = t, and lhs is not rewritable in t.
  See Note [Rewritable]. These are (T1), (T2), and (T3).
* We further know fw &gt;= fs. (If not, then we short-circuit via (K0).)

K4 says that we may keep lhs1 -fs-&gt; s in S if:
  lhs1 is a tyvar AND fs &gt;= fw

Why K4 guarantees termination:
  * If fs &gt;= fw, we know a is not rewritable in t, because of (T2).
  * We further know lhs /= a, because of (T1).
  * Accordingly, a use of the new inert item lhs -fw-&gt; t cannot create the conditions
    for a use of a -fs-&gt; s (precisely because t does not mention a), and hence,
    the extended substitution (with lhs -fw-&gt; t in it) is a terminating
    generalised substitution.

Recall that the termination generalised substitution includes only mappings that
pass an occurs check. This is (T3). At one point, we worried that the
argument here would fail if s mentioned a, but (T3) rules out this possibility.
Put another way: the terminating generalised substitution considers only the inert_eqs,
not other parts of the inert set (such as the irreds).

Can we liberalise K4? No.

Why we cannot drop the (fs &gt;= fw) condition:
  * Suppose not (fs &gt;= fw). It might be the case that t mentions a, and this
    can cause a loop. Example:

      Work:  [G] b ~ a
      Inert: [W] a ~ b

    (where G &gt;= G, G &gt;= W, and W &gt;= W)
    If we don't kick out the inert, then we get a loop on e.g. [W] a ~ Int.

  * Note that the above example is different if the inert is a Given G, because
    (T1) won't hold.

Why we cannot drop the tyvar condition:
  * Presume fs &gt;= fw. Thus, F tys is not rewritable in t, because of (T2).
  * Can the use of lhs -fw-&gt; t create the conditions for a use of F tys -fs-&gt; s?
    Yes! This can happen if t appears within tys.

    Here is an example:

      Work:  [G] a ~ Int
      Inert: [G] F Int ~ F a

    Now, if we have [W] F a ~ Bool, we will rewrite ad infinitum on the left-hand
    side. The key reason why K2b works in the tyvar case is that tyvars are atomic:
    if the right-hand side of an equality does not mention a variable a, then it
    cannot allow an equality with an LHS of a to fire. This is not the case for
    type family applications.

Bottom line: K4 can keep only inerts with tyvars on the left. Put differently,
K4 will never prevent an inert with a type family on the left from being kicked
out.

Consequence: We never kick out a Given/Nominal equality with a tyvar on the left.
This is Lemma (L3) of Note [Extending the inert equalities]. It is good because
it means we can effectively model the mutable filling of metavariables with
Given/Nominal equalities. That is: it should be the case that we could rewrite
our solver never to fill in a metavariable; instead, it would &quot;solve&quot; a wanted
like alpha ~ Int by turning it into a Given, allowing it to be used in rewriting.
We would want the solver to behave the same whether it uses metavariables or
Givens. And (L3) says that no Given/Nominals over tyvars are ever kicked out,
just like we never unfill a metavariable. Nice.

Getting this wrong (that is, allowing K4 to apply to situations with the type
family on the left) led to #19042. (At that point, K4 was known as K2b.)

Originally, this condition was part of K2, but #17672 suggests it should be
a top-level K condition.

Note [K3: completeness of solving]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(K3) is not necessary for the extended substitution
to be terminating.  In fact K1 could be made stronger by saying
   ... then (not (fw &gt;= fs) or not (fs &gt;= fs))
But it's not enough for S to be terminating; we also want completeness.
That is, we want to be able to solve all soluble wanted equalities.
Suppose we have

   work-item   b -G-&gt; a
   inert-item  a -W-&gt; b

Assuming (G &gt;= W) but not (W &gt;= W), this fulfills all the conditions,
so we could extend the inerts, thus:

   inert-items   b -G-&gt; a
                 a -W-&gt; b

But if we kicked-out the inert item, we'd get

   work-item     a -W-&gt; b
   inert-item    b -G-&gt; a

Then rewrite the work-item gives us (a -W-&gt; a), which is soluble via Refl.
So we add one more clause to the kick-out criteria

Another way to understand (K3) is that we treat an inert item
        a -f-&gt; b
in the same way as
        b -f-&gt; a
So if we kick out one, we should kick out the other.  The orientation
is somewhat accidental.

When considering roles, we also need the second clause (K3b). Consider

  work-item    c -G/N-&gt; a
  inert-item   a -W/R-&gt; b c

The work-item doesn't get rewritten by the inert, because (&gt;=) doesn't hold.
But we don't kick out the inert item because not (W/R &gt;= W/R).  So we just
add the work item. But then, consider if we hit the following:

  work-item    b -G/N-&gt; Id
  inert-items  a -W/R-&gt; b c
               c -G/N-&gt; a
where
  newtype Id x = Id x

For similar reasons, if we only had (K3a), we wouldn't kick the
representational inert out. And then, we'd miss solving the inert, which
now reduced to reflexivity.

The solution here is to kick out representational inerts whenever the
lhs of a work item is &quot;exposed&quot;, where exposed means being at the
head of the top-level application chain (lhs t1 .. tn).  See
is_can_eq_lhs_head. This is encoded in (K3b).

Beware: if we make this test succeed too often, we kick out too much,
and the solver might loop.  Consider (#14363)
  work item:   [G] a ~R f b
  inert item:  [G] b ~R f a
In GHC 8.2 the completeness tests more aggressive, and kicked out
the inert item; but no rewriting happened and there was an infinite
loop.  All we need is to have the tyvar at the head.

Note [Flavours with roles]
~~~~~~~~~~~~~~~~~~~~~~~~~~
The system described in Note [inert_eqs: the inert equalities]
discusses an abstract
set of flavours. In GHC, flavours have two components: the flavour proper,
taken from {Wanted, Given} and the equality relation (often called
role), taken from {NomEq, ReprEq}.
When substituting w.r.t. the inert set,
as described in Note [inert_eqs: the inert equalities],
we must be careful to respect all components of a flavour.
For example, if we have

  inert set: a -G/R-&gt; Int
             b -G/R-&gt; Bool

  type role T nominal representational

and we wish to compute S(W/R, T a b), the correct answer is T a Bool, NOT
T Int Bool. The reason is that T's first parameter has a nominal role, and
thus rewriting a to Int in T a b is wrong. Indeed, this non-congruence of
substitution means that the proof in Note [inert_eqs: the inert equalities] may
need to be revisited, but we don't think that the end conclusion is wrong.
-}</span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="hs-keyword">data</span><span> </span><span id="InertCans"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-var">InertCans</span></a></span></span><span>   </span><span class="hs-comment">-- See Note [Detailed InertCans Invariants] for more</span><span>
</span><span id="line-1131"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IC"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-var">IC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="inert_eqs"><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var hs-var">inert_eqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-1132"></span><span>              </span><span class="hs-comment">-- See Note [inert_eqs: the inert equalities]</span><span>
</span><span id="line-1133"></span><span>              </span><span class="hs-comment">-- All EqCt with a TyVarLHS; index is the LHS tyvar</span><span>
</span><span id="line-1134"></span><span>              </span><span class="hs-comment">-- Domain = skolems and untouchables; a touchable would be unified</span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_funeqs"><span class="annot"><span class="annottext">InertCans -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var hs-var">inert_funeqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span>
</span><span id="line-1137"></span><span>              </span><span class="hs-comment">-- All EqCt with a TyFamLHS; index is the whole family head type.</span><span>
</span><span id="line-1138"></span><span>              </span><span class="hs-comment">-- LHS is fully rewritten (modulo eqCanRewrite constraints)</span><span>
</span><span id="line-1139"></span><span>              </span><span class="hs-comment">--     wrt inert_eqs</span><span>
</span><span id="line-1140"></span><span>              </span><span class="hs-comment">-- Can include both [G] and [W]</span><span>
</span><span id="line-1141"></span><span>
</span><span id="line-1142"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_dicts"><span class="annot"><span class="annottext">InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var hs-var">inert_dicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-1143"></span><span>              </span><span class="hs-comment">-- Dictionaries only</span><span>
</span><span id="line-1144"></span><span>              </span><span class="hs-comment">-- All fully rewritten (modulo flavour constraints)</span><span>
</span><span id="line-1145"></span><span>              </span><span class="hs-comment">--     wrt inert_eqs</span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_insts"><span class="annot"><span class="annottext">InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var hs-var">inert_insts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_safehask"><span class="annot"><span class="annottext">InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var hs-var">inert_safehask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-1150"></span><span>              </span><span class="hs-comment">-- Failed dictionary resolution due to Safe Haskell overlapping</span><span>
</span><span id="line-1151"></span><span>              </span><span class="hs-comment">-- instances restriction. We keep this separate from inert_dicts</span><span>
</span><span id="line-1152"></span><span>              </span><span class="hs-comment">-- as it doesn't cause compilation failure, just safe inference</span><span>
</span><span id="line-1153"></span><span>              </span><span class="hs-comment">-- failure.</span><span>
</span><span id="line-1154"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-1155"></span><span>              </span><span class="hs-comment">-- ^ See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><span id="line-1156"></span><span>              </span><span class="hs-comment">-- in GHC.Tc.Solver</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_irreds"><span class="annot"><span class="annottext">InertCans -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var hs-var">inert_irreds</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span>
</span><span id="line-1159"></span><span>              </span><span class="hs-comment">-- Irreducible predicates that cannot be made canonical,</span><span>
</span><span id="line-1160"></span><span>              </span><span class="hs-comment">--     and which don't interact with others (e.g.  (c a))</span><span>
</span><span id="line-1161"></span><span>              </span><span class="hs-comment">-- and insoluble predicates (e.g.  Int ~ Bool, or a ~ [a])</span><span>
</span><span id="line-1162"></span><span>
</span><span id="line-1163"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_given_eq_lvl"><span class="annot"><span class="annottext">InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var hs-var">inert_given_eq_lvl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-1164"></span><span>              </span><span class="hs-comment">-- The TcLevel of the innermost implication that has a Given</span><span>
</span><span id="line-1165"></span><span>              </span><span class="hs-comment">-- equality of the sort that make a unification variable untouchable</span><span>
</span><span id="line-1166"></span><span>              </span><span class="hs-comment">-- (see Note [Unification preconditions] in GHC.Tc.Utils.Unify).</span><span>
</span><span id="line-1167"></span><span>              </span><span class="hs-comment">-- See Note [Tracking Given equalities]</span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="inert_given_eqs"><span class="annot"><span class="annottext">InertCans -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var hs-var">inert_given_eqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1170"></span><span>              </span><span class="hs-comment">-- True &lt;=&gt; The inert Givens *at this level* (tcl_tclvl)</span><span>
</span><span id="line-1171"></span><span>              </span><span class="hs-comment">--          could includes at least one equality /other than/ a</span><span>
</span><span id="line-1172"></span><span>              </span><span class="hs-comment">--          let-bound skolem equality.</span><span>
</span><span id="line-1173"></span><span>              </span><span class="hs-comment">-- Reason: report these givens when reporting a failed equality</span><span>
</span><span id="line-1174"></span><span>              </span><span class="hs-comment">-- See Note [Tracking Given equalities]</span><span>
</span><span id="line-1175"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span class="hs-keyword">type</span><span> </span><span id="InertEqs"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-var">InertEqs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#DTyVarEnv"><span class="hs-identifier hs-type">DTyVarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-1178"></span><span class="hs-keyword">type</span><span> </span><span id="InertFunEqs"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-var">InertFunEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span>  </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-1179"></span><span class="hs-keyword">type</span><span> </span><span id="InertIrreds"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-var">InertIrreds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span>
</span><span id="line-1180"></span><span>
</span><span id="line-1181"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1182"></span><span>  </span><span id="local-6989586621682547583"><span class="annot"><span class="annottext">ppr :: InertCans -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547584"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547584"><span class="hs-identifier hs-var">eqs</span></a></span></span><span>
</span><span id="line-1183"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547585"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547585"><span class="hs-identifier hs-var">funeqs</span></a></span></span><span>
</span><span id="line-1184"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547586"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547586"><span class="hs-identifier hs-var">dicts</span></a></span></span><span>
</span><span id="line-1185"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_safehask :: InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_safehask"><span class="hs-identifier hs-var">inert_safehask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547587"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547587"><span class="hs-identifier hs-var">safehask</span></a></span></span><span>
</span><span id="line-1186"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547588"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547588"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-1187"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547589"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547589"><span class="hs-identifier hs-var">ge_lvl</span></a></span></span><span>
</span><span id="line-1188"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_given_eqs :: InertCans -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547590"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682547590"><span class="hs-identifier hs-var">given_eqs</span></a></span></span><span>
</span><span id="line-1189"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547591"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547591"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1192"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertEqs -&gt; Bool
forall a. DVarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyDVarEnv"><span class="hs-identifier hs-var">isEmptyDVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547584"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1193"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Equalities =&quot;</span></span><span>
</span><span id="line-1194"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EqCt -&gt; SDoc
forall a. Outputable a =&gt; Bag a -&gt; SDoc
</span><a href="GHC.Data.Bag.html#pprBag"><span class="hs-identifier hs-var">pprBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqCt -&gt; Bag EqCt -&gt; Bag EqCt) -&gt; InertEqs -&gt; Bag EqCt -&gt; Bag EqCt
forall b. (EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Bag EqCt -&gt; Bag EqCt
forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547584"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EqCt
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertFunEqs -&gt; Bool
forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Types.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547585"><span class="hs-identifier hs-var">funeqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1196"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Type-function equalities =&quot;</span></span><span>
</span><span id="line-1197"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EqCt -&gt; SDoc
forall a. Outputable a =&gt; Bag a -&gt; SDoc
</span><a href="GHC.Data.Bag.html#pprBag"><span class="hs-identifier hs-var">pprBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqCt -&gt; Bag EqCt -&gt; Bag EqCt)
-&gt; InertFunEqs -&gt; Bag EqCt -&gt; Bag EqCt
forall b. (EqCt -&gt; b -&gt; b) -&gt; InertFunEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Bag EqCt -&gt; Bag EqCt
forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547585"><span class="hs-identifier hs-var">funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EqCt
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Bool
forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Types.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547586"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1199"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Dictionaries =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag DictCt -&gt; SDoc
forall a. Outputable a =&gt; Bag a -&gt; SDoc
</span><a href="GHC.Data.Bag.html#pprBag"><span class="hs-identifier hs-var">pprBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Bag DictCt
forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547586"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Bool
forall a. TcAppMap a -&gt; Bool
</span><a href="GHC.Tc.Solver.Types.html#isEmptyTcAppMap"><span class="hs-identifier hs-var">isEmptyTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547587"><span class="hs-identifier hs-var">safehask</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1201"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Safe Haskell unsafe overlap =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bag DictCt -&gt; SDoc
forall a. Outputable a =&gt; Bag a -&gt; SDoc
</span><a href="GHC.Data.Bag.html#pprBag"><span class="hs-identifier hs-var">pprBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Bag DictCt
forall a. DictMap a -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#dictsToBag"><span class="hs-identifier hs-var">dictsToBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547587"><span class="hs-identifier hs-var">safehask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1202"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertIrreds -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547588"><span class="hs-identifier hs-var">irreds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1203"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Irreds =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds -&gt; SDoc
forall a. Outputable a =&gt; Bag a -&gt; SDoc
</span><a href="GHC.Data.Bag.html#pprBag"><span class="hs-identifier hs-var">pprBag</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547588"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1204"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[QCInst] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547591"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1205"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given instances =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(QCInst -&gt; SDoc) -&gt; [QCInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547591"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Innermost given equalities =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547589"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span>
</span><span id="line-1207"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given eqs at this level =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682547590"><span class="hs-identifier hs-var">given_eqs</span></a></span><span>
</span><span id="line-1208"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Inert equalities
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#emptyTyEqs"><span class="hs-identifier hs-type">emptyTyEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-1218"></span><span id="emptyTyEqs"><span class="annot"><span class="annottext">emptyTyEqs :: InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#emptyTyEqs"><span class="hs-identifier hs-var hs-var">emptyTyEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs
forall a. DVarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyDVarEnv"><span class="hs-identifier hs-var">emptyDVarEnv</span></a></span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addEqToCans"><span class="hs-identifier hs-type">addEqToCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1221"></span><span id="addEqToCans"><span class="annot"><span class="annottext">addEqToCans :: TcLevel -&gt; EqCt -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#addEqToCans"><span class="hs-identifier hs-var hs-var">addEqToCans</span></a></span></span><span> </span><span id="local-6989586621682547596"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547596"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621682547597"><span class="annot"><span class="annottext">eq_ct :: EqCt
</span><a href="#local-6989586621682547597"><span class="hs-identifier hs-var">eq_ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547600"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547600"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>            </span><span id="local-6989586621682547601"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621682547601"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547602"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547602"><span class="hs-identifier hs-var">funeqs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547603"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547603"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updGivenEqs"><span class="hs-identifier hs-var">updGivenEqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547596"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547597"><span class="hs-identifier hs-var">eq_ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; InertCans -&gt; InertCans
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1224"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547600"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1225"></span><span>       </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682547606"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547606"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682547607"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547607"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547601"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addCanFunEq"><span class="hs-identifier hs-type">addCanFunEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547602"><span class="hs-identifier hs-type">funeqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547606"><span class="hs-identifier hs-type">tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547607"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547597"><span class="hs-identifier hs-type">eq_ct</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1226"></span><span>       </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547610"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547610"><span class="hs-identifier hs-var">tv</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547601"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addTyEq"><span class="hs-identifier hs-type">addTyEq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547603"><span class="hs-identifier hs-type">eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547610"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547597"><span class="hs-identifier hs-type">eq_ct</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addTyEq"><span class="hs-identifier hs-type">addTyEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-1229"></span><span id="addTyEq"><span class="annot"><span class="annottext">addTyEq :: InertEqs -&gt; TcTyVar -&gt; EqCt -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addTyEq"><span class="hs-identifier hs-var hs-var">addTyEq</span></a></span></span><span> </span><span id="local-6989586621682547612"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547612"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span> </span><span id="local-6989586621682547613"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547613"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682547614"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547614"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1230"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqualCtList -&gt; EqualCtList -&gt; EqualCtList)
-&gt; InertEqs -&gt; TcTyVar -&gt; EqualCtList -&gt; InertEqs
forall a. (a -&gt; a -&gt; a) -&gt; DVarEnv a -&gt; TcTyVar -&gt; a -&gt; DVarEnv a
</span><a href="GHC.Types.Var.Env.html#extendDVarEnv_C"><span class="hs-identifier hs-var">extendDVarEnv_C</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; EqualCtList -&gt; EqualCtList
</span><a href="#local-6989586621682547616"><span class="hs-identifier hs-var">add_eq</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547612"><span class="hs-identifier hs-var">old_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547613"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547614"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1232"></span><span>    </span><span id="local-6989586621682547616"><span class="annot"><span class="annottext">add_eq :: EqualCtList -&gt; EqualCtList -&gt; EqualCtList
</span><a href="#local-6989586621682547616"><span class="hs-identifier hs-var hs-var">add_eq</span></a></span></span><span> </span><span id="local-6989586621682547617"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547617"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; EqualCtList -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Types.html#addToEqualCtList"><span class="hs-identifier hs-var">addToEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547614"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547617"><span class="hs-identifier hs-var">old_eqs</span></a></span><span>
</span><span id="line-1233"></span><span>
</span><span id="line-1234"></span><span id="local-6989586621682547161"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier hs-type">foldTyEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547161"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547161"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547161"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547161"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1235"></span><span id="foldTyEqs"><span class="annot"><span class="annottext">foldTyEqs :: forall b. (EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier hs-var hs-var">foldTyEqs</span></a></span></span><span> </span><span id="local-6989586621682547620"><span class="annot"><span class="annottext">EqCt -&gt; b -&gt; b
</span><a href="#local-6989586621682547620"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682547621"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547621"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621682547622"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547622"><span class="hs-identifier hs-var">z</span></a></span></span><span>
</span><span id="line-1236"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqualCtList -&gt; b -&gt; b) -&gt; b -&gt; InertEqs -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; DVarEnv a -&gt; b
</span><a href="GHC.Types.Var.Env.html#foldDVarEnv"><span class="hs-identifier hs-var">foldDVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682547624"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547624"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span id="local-6989586621682547625"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547625"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; b -&gt; b) -&gt; b -&gt; EqualCtList -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; b -&gt; b
</span><a href="#local-6989586621682547620"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547625"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547624"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547622"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547621"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#findTyEqs"><span class="hs-identifier hs-type">findTyEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1239"></span><span id="findTyEqs"><span class="annot"><span class="annottext">findTyEqs :: InertCans -&gt; TcTyVar -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.InertSet.html#findTyEqs"><span class="hs-identifier hs-var hs-var">findTyEqs</span></a></span></span><span> </span><span id="local-6989586621682547628"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547628"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span id="local-6989586621682547629"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547629"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertEqs -&gt; TcTyVar -&gt; Maybe EqualCtList
forall a. DVarEnv a -&gt; TcTyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupDVarEnv"><span class="hs-identifier hs-var">lookupDVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547628"><span class="hs-identifier hs-var">icans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547629"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delEq"><span class="hs-identifier hs-type">delEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1242"></span><span id="delEq"><span class="annot"><span class="annottext">delEq :: EqCt -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#delEq"><span class="hs-identifier hs-var hs-var">delEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547632"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547632"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_rhs :: EqCt -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#eq_rhs"><span class="hs-identifier hs-var">eq_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547634"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547634"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547635"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547635"><span class="hs-identifier hs-var">ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547632"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1243"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547636"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547636"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1244"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547635"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#alterDVarEnv"><span class="hs-identifier hs-type">alterDVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547638"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547635"><span class="hs-identifier hs-type">ic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682547636"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1245"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682547639"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547639"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span id="local-6989586621682547640"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547640"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1246"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547635"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#alterTcApp"><span class="hs-identifier hs-type">alterTcApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547635"><span class="hs-identifier hs-type">ic</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682547639"><span class="hs-identifier hs-type">tf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547640"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547638"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1248"></span><span>    </span><span class="annot"><a href="#local-6989586621682547642"><span class="hs-identifier hs-type">isThisOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1249"></span><span>    </span><span id="local-6989586621682547642"><span class="annot"><span class="annottext">isThisOne :: EqCt -&gt; Bool
</span><a href="#local-6989586621682547642"><span class="hs-identifier hs-var hs-var">isThisOne</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_rhs :: EqCt -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#eq_rhs"><span class="hs-identifier hs-var">eq_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547643"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547643"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTypeNoKindCheck"><span class="hs-identifier hs-var">tcEqTypeNoKindCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547634"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547643"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1250"></span><span>
</span><span id="line-1251"></span><span>    </span><span class="annot"><a href="#local-6989586621682547638"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span>
</span><span id="line-1252"></span><span>    </span><span id="local-6989586621682547638"><span class="annot"><span class="annottext">upd :: Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621682547638"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682547645"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547645"><span class="hs-identifier hs-var">eq_ct_list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Bool) -&gt; EqualCtList -&gt; Maybe EqualCtList
</span><a href="GHC.Tc.Solver.Types.html#filterEqualCtList"><span class="hs-identifier hs-var">filterEqualCtList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (EqCt -&gt; Bool) -&gt; EqCt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682547642"><span class="hs-identifier hs-var">isThisOne</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547645"><span class="hs-identifier hs-var">eq_ct_list</span></a></span><span>
</span><span id="line-1253"></span><span>    </span><span class="annot"><a href="#local-6989586621682547638"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList
</span><span class="hs-identifier hs-var">Nothing</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#findEq"><span class="hs-identifier hs-type">findEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1256"></span><span id="findEq"><span class="annot"><span class="annottext">findEq :: InertCans -&gt; CanEqLHS -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.InertSet.html#findEq"><span class="hs-identifier hs-var hs-var">findEq</span></a></span></span><span> </span><span id="local-6989586621682547649"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547649"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547650"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547650"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans -&gt; TcTyVar -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.InertSet.html#findTyEqs"><span class="hs-identifier hs-var">findTyEqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547649"><span class="hs-identifier hs-var">icans</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547650"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1257"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#findEq"><span class="hs-identifier hs-var">findEq</span></a></span><span> </span><span id="local-6989586621682547651"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547651"><span class="hs-identifier hs-var">icans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682547652"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547652"><span class="hs-identifier hs-var">fun_tc</span></a></span></span><span> </span><span id="local-6989586621682547653"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547653"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertFunEqs -&gt; TyCon -&gt; [Type] -&gt; Maybe EqualCtList
forall a. FunEqMap a -&gt; TyCon -&gt; [Type] -&gt; Maybe a
</span><a href="GHC.Tc.Solver.Types.html#findFunEq"><span class="hs-identifier hs-var">findFunEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547651"><span class="hs-identifier hs-var">icans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547652"><span class="hs-identifier hs-var">fun_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547653"><span class="hs-identifier hs-var">fun_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>
</span><span id="line-1260"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partition_eqs_container"><span class="hs-pragma hs-type">partition_eqs_container</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1261"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partition_eqs_container"><span class="hs-identifier hs-type">partition_eqs_container</span></a></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682547181"><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span></span><span>
</span><span id="line-1263"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span>    </span><span class="hs-comment">-- empty container</span><span>
</span><span id="line-1264"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682547182"><span class="annot"><a href="#local-6989586621682547182"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547182"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547182"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547182"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547182"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- folder</span><span>
</span><span id="line-1265"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- extender</span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span>
</span><span id="line-1268"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span id="partition_eqs_container"><span class="annot"><span class="annottext">partition_eqs_container :: forall container.
container
-&gt; (forall b. (EqCt -&gt; b -&gt; b) -&gt; container -&gt; b -&gt; b)
-&gt; (EqCt -&gt; container -&gt; container)
-&gt; (EqCt -&gt; Bool)
-&gt; container
-&gt; (EqualCtList, container)
</span><a href="GHC.Tc.Solver.InertSet.html#partition_eqs_container"><span class="hs-identifier hs-var hs-var">partition_eqs_container</span></a></span></span><span> </span><span id="local-6989586621682547656"><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547656"><span class="hs-identifier hs-var">empty_container</span></a></span></span><span> </span><span id="local-6989586621682547657"><span class="annot"><span class="annottext">forall b. (EqCt -&gt; b -&gt; b) -&gt; container -&gt; b -&gt; b
</span><a href="#local-6989586621682547657"><span class="hs-identifier hs-var">fold_container</span></a></span></span><span> </span><span id="local-6989586621682547658"><span class="annot"><span class="annottext">EqCt -&gt; container -&gt; container
</span><a href="#local-6989586621682547658"><span class="hs-identifier hs-var">extend_container</span></a></span></span><span> </span><span id="local-6989586621682547659"><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682547659"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621682547660"><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547660"><span class="hs-identifier hs-var">orig_inerts</span></a></span></span><span>
</span><span id="line-1270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; (EqualCtList, container) -&gt; (EqualCtList, container))
-&gt; container
-&gt; (EqualCtList, container)
-&gt; (EqualCtList, container)
forall b. (EqCt -&gt; b -&gt; b) -&gt; container -&gt; b -&gt; b
</span><a href="#local-6989586621682547657"><span class="hs-identifier hs-var">fold_container</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; (EqualCtList, container) -&gt; (EqualCtList, container)
</span><a href="#local-6989586621682547661"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547660"><span class="hs-identifier hs-var">orig_inerts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547656"><span class="hs-identifier hs-var">empty_container</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1272"></span><span>    </span><span class="annot"><a href="#local-6989586621682547661"><span class="hs-identifier hs-type">folder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682547181"><span class="hs-identifier hs-type">container</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1273"></span><span>    </span><span id="local-6989586621682547661"><span class="annot"><span class="annottext">folder :: EqCt -&gt; (EqualCtList, container) -&gt; (EqualCtList, container)
</span><a href="#local-6989586621682547661"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span id="local-6989586621682547662"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547662"><span class="hs-identifier hs-var">eq_ct</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682547663"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547663"><span class="hs-identifier hs-var">acc_true</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547664"><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547664"><span class="hs-identifier hs-var">acc_false</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682547659"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547662"><span class="hs-identifier hs-var">eq_ct</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547662"><span class="hs-identifier hs-var">eq_ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; EqualCtList -&gt; EqualCtList
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547663"><span class="hs-identifier hs-var">acc_true</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547664"><span class="hs-identifier hs-var">acc_false</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547663"><span class="hs-identifier hs-var">acc_true</span></a></span><span class="hs-special">,</span><span>         </span><span class="annot"><span class="annottext">EqCt -&gt; container -&gt; container
</span><a href="#local-6989586621682547658"><span class="hs-identifier hs-var">extend_container</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547662"><span class="hs-identifier hs-var">eq_ct</span></a></span><span> </span><span class="annot"><span class="annottext">container
</span><a href="#local-6989586621682547664"><span class="hs-identifier hs-var">acc_false</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partitionInertEqs"><span class="hs-identifier hs-type">partitionInertEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- EqCt will always have a TyVarLHS</span><span>
</span><span id="line-1278"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-1279"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span id="partitionInertEqs"><span class="annot"><span class="annottext">partitionInertEqs :: (EqCt -&gt; Bool) -&gt; InertEqs -&gt; (EqualCtList, InertEqs)
</span><a href="GHC.Tc.Solver.InertSet.html#partitionInertEqs"><span class="hs-identifier hs-var hs-var">partitionInertEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs
-&gt; (forall b. (EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b)
-&gt; (EqCt -&gt; InertEqs -&gt; InertEqs)
-&gt; (EqCt -&gt; Bool)
-&gt; InertEqs
-&gt; (EqualCtList, InertEqs)
forall container.
container
-&gt; (forall b. (EqCt -&gt; b -&gt; b) -&gt; container -&gt; b -&gt; b)
-&gt; (EqCt -&gt; container -&gt; container)
-&gt; (EqCt -&gt; Bool)
-&gt; container
-&gt; (EqualCtList, container)
</span><a href="GHC.Tc.Solver.InertSet.html#partition_eqs_container"><span class="hs-identifier hs-var">partition_eqs_container</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#emptyTyEqs"><span class="hs-identifier hs-var">emptyTyEqs</span></a></span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
forall b. (EqCt -&gt; b -&gt; b) -&gt; InertEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldTyEqs"><span class="hs-identifier hs-var">foldTyEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; InertEqs -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addInertEqs"><span class="hs-identifier hs-var">addInertEqs</span></a></span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addInertEqs"><span class="hs-identifier hs-type">addInertEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertEqs"><span class="hs-identifier hs-type">InertEqs</span></a></span><span>
</span><span id="line-1283"></span><span class="hs-comment">-- Precondition: CanEqLHS is a TyVarLHS</span><span>
</span><span id="line-1284"></span><span id="addInertEqs"><span class="annot"><span class="annottext">addInertEqs :: EqCt -&gt; InertEqs -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addInertEqs"><span class="hs-identifier hs-var hs-var">addInertEqs</span></a></span></span><span> </span><span id="local-6989586621682547666"><span class="annot"><span class="annottext">eq_ct :: EqCt
</span><a href="#local-6989586621682547666"><span class="hs-identifier hs-var">eq_ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547667"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547667"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547668"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547668"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertEqs -&gt; TcTyVar -&gt; EqCt -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addTyEq"><span class="hs-identifier hs-var">addTyEq</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547668"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547667"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547666"><span class="hs-identifier hs-var">eq_ct</span></a></span><span>
</span><span id="line-1285"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addInertEqs"><span class="hs-identifier hs-var">addInertEqs</span></a></span><span> </span><span id="local-6989586621682547669"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547669"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; InertEqs
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extendInertEqs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547669"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addCanFunEq"><span class="hs-identifier hs-type">addCanFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span>
</span><span id="line-1290"></span><span id="addCanFunEq"><span class="annot"><span class="annottext">addCanFunEq :: InertFunEqs -&gt; TyCon -&gt; [Type] -&gt; EqCt -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addCanFunEq"><span class="hs-identifier hs-var hs-var">addCanFunEq</span></a></span></span><span> </span><span id="local-6989586621682547671"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547671"><span class="hs-identifier hs-var">old_eqs</span></a></span></span><span> </span><span id="local-6989586621682547672"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547672"><span class="hs-identifier hs-var">fun_tc</span></a></span></span><span> </span><span id="local-6989586621682547673"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547673"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span> </span><span id="local-6989586621682547674"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547674"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1291"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertFunEqs
-&gt; TyCon
-&gt; [Type]
-&gt; (Maybe EqualCtList -&gt; Maybe EqualCtList)
-&gt; InertFunEqs
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; XT a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#alterTcApp"><span class="hs-identifier hs-var">alterTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547671"><span class="hs-identifier hs-var">old_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547672"><span class="hs-identifier hs-var">fun_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547673"><span class="hs-identifier hs-var">fun_args</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621682547675"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1293"></span><span>    </span><span id="local-6989586621682547675"><span class="annot"><span class="annottext">upd :: Maybe EqualCtList -&gt; Maybe EqualCtList
</span><a href="#local-6989586621682547675"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682547676"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547676"><span class="hs-identifier hs-var">old_equal_ct_list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; Maybe EqualCtList
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EqualCtList -&gt; Maybe EqualCtList)
-&gt; EqualCtList -&gt; Maybe EqualCtList
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; EqualCtList -&gt; EqualCtList
</span><a href="GHC.Tc.Solver.Types.html#addToEqualCtList"><span class="hs-identifier hs-var">addToEqualCtList</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547674"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547676"><span class="hs-identifier hs-var">old_equal_ct_list</span></a></span><span>
</span><span id="line-1294"></span><span>    </span><span class="annot"><a href="#local-6989586621682547675"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EqualCtList
</span><span class="hs-identifier hs-var">Nothing</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqualCtList -&gt; Maybe EqualCtList
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547674"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1295"></span><span>
</span><span id="line-1296"></span><span id="local-6989586621682547163"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier hs-type">foldFunEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547163"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547163"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#FunEqMap"><span class="hs-identifier hs-type">FunEqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#EqualCtList"><span class="hs-identifier hs-type">EqualCtList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547163"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547163"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1297"></span><span id="foldFunEqs"><span class="annot"><span class="annottext">foldFunEqs :: forall b. (EqCt -&gt; b -&gt; b) -&gt; InertFunEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier hs-var hs-var">foldFunEqs</span></a></span></span><span> </span><span id="local-6989586621682547678"><span class="annot"><span class="annottext">EqCt -&gt; b -&gt; b
</span><a href="#local-6989586621682547678"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682547679"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547679"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span> </span><span id="local-6989586621682547680"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547680"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqualCtList -&gt; b -&gt; b) -&gt; InertFunEqs -&gt; b -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682547682"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547682"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621682547683"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547683"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; b -&gt; b) -&gt; b -&gt; EqualCtList -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; b -&gt; b
</span><a href="#local-6989586621682547678"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547683"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547682"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547679"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547680"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partitionFunEqs"><span class="hs-identifier hs-type">partitionFunEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- EqCt will have a TyFamLHS</span><span>
</span><span id="line-1300"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span>
</span><span id="line-1301"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span id="partitionFunEqs"><span class="annot"><span class="annottext">partitionFunEqs :: (EqCt -&gt; Bool) -&gt; InertFunEqs -&gt; (EqualCtList, InertFunEqs)
</span><a href="GHC.Tc.Solver.InertSet.html#partitionFunEqs"><span class="hs-identifier hs-var hs-var">partitionFunEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertFunEqs
-&gt; (forall b. (EqCt -&gt; b -&gt; b) -&gt; InertFunEqs -&gt; b -&gt; b)
-&gt; (EqCt -&gt; InertFunEqs -&gt; InertFunEqs)
-&gt; (EqCt -&gt; Bool)
-&gt; InertFunEqs
-&gt; (EqualCtList, InertFunEqs)
forall container.
container
-&gt; (forall b. (EqCt -&gt; b -&gt; b) -&gt; container -&gt; b -&gt; b)
-&gt; (EqCt -&gt; container -&gt; container)
-&gt; (EqCt -&gt; Bool)
-&gt; container
-&gt; (EqualCtList, container)
</span><a href="GHC.Tc.Solver.InertSet.html#partition_eqs_container"><span class="hs-identifier hs-var">partition_eqs_container</span></a></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyFunEqs"><span class="hs-identifier hs-var">emptyFunEqs</span></a></span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; b -&gt; b) -&gt; InertFunEqs -&gt; b -&gt; b
forall b. (EqCt -&gt; b -&gt; b) -&gt; InertFunEqs -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldFunEqs"><span class="hs-identifier hs-var">foldFunEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; InertFunEqs -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addFunEqs"><span class="hs-identifier hs-var">addFunEqs</span></a></span><span>
</span><span id="line-1303"></span><span>
</span><span id="line-1304"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addFunEqs"><span class="hs-identifier hs-type">addFunEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertFunEqs"><span class="hs-identifier hs-type">InertFunEqs</span></a></span><span>
</span><span id="line-1305"></span><span class="hs-comment">-- Precondition: EqCt is a TyFamLHS</span><span>
</span><span id="line-1306"></span><span id="addFunEqs"><span class="annot"><span class="annottext">addFunEqs :: EqCt -&gt; InertFunEqs -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addFunEqs"><span class="hs-identifier hs-var hs-var">addFunEqs</span></a></span></span><span> </span><span id="local-6989586621682547685"><span class="annot"><span class="annottext">eq_ct :: EqCt
</span><a href="#local-6989586621682547685"><span class="hs-identifier hs-var">eq_ct</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682547686"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547686"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682547687"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547687"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547688"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547688"><span class="hs-identifier hs-var">fun_eqs</span></a></span></span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertFunEqs -&gt; TyCon -&gt; [Type] -&gt; EqCt -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#addCanFunEq"><span class="hs-identifier hs-var">addCanFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547688"><span class="hs-identifier hs-var">fun_eqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547686"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547687"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547685"><span class="hs-identifier hs-var">eq_ct</span></a></span><span>
</span><span id="line-1308"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addFunEqs"><span class="hs-identifier hs-var">addFunEqs</span></a></span><span> </span><span id="local-6989586621682547689"><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547689"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; InertFunEqs
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extendFunEqs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqCt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt
</span><a href="#local-6989586621682547689"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Inert Dicts
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1317"></span><span>
</span><span id="line-1318"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updDicts"><span class="hs-identifier hs-type">updDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1319"></span><span id="updDicts"><span class="annot"><span class="annottext">updDicts :: (DictMap DictCt -&gt; DictMap DictCt) -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updDicts"><span class="hs-identifier hs-var hs-var">updDicts</span></a></span></span><span> </span><span id="local-6989586621682547690"><span class="annot"><span class="annottext">DictMap DictCt -&gt; DictMap DictCt
</span><a href="#local-6989586621682547690"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621682547691"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547691"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547691"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547690"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547691"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span id="local-6989586621682547190"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delDict"><span class="hs-identifier hs-type">delDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547190"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547190"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1322"></span><span id="delDict"><span class="annot"><span class="annottext">delDict :: forall a. DictCt -&gt; DictMap a -&gt; DictMap a
</span><a href="GHC.Tc.Solver.InertSet.html#delDict"><span class="hs-identifier hs-var hs-var">delDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_cls :: DictCt -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#di_cls"><span class="hs-identifier hs-var">di_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547694"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547694"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_tys :: DictCt -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#di_tys"><span class="hs-identifier hs-var">di_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547696"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547696"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547697"><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682547697"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-1323"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap a -&gt; TyCon -&gt; [Type] -&gt; DictMap a
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#delTcApp"><span class="hs-identifier hs-var">delTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap a
</span><a href="#local-6989586621682547697"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547694"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547696"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1324"></span><span>
</span><span id="line-1325"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addDict"><span class="hs-identifier hs-type">addDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-1326"></span><span id="addDict"><span class="annot"><span class="annottext">addDict :: DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#addDict"><span class="hs-identifier hs-var hs-var">addDict</span></a></span></span><span> </span><span id="local-6989586621682547699"><span class="annot"><span class="annottext">item :: DictCt
</span><a href="#local-6989586621682547699"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_cls :: DictCt -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#di_cls"><span class="hs-identifier hs-var">di_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547700"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547700"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_tys :: DictCt -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#di_tys"><span class="hs-identifier hs-var">di_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547701"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547701"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547702"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547702"><span class="hs-identifier hs-var">dm</span></a></span></span><span>
</span><span id="line-1327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt -&gt; TyCon -&gt; [Type] -&gt; DictCt -&gt; DictMap DictCt
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547702"><span class="hs-identifier hs-var">dm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547700"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547701"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621682547699"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-1328"></span><span>
</span><span id="line-1329"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addSolvedDict"><span class="hs-identifier hs-type">addSolvedDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-1330"></span><span id="addSolvedDict"><span class="annot"><span class="annottext">addSolvedDict :: DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#addSolvedDict"><span class="hs-identifier hs-var hs-var">addSolvedDict</span></a></span></span><span> </span><span id="local-6989586621682547704"><span class="annot"><span class="annottext">item :: DictCt
</span><a href="#local-6989586621682547704"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_cls :: DictCt -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#di_cls"><span class="hs-identifier hs-var">di_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547705"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547705"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_tys :: DictCt -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#di_tys"><span class="hs-identifier hs-var">di_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547706"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547706"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547707"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547707"><span class="hs-identifier hs-var">dm</span></a></span></span><span>
</span><span id="line-1331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt -&gt; TyCon -&gt; [Type] -&gt; DictCt -&gt; DictMap DictCt
forall a. TcAppMap a -&gt; TyCon -&gt; [Type] -&gt; a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#insertTcApp"><span class="hs-identifier hs-var">insertTcApp</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547707"><span class="hs-identifier hs-var">dm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547705"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547706"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621682547704"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-1332"></span><span>
</span><span id="line-1333"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#filterDicts"><span class="hs-identifier hs-type">filterDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span>
</span><span id="line-1334"></span><span id="filterDicts"><span class="annot"><span class="annottext">filterDicts :: (DictCt -&gt; Bool) -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#filterDicts"><span class="hs-identifier hs-var hs-var">filterDicts</span></a></span></span><span> </span><span id="local-6989586621682547708"><span class="annot"><span class="annottext">DictCt -&gt; Bool
</span><a href="#local-6989586621682547708"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682547709"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547709"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; Bool) -&gt; DictMap DictCt -&gt; DictMap DictCt
forall a. (a -&gt; Bool) -&gt; TcAppMap a -&gt; TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#filterTcAppMap"><span class="hs-identifier hs-var">filterTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Bool
</span><a href="#local-6989586621682547708"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547709"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#partitionDicts"><span class="hs-identifier hs-type">partitionDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Types.html#DictMap"><span class="hs-identifier hs-type">DictMap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1337"></span><span id="partitionDicts"><span class="annot"><span class="annottext">partitionDicts :: (DictCt -&gt; Bool) -&gt; DictMap DictCt -&gt; (Bag DictCt, DictMap DictCt)
</span><a href="GHC.Tc.Solver.InertSet.html#partitionDicts"><span class="hs-identifier hs-var hs-var">partitionDicts</span></a></span></span><span> </span><span id="local-6989586621682547711"><span class="annot"><span class="annottext">DictCt -&gt; Bool
</span><a href="#local-6989586621682547711"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682547712"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547712"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt
 -&gt; (Bag DictCt, DictMap DictCt) -&gt; (Bag DictCt, DictMap DictCt))
-&gt; DictMap DictCt
-&gt; (Bag DictCt, DictMap DictCt)
-&gt; (Bag DictCt, DictMap DictCt)
forall a b. (a -&gt; b -&gt; b) -&gt; TcAppMap a -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.Types.html#foldTcAppMap"><span class="hs-identifier hs-var">foldTcAppMap</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
-&gt; (Bag DictCt, DictMap DictCt) -&gt; (Bag DictCt, DictMap DictCt)
</span><a href="#local-6989586621682547713"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547712"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag DictCt
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
forall a. TcAppMap a
</span><a href="GHC.Tc.Solver.Types.html#emptyDictMap"><span class="hs-identifier hs-var">emptyDictMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1338"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1339"></span><span>    </span><span id="local-6989586621682547713"><span class="annot"><span class="annottext">k :: DictCt
-&gt; (Bag DictCt, DictMap DictCt) -&gt; (Bag DictCt, DictMap DictCt)
</span><a href="#local-6989586621682547713"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682547714"><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621682547714"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682547715"><span class="annot"><span class="annottext">Bag DictCt
</span><a href="#local-6989586621682547715"><span class="hs-identifier hs-var">yeses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547716"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547716"><span class="hs-identifier hs-var">noes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Bool
</span><a href="#local-6989586621682547711"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621682547714"><span class="hs-identifier hs-var">ct</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621682547714"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Bag DictCt -&gt; Bag DictCt
forall a. a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#consBag"><span class="hs-operator hs-var">`consBag`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag DictCt
</span><a href="#local-6989586621682547715"><span class="hs-identifier hs-var">yeses</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547716"><span class="hs-identifier hs-var">noes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag DictCt
</span><a href="#local-6989586621682547715"><span class="hs-identifier hs-var">yeses</span></a></span><span class="hs-special">,</span><span>              </span><span class="annot"><span class="annottext">DictCt -&gt; DictMap DictCt -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#addDict"><span class="hs-identifier hs-var">addDict</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt
</span><a href="#local-6989586621682547714"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547716"><span class="hs-identifier hs-var">noes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span>
</span><span id="line-1343"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                   Inert Irreds
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1348"></span><span>
</span><span id="line-1349"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrredToCans"><span class="hs-identifier hs-type">addIrredToCans</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1350"></span><span id="addIrredToCans"><span class="annot"><span class="annottext">addIrredToCans :: TcLevel -&gt; IrredCt -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#addIrredToCans"><span class="hs-identifier hs-var hs-var">addIrredToCans</span></a></span></span><span> </span><span id="local-6989586621682547717"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547717"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621682547718"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547718"><span class="hs-identifier hs-var">irred</span></a></span></span><span> </span><span id="local-6989586621682547719"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547719"><span class="hs-identifier hs-var">ics</span></a></span></span><span>
</span><span id="line-1351"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updGivenEqs"><span class="hs-identifier hs-var">updGivenEqs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547717"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IrredCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547718"><span class="hs-identifier hs-var">irred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InertCans -&gt; InertCans) -&gt; InertCans -&gt; InertCans
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1352"></span><span>    </span><span class="annot"><span class="annottext">(InertIrreds -&gt; InertIrreds) -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updIrreds"><span class="hs-identifier hs-var">updIrreds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IrredCt -&gt; InertIrreds -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#addIrred"><span class="hs-identifier hs-var">addIrred</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547718"><span class="hs-identifier hs-var">irred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547719"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-1353"></span><span>
</span><span id="line-1354"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrreds"><span class="hs-identifier hs-type">addIrreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span>
</span><span id="line-1355"></span><span id="addIrreds"><span class="annot"><span class="annottext">addIrreds :: [IrredCt] -&gt; InertIrreds -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#addIrreds"><span class="hs-identifier hs-var hs-var">addIrreds</span></a></span></span><span> </span><span id="local-6989586621682547721"><span class="annot"><span class="annottext">[IrredCt]
</span><a href="#local-6989586621682547721"><span class="hs-identifier hs-var">extras</span></a></span></span><span> </span><span id="local-6989586621682547722"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547722"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-1356"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[IrredCt] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[IrredCt]
</span><a href="#local-6989586621682547721"><span class="hs-identifier hs-var">extras</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547722"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1357"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547722"><span class="hs-identifier hs-var">irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds -&gt; InertIrreds -&gt; InertIrreds
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">[IrredCt] -&gt; InertIrreds
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[IrredCt]
</span><a href="#local-6989586621682547721"><span class="hs-identifier hs-var">extras</span></a></span><span>
</span><span id="line-1358"></span><span>
</span><span id="line-1359"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addIrred"><span class="hs-identifier hs-type">addIrred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span>
</span><span id="line-1360"></span><span id="addIrred"><span class="annot"><span class="annottext">addIrred :: IrredCt -&gt; InertIrreds -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#addIrred"><span class="hs-identifier hs-var hs-var">addIrred</span></a></span></span><span> </span><span id="local-6989586621682547724"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547724"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span id="local-6989586621682547725"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547725"><span class="hs-identifier hs-var">irreds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547725"><span class="hs-identifier hs-var">irreds</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds -&gt; IrredCt -&gt; InertIrreds
forall a. Bag a -&gt; a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#snocBag"><span class="hs-operator hs-var">`snocBag`</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547724"><span class="hs-identifier hs-var">extra</span></a></span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updIrreds"><span class="hs-identifier hs-type">updIrreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1363"></span><span id="updIrreds"><span class="annot"><span class="annottext">updIrreds :: (InertIrreds -&gt; InertIrreds) -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updIrreds"><span class="hs-identifier hs-var hs-var">updIrreds</span></a></span></span><span> </span><span id="local-6989586621682547727"><span class="annot"><span class="annottext">InertIrreds -&gt; InertIrreds
</span><a href="#local-6989586621682547727"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621682547728"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547728"><span class="hs-identifier hs-var">ics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547728"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547727"><span class="hs-identifier hs-type">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682547728"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1364"></span><span>
</span><span id="line-1365"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#delIrred"><span class="hs-identifier hs-type">delIrred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1366"></span><span class="hs-comment">-- Remove a particular (Given) Irred, on the instructions of a plugin</span><span>
</span><span id="line-1367"></span><span class="hs-comment">-- For some reason this is done vis the evidence Id, not the type</span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- Compare delEq.  I have not idea why</span><span>
</span><span id="line-1369"></span><span id="delIrred"><span class="annot"><span class="annottext">delIrred :: IrredCt -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#delIrred"><span class="hs-identifier hs-var hs-var">delIrred</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547731"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547731"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547732"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547732"><span class="hs-identifier hs-var">ics</span></a></span></span><span>
</span><span id="line-1370"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InertIrreds -&gt; InertIrreds) -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updIrreds"><span class="hs-identifier hs-var">updIrreds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IrredCt -&gt; Bool) -&gt; InertIrreds -&gt; InertIrreds
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Bool
</span><a href="#local-6989586621682547734"><span class="hs-identifier hs-var">keep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547732"><span class="hs-identifier hs-var">ics</span></a></span><span>
</span><span id="line-1371"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1372"></span><span>    </span><span id="local-6989586621682547735"><span class="annot"><span class="annottext">ev_id :: TcTyVar
</span><a href="#local-6989586621682547735"><span class="hs-identifier hs-var hs-var">ev_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctEvEvId"><span class="hs-identifier hs-var">ctEvEvId</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547731"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1373"></span><span>    </span><span id="local-6989586621682547734"><span class="annot"><span class="annottext">keep :: IrredCt -&gt; Bool
</span><a href="#local-6989586621682547734"><span class="hs-identifier hs-var hs-var">keep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ir_ev :: IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ir_ev"><span class="hs-identifier hs-var">ir_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547737"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547737"><span class="hs-identifier hs-var">ev'</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547735"><span class="hs-identifier hs-var">ev_id</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctEvEvId"><span class="hs-identifier hs-var">ctEvEvId</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547737"><span class="hs-identifier hs-var">ev'</span></a></span><span>
</span><span id="line-1374"></span><span>
</span><span id="line-1375"></span><span id="local-6989586621682547199"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#foldIrreds"><span class="hs-identifier hs-type">foldIrreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547199"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547199"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547199"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547199"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1376"></span><span id="foldIrreds"><span class="annot"><span class="annottext">foldIrreds :: forall b. (IrredCt -&gt; b -&gt; b) -&gt; InertIrreds -&gt; b -&gt; b
</span><a href="GHC.Tc.Solver.InertSet.html#foldIrreds"><span class="hs-identifier hs-var hs-var">foldIrreds</span></a></span></span><span> </span><span id="local-6989586621682547740"><span class="annot"><span class="annottext">IrredCt -&gt; b -&gt; b
</span><a href="#local-6989586621682547740"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682547741"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547741"><span class="hs-identifier hs-var">irreds</span></a></span></span><span> </span><span id="local-6989586621682547742"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547742"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; b -&gt; b) -&gt; b -&gt; InertIrreds -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Bag a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; b -&gt; b
</span><a href="#local-6989586621682547740"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682547742"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547741"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1377"></span><span>
</span><span id="line-1378"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#findMatchingIrreds"><span class="hs-identifier hs-type">findMatchingIrreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1379"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#IrredCt"><span class="hs-identifier hs-type">IrredCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertIrreds"><span class="hs-identifier hs-type">InertIrreds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span id="findMatchingIrreds"><span class="annot"><span class="annottext">findMatchingIrreds :: InertIrreds -&gt; CtEvidence -&gt; (Bag (IrredCt, SwapFlag), InertIrreds)
</span><a href="GHC.Tc.Solver.InertSet.html#findMatchingIrreds"><span class="hs-identifier hs-var hs-var">findMatchingIrreds</span></a></span></span><span> </span><span id="local-6989586621682547743"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547743"><span class="hs-identifier hs-var">irreds</span></a></span></span><span> </span><span id="local-6989586621682547744"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547744"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-1381"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621682547745"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547745"><span class="hs-identifier hs-var">eq_rel1</span></a></span></span><span> </span><span id="local-6989586621682547746"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547746"><span class="hs-identifier hs-var">lty1</span></a></span></span><span> </span><span id="local-6989586621682547747"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547747"><span class="hs-identifier hs-var">rty1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547748"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-1382"></span><span>    </span><span class="hs-comment">-- See Note [Solving irreducible equalities]</span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt)
-&gt; InertIrreds -&gt; (Bag (IrredCt, SwapFlag), InertIrreds)
forall a b c. (a -&gt; Either b c) -&gt; Bag a -&gt; (Bag b, Bag c)
</span><a href="GHC.Data.Bag.html#partitionBagWith"><span class="hs-identifier hs-var">partitionBagWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel
-&gt; Type -&gt; Type -&gt; IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt
</span><a href="#local-6989586621682547750"><span class="hs-identifier hs-var">match_eq</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547745"><span class="hs-identifier hs-var">eq_rel1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547746"><span class="hs-identifier hs-var">lty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547747"><span class="hs-identifier hs-var">rty1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547743"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1384"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt)
-&gt; InertIrreds -&gt; (Bag (IrredCt, SwapFlag), InertIrreds)
forall a b c. (a -&gt; Either b c) -&gt; Bag a -&gt; (Bag b, Bag c)
</span><a href="GHC.Data.Bag.html#partitionBagWith"><span class="hs-identifier hs-var">partitionBagWith</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt
</span><a href="#local-6989586621682547751"><span class="hs-identifier hs-var">match_non_eq</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547743"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1387"></span><span>    </span><span id="local-6989586621682547748"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682547748"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547744"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1388"></span><span>    </span><span id="local-6989586621682547751"><span class="annot"><span class="annottext">match_non_eq :: IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt
</span><a href="#local-6989586621682547751"><span class="hs-identifier hs-var hs-var">match_non_eq</span></a></span></span><span> </span><span id="local-6989586621682547752"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547752"><span class="hs-identifier hs-var">irred</span></a></span></span><span>
</span><span id="line-1389"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#irredCtPred"><span class="hs-identifier hs-var">irredCtPred</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547752"><span class="hs-identifier hs-var">irred</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTypeNoKindCheck"><span class="hs-operator hs-var">`tcEqTypeNoKindCheck`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547748"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt, SwapFlag) -&gt; Either (IrredCt, SwapFlag) IrredCt
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547752"><span class="hs-identifier hs-var">irred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1390"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547752"><span class="hs-identifier hs-var">irred</span></a></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>    </span><span id="local-6989586621682547750"><span class="annot"><span class="annottext">match_eq :: EqRel
-&gt; Type -&gt; Type -&gt; IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt
</span><a href="#local-6989586621682547750"><span class="hs-identifier hs-var hs-var">match_eq</span></a></span></span><span> </span><span id="local-6989586621682547757"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547757"><span class="hs-identifier hs-var">eq_rel1</span></a></span></span><span> </span><span id="local-6989586621682547758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547758"><span class="hs-identifier hs-var">lty1</span></a></span></span><span> </span><span id="local-6989586621682547759"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547759"><span class="hs-identifier hs-var">rty1</span></a></span></span><span> </span><span id="local-6989586621682547760"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547760"><span class="hs-identifier hs-var">irred</span></a></span></span><span>
</span><span id="line-1393"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621682547761"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547761"><span class="hs-identifier hs-var">eq_rel2</span></a></span></span><span> </span><span id="local-6989586621682547762"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547762"><span class="hs-identifier hs-var">lty2</span></a></span></span><span> </span><span id="local-6989586621682547763"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547763"><span class="hs-identifier hs-var">rty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IrredCt -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#irredCtPred"><span class="hs-identifier hs-var">irredCtPred</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547760"><span class="hs-identifier hs-var">irred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547757"><span class="hs-identifier hs-var">eq_rel1</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547761"><span class="hs-identifier hs-var">eq_rel2</span></a></span><span>
</span><span id="line-1395"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682547764"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682547764"><span class="hs-identifier hs-var">swap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type -&gt; Maybe SwapFlag
</span><a href="#local-6989586621682547765"><span class="hs-identifier hs-var">match_eq_help</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547758"><span class="hs-identifier hs-var">lty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547759"><span class="hs-identifier hs-var">rty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547762"><span class="hs-identifier hs-var">lty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547763"><span class="hs-identifier hs-var">rty2</span></a></span><span>
</span><span id="line-1396"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt, SwapFlag) -&gt; Either (IrredCt, SwapFlag) IrredCt
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547760"><span class="hs-identifier hs-var">irred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682547764"><span class="hs-identifier hs-var">swap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1397"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1398"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Either (IrredCt, SwapFlag) IrredCt
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547760"><span class="hs-identifier hs-var">irred</span></a></span><span>
</span><span id="line-1399"></span><span>
</span><span id="line-1400"></span><span>    </span><span id="local-6989586621682547765"><span class="annot"><span class="annottext">match_eq_help :: Type -&gt; Type -&gt; Type -&gt; Type -&gt; Maybe SwapFlag
</span><a href="#local-6989586621682547765"><span class="hs-identifier hs-var hs-var">match_eq_help</span></a></span></span><span> </span><span id="local-6989586621682547766"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547766"><span class="hs-identifier hs-var">lty1</span></a></span></span><span> </span><span id="local-6989586621682547767"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547767"><span class="hs-identifier hs-var">rty1</span></a></span></span><span> </span><span id="local-6989586621682547768"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547768"><span class="hs-identifier hs-var">lty2</span></a></span></span><span> </span><span id="local-6989586621682547769"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547769"><span class="hs-identifier hs-var">rty2</span></a></span></span><span>
</span><span id="line-1401"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547766"><span class="hs-identifier hs-var">lty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTypeNoKindCheck"><span class="hs-operator hs-var">`tcEqTypeNoKindCheck`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547768"><span class="hs-identifier hs-var">lty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547767"><span class="hs-identifier hs-var">rty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTypeNoKindCheck"><span class="hs-operator hs-var">`tcEqTypeNoKindCheck`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547769"><span class="hs-identifier hs-var">rty2</span></a></span><span>
</span><span id="line-1402"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; Maybe SwapFlag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span>
</span><span id="line-1403"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547766"><span class="hs-identifier hs-var">lty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTypeNoKindCheck"><span class="hs-operator hs-var">`tcEqTypeNoKindCheck`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547769"><span class="hs-identifier hs-var">rty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547767"><span class="hs-identifier hs-var">rty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTypeNoKindCheck"><span class="hs-operator hs-var">`tcEqTypeNoKindCheck`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547768"><span class="hs-identifier hs-var">lty2</span></a></span><span>
</span><span id="line-1404"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; Maybe SwapFlag
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span>
</span><span id="line-1405"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1406"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SwapFlag
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1407"></span><span>
</span><span id="line-1408"></span><span class="hs-comment">{- Note [Solving irreducible equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#14333)
  [G] a b ~R# c d
  [W] c d ~R# a b
Clearly we should be able to solve this! Even though the constraints are
not decomposable. We solve this when looking up the work-item in the
irreducible constraints to look for an identical one.  When doing this
lookup, findMatchingIrreds spots the equality case, and matches either
way around. It has to return a swap-flag so we can generate evidence
that is the right way round too.
-}</span><span>
</span><span id="line-1420"></span><span>
</span><span id="line-1421"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Adding to and removing from the inert set
*                                                                      *
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#updGivenEqs"><span class="hs-identifier hs-type">updGivenEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span>
</span><span id="line-1429"></span><span class="hs-comment">-- Set the inert_given_eq_level to the current level (tclvl)</span><span>
</span><span id="line-1430"></span><span class="hs-comment">-- if the constraint is a given equality that should prevent</span><span>
</span><span id="line-1431"></span><span class="hs-comment">-- filling in an outer unification variable.</span><span>
</span><span id="line-1432"></span><span class="hs-comment">-- See Note [Tracking Given equalities]</span><span>
</span><span id="line-1433"></span><span id="updGivenEqs"><span class="annot"><span class="annottext">updGivenEqs :: TcLevel -&gt; Ct -&gt; InertCans -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#updGivenEqs"><span class="hs-identifier hs-var hs-var">updGivenEqs</span></a></span></span><span> </span><span id="local-6989586621682547771"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547771"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621682547772"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547772"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621682547773"><span class="annot"><span class="annottext">inerts :: InertCans
</span><a href="#local-6989586621682547773"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_given_eq_lvl :: InertCans -&gt; TcLevel
</span><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547774"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547774"><span class="hs-identifier hs-var">ge_lvl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547772"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547773"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621682547776"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547772"><span class="hs-identifier hs-var">ct</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547773"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-comment">-- See Note [Let-bound skolems]</span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547773"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eq_lvl"><span class="hs-identifier hs-var">inert_given_eq_lvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547777"><span class="hs-identifier hs-type">ge_lvl'</span></a></span><span>
</span><span id="line-1437"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_given_eqs"><span class="hs-identifier hs-var">inert_given_eqs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1438"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1439"></span><span>    </span><span id="local-6989586621682547777"><span class="annot"><span class="annottext">ge_lvl' :: TcLevel
</span><a href="#local-6989586621682547777"><span class="hs-identifier hs-var hs-var">ge_lvl'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#mentionsOuterVar"><span class="hs-identifier hs-var">mentionsOuterVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547771"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547772"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1440"></span><span>              </span><span class="hs-comment">-- Includes things like (c a), which *might* be an equality</span><span>
</span><span id="line-1441"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547771"><span class="hs-identifier hs-var">tclvl</span></a></span><span>
</span><span id="line-1442"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1443"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547774"><span class="hs-identifier hs-var">ge_lvl</span></a></span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span>    </span><span class="annot"><a href="#local-6989586621682547776"><span class="hs-identifier hs-type">not_equality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1446"></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; definitely not an equality of any kind</span><span>
</span><span id="line-1447"></span><span>    </span><span class="hs-comment">--          except for a let-bound skolem, which doesn't count</span><span>
</span><span id="line-1448"></span><span>    </span><span class="hs-comment">--          See Note [Let-bound skolems]</span><span>
</span><span id="line-1449"></span><span>    </span><span class="hs-comment">-- NB: no need to spot the boxed CDictCan (a ~ b) because its</span><span>
</span><span id="line-1450"></span><span>    </span><span class="hs-comment">--     superclass (a ~# b) will be a CEqCan</span><span>
</span><span id="line-1451"></span><span>    </span><span id="local-6989586621682547776"><span class="annot"><span class="annottext">not_equality :: Ct -&gt; Bool
</span><a href="#local-6989586621682547776"><span class="hs-identifier hs-var hs-var">not_equality</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547779"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547779"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#isOuterTyVar"><span class="hs-identifier hs-var">isOuterTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547771"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547779"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>    </span><span class="annot"><a href="#local-6989586621682547776"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1453"></span><span>    </span><span class="annot"><a href="#local-6989586621682547776"><span class="hs-identifier hs-var">not_equality</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span>                                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1454"></span><span>
</span><span id="line-1455"></span><span class="hs-keyword">data</span><span> </span><span id="KickOutSpec"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KickOutSpec"><span class="hs-identifier hs-var">KickOutSpec</span></a></span></span><span> </span><span class="hs-comment">-- See Note [KickOutSpec]</span><span>
</span><span id="line-1456"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="KOAfterUnify"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterUnify"><span class="hs-identifier hs-var">KOAfterUnify</span></a></span></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span>   </span><span class="hs-comment">-- We have unified these tyvars</span><span>
</span><span id="line-1457"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="KOAfterAdding"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterAdding"><span class="hs-identifier hs-var">KOAfterAdding</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>     </span><span class="hs-comment">-- We are adding to the inert set a canonical equality</span><span>
</span><span id="line-1458"></span><span>                               </span><span class="hs-comment">-- constraint with this LHS</span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span class="hs-comment">{- Note [KickOutSpec]
~~~~~~~~~~~~~~~~~~~~~~
KickOutSpec explains why we are kicking out.

Important property:
  KOAfterAdding (TyVarLHS tv) should behave exactly like
  KOAfterUnifying (unitVarSet tv)

The main reasons for treating the two separately are
* More efficient in the single-tyvar case
* The code is far more perspicuous
-}</span><span>
</span><span id="line-1472"></span><span>
</span><span id="line-1473"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#kickOutRewritableLHS"><span class="hs-identifier hs-type">kickOutRewritableLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KickOutSpec"><span class="hs-identifier hs-type">KickOutSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertCans"><span class="hs-identifier hs-type">InertCans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1474"></span><span class="hs-comment">-- See Note [kickOutRewritable]</span><span>
</span><span id="line-1475"></span><span id="kickOutRewritableLHS"><span class="annot"><span class="annottext">kickOutRewritableLHS :: KickOutSpec -&gt; CtFlavourRole -&gt; InertCans -&gt; (Bag Ct, InertCans)
</span><a href="GHC.Tc.Solver.InertSet.html#kickOutRewritableLHS"><span class="hs-identifier hs-var hs-var">kickOutRewritableLHS</span></a></span></span><span> </span><span id="local-6989586621682547784"><span class="annot"><span class="annottext">KickOutSpec
</span><a href="#local-6989586621682547784"><span class="hs-identifier hs-var">ko_spec</span></a></span></span><span> </span><span id="local-6989586621682547785"><span class="annot"><span class="annottext">new_fr :: CtFlavourRole
</span><a href="#local-6989586621682547785"><span class="hs-identifier hs-var">new_fr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547786"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547786"><span class="hs-identifier hs-var">new_role</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>                     </span><span id="local-6989586621682547787"><span class="annot"><span class="annottext">ics :: InertCans
</span><a href="#local-6989586621682547787"><span class="hs-identifier hs-var">ics</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IC"><span class="hs-identifier hs-type">IC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_eqs :: InertCans -&gt; InertEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547788"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547788"><span class="hs-identifier hs-var">tv_eqs</span></a></span></span><span>
</span><span id="line-1477"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_dicts :: InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547789"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547789"><span class="hs-identifier hs-var">dictmap</span></a></span></span><span>
</span><span id="line-1478"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_funeqs :: InertCans -&gt; InertFunEqs
</span><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547790"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547790"><span class="hs-identifier hs-var">funeqmap</span></a></span></span><span>
</span><span id="line-1479"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_irreds :: InertCans -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547791"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547791"><span class="hs-identifier hs-var">irreds</span></a></span></span><span>
</span><span id="line-1480"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inert_insts :: InertCans -&gt; [QCInst]
</span><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547792"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547792"><span class="hs-identifier hs-var">old_insts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1481"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682547793"><span class="hs-identifier hs-var">kicked_out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547794"><span class="hs-identifier hs-var">inert_cans_in</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1482"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1483"></span><span>    </span><span class="hs-comment">-- inert_safehask stays unchanged; is that right?</span><span>
</span><span id="line-1484"></span><span>    </span><span id="local-6989586621682547794"><span class="annot"><span class="annottext">inert_cans_in :: InertCans
</span><a href="#local-6989586621682547794"><span class="hs-identifier hs-var hs-var">inert_cans_in</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547787"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_eqs"><span class="hs-identifier hs-var">inert_eqs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547795"><span class="hs-identifier hs-type">tv_eqs_in</span></a></span><span>
</span><span id="line-1485"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547796"><span class="hs-identifier hs-type">dicts_in</span></a></span><span>
</span><span id="line-1486"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_funeqs"><span class="hs-identifier hs-var">inert_funeqs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547797"><span class="hs-identifier hs-type">feqs_in</span></a></span><span>
</span><span id="line-1487"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547798"><span class="hs-identifier hs-type">irs_in</span></a></span><span>
</span><span id="line-1488"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_insts"><span class="hs-identifier hs-var">inert_insts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682547799"><span class="hs-identifier hs-type">insts_in</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span>    </span><span class="annot"><a href="#local-6989586621682547793"><span class="hs-identifier hs-type">kicked_out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span>
</span><span id="line-1491"></span><span>    </span><span id="local-6989586621682547793"><span class="annot"><span class="annottext">kicked_out :: Bag Ct
</span><a href="#local-6989586621682547793"><span class="hs-identifier hs-var hs-var">kicked_out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DictCt -&gt; Ct) -&gt; Bag DictCt -&gt; Bag Ct
forall a b. (a -&gt; b) -&gt; Bag a -&gt; Bag b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a></span><span> </span><span class="annot"><span class="annottext">Bag DictCt
</span><a href="#local-6989586621682547800"><span class="hs-identifier hs-var">dicts_out</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; Bag Ct -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#andCts"><span class="hs-operator hs-var">`andCts`</span></a></span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Ct) -&gt; InertIrreds -&gt; Bag Ct
forall a b. (a -&gt; b) -&gt; Bag a -&gt; Bag b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a></span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547802"><span class="hs-identifier hs-var">irs_out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>                  </span><span class="annot"><span class="annottext">Bag Ct -&gt; [Ct] -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#extendCtsList"><span class="hs-operator hs-var">`extendCtsList`</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547804"><span class="hs-identifier hs-var">insts_out</span></a></span><span>
</span><span id="line-1493"></span><span>                  </span><span class="annot"><span class="annottext">Bag Ct -&gt; [Ct] -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#extendCtsList"><span class="hs-operator hs-var">`extendCtsList`</span></a></span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Ct) -&gt; EqualCtList -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547805"><span class="hs-identifier hs-var">tv_eqs_out</span></a></span><span>
</span><span id="line-1494"></span><span>                  </span><span class="annot"><span class="annottext">Bag Ct -&gt; [Ct] -&gt; Bag Ct
</span><a href="GHC.Tc.Types.Constraint.html#extendCtsList"><span class="hs-operator hs-var">`extendCtsList`</span></a></span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Ct) -&gt; EqualCtList -&gt; [Ct]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-var">CEqCan</span></a></span><span> </span><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547806"><span class="hs-identifier hs-var">feqs_out</span></a></span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682547805"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547805"><span class="hs-identifier hs-var">tv_eqs_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547795"><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547795"><span class="hs-identifier hs-var">tv_eqs_in</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Bool) -&gt; InertEqs -&gt; (EqualCtList, InertEqs)
</span><a href="GHC.Tc.Solver.InertSet.html#partitionInertEqs"><span class="hs-identifier hs-var">partitionInertEqs</span></a></span><span> </span><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682547807"><span class="hs-identifier hs-var">kick_out_eq</span></a></span><span> </span><span class="annot"><span class="annottext">InertEqs
</span><a href="#local-6989586621682547788"><span class="hs-identifier hs-var">tv_eqs</span></a></span><span>
</span><span id="line-1497"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682547806"><span class="annot"><span class="annottext">EqualCtList
</span><a href="#local-6989586621682547806"><span class="hs-identifier hs-var">feqs_out</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682547797"><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547797"><span class="hs-identifier hs-var">feqs_in</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqCt -&gt; Bool) -&gt; InertFunEqs -&gt; (EqualCtList, InertFunEqs)
</span><a href="GHC.Tc.Solver.InertSet.html#partitionFunEqs"><span class="hs-identifier hs-var">partitionFunEqs</span></a></span><span>   </span><span class="annot"><span class="annottext">EqCt -&gt; Bool
</span><a href="#local-6989586621682547807"><span class="hs-identifier hs-var">kick_out_eq</span></a></span><span> </span><span class="annot"><span class="annottext">InertFunEqs
</span><a href="#local-6989586621682547790"><span class="hs-identifier hs-var">funeqmap</span></a></span><span>
</span><span id="line-1498"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682547800"><span class="annot"><span class="annottext">Bag DictCt
</span><a href="#local-6989586621682547800"><span class="hs-identifier hs-var">dicts_out</span></a></span></span><span class="hs-special">,</span><span>  </span><span id="local-6989586621682547796"><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547796"><span class="hs-identifier hs-var">dicts_in</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; Bool) -&gt; DictMap DictCt -&gt; (Bag DictCt, DictMap DictCt)
</span><a href="GHC.Tc.Solver.InertSet.html#partitionDicts"><span class="hs-identifier hs-var">partitionDicts</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621682547808"><span class="hs-identifier hs-var">kick_out_ct</span></a></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; (DictCt -&gt; Ct) -&gt; DictCt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DictMap DictCt
</span><a href="#local-6989586621682547789"><span class="hs-identifier hs-var">dictmap</span></a></span><span>
</span><span id="line-1499"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682547802"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547802"><span class="hs-identifier hs-var">irs_out</span></a></span></span><span class="hs-special">,</span><span>    </span><span id="local-6989586621682547798"><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547798"><span class="hs-identifier hs-var">irs_in</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IrredCt -&gt; Bool) -&gt; InertIrreds -&gt; (InertIrreds, InertIrreds)
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; (Bag a, Bag a)
</span><a href="GHC.Data.Bag.html#partitionBag"><span class="hs-identifier hs-var">partitionBag</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="#local-6989586621682547808"><span class="hs-identifier hs-var">kick_out_ct</span></a></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; (IrredCt -&gt; Ct) -&gt; IrredCt -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InertIrreds
</span><a href="#local-6989586621682547791"><span class="hs-identifier hs-var">irreds</span></a></span><span>
</span><span id="line-1500"></span><span>      </span><span class="hs-comment">-- Kick out even insolubles: See Note [Rewrite insolubles]</span><span>
</span><span id="line-1501"></span><span>      </span><span class="hs-comment">-- Of course we must kick out irreducibles like (c a), in case</span><span>
</span><span id="line-1502"></span><span>      </span><span class="hs-comment">-- we can rewrite 'c' to something more useful</span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span>    </span><span class="hs-comment">-- Kick-out for inert instances</span><span>
</span><span id="line-1505"></span><span>    </span><span class="hs-comment">-- See Note [Quantified constraints] in GHC.Tc.Solver.Solve</span><span>
</span><span id="line-1506"></span><span>    </span><span class="annot"><a href="#local-6989586621682547804"><span class="hs-identifier hs-type">insts_out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1507"></span><span>    </span><span class="annot"><a href="#local-6989586621682547799"><span class="hs-identifier hs-type">insts_in</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1508"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682547804"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682547804"><span class="hs-identifier hs-var">insts_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547799"><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547799"><span class="hs-identifier hs-var">insts_in</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1509"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621682547810"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Given"><span class="hs-identifier hs-var">Given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- All the insts are Givens</span><span>
</span><span id="line-1510"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QCInst -&gt; Either Ct QCInst) -&gt; [QCInst] -&gt; ([Ct], [QCInst])
forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Either Ct QCInst
</span><a href="#local-6989586621682547813"><span class="hs-identifier hs-var">kick_out_qci</span></a></span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547792"><span class="hs-identifier hs-var">old_insts</span></a></span><span>
</span><span id="line-1511"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1512"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[QCInst]
</span><a href="#local-6989586621682547792"><span class="hs-identifier hs-var">old_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1513"></span><span>    </span><span id="local-6989586621682547813"><span class="annot"><span class="annottext">kick_out_qci :: QCInst -&gt; Either Ct QCInst
</span><a href="#local-6989586621682547813"><span class="hs-identifier hs-var hs-var">kick_out_qci</span></a></span></span><span> </span><span id="local-6989586621682547814"><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621682547814"><span class="hs-identifier hs-var">qci</span></a></span></span><span>
</span><span id="line-1514"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682547815"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621682547815"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621682547814"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-1515"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547817"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621682547814"><span class="hs-identifier hs-var">qci</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1516"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Either Ct QCInst
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547815"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1517"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1518"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Either Ct QCInst
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621682547814"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span>    </span><span class="annot"><a href="#local-6989586621682547819"><span class="hs-identifier hs-type">fr_tv_can_rewrite_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1521"></span><span>    </span><span id="local-6989586621682547819"><span class="annot"><span class="annottext">fr_tv_can_rewrite_ty :: (TcTyVar -&gt; Bool) -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547819"><span class="hs-identifier hs-var hs-var">fr_tv_can_rewrite_ty</span></a></span></span><span> </span><span id="local-6989586621682547820"><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547820"><span class="hs-identifier hs-var">ok_tv</span></a></span></span><span> </span><span id="local-6989586621682547821"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547821"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682547822"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547822"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; (EqRel -&gt; TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableTyVar"><span class="hs-identifier hs-var">anyRewritableTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547821"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547824"><span class="hs-identifier hs-var">can_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547822"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1523"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1524"></span><span>        </span><span class="annot"><a href="#local-6989586621682547824"><span class="hs-identifier hs-type">can_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1525"></span><span>        </span><span id="local-6989586621682547824"><span class="annot"><span class="annottext">can_rewrite :: EqRel -&gt; TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547824"><span class="hs-identifier hs-var hs-var">can_rewrite</span></a></span></span><span> </span><span id="local-6989586621682547825"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547825"><span class="hs-identifier hs-var">old_role</span></a></span></span><span> </span><span id="local-6989586621682547826"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547826"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547786"><span class="hs-identifier hs-var">new_role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewrite"><span class="hs-operator hs-var">`eqCanRewrite`</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547825"><span class="hs-identifier hs-var">old_role</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547820"><span class="hs-identifier hs-var">ok_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547826"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1526"></span><span>
</span><span id="line-1527"></span><span>    </span><span class="annot"><a href="#local-6989586621682547828"><span class="hs-identifier hs-type">fr_tf_can_rewrite_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1528"></span><span>    </span><span id="local-6989586621682547828"><span class="annot"><span class="annottext">fr_tf_can_rewrite_ty :: TyCon -&gt; [Type] -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547828"><span class="hs-identifier hs-var hs-var">fr_tf_can_rewrite_ty</span></a></span></span><span> </span><span id="local-6989586621682547829"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547829"><span class="hs-identifier hs-var">new_tf</span></a></span></span><span> </span><span id="local-6989586621682547830"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547830"><span class="hs-identifier hs-var">new_tf_args</span></a></span></span><span> </span><span id="local-6989586621682547831"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547831"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682547832"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547832"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1529"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; (EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#anyRewritableTyFamApp"><span class="hs-identifier hs-var">anyRewritableTyFamApp</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547831"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="#local-6989586621682547834"><span class="hs-identifier hs-var">can_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547832"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1530"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1531"></span><span>        </span><span class="annot"><a href="#local-6989586621682547834"><span class="hs-identifier hs-type">can_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1532"></span><span>        </span><span id="local-6989586621682547834"><span class="annot"><span class="annottext">can_rewrite :: EqRel -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="#local-6989586621682547834"><span class="hs-identifier hs-var hs-var">can_rewrite</span></a></span></span><span> </span><span id="local-6989586621682547835"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547835"><span class="hs-identifier hs-var">old_role</span></a></span></span><span> </span><span id="local-6989586621682547836"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547836"><span class="hs-identifier hs-var">old_tf</span></a></span></span><span> </span><span id="local-6989586621682547837"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547837"><span class="hs-identifier hs-var">old_tf_args</span></a></span></span><span>
</span><span id="line-1533"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547786"><span class="hs-identifier hs-var">new_role</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewrite"><span class="hs-operator hs-var">`eqCanRewrite`</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547835"><span class="hs-identifier hs-var">old_role</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1534"></span><span>            </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTyConApps"><span class="hs-identifier hs-var">tcEqTyConApps</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547829"><span class="hs-identifier hs-var">new_tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547830"><span class="hs-identifier hs-var">new_tf_args</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547836"><span class="hs-identifier hs-var">old_tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547837"><span class="hs-identifier hs-var">old_tf_args</span></a></span><span>
</span><span id="line-1535"></span><span>              </span><span class="hs-comment">-- it's possible for old_tf_args to have too many. This is fine;</span><span>
</span><span id="line-1536"></span><span>              </span><span class="hs-comment">-- we'll only check what we need to.</span><span>
</span><span id="line-1537"></span><span>
</span><span id="line-1538"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621682547817"><span class="hs-pragma hs-type">fr_can_rewrite_ty</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- Perform case analysis on ko_spec only once</span><span>
</span><span id="line-1539"></span><span>    </span><span class="annot"><a href="#local-6989586621682547817"><span class="hs-identifier hs-type">fr_can_rewrite_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1540"></span><span>    </span><span id="local-6989586621682547817"><span class="annot"><span class="annottext">fr_can_rewrite_ty :: EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547817"><span class="hs-identifier hs-var hs-var">fr_can_rewrite_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">KickOutSpec
</span><a href="#local-6989586621682547784"><span class="hs-identifier hs-var">ko_spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- See Note [KickOutSpec]</span><span>
</span><span id="line-1541"></span><span>      </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterUnify"><span class="hs-identifier hs-type">KOAfterUnify</span></a></span><span> </span><span id="local-6989586621682547839"><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547839"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547819"><span class="hs-identifier hs-var">fr_tv_can_rewrite_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547839"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1542"></span><span>      </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterAdding"><span class="hs-identifier hs-type">KOAfterAdding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547841"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547841"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547819"><span class="hs-identifier hs-var">fr_tv_can_rewrite_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547841"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1543"></span><span>      </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterAdding"><span class="hs-identifier hs-type">KOAfterAdding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682547842"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547842"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span id="local-6989586621682547843"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547843"><span class="hs-identifier hs-var">tf_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547828"><span class="hs-identifier hs-var">fr_tf_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547842"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547843"><span class="hs-identifier hs-var">tf_args</span></a></span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span>    </span><span class="annot"><a href="#local-6989586621682547810"><span class="hs-identifier hs-type">fr_may_rewrite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1546"></span><span>    </span><span id="local-6989586621682547810"><span class="annot"><span class="annottext">fr_may_rewrite :: CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621682547810"><span class="hs-identifier hs-var hs-var">fr_may_rewrite</span></a></span></span><span> </span><span id="local-6989586621682547844"><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547844"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547785"><span class="hs-identifier hs-var">new_fr</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewriteFR"><span class="hs-operator hs-var">`eqCanRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547844"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-1547"></span><span>        </span><span class="hs-comment">-- Can the new item rewrite the inert item?</span><span>
</span><span id="line-1548"></span><span>
</span><span id="line-1549"></span><span>    </span><span class="annot"><a href="#local-6989586621682547808"><span class="hs-identifier hs-type">kick_out_ct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1550"></span><span>    </span><span class="hs-comment">-- Kick it out if the new CEqCan can rewrite the inert one</span><span>
</span><span id="line-1551"></span><span>    </span><span class="hs-comment">-- See Note [kickOutRewritable]</span><span>
</span><span id="line-1552"></span><span>    </span><span id="local-6989586621682547808"><span class="annot"><span class="annottext">kick_out_ct :: Ct -&gt; Bool
</span><a href="#local-6989586621682547808"><span class="hs-identifier hs-var hs-var">kick_out_ct</span></a></span></span><span> </span><span id="local-6989586621682547846"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547846"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621682547810"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547847"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547817"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547848"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547846"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1553"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1554"></span><span>        </span><span id="local-6989586621682547847"><span class="annot"><span class="annottext">fs :: CtFlavourRole
</span><a href="#local-6989586621682547847"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682547848"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547848"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtFlavourRole
</span><a href="GHC.Tc.Types.Constraint.html#ctFlavourRole"><span class="hs-identifier hs-var">ctFlavourRole</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682547846"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span>    </span><span class="hs-comment">-- Implements criteria K1-K3 in Note [Extending the inert equalities]</span><span>
</span><span id="line-1557"></span><span>    </span><span class="annot"><a href="#local-6989586621682547807"><span class="hs-identifier hs-type">kick_out_eq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1558"></span><span>    </span><span id="local-6989586621682547807"><span class="annot"><span class="annottext">kick_out_eq :: EqCt -&gt; Bool
</span><a href="#local-6989586621682547807"><span class="hs-identifier hs-var hs-var">kick_out_eq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#EqCt"><span class="hs-identifier hs-type">EqCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">eq_lhs :: EqCt -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#eq_lhs"><span class="hs-identifier hs-var">eq_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547851"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547851"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_rhs :: EqCt -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#eq_rhs"><span class="hs-identifier hs-var">eq_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547852"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547852"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>
</span><span id="line-1559"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_ev :: EqCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#eq_ev"><span class="hs-identifier hs-var">eq_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547854"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547854"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eq_eq_rel :: EqCt -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#eq_eq_rel"><span class="hs-identifier hs-var">eq_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547856"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547856"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1560"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole -&gt; Bool
</span><a href="#local-6989586621682547810"><span class="hs-identifier hs-var">fr_may_rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547857"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1561"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- (K0) Keep it in the inert set if the new thing can't rewrite it</span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span>      </span><span class="hs-comment">-- Below here (fr_may_rewrite fs) is True</span><span>
</span><span id="line-1564"></span><span>
</span><span id="line-1565"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547851"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1566"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547857"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewriteFR"><span class="hs-operator hs-var">`eqCanRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547785"><span class="hs-identifier hs-var">new_fr</span></a></span><span>
</span><span id="line-1567"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- (K4) Keep it in the inert set if the LHS is a tyvar and</span><span>
</span><span id="line-1568"></span><span>               </span><span class="hs-comment">-- it can rewrite the work item. See Note [K4]</span><span>
</span><span id="line-1569"></span><span>
</span><span id="line-1570"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547817"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547856"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547851"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- (K1)</span><span>
</span><span id="line-1572"></span><span>         </span><span class="hs-comment">-- The above check redundantly checks the role &amp; flavour,</span><span>
</span><span id="line-1573"></span><span>         </span><span class="hs-comment">-- but it's very convenient</span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682547859"><span class="hs-identifier hs-var">kick_out_for_inertness</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- (K2)</span><span>
</span><span id="line-1576"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682547860"><span class="hs-identifier hs-var">kick_out_for_completeness</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- (K3)</span><span>
</span><span id="line-1577"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1580"></span><span>        </span><span id="local-6989586621682547857"><span class="annot"><span class="annottext">fs :: CtFlavourRole
</span><a href="#local-6989586621682547857"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547854"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547856"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>        </span><span id="local-6989586621682547859"><span class="annot"><span class="annottext">kick_out_for_inertness :: Bool
</span><a href="#local-6989586621682547859"><span class="hs-identifier hs-var hs-var">kick_out_for_inertness</span></a></span></span><span>
</span><span id="line-1582"></span><span>          </span><span class="hs-glyph">=</span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547857"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole -&gt; CtFlavourRole -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanRewriteFR"><span class="hs-operator hs-var">`eqCanRewriteFR`</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavourRole
</span><a href="#local-6989586621682547857"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- (K2a)</span><span>
</span><span id="line-1583"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547817"><span class="hs-identifier hs-var">fr_can_rewrite_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547856"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547852"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>    </span><span class="hs-comment">-- (K2b)</span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>        </span><span id="local-6989586621682547860"><span class="annot"><span class="annottext">kick_out_for_completeness :: Bool
</span><a href="#local-6989586621682547860"><span class="hs-identifier hs-var hs-var">kick_out_for_completeness</span></a></span></span><span>  </span><span class="hs-comment">-- (K3) and Note [K3: completeness of solving]</span><span>
</span><span id="line-1586"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682547856"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1587"></span><span>              </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547862"><span class="hs-identifier hs-var">is_new_lhs</span></a></span><span>      </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547852"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>   </span><span class="hs-comment">-- (K3a)</span><span>
</span><span id="line-1588"></span><span>              </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547864"><span class="hs-identifier hs-var">head_is_new_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547852"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>   </span><span class="hs-comment">-- (K3b)</span><span>
</span><span id="line-1589"></span><span>
</span><span id="line-1590"></span><span>    </span><span class="annot"><a href="#local-6989586621682547862"><span class="hs-identifier hs-type">is_new_lhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1591"></span><span>    </span><span id="local-6989586621682547862"><span class="annot"><span class="annottext">is_new_lhs :: Type -&gt; Bool
</span><a href="#local-6989586621682547862"><span class="hs-identifier hs-var hs-var">is_new_lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">KickOutSpec
</span><a href="#local-6989586621682547784"><span class="hs-identifier hs-var">ko_spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- See Note [KickOutSpec]</span><span>
</span><span id="line-1592"></span><span>          </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterUnify"><span class="hs-identifier hs-type">KOAfterUnify</span></a></span><span> </span><span id="local-6989586621682547865"><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547865"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVarSet -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547866"><span class="hs-identifier hs-var">is_tyvar_ty_for</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547865"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1593"></span><span>          </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterAdding"><span class="hs-identifier hs-type">KOAfterAdding</span></a></span><span> </span><span id="local-6989586621682547867"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547867"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682547867"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>
</span><span id="line-1595"></span><span>    </span><span class="annot"><a href="#local-6989586621682547866"><span class="hs-identifier hs-type">is_tyvar_ty_for</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1596"></span><span>    </span><span class="hs-comment">-- True if the type is equal to one of the tyvars</span><span>
</span><span id="line-1597"></span><span>    </span><span id="local-6989586621682547866"><span class="annot"><span class="annottext">is_tyvar_ty_for :: TcTyVarSet -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547866"><span class="hs-identifier hs-var hs-var">is_tyvar_ty_for</span></a></span></span><span> </span><span id="local-6989586621682547869"><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547869"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682547870"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547870"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1598"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TcTyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547870"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1599"></span><span>          </span><span class="annot"><span class="annottext">Maybe TcTyVar
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1600"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682547872"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547872"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547872"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547869"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span>    </span><span class="annot"><a href="#local-6989586621682547864"><span class="hs-identifier hs-type">head_is_new_lhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1603"></span><span>    </span><span id="local-6989586621682547864"><span class="annot"><span class="annottext">head_is_new_lhs :: Type -&gt; Bool
</span><a href="#local-6989586621682547864"><span class="hs-identifier hs-var hs-var">head_is_new_lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">KickOutSpec
</span><a href="#local-6989586621682547784"><span class="hs-identifier hs-var">ko_spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- See Note [KickOutSpec]</span><span>
</span><span id="line-1604"></span><span>          </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterUnify"><span class="hs-identifier hs-type">KOAfterUnify</span></a></span><span> </span><span id="local-6989586621682547873"><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547873"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547874"><span class="hs-identifier hs-var">tv_at_head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarSet
</span><a href="#local-6989586621682547873"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1605"></span><span>          </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterAdding"><span class="hs-identifier hs-type">KOAfterAdding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682547875"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547875"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547874"><span class="hs-identifier hs-var">tv_at_head</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547875"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>          </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KOAfterAdding"><span class="hs-identifier hs-type">KOAfterAdding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682547876"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547876"><span class="hs-identifier hs-var">tf</span></a></span></span><span> </span><span id="local-6989586621682547877"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547877"><span class="hs-identifier hs-var">tf_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547878"><span class="hs-identifier hs-var">fam_at_head</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547876"><span class="hs-identifier hs-var">tf</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547877"><span class="hs-identifier hs-var">tf_args</span></a></span><span>
</span><span id="line-1607"></span><span>
</span><span id="line-1608"></span><span>    </span><span class="annot"><a href="#local-6989586621682547874"><span class="hs-identifier hs-type">tv_at_head</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1609"></span><span>    </span><span id="local-6989586621682547874"><span class="annot"><span class="annottext">tv_at_head :: (TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547874"><span class="hs-identifier hs-var hs-var">tv_at_head</span></a></span></span><span> </span><span id="local-6989586621682547879"><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547879"><span class="hs-identifier hs-var">is_tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1610"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1611"></span><span>        </span><span id="local-6989586621682547880"><span class="annot"><span class="annottext">go :: Type -&gt; Bool
</span><a href="#local-6989586621682547880"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">Rep.TyVarTy</span></a></span><span> </span><span id="local-6989586621682547882"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547882"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547879"><span class="hs-identifier hs-var">is_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547882"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1612"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">Rep.AppTy</span></a></span><span> </span><span id="local-6989586621682547884"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547884"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547884"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1613"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">Rep.CastTy</span></a></span><span> </span><span id="local-6989586621682547886"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547886"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547886"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1614"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">Rep.TyConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1615"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">Rep.LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1616"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">Rep.ForAllTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1617"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">Rep.FunTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1618"></span><span>        </span><span class="annot"><a href="#local-6989586621682547880"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">Rep.CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span>    </span><span class="annot"><a href="#local-6989586621682547878"><span class="hs-identifier hs-type">fam_at_head</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1621"></span><span>    </span><span id="local-6989586621682547878"><span class="annot"><span class="annottext">fam_at_head :: TyCon -&gt; [Type] -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547878"><span class="hs-identifier hs-var hs-var">fam_at_head</span></a></span></span><span> </span><span id="local-6989586621682547892"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547892"><span class="hs-identifier hs-var">fun_tc</span></a></span></span><span> </span><span id="local-6989586621682547893"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547893"><span class="hs-identifier hs-var">fun_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1622"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1623"></span><span>        </span><span id="local-6989586621682547894"><span class="annot"><span class="annottext">go :: Type -&gt; Bool
</span><a href="#local-6989586621682547894"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">Rep.TyVarTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1624"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">Rep.AppTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- no TyConApp to the left of an AppTy</span><span>
</span><span id="line-1625"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">Rep.CastTy</span></a></span><span> </span><span id="local-6989586621682547895"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547895"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547895"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1626"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">Rep.TyConApp</span></a></span><span> </span><span id="local-6989586621682547896"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547896"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682547897"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547897"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TyCon -&gt; [Type] -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqTyConApps"><span class="hs-identifier hs-var">tcEqTyConApps</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547892"><span class="hs-identifier hs-var">fun_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547893"><span class="hs-identifier hs-var">fun_args</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547896"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547897"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1627"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">Rep.LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1628"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">Rep.ForAllTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1629"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">Rep.FunTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1630"></span><span>        </span><span class="annot"><a href="#local-6989586621682547894"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">Rep.CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1631"></span><span>
</span><span id="line-1632"></span><span class="hs-comment">{- Note [kickOutRewritable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [inert_eqs: the inert equalities].

When we add a new inert equality (lhs ~N ty) to the inert set,
we must kick out any inert items that could be rewritten by the
new equality, to maintain the inert-set invariants.

  - We want to kick out an existing inert constraint if
    a) the new constraint can rewrite the inert one
    b) 'lhs' is free in the inert constraint (so that it *will*)
       rewrite it if we kick it out.

    For (b) we use anyRewritableCanLHS, which examines the types /and
    kinds/ that are directly visible in the type. Hence
    we will have exposed all the rewriting we care about to make the
    most precise kinds visible for matching classes etc. No need to
    kick out constraints that mention type variables whose kinds
    contain this LHS!

  - We don't kick out constraints from inert_solved_dicts, and
    inert_solved_funeqs optimistically. But when we lookup we have to
    take the substitution into account

NB: we could in principle avoid kick-out:
  a) When unifying a meta-tyvar from an outer level, because
     then the entire implication will be iterated; see
     Note [The Unification Level Flag] in GHC.Tc.Solver.Monad.

  b) For Givens, after a unification.  By (GivenInv) in GHC.Tc.Utils.TcType
     Note [TcLevel invariants], a Given can't include a meta-tyvar from
     its own level, so it falls under (a).  Of course, we must still
     kick out Givens when adding a new non-unification Given.

But kicking out more vigorously may lead to earlier unification and fewer
iterations, so we don't take advantage of these possibilities.

Note [Rewrite insolubles]
~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have an insoluble alpha ~ [alpha], which is insoluble
because an occurs check.  And then we unify alpha := [Int].  Then we
really want to rewrite the insoluble to [Int] ~ [[Int]].  Now it can
be decomposed.  Otherwise we end up with a &quot;Can't match [Int] ~
[[Int]]&quot; which is true, but a bit confusing because the outer type
constructors match.

Hence:
 * In the main simplifier loops in GHC.Tc.Solver (solveWanteds,
   simpl_loop), we feed the insolubles in solveSimpleWanteds,
   so that they get rewritten (albeit not solved).

 * We kick insolubles out of the inert set, if they can be
   rewritten (see GHC.Tc.Solver.Monad.kick_out_rewritable)

 * We rewrite those insolubles in GHC.Tc.Solver.Equality
   See Note [Make sure that insolubles are fully rewritten]
   in GHC.Tc.Solver.Equality
-}</span><span>
</span><span id="line-1690"></span><span>
</span><span id="line-1691"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Queries
*                                                                      *
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#mentionsOuterVar"><span class="hs-identifier hs-type">mentionsOuterVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1699"></span><span id="mentionsOuterVar"><span class="annot"><span class="annottext">mentionsOuterVar :: TcLevel -&gt; CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#mentionsOuterVar"><span class="hs-identifier hs-var hs-var">mentionsOuterVar</span></a></span></span><span> </span><span id="local-6989586621682547898"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547898"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621682547899"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547899"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-1700"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfType"><span class="hs-identifier hs-var">anyFreeVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#isOuterTyVar"><span class="hs-identifier hs-var">isOuterTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547898"><span class="hs-identifier hs-var">tclvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; Type -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1701"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547899"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1702"></span><span>
</span><span id="line-1703"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#isOuterTyVar"><span class="hs-identifier hs-type">isOuterTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1704"></span><span class="hs-comment">-- True of a type variable that comes from a</span><span>
</span><span id="line-1705"></span><span class="hs-comment">-- shallower level than the ambient level (tclvl)</span><span>
</span><span id="line-1706"></span><span id="isOuterTyVar"><span class="annot"><span class="annottext">isOuterTyVar :: TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#isOuterTyVar"><span class="hs-identifier hs-var hs-var">isOuterTyVar</span></a></span></span><span> </span><span id="local-6989586621682547902"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547902"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621682547903"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547903"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1707"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547903"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-var">isTouchableMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547902"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547903"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547903"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547902"><span class="hs-identifier hs-var">tclvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1708"></span><span>                 </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682547902"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#strictlyDeeperThan"><span class="hs-operator hs-var">`strictlyDeeperThan`</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#tcTyVarLevel"><span class="hs-identifier hs-var">tcTyVarLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547903"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1709"></span><span>    </span><span class="hs-comment">-- ASSERT: we are dealing with Givens here, and invariant (GivenInv) from</span><span>
</span><span id="line-1710"></span><span>    </span><span class="hs-comment">-- Note Note [TcLevel invariants] in GHC.Tc.Utils.TcType ensures that there can't</span><span>
</span><span id="line-1711"></span><span>    </span><span class="hs-comment">-- be a touchable meta tyvar.   If this wasn't true, you might worry that,</span><span>
</span><span id="line-1712"></span><span>    </span><span class="hs-comment">-- at level 3, a meta-tv alpha[3] gets unified with skolem b[2], and thereby</span><span>
</span><span id="line-1713"></span><span>    </span><span class="hs-comment">-- becomes &quot;outer&quot; even though its level numbers says it isn't.</span><span>
</span><span id="line-1714"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- Coercion variables; doesn't much matter</span><span>
</span><span id="line-1715"></span><span>
</span><span id="line-1716"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#noGivenNewtypeReprEqs"><span class="hs-identifier hs-type">noGivenNewtypeReprEqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1717"></span><span class="hs-comment">-- True &lt;=&gt; there is no Irred looking like (N tys1 ~ N tys2)</span><span>
</span><span id="line-1718"></span><span class="hs-comment">-- See Note [Decomposing newtype equalities] (EX2) in GHC.Tc.Solver.Equality</span><span>
</span><span id="line-1719"></span><span class="hs-comment">--     This is the only call site.</span><span>
</span><span id="line-1720"></span><span id="noGivenNewtypeReprEqs"><span class="annot"><span class="annottext">noGivenNewtypeReprEqs :: TyCon -&gt; InertSet -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#noGivenNewtypeReprEqs"><span class="hs-identifier hs-var hs-var">noGivenNewtypeReprEqs</span></a></span></span><span> </span><span id="local-6989586621682547909"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547909"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682547910"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682547910"><span class="hs-identifier hs-var">inerts</span></a></span></span><span>
</span><span id="line-1721"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IrredCt -&gt; Bool) -&gt; InertIrreds -&gt; Bool
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt -&gt; Bool
</span><a href="#local-6989586621682547912"><span class="hs-identifier hs-var">might_help</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; InertIrreds
</span><a href="GHC.Tc.Solver.InertSet.html#inert_irreds"><span class="hs-identifier hs-var">inert_irreds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682547910"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1722"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1723"></span><span>    </span><span id="local-6989586621682547912"><span class="annot"><span class="annottext">might_help :: IrredCt -&gt; Bool
</span><a href="#local-6989586621682547912"><span class="hs-identifier hs-var hs-var">might_help</span></a></span></span><span> </span><span id="local-6989586621682547913"><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547913"><span class="hs-identifier hs-var">irred</span></a></span></span><span>
</span><span id="line-1724"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IrredCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#irredCtEvidence"><span class="hs-identifier hs-var">irredCtEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">IrredCt
</span><a href="#local-6989586621682547913"><span class="hs-identifier hs-var">irred</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1725"></span><span>          </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span id="local-6989586621682547915"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547915"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682547916"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547916"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-1726"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682547917"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547917"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547915"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-1727"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547909"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547917"><span class="hs-identifier hs-var">tc1</span></a></span><span>
</span><span id="line-1728"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682547919"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547919"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547916"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1729"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547909"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547919"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1730"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1731"></span><span>          </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1732"></span><span>
</span><span id="line-1733"></span><span class="hs-comment">-- | Returns True iff there are no Given constraints that might,</span><span>
</span><span id="line-1734"></span><span class="hs-comment">-- potentially, match the given class constraint. This is used when checking to see if a</span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- Given might overlap with an instance. See Note [Instance and Given overlap]</span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- in GHC.Tc.Solver.Dict</span><span>
</span><span id="line-1737"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#noMatchableGivenDicts"><span class="hs-identifier hs-type">noMatchableGivenDicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1738"></span><span id="noMatchableGivenDicts"><span class="annot"><span class="annottext">noMatchableGivenDicts :: InertSet -&gt; CtLoc -&gt; Class -&gt; [Type] -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#noMatchableGivenDicts"><span class="hs-identifier hs-var hs-var">noMatchableGivenDicts</span></a></span></span><span> </span><span id="local-6989586621682547920"><span class="annot"><span class="annottext">inerts :: InertSet
</span><a href="#local-6989586621682547920"><span class="hs-identifier hs-var">inerts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cans :: InertSet -&gt; InertCans
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cans"><span class="hs-identifier hs-var">inert_cans</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547921"><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547921"><span class="hs-identifier hs-var">inert_cans</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682547922"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547922"><span class="hs-identifier hs-var">loc_w</span></a></span></span><span> </span><span id="local-6989586621682547923"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547923"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621682547924"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547924"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1739"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DictCt -&gt; Bool) -&gt; Bag DictCt -&gt; Bool
forall a. (a -&gt; Bool) -&gt; Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a></span><span> </span><span class="annot"><span class="annottext">DictCt -&gt; Bool
</span><a href="#local-6989586621682547925"><span class="hs-identifier hs-var">matchable_given</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag DictCt -&gt; Bool) -&gt; Bag DictCt -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1740"></span><span>    </span><span class="annot"><span class="annottext">DictMap DictCt -&gt; Class -&gt; Bag DictCt
forall a. DictMap a -&gt; Class -&gt; Bag a
</span><a href="GHC.Tc.Solver.Types.html#findDictsByClass"><span class="hs-identifier hs-var">findDictsByClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InertCans -&gt; DictMap DictCt
</span><a href="GHC.Tc.Solver.InertSet.html#inert_dicts"><span class="hs-identifier hs-var">inert_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">InertCans
</span><a href="#local-6989586621682547921"><span class="hs-identifier hs-var">inert_cans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547923"><span class="hs-identifier hs-var">clas</span></a></span><span>
</span><span id="line-1741"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1742"></span><span>    </span><span id="local-6989586621682547927"><span class="annot"><span class="annottext">pred_w :: Type
</span><a href="#local-6989586621682547927"><span class="hs-identifier hs-var hs-var">pred_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682547923"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547924"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1743"></span><span>
</span><span id="line-1744"></span><span>    </span><span class="annot"><a href="#local-6989586621682547925"><span class="hs-identifier hs-type">matchable_given</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1745"></span><span>    </span><span id="local-6989586621682547925"><span class="annot"><span class="annottext">matchable_given :: DictCt -&gt; Bool
</span><a href="#local-6989586621682547925"><span class="hs-identifier hs-var hs-var">matchable_given</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#DictCt"><span class="hs-identifier hs-type">DictCt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_ev :: DictCt -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#di_ev"><span class="hs-identifier hs-var">di_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547930"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547930"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1746"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547933"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547933"><span class="hs-identifier hs-var">loc_g</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_pred :: CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctev_pred"><span class="hs-identifier hs-var">ctev_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547935"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547935"><span class="hs-identifier hs-var">pred_g</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682547930"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1747"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Subst -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Subst -&gt; Bool) -&gt; Maybe Subst -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; Type -&gt; CtLoc -&gt; Type -&gt; CtLoc -&gt; Maybe Subst
</span><a href="GHC.Tc.Solver.InertSet.html#mightEqualLater"><span class="hs-identifier hs-var">mightEqualLater</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682547920"><span class="hs-identifier hs-var">inerts</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547935"><span class="hs-identifier hs-var">pred_g</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547933"><span class="hs-identifier hs-var">loc_g</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547927"><span class="hs-identifier hs-var">pred_w</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547922"><span class="hs-identifier hs-var">loc_w</span></a></span><span>
</span><span id="line-1748"></span><span>
</span><span id="line-1749"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1750"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1751"></span><span>
</span><span id="line-1752"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#mightEqualLater"><span class="hs-identifier hs-type">mightEqualLater</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-1753"></span><span class="hs-comment">-- See Note [What might equal later?]</span><span>
</span><span id="line-1754"></span><span class="hs-comment">-- Used to implement logic in Note [Instance and Given overlap] in GHC.Tc.Solver.Dict</span><span>
</span><span id="line-1755"></span><span id="mightEqualLater"><span class="annot"><span class="annottext">mightEqualLater :: InertSet -&gt; Type -&gt; CtLoc -&gt; Type -&gt; CtLoc -&gt; Maybe Subst
</span><a href="GHC.Tc.Solver.InertSet.html#mightEqualLater"><span class="hs-identifier hs-var hs-var">mightEqualLater</span></a></span></span><span> </span><span id="local-6989586621682547938"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682547938"><span class="hs-identifier hs-var">inert_set</span></a></span></span><span> </span><span id="local-6989586621682547939"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547939"><span class="hs-identifier hs-var">given_pred</span></a></span></span><span> </span><span id="local-6989586621682547940"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547940"><span class="hs-identifier hs-var">given_loc</span></a></span></span><span> </span><span id="local-6989586621682547941"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547941"><span class="hs-identifier hs-var">wanted_pred</span></a></span></span><span> </span><span id="local-6989586621682547942"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547942"><span class="hs-identifier hs-var">wanted_loc</span></a></span></span><span>
</span><span id="line-1756"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var">prohibitedSuperClassSolve</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547940"><span class="hs-identifier hs-var">given_loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547942"><span class="hs-identifier hs-var">wanted_loc</span></a></span><span>
</span><span id="line-1757"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Subst
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1758"></span><span>
</span><span id="line-1759"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1760"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BindFun -&gt; [Type] -&gt; [Type] -&gt; UnifyResult
</span><a href="GHC.Core.Unify.html#tcUnifyTysFG"><span class="hs-identifier hs-var">tcUnifyTysFG</span></a></span><span> </span><span class="annot"><span class="annottext">BindFun
</span><a href="#local-6989586621682547944"><span class="hs-identifier hs-var">bind_fun</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547945"><span class="hs-identifier hs-var">flattened_given</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547946"><span class="hs-identifier hs-var">flattened_wanted</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1761"></span><span>      </span><span class="annot"><a href="GHC.Core.Unify.html#Unifiable"><span class="hs-identifier hs-type">Unifiable</span></a></span><span> </span><span id="local-6989586621682547948"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682547948"><span class="hs-identifier hs-var">subst</span></a></span></span><span>
</span><span id="line-1762"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Maybe Subst
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682547948"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1763"></span><span>      </span><span class="annot"><a href="GHC.Core.Unify.html#MaybeApart"><span class="hs-identifier hs-type">MaybeApart</span></a></span><span> </span><span id="local-6989586621682547950"><span class="annot"><span class="annottext">MaybeApartReason
</span><a href="#local-6989586621682547950"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621682547951"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682547951"><span class="hs-identifier hs-var">subst</span></a></span></span><span>
</span><span id="line-1764"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MaybeApartReason
</span><a href="GHC.Core.Unify.html#MARInfinite"><span class="hs-identifier hs-var">MARInfinite</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeApartReason
</span><a href="#local-6989586621682547950"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-comment">-- see Example 7 in the Note.</span><span>
</span><span id="line-1765"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Subst
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1766"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1767"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Maybe Subst
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682547951"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1768"></span><span>      </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="GHC.Core.Unify.html#SurelyApart"><span class="hs-identifier hs-var">SurelyApart</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Subst
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1769"></span><span>
</span><span id="line-1770"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1771"></span><span>    </span><span id="local-6989586621682547954"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621682547954"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(TcTyVarSet -&gt; InScopeSet) -&gt; TcTyVarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcTyVarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547939"><span class="hs-identifier hs-var">given_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547941"><span class="hs-identifier hs-var">wanted_pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1772"></span><span>
</span><span id="line-1773"></span><span>    </span><span class="hs-comment">-- NB: flatten both at the same time, so that we can share mappings</span><span>
</span><span id="line-1774"></span><span>    </span><span class="hs-comment">-- from type family applications to variables, and also to guarantee</span><span>
</span><span id="line-1775"></span><span>    </span><span class="hs-comment">-- that the fresh variables are really fresh between the given and</span><span>
</span><span id="line-1776"></span><span>    </span><span class="hs-comment">-- the wanted. Flattening both at the same time is needed to get</span><span>
</span><span id="line-1777"></span><span>    </span><span class="hs-comment">-- Example 10 from the Note.</span><span>
</span><span id="line-1778"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621682547945"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547945"><span class="hs-identifier hs-var">flattened_given</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547946"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547946"><span class="hs-identifier hs-var">flattened_wanted</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547957"><span class="annot"><span class="annottext">TyVarEnv (TyCon, [Type])
</span><a href="#local-6989586621682547957"><span class="hs-identifier hs-var">var_mapping</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1779"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; [Type] -&gt; ([Type], TyVarEnv (TyCon, [Type]))
</span><a href="GHC.Core.Unify.html#flattenTysX"><span class="hs-identifier hs-var">flattenTysX</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621682547954"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547939"><span class="hs-identifier hs-var">given_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547941"><span class="hs-identifier hs-var">wanted_pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1780"></span><span>
</span><span id="line-1781"></span><span>    </span><span class="annot"><a href="#local-6989586621682547944"><span class="hs-identifier hs-type">bind_fun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html#BindFun"><span class="hs-identifier hs-type">BindFun</span></a></span><span>
</span><span id="line-1782"></span><span>    </span><span id="local-6989586621682547944"><span class="annot"><span class="annottext">bind_fun :: BindFun
</span><a href="#local-6989586621682547944"><span class="hs-identifier hs-var hs-var">bind_fun</span></a></span></span><span> </span><span id="local-6989586621682547959"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547959"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682547960"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547960"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>
</span><span id="line-1783"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547959"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1784"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; MetaInfo -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547962"><span class="hs-identifier hs-var">can_unify</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547959"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#metaTyVarInfo"><span class="hs-identifier hs-var">metaTyVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547959"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547960"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-1785"></span><span>         </span><span class="hs-comment">-- this checks for CycleBreakerTvs and TyVarTvs; forgetting</span><span>
</span><span id="line-1786"></span><span>         </span><span class="hs-comment">-- the latter was #19106.</span><span>
</span><span id="line-1787"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindFlag
</span><a href="GHC.Core.Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a></span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span>         </span><span class="hs-comment">-- See Examples 4, 5, and 6 from the Note</span><span>
</span><span id="line-1790"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682547965"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682547965"><span class="hs-identifier hs-var">_fam_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682547966"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547966"><span class="hs-identifier hs-var">fam_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyVarEnv (TyCon, [Type]) -&gt; TcTyVar -&gt; Maybe (TyCon, [Type])
forall a. VarEnv a -&gt; TcTyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarEnv (TyCon, [Type])
</span><a href="#local-6989586621682547957"><span class="hs-identifier hs-var">var_mapping</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547959"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1791"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; [Type] -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfTypes"><span class="hs-identifier hs-var">anyFreeVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547969"><span class="hs-identifier hs-var">mentions_meta_ty_var</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682547966"><span class="hs-identifier hs-var">fam_args</span></a></span><span>
</span><span id="line-1792"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindFlag
</span><a href="GHC.Core.Unify.html#BindMe"><span class="hs-identifier hs-var">BindMe</span></a></span><span>
</span><span id="line-1793"></span><span>
</span><span id="line-1794"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1795"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BindFlag
</span><a href="GHC.Core.Unify.html#Apart"><span class="hs-identifier hs-var">Apart</span></a></span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span>    </span><span class="hs-comment">-- True for TauTv and TyVarTv (and RuntimeUnkTv) meta-tyvars</span><span>
</span><span id="line-1798"></span><span>    </span><span class="hs-comment">-- (as they can be unified)</span><span>
</span><span id="line-1799"></span><span>    </span><span class="hs-comment">-- and also for CycleBreakerTvs that mentions meta-tyvars</span><span>
</span><span id="line-1800"></span><span>    </span><span class="annot"><a href="#local-6989586621682547969"><span class="hs-identifier hs-type">mentions_meta_ty_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1801"></span><span>    </span><span id="local-6989586621682547969"><span class="annot"><span class="annottext">mentions_meta_ty_var :: TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547969"><span class="hs-identifier hs-var hs-var">mentions_meta_ty_var</span></a></span></span><span> </span><span id="local-6989586621682547971"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547971"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1802"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isMetaTyVar"><span class="hs-identifier hs-var">isMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547971"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1803"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#metaTyVarInfo"><span class="hs-identifier hs-var">metaTyVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547971"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1804"></span><span>          </span><span class="hs-comment">-- See Examples 8 and 9 in the Note</span><span>
</span><span id="line-1805"></span><span>          </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#CycleBreakerTv"><span class="hs-identifier hs-var">CycleBreakerTv</span></a></span><span>
</span><span id="line-1806"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfType"><span class="hs-identifier hs-var">anyFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547969"><span class="hs-identifier hs-var">mentions_meta_ty_var</span></a></span><span>
</span><span id="line-1807"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; InertSet -&gt; Type
</span><a href="GHC.Tc.Solver.InertSet.html#lookupCycleBreakerVar"><span class="hs-identifier hs-var">lookupCycleBreakerVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547971"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682547938"><span class="hs-identifier hs-var">inert_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span>          </span><span class="annot"><span class="annottext">MetaInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1809"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1810"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1811"></span><span>
</span><span id="line-1812"></span><span>    </span><span class="hs-comment">-- Like checkTopShape, but allows cbv variables to unify</span><span>
</span><span id="line-1813"></span><span>    </span><span class="annot"><a href="#local-6989586621682547962"><span class="hs-identifier hs-type">can_unify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaInfo"><span class="hs-identifier hs-type">MetaInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1814"></span><span>    </span><span id="local-6989586621682547962"><span class="annot"><span class="annottext">can_unify :: TcTyVar -&gt; MetaInfo -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682547962"><span class="hs-identifier hs-var hs-var">can_unify</span></a></span></span><span> </span><span id="local-6989586621682547974"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547974"><span class="hs-identifier hs-var">_lhs_tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span> </span><span id="local-6989586621682547976"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547976"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>  </span><span class="hs-comment">-- see Example 3 from the Note</span><span>
</span><span id="line-1815"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682547977"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547977"><span class="hs-identifier hs-var">rhs_tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TcTyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547976"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-1816"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547977"><span class="hs-identifier hs-var">rhs_tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1817"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_info :: TcTyVarDetails -&gt; MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#mtv_info"><span class="hs-identifier hs-var">mtv_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaInfo
</span><a href="GHC.Tc.Utils.TcType.html#TyVarTv"><span class="hs-identifier hs-var">TyVarTv</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1818"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- Could unify with anything</span><span>
</span><span id="line-1819"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-type">SkolemTv</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1820"></span><span>          </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#RuntimeUnk"><span class="hs-identifier hs-var">RuntimeUnk</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1821"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- not a var on the RHS</span><span>
</span><span id="line-1822"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1823"></span><span>    </span><span class="annot"><a href="#local-6989586621682547962"><span class="hs-identifier hs-var">can_unify</span></a></span><span> </span><span id="local-6989586621682547983"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547983"><span class="hs-identifier hs-var">lhs_tv</span></a></span></span><span> </span><span id="local-6989586621682547984"><span class="annot"><span class="annottext">MetaInfo
</span><a href="#local-6989586621682547984"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span id="local-6989586621682547985"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547985"><span class="hs-identifier hs-var">_rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="#local-6989586621682547969"><span class="hs-identifier hs-var">mentions_meta_ty_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547983"><span class="hs-identifier hs-var">lhs_tv</span></a></span><span>
</span><span id="line-1824"></span><span>
</span><span id="line-1825"></span><span class="hs-comment">-- | Is it (potentially) loopy to use the first @ct1@ to solve @ct2@?</span><span>
</span><span id="line-1826"></span><span class="hs-comment">--</span><span>
</span><span id="line-1827"></span><span class="hs-comment">-- Necessary (but not sufficient) conditions for this function to return @True@:</span><span>
</span><span id="line-1828"></span><span class="hs-comment">--</span><span>
</span><span id="line-1829"></span><span class="hs-comment">--   - @ct1@ and @ct2@ both arise from superclass expansion,</span><span>
</span><span id="line-1830"></span><span class="hs-comment">--   - @ct1@ is a Given and @ct2@ is a Wanted.</span><span>
</span><span id="line-1831"></span><span class="hs-comment">--</span><span>
</span><span id="line-1832"></span><span class="hs-comment">-- See Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance, (sc2).</span><span>
</span><span id="line-1833"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-type">prohibitedSuperClassSolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ is it loopy to use this one ...</span></span><span>
</span><span id="line-1834"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ ... to solve this one?</span></span><span>
</span><span id="line-1835"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ True ==&gt; don't solve it</span></span><span>
</span><span id="line-1836"></span><span id="prohibitedSuperClassSolve"><span class="annot"><span class="annottext">prohibitedSuperClassSolve :: CtLoc -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var hs-var">prohibitedSuperClassSolve</span></a></span></span><span> </span><span id="local-6989586621682547986"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547986"><span class="hs-identifier hs-var">given_loc</span></a></span></span><span> </span><span id="local-6989586621682547987"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547987"><span class="hs-identifier hs-var">wanted_loc</span></a></span></span><span>
</span><span id="line-1837"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ScDepth
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682547989"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682547989"><span class="hs-identifier hs-var">blocked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547986"><span class="hs-identifier hs-var">given_loc</span></a></span><span>
</span><span id="line-1838"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682547989"><span class="hs-identifier hs-var">blocked</span></a></span><span>
</span><span id="line-1839"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#ScOrigin"><span class="hs-identifier hs-type">ScOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NakedScFlag
</span><a href="GHC.Tc.Types.Origin.html#NakedSc"><span class="hs-identifier hs-var">NakedSc</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682547987"><span class="hs-identifier hs-var">wanted_loc</span></a></span><span>
</span><span id="line-1840"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>    </span><span class="hs-comment">-- Prohibited if the Wanted is a superclass</span><span>
</span><span id="line-1841"></span><span>            </span><span class="hs-comment">-- and the Given has come via a superclass selection from</span><span>
</span><span id="line-1842"></span><span>            </span><span class="hs-comment">-- a predicate bigger than the head</span><span>
</span><span id="line-1843"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1844"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span class="hs-comment">{- Note [What might equal later?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We must determine whether a Given might later equal a Wanted. We
definitely need to account for the possibility that any metavariable
might be arbitrarily instantiated. Yet we do *not* want
to allow skolems in to be instantiated, as we've already rewritten
with respect to any Givens. (We're solving a Wanted here, and so
all Givens have already been processed.)

This is best understood by example.

1. C alpha  ~?  C Int

   That given certainly might match later.

2. C a  ~?  C Int

   No. No new givens are going to arise that will get the `a` to rewrite
   to Int.

3. C alpha[tv]   ~?  C Int

   That alpha[tv] is a TyVarTv, unifiable only with other type variables.
   It cannot equal later.

4. C (F alpha)   ~?   C Int

   Sure -- that can equal later, if we learn something useful about alpha.

5. C (F alpha[tv])  ~?  C Int

   This, too, might equal later. Perhaps we have [G] F b ~ Int elsewhere.
   Or maybe we have C (F alpha[tv] beta[tv]), these unify with each other,
   and F x x = Int. Remember: returning True doesn't commit ourselves to
   anything.

6. C (F a)  ~?  C a

   No, this won't match later. If we could rewrite (F a) or a, we would
   have by now. But see also Red Herring below.

7. C (Maybe alpha)  ~?  C alpha

   We say this cannot equal later, because it would require
   alpha := Maybe (Maybe (Maybe ...)). While such a type can be contrived,
   we choose not to worry about it. See Note [Infinitary substitution in lookup]
   in GHC.Core.InstEnv. Getting this wrong let to #19107, tested in
   typecheck/should_compile/T19107.

8. C cbv   ~?  C Int
   where cbv = F a

   The cbv is a cycle-breaker var which stands for F a. See
   Note [Type equality cycles] in GHC.Tc.Solver.Equality
   This is just like case 6, and we say &quot;no&quot;. Saying &quot;no&quot; here is
   essential in getting the parser to type-check, with its use of DisambECP.

9. C cbv   ~?   C Int
   where cbv = F alpha

   Here, we might indeed equal later. Distinguishing between
   this case and Example 8 is why we need the InertSet in mightEqualLater.

10. C (F alpha, Int)  ~?  C (Bool, F alpha)

   This cannot equal later, because F a would have to equal both Bool and
   Int.

To deal with type family applications, we use the Core flattener. See
Note [Flattening type-family applications when matching instances] in GHC.Core.Unify.
The Core flattener replaces all type family applications with
fresh variables. The next question: should we allow these fresh
variables in the domain of a unifying substitution?

A type family application that mentions only skolems (example 6) is settled:
any skolems would have been rewritten w.r.t. Givens by now. These type family
applications match only themselves. A type family application that mentions
metavariables, on the other hand, can match anything. So, if the original type
family application contains a metavariable, we use BindMe to tell the unifier
to allow it in the substitution. On the other hand, a type family application
with only skolems is considered rigid.

This treatment fixes #18910 and is tested in
typecheck/should_compile/InstanceGivenOverlap{,2}

Red Herring
~~~~~~~~~~~
In #21208, we have this scenario:

instance forall b. C b
[G] C a[sk]
[W] C (F a[sk])

What should we do with that wanted? According to the logic above, the Given
cannot match later (this is example 6), and so we use the global instance.
But wait, you say: What if we learn later (say by a future type instance F a = a)
that F a unifies with a? That looks like the Given might really match later!

This mechanism described in this Note is *not* about this kind of situation, however.
It is all asking whether a Given might match the Wanted *in this run of the solver*.
It is *not* about whether a variable might be instantiated so that the Given matches,
or whether a type instance introduced in a downstream module might make the Given match.
The reason we care about what might match later is only about avoiding order-dependence.
That is, we don't want to commit to a course of action that depends on seeing constraints
in a certain order. But an instantiation of a variable and a later type instance
don't introduce order dependency in this way, and so mightMatchLater is right to ignore
these possibilities.

Here is an example, with no type families, that is perhaps clearer:

instance forall b. C (Maybe b)
[G] C (Maybe Int)
[W] C (Maybe a)

What to do? We *might* say that the Given could match later and should thus block
us from using the global instance. But we don't do this. Instead, we rely on class
coherence to say that choosing the global instance is just fine, even if later we
call a function with (a := Int). After all, in this run of the solver, [G] C (Maybe Int)
will definitely never match [W] C (Maybe a). (Recall that we process Givens before
Wanteds, so there is no [G] a ~ Int hanging about unseen.)

Interestingly, in the first case (from #21208), the behavior changed between
GHC 8.10.7 and GHC 9.2, with the latter behaving correctly and the former
reporting overlapping instances.

Test case: typecheck/should_compile/T21208.

-}</span><span>
</span><span id="line-1974"></span><span>
</span><span id="line-1975"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
    Cycle breakers
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span class="annot"><span class="hs-comment">-- | Return the type family application a CycleBreakerTv maps to.</span></span><span>
</span><span id="line-1982"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#lookupCycleBreakerVar"><span class="hs-identifier hs-type">lookupCycleBreakerVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ cbv, must be a CycleBreakerTv</span></span><span>
</span><span id="line-1983"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-1984"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ type family application the cbv maps to</span></span><span>
</span><span id="line-1985"></span><span id="lookupCycleBreakerVar"><span class="annot"><span class="annottext">lookupCycleBreakerVar :: TcTyVar -&gt; InertSet -&gt; Type
</span><a href="GHC.Tc.Solver.InertSet.html#lookupCycleBreakerVar"><span class="hs-identifier hs-var hs-var">lookupCycleBreakerVar</span></a></span></span><span> </span><span id="local-6989586621682547993"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547993"><span class="hs-identifier hs-var">cbv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inert_cycle_breakers :: InertSet -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682547994"><span class="annot"><span class="annottext">CycleBreakerVarStack
</span><a href="#local-6989586621682547994"><span class="hs-identifier hs-var">cbvs_stack</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1986"></span><span class="hs-comment">-- This function looks at every environment in the stack. This is necessary</span><span>
</span><span id="line-1987"></span><span class="hs-comment">-- to avoid #20231. This function (and its one usage site) is the only reason</span><span>
</span><span id="line-1988"></span><span class="hs-comment">-- that we store a stack instead of just the top environment.</span><span>
</span><span id="line-1989"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682547995"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547995"><span class="hs-identifier hs-var">tyfam_app</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Type -&gt; Maybe Type
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isCycleBreakerTyVar"><span class="hs-identifier hs-var">isCycleBreakerTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547993"><span class="hs-identifier hs-var">cbv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Type -&gt; Maybe Type) -&gt; Maybe Type -&gt; Maybe Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1990"></span><span>                      </span><span class="annot"><span class="annottext">NonEmpty (Maybe Type) -&gt; Maybe Type
forall (f :: * -&gt; *) a. Foldable f =&gt; f (Maybe a) -&gt; Maybe a
</span><a href="GHC.Data.Maybe.html#firstJusts"><span class="hs-identifier hs-var">firstJusts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Bag (TcTyVar, Type) -&gt; Maybe Type)
-&gt; CycleBreakerVarStack -&gt; NonEmpty (Maybe Type)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
</span><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#map"><span class="hs-identifier hs-var">NE.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bag (TcTyVar, Type) -&gt; Maybe Type
forall a b. Eq a =&gt; a -&gt; Bag (a, b) -&gt; Maybe b
</span><a href="GHC.Data.Bag.html#lookupBag"><span class="hs-identifier hs-var">lookupBag</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547993"><span class="hs-identifier hs-var">cbv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack
</span><a href="#local-6989586621682547994"><span class="hs-identifier hs-var">cbvs_stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1991"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682547995"><span class="hs-identifier hs-var">tyfam_app</span></a></span><span>
</span><span id="line-1992"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1993"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Type
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupCycleBreakerVar found an unbound cycle breaker&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682547993"><span class="hs-identifier hs-var">cbv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CycleBreakerVarStack
</span><a href="#local-6989586621682547994"><span class="hs-identifier hs-var">cbvs_stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1994"></span><span>
</span><span id="line-1995"></span><span class="hs-comment">-- | Push a fresh environment onto the cycle-breaker var stack. Useful</span><span>
</span><span id="line-1996"></span><span class="hs-comment">-- when entering a nested implication.</span><span>
</span><span id="line-1997"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#pushCycleBreakerVarStack"><span class="hs-identifier hs-type">pushCycleBreakerVarStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-1998"></span><span id="pushCycleBreakerVarStack"><span class="annot"><span class="annottext">pushCycleBreakerVarStack :: CycleBreakerVarStack -&gt; CycleBreakerVarStack
</span><a href="GHC.Tc.Solver.InertSet.html#pushCycleBreakerVarStack"><span class="hs-identifier hs-var hs-var">pushCycleBreakerVarStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type) -&gt; CycleBreakerVarStack -&gt; CycleBreakerVarStack
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#%3C%7C"><span class="hs-operator hs-var">&lt;|</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1999"></span><span>
</span><span id="line-2000"></span><span class="annot"><span class="hs-comment">-- | Add a new cycle-breaker binding to the top environment on the stack.</span></span><span>
</span><span id="line-2001"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#addCycleBreakerBindings"><span class="hs-identifier hs-type">addCycleBreakerBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ (cbv,expansion) pairs</span></span><span>
</span><span id="line-2002"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InertSet"><span class="hs-identifier hs-type">InertSet</span></a></span><span>
</span><span id="line-2003"></span><span id="addCycleBreakerBindings"><span class="annot"><span class="annottext">addCycleBreakerBindings :: Bag (TcTyVar, Type) -&gt; InertSet -&gt; InertSet
</span><a href="GHC.Tc.Solver.InertSet.html#addCycleBreakerBindings"><span class="hs-identifier hs-var hs-var">addCycleBreakerBindings</span></a></span></span><span> </span><span id="local-6989586621682548002"><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548002"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span id="local-6989586621682548003"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682548003"><span class="hs-identifier hs-var">ics</span></a></span></span><span>
</span><span id="line-2004"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; InertSet -&gt; InertSet
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TcTyVar, Type) -&gt; Bool) -&gt; Bag (TcTyVar, Type) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isCycleBreakerTyVar"><span class="hs-identifier hs-var">isCycleBreakerTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool)
-&gt; ((TcTyVar, Type) -&gt; TcTyVar) -&gt; (TcTyVar, Type) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TcTyVar, Type) -&gt; TcTyVar
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548002"><span class="hs-identifier hs-var">prs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag (TcTyVar, Type) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548002"><span class="hs-identifier hs-var">prs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(InertSet -&gt; InertSet) -&gt; InertSet -&gt; InertSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2005"></span><span>    </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682548003"><span class="hs-identifier hs-var">ics</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682548006"><span class="hs-identifier hs-type">add_to</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#inert_cycle_breakers"><span class="hs-identifier hs-var">inert_cycle_breakers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682548003"><span class="hs-identifier hs-type">ics</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2006"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2007"></span><span>    </span><span id="local-6989586621682548006"><span class="annot"><span class="annottext">add_to :: CycleBreakerVarStack -&gt; CycleBreakerVarStack
</span><a href="#local-6989586621682548006"><span class="hs-identifier hs-var hs-var">add_to</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682548007"><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548007"><span class="hs-identifier hs-var">top_env</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621682548008"><span class="annot"><span class="annottext">[Bag (TcTyVar, Type)]
</span><a href="#local-6989586621682548008"><span class="hs-identifier hs-var">rest_envs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548002"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type) -&gt; Bag (TcTyVar, Type) -&gt; Bag (TcTyVar, Type)
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548007"><span class="hs-identifier hs-var">top_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
-&gt; [Bag (TcTyVar, Type)] -&gt; CycleBreakerVarStack
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[Bag (TcTyVar, Type)]
</span><a href="#local-6989586621682548008"><span class="hs-identifier hs-var">rest_envs</span></a></span><span>
</span><span id="line-2008"></span><span>
</span><span id="line-2009"></span><span class="hs-comment">-- | Perform a monadic operation on all pairs in the top environment</span><span>
</span><span id="line-2010"></span><span class="hs-comment">-- in the stack.</span><span>
</span><span id="line-2011"></span><span id="local-6989586621682547252"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#forAllCycleBreakerBindings_"><span class="hs-identifier hs-type">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682547252"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-2012"></span><span>                            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#CycleBreakerVarStack"><span class="hs-identifier hs-type">CycleBreakerVarStack</span></a></span><span>
</span><span id="line-2013"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547252"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682547252"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2014"></span><span id="forAllCycleBreakerBindings_"><span class="annot"><span class="annottext">forAllCycleBreakerBindings_ :: forall (m :: * -&gt; *).
Monad m =&gt;
CycleBreakerVarStack -&gt; (TcTyVar -&gt; Type -&gt; m ()) -&gt; m ()
</span><a href="GHC.Tc.Solver.InertSet.html#forAllCycleBreakerBindings_"><span class="hs-identifier hs-var hs-var">forAllCycleBreakerBindings_</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682548012"><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548012"><span class="hs-identifier hs-var">top_env</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621682548013"><span class="annot"><span class="annottext">[Bag (TcTyVar, Type)]
</span><a href="#local-6989586621682548013"><span class="hs-identifier hs-var">_rest_envs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682548014"><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; m ()
</span><a href="#local-6989586621682548014"><span class="hs-identifier hs-var">action</span></a></span></span><span>
</span><span id="line-2015"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type) -&gt; ((TcTyVar, Type) -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">Bag (TcTyVar, Type)
</span><a href="#local-6989586621682548012"><span class="hs-identifier hs-var">top_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; Type -&gt; m ()) -&gt; (TcTyVar, Type) -&gt; m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; m ()
</span><a href="#local-6989586621682548014"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2016"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#forAllCycleBreakerBindings_"><span class="hs-pragma hs-type">forAllCycleBreakerBindings_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- to allow SPECIALISE later</span><span>
</span><span id="line-2017"></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
         Solving one from another
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2024"></span><span>
</span><span id="line-2025"></span><span class="hs-keyword">data</span><span> </span><span id="InteractResult"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InteractResult"><span class="hs-identifier hs-var">InteractResult</span></a></span></span><span>
</span><span id="line-2026"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="KeepInert"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span></span><span>   </span><span class="hs-comment">-- Keep the inert item, and solve the work item from it</span><span>
</span><span id="line-2027"></span><span>                 </span><span class="hs-comment">-- (if the latter is Wanted; just discard it if not)</span><span>
</span><span id="line-2028"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="KeepWork"><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span></span><span>    </span><span class="hs-comment">-- Keep the work item, and solve the inert item from it</span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InteractResult"><span class="hs-identifier hs-type">InteractResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2031"></span><span>  </span><span id="local-6989586621682548022"><span class="annot"><span class="annottext">ppr :: InteractResult -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;keep inert&quot;</span></span><span>
</span><span id="line-2032"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;keep work-item&quot;</span></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#solveOneFromTheOther"><span class="hs-identifier hs-type">solveOneFromTheOther</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>  </span><span class="hs-comment">-- Inert    (Dict or Irred)</span><span>
</span><span id="line-2035"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span>  </span><span class="hs-comment">-- WorkItem (same predicate as inert)</span><span>
</span><span id="line-2036"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html#InteractResult"><span class="hs-identifier hs-type">InteractResult</span></a></span><span>
</span><span id="line-2037"></span><span class="hs-comment">-- Precondition:</span><span>
</span><span id="line-2038"></span><span class="annot"><span class="hs-comment">-- * inert and work item represent evidence for the /same/ predicate</span></span><span>
</span><span id="line-2039"></span><span class="annot"><span class="hs-comment">-- * Both are CDictCan or CIrredCan</span></span><span>
</span><span id="line-2040"></span><span class="hs-comment">--</span><span>
</span><span id="line-2041"></span><span class="hs-comment">-- We can always solve one from the other: even if both are wanted,</span><span>
</span><span id="line-2042"></span><span class="hs-comment">-- although we don't rewrite wanteds with wanteds, we can combine</span><span>
</span><span id="line-2043"></span><span class="hs-comment">-- two wanteds into one by solving one from the other</span><span>
</span><span id="line-2044"></span><span>
</span><span id="line-2045"></span><span id="solveOneFromTheOther"><span class="annot"><span class="annottext">solveOneFromTheOther :: Ct -&gt; Ct -&gt; InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#solveOneFromTheOther"><span class="hs-identifier hs-var hs-var">solveOneFromTheOther</span></a></span></span><span> </span><span id="local-6989586621682548023"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682548023"><span class="hs-identifier hs-var">ct_i</span></a></span></span><span> </span><span id="local-6989586621682548024"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682548024"><span class="hs-identifier hs-var">ct_w</span></a></span></span><span>
</span><span id="line-2046"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682548026"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548026"><span class="hs-identifier hs-var">loc_w</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548027"><span class="hs-identifier hs-var">ev_w</span></a></span><span>
</span><span id="line-2047"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var">prohibitedSuperClassSolve</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548028"><span class="hs-identifier hs-var">loc_i</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548026"><span class="hs-identifier hs-var">loc_w</span></a></span><span>
</span><span id="line-2048"></span><span>  </span><span class="hs-comment">-- See Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance</span><span>
</span><span id="line-2049"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Inert must be Given</span><span>
</span><span id="line-2050"></span><span>    </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>
</span><span id="line-2051"></span><span>
</span><span id="line-2052"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548027"><span class="hs-identifier hs-var">ev_w</span></a></span><span>
</span><span id="line-2053"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Inert is Given or Wanted</span><span>
</span><span id="line-2054"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548029"><span class="hs-identifier hs-var">ev_i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2055"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>
</span><span id="line-2056"></span><span>        </span><span class="hs-comment">-- work is Wanted; inert is Given: easy choice.</span><span>
</span><span id="line-2057"></span><span>
</span><span id="line-2058"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- Both are Wanted</span><span>
</span><span id="line-2059"></span><span>        </span><span class="hs-comment">-- If only one has no pending superclasses, use it</span><span>
</span><span id="line-2060"></span><span>        </span><span class="hs-comment">-- Otherwise we can get infinite superclass expansion (#22516)</span><span>
</span><span id="line-2061"></span><span>        </span><span class="hs-comment">-- in silly cases like   class C T b =&gt; C a b where ...</span><span>
</span><span id="line-2062"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548030"><span class="hs-identifier hs-var">is_psc_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548031"><span class="hs-identifier hs-var">is_psc_w</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>
</span><span id="line-2063"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548030"><span class="hs-identifier hs-var">is_psc_i</span></a></span><span class="hs-special">,</span><span>     </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548031"><span class="hs-identifier hs-var">is_psc_w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>
</span><span id="line-2064"></span><span>
</span><span id="line-2065"></span><span>        </span><span class="hs-comment">-- If only one is a WantedSuperclassOrigin (arising from expanding</span><span>
</span><span id="line-2066"></span><span>        </span><span class="hs-comment">-- a Wanted class constraint), keep the other: wanted superclasses</span><span>
</span><span id="line-2067"></span><span>        </span><span class="hs-comment">-- may be unexpected by users</span><span>
</span><span id="line-2068"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548032"><span class="hs-identifier hs-var">is_wsc_orig_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548033"><span class="hs-identifier hs-var">is_wsc_orig_w</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>
</span><span id="line-2069"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548032"><span class="hs-identifier hs-var">is_wsc_orig_i</span></a></span><span class="hs-special">,</span><span>     </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548033"><span class="hs-identifier hs-var">is_wsc_orig_w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>
</span><span id="line-2070"></span><span>
</span><span id="line-2071"></span><span>        </span><span class="hs-comment">-- otherwise, just choose the lower span</span><span>
</span><span id="line-2072"></span><span>        </span><span class="hs-comment">-- reason: if we have something like (abs 1) (where the</span><span>
</span><span id="line-2073"></span><span>        </span><span class="hs-comment">-- Num constraint cannot be satisfied), it's better to</span><span>
</span><span id="line-2074"></span><span>        </span><span class="hs-comment">-- get an error about abs than about 1.</span><span>
</span><span id="line-2075"></span><span>        </span><span class="hs-comment">-- This test might become more elaborate if we see an</span><span>
</span><span id="line-2076"></span><span>        </span><span class="hs-comment">-- opportunity to improve the error messages</span><span>
</span><span id="line-2077"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; RealSrcSpan -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;)</span></span><span> </span><span class="annot"><span class="annottext">(RealSrcSpan -&gt; RealSrcSpan -&gt; Bool)
-&gt; (CtLoc -&gt; RealSrcSpan) -&gt; CtLoc -&gt; CtLoc -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.Constraint.html#ctLocSpan"><span class="hs-identifier hs-var">ctLocSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548028"><span class="hs-identifier hs-var">loc_i</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548036"><span class="hs-identifier hs-var">loc_w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>
</span><span id="line-2078"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>
</span><span id="line-2079"></span><span>
</span><span id="line-2080"></span><span>  </span><span class="hs-comment">-- From here on the work-item is Given</span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682548037"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548037"><span class="hs-identifier hs-var">loc_i</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548029"><span class="hs-identifier hs-var">ev_i</span></a></span><span>
</span><span id="line-2083"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLoc -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#prohibitedSuperClassSolve"><span class="hs-identifier hs-var">prohibitedSuperClassSolve</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548036"><span class="hs-identifier hs-var">loc_w</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548037"><span class="hs-identifier hs-var">loc_i</span></a></span><span>
</span><span id="line-2084"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>   </span><span class="hs-comment">-- Just discard the un-usable Given</span><span>
</span><span id="line-2085"></span><span>                </span><span class="hs-comment">-- This never actually happens because</span><span>
</span><span id="line-2086"></span><span>                </span><span class="hs-comment">-- Givens get processed first</span><span>
</span><span id="line-2087"></span><span>
</span><span id="line-2088"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548029"><span class="hs-identifier hs-var">ev_i</span></a></span><span>
</span><span id="line-2089"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>
</span><span id="line-2090"></span><span>
</span><span id="line-2091"></span><span>  </span><span class="hs-comment">-- From here on both are Given</span><span>
</span><span id="line-2092"></span><span>  </span><span class="hs-comment">-- See Note [Replacement vs keeping]</span><span>
</span><span id="line-2093"></span><span>
</span><span id="line-2094"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682548038"><span class="hs-identifier hs-var">lvl_i</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682548039"><span class="hs-identifier hs-var">lvl_w</span></a></span><span>
</span><span id="line-2095"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="#local-6989586621682548040"><span class="hs-identifier hs-var">same_level_strategy</span></a></span><span>
</span><span id="line-2096"></span><span>
</span><span id="line-2097"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>   </span><span class="hs-comment">-- Both are Given, levels differ</span><span>
</span><span id="line-2098"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="#local-6989586621682548041"><span class="hs-identifier hs-var">different_level_strategy</span></a></span><span>
</span><span id="line-2099"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2100"></span><span>     </span><span id="local-6989586621682548029"><span class="annot"><span class="annottext">ev_i :: CtEvidence
</span><a href="#local-6989586621682548029"><span class="hs-identifier hs-var hs-var">ev_i</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682548023"><span class="hs-identifier hs-var">ct_i</span></a></span><span>
</span><span id="line-2101"></span><span>     </span><span id="local-6989586621682548027"><span class="annot"><span class="annottext">ev_w :: CtEvidence
</span><a href="#local-6989586621682548027"><span class="hs-identifier hs-var hs-var">ev_w</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682548024"><span class="hs-identifier hs-var">ct_w</span></a></span><span>
</span><span id="line-2102"></span><span>
</span><span id="line-2103"></span><span>     </span><span id="local-6989586621682548042"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682548042"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548029"><span class="hs-identifier hs-var">ev_i</span></a></span><span>
</span><span id="line-2104"></span><span>
</span><span id="line-2105"></span><span>     </span><span id="local-6989586621682548028"><span class="annot"><span class="annottext">loc_i :: CtLoc
</span><a href="#local-6989586621682548028"><span class="hs-identifier hs-var hs-var">loc_i</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548029"><span class="hs-identifier hs-var">ev_i</span></a></span><span>
</span><span id="line-2106"></span><span>     </span><span id="local-6989586621682548036"><span class="annot"><span class="annottext">loc_w :: CtLoc
</span><a href="#local-6989586621682548036"><span class="hs-identifier hs-var hs-var">loc_w</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682548027"><span class="hs-identifier hs-var">ev_w</span></a></span><span>
</span><span id="line-2107"></span><span>     </span><span id="local-6989586621682548044"><span class="annot"><span class="annottext">orig_i :: CtOrigin
</span><a href="#local-6989586621682548044"><span class="hs-identifier hs-var hs-var">orig_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548028"><span class="hs-identifier hs-var">loc_i</span></a></span><span>
</span><span id="line-2108"></span><span>     </span><span id="local-6989586621682548045"><span class="annot"><span class="annottext">orig_w :: CtOrigin
</span><a href="#local-6989586621682548045"><span class="hs-identifier hs-var hs-var">orig_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548036"><span class="hs-identifier hs-var">loc_w</span></a></span><span>
</span><span id="line-2109"></span><span>     </span><span id="local-6989586621682548038"><span class="annot"><span class="annottext">lvl_i :: TcLevel
</span><a href="#local-6989586621682548038"><span class="hs-identifier hs-var hs-var">lvl_i</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcLevel
</span><a href="GHC.Tc.Types.Constraint.html#ctLocLevel"><span class="hs-identifier hs-var">ctLocLevel</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548028"><span class="hs-identifier hs-var">loc_i</span></a></span><span>
</span><span id="line-2110"></span><span>     </span><span id="local-6989586621682548039"><span class="annot"><span class="annottext">lvl_w :: TcLevel
</span><a href="#local-6989586621682548039"><span class="hs-identifier hs-var hs-var">lvl_w</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcLevel
</span><a href="GHC.Tc.Types.Constraint.html#ctLocLevel"><span class="hs-identifier hs-var">ctLocLevel</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682548036"><span class="hs-identifier hs-var">loc_w</span></a></span><span>
</span><span id="line-2111"></span><span>
</span><span id="line-2112"></span><span>     </span><span id="local-6989586621682548031"><span class="annot"><span class="annottext">is_psc_w :: Bool
</span><a href="#local-6989586621682548031"><span class="hs-identifier hs-var hs-var">is_psc_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isPendingScDict"><span class="hs-identifier hs-var">isPendingScDict</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682548024"><span class="hs-identifier hs-var">ct_w</span></a></span><span>
</span><span id="line-2113"></span><span>     </span><span id="local-6989586621682548030"><span class="annot"><span class="annottext">is_psc_i :: Bool
</span><a href="#local-6989586621682548030"><span class="hs-identifier hs-var hs-var">is_psc_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isPendingScDict"><span class="hs-identifier hs-var">isPendingScDict</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682548023"><span class="hs-identifier hs-var">ct_i</span></a></span><span>
</span><span id="line-2114"></span><span>
</span><span id="line-2115"></span><span>     </span><span id="local-6989586621682548032"><span class="annot"><span class="annottext">is_wsc_orig_i :: Bool
</span><a href="#local-6989586621682548032"><span class="hs-identifier hs-var hs-var">is_wsc_orig_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Bool
</span><a href="GHC.Tc.Types.Origin.html#isWantedSuperclassOrigin"><span class="hs-identifier hs-var">isWantedSuperclassOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682548044"><span class="hs-identifier hs-var">orig_i</span></a></span><span>
</span><span id="line-2116"></span><span>     </span><span id="local-6989586621682548033"><span class="annot"><span class="annottext">is_wsc_orig_w :: Bool
</span><a href="#local-6989586621682548033"><span class="hs-identifier hs-var hs-var">is_wsc_orig_w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Bool
</span><a href="GHC.Tc.Types.Origin.html#isWantedSuperclassOrigin"><span class="hs-identifier hs-var">isWantedSuperclassOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682548045"><span class="hs-identifier hs-var">orig_w</span></a></span><span>
</span><span id="line-2117"></span><span>
</span><span id="line-2118"></span><span>     </span><span id="local-6989586621682548041"><span class="annot"><span class="annottext">different_level_strategy :: InteractResult
</span><a href="#local-6989586621682548041"><span class="hs-identifier hs-var hs-var">different_level_strategy</span></a></span></span><span>  </span><span class="hs-comment">-- Both Given</span><span>
</span><span id="line-2119"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isIPLikePred"><span class="hs-identifier hs-var">isIPLikePred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682548042"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682548039"><span class="hs-identifier hs-var">lvl_w</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682548038"><span class="hs-identifier hs-var">lvl_i</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>
</span><span id="line-2120"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682548039"><span class="hs-identifier hs-var">lvl_w</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682548038"><span class="hs-identifier hs-var">lvl_i</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>
</span><span id="line-2121"></span><span>       </span><span class="hs-comment">-- See Note [Replacement vs keeping] part (1)</span><span>
</span><span id="line-2122"></span><span>       </span><span class="hs-comment">-- For the isIPLikePred case see Note [Shadowing of implicit parameters]</span><span>
</span><span id="line-2123"></span><span>       </span><span class="hs-comment">--                               in GHC.Tc.Solver.Dict</span><span>
</span><span id="line-2124"></span><span>
</span><span id="line-2125"></span><span>     </span><span id="local-6989586621682548040"><span class="annot"><span class="annottext">same_level_strategy :: InteractResult
</span><a href="#local-6989586621682548040"><span class="hs-identifier hs-var hs-var">same_level_strategy</span></a></span></span><span> </span><span class="hs-comment">-- Both Given</span><span>
</span><span id="line-2126"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682548044"><span class="hs-identifier hs-var">orig_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682548045"><span class="hs-identifier hs-var">orig_w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2127"></span><span>
</span><span id="line-2128"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682548051"><span class="annot"><span class="annottext">ScDepth
</span><a href="#local-6989586621682548051"><span class="hs-identifier hs-var">depth_i</span></a></span></span><span> </span><span id="local-6989586621682548052"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548052"><span class="hs-identifier hs-var">blocked_i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682548053"><span class="annot"><span class="annottext">ScDepth
</span><a href="#local-6989586621682548053"><span class="hs-identifier hs-var">depth_w</span></a></span></span><span> </span><span id="local-6989586621682548054"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548054"><span class="hs-identifier hs-var">blocked_w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2129"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548052"><span class="hs-identifier hs-var">blocked_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548054"><span class="hs-identifier hs-var">blocked_w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>  </span><span class="hs-comment">-- Case 2(a) from</span><span>
</span><span id="line-2130"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548052"><span class="hs-identifier hs-var">blocked_i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682548054"><span class="hs-identifier hs-var">blocked_w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span> </span><span class="hs-comment">-- Note [Replacement vs keeping]</span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span>             </span><span class="hs-comment">-- Both blocked or both not blocked</span><span>
</span><span id="line-2133"></span><span>
</span><span id="line-2134"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ScDepth
</span><a href="#local-6989586621682548053"><span class="hs-identifier hs-var">depth_w</span></a></span><span> </span><span class="annot"><span class="annottext">ScDepth -&gt; ScDepth -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">ScDepth
</span><a href="#local-6989586621682548051"><span class="hs-identifier hs-var">depth_i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>   </span><span class="hs-comment">-- Case 2(c) from</span><span>
</span><span id="line-2135"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>  </span><span class="hs-comment">-- Note [Replacement vs keeping]</span><span>
</span><span id="line-2136"></span><span>
</span><span id="line-2137"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepWork"><span class="hs-identifier hs-var">KeepWork</span></a></span><span>  </span><span class="hs-comment">-- Case 2(b) from Note [Replacement vs keeping]</span><span>
</span><span id="line-2138"></span><span>
</span><span id="line-2139"></span><span>           </span><span class="annot"><span class="annottext">(CtOrigin, CtOrigin)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InteractResult
</span><a href="GHC.Tc.Solver.InertSet.html#KeepInert"><span class="hs-identifier hs-var">KeepInert</span></a></span><span>  </span><span class="hs-comment">-- Case 2(d) from Note [Replacement vs keeping]</span><span>
</span><span id="line-2140"></span><span>
</span><span id="line-2141"></span><span class="hs-comment">{-
Note [Replacement vs keeping]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we have two Given constraints both of type (C tys), say, which should
we keep?  More subtle than you might think! This is all implemented in
solveOneFromTheOther.

  1) Constraints come from different levels (different_level_strategy)

      - For implicit parameters we want to keep the innermost (deepest)
        one, so that it overrides the outer one.
        See Note [Shadowing of implicit parameters] in GHC.Tc.Solver.Dict

      - For everything else, we want to keep the outermost one.  Reason: that
        makes it more likely that the inner one will turn out to be unused,
        and can be reported as redundant.  See Note [Tracking redundant constraints]
        in GHC.Tc.Solver.

        It transpires that using the outermost one is responsible for an
        8% performance improvement in nofib cryptarithm2, compared to
        just rolling the dice.  I didn't investigate why.

  2) Constraints coming from the same level (i.e. same implication)

       (a) If both are GivenSCOrigin, choose the one that is unblocked if possible
           according to Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance.

       (b) Prefer constraints that are not superclass selections. Example:

             f :: (Eq a, Ord a) =&gt; a -&gt; Bool
             f x = x == x

           Eager superclass expansion gives us two [G] Eq a constraints. We
           want to keep the one from the user-written Eq a, not the superclass
           selection. This means we report the Ord a as redundant with
           -Wredundant-constraints, not the Eq a.

           Getting this wrong was #20602. See also
           Note [Tracking redundant constraints] in GHC.Tc.Solver.

       (c) If both are GivenSCOrigin, chooose the one with the shallower
           superclass-selection depth, in the hope of identifying more correct
           redundant constraints. This is really a generalization of point (b),
           because the superclass depth of a non-superclass constraint is 0.

           (If the levels differ, we definitely won't have both with GivenSCOrigin.)

       (d) Finally, when there is still a choice, use KeepInert rather than
           KeepWork, for two reasons:
             - to avoid unnecessary munging of the inert set.
             - to cut off superclass loops; see Note [Superclass loops] in GHC.Tc.Solver.Dict

Doing the level-check for implicit parameters, rather than making the work item
always override, is important.  Consider

    data T a where { T1 :: (?x::Int) =&gt; T Int; T2 :: T a }

    f :: (?x::a) =&gt; T a -&gt; Int
    f T1 = ?x
    f T2 = 3

We have a [G] (?x::a) in the inert set, and at the pattern match on T1 we add
two new givens in the work-list:  [G] (?x::Int)
                                  [G] (a ~ Int)
Now consider these steps
  - process a~Int, kicking out (?x::a)
  - process (?x::Int), the inner given, adding to inert set
  - process (?x::a), the outer given, overriding the inner given
Wrong!  The level-check ensures that the inner implicit parameter wins.
(Actually I think that the order in which the work-list is processed means
that this chain of events won't happen, but that's very fragile.)
-}</span><span>
</span><span id="line-2213"></span></pre></body></html>