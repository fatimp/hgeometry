<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, RecursiveDo #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DisambiguateRecordFields #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topSkolemise"><span class="hs-identifier">topSkolemise</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier">topInstantiate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instantiateSigma"><span class="hs-identifier">instantiateSigma</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier">instCall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier">instDFunType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier">instStupidTheta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instTyVarsWith"><span class="hs-identifier">instTyVarsWith</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier">newWanted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newWanteds"><span class="hs-identifier">newWanteds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstType"><span class="hs-identifier">tcInstType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstTypeBndrs"><span class="hs-identifier">tcInstTypeBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSkolemiseInvisibleBndrs"><span class="hs-identifier">tcSkolemiseInvisibleBndrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVars"><span class="hs-identifier">tcInstSkolTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier">tcInstSkolTyVarsX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarBndrsX"><span class="hs-identifier">tcInstSkolTyVarBndrsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSkolDFunType"><span class="hs-identifier">tcSkolDFunType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSuperSkolTyVars"><span class="hs-identifier">tcSuperSkolTyVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier">tcInstSuperSkolTyVarsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier">freshenTyVarBndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenCoVarBndrsX"><span class="hs-identifier">freshenCoVarBndrsX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier">tcInstInvisibleTyBindersN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinders"><span class="hs-identifier">tcInstInvisibleTyBinders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinder"><span class="hs-identifier">tcInstInvisibleTyBinder</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier">newOverloadedLit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier">mkOverLit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newClsInst"><span class="hs-identifier">newClsInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newFamInst"><span class="hs-identifier">newFamInst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcGetInsts"><span class="hs-identifier">tcGetInsts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier">tcGetInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#getOverlapFlag"><span class="hs-identifier">getOverlapFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcExtendLocalInstEnv"><span class="hs-identifier">tcExtendLocalInstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier">instCallConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier">newMethodFromName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSyntaxName"><span class="hs-identifier">tcSyntaxName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>     </span><span class="hs-comment">-- Simple functions over evidence variables</span><span>
</span><span id="line-38"></span><span>     </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#tyCoVarsOfWC"><span class="hs-identifier">tyCoVarsOfWC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>     </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#tyCoVarsOfCt"><span class="hs-identifier">tyCoVarsOfCt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#tyCoVarsOfCts"><span class="hs-identifier">tyCoVarsOfCts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#heqDataCon"><span class="hs-identifier">heqDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#integerTyConName"><span class="hs-identifier">integerTyConName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html"><span class="hs-identifier">GHC.Hs.Syn.Type</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html#hsLitType"><span class="hs-identifier">hsLitType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier">Expr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#isOrphan"><span class="hs-identifier">isOrphan</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- For the Coercion constructor</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier">debugPprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier">Class</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier">unifyType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.FunDeps.html"><span class="hs-identifier">GHC.Tc.Instance.FunDeps</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html"><span class="hs-identifier">GHC.Tc.Zonk.Monad</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier">ZonkM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html#mkDictFunId"><span class="hs-identifier">mkDictFunId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier">TypeOrKind</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier">Arity</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SrcLoc</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.10.1-5e10/src//GHC.LanguageExtensions.html/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Unique.html"><span class="hs-identifier">GHC.Utils.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier">sameUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Warnings.html"><span class="hs-identifier">GHC.Unit.Module.Warnings</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.html/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.html/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.Function.html/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">on</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Creating and emitting constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-type">newMethodFromName</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ why do we need this?</span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ name of the method</span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span class="hs-special">]</span><span>           </span><span class="annot"><span class="hs-comment">-- ^ types with which to instantiate the class</span></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- ^ Used when 'Name' is the wired-in name for a wired-in class method,</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- so the caller knows its type for sure, which should be of form</span><span>
</span><span id="line-118"></span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- &gt; forall a. C a =&gt; &lt;blah&gt;</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- 'newMethodFromName' is supposed to instantiate just the outer</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- type variable and constraint</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span id="newMethodFromName"><span class="annot"><span class="annottext">newMethodFromName :: CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var hs-var">newMethodFromName</span></a></span></span><span> </span><span id="local-6989586621682801773"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801773"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682801774"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682801774"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682801775"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801775"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801776"><span class="annot"><a href="#local-6989586621682801776"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM DFunId
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682801774"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-126"></span><span>              </span><span class="hs-comment">-- Use tcLookupId not tcLookupGlobalId; the method is almost</span><span>
</span><span id="line-127"></span><span>              </span><span class="hs-comment">-- always a class op, but with -XRebindableSyntax GHC is</span><span>
</span><span id="line-128"></span><span>              </span><span class="hs-comment">-- meant to find whatever thing is in scope, and that may</span><span>
</span><span id="line-129"></span><span>              </span><span class="hs-comment">-- be an ordinary function.</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682801778"><span class="annot"><a href="#local-6989586621682801778"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [Type] -&gt; Type
Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801776"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801775"><span class="hs-identifier hs-var">ty_args</span></a></span><span>
</span><span id="line-132"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621682801781"><span class="annot"><a href="#local-6989586621682801781"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801782"><span class="annot"><a href="#local-6989586621682801782"><span class="hs-identifier hs-var">_caller_knows_this</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-type">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801778"><span class="hs-identifier hs-type">ty</span></a></span><span>
</span><span id="line-133"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682801784"><span class="annot"><a href="#local-6989586621682801784"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-type">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-type">isForAllTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801778"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-type">isSingleton</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801781"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-134"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-type">instCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801773"><span class="hs-identifier hs-type">origin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801775"><span class="hs-identifier hs-type">ty_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801781"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-type">mkHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801784"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801776"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
         Instantiation and skolemisation
*                                                                      *
************************************************************************

Note [Skolemisation]
~~~~~~~~~~~~~~~~~~~~
topSkolemise decomposes and skolemises a type, returning a type
with no top level foralls or (=&gt;)

Examples:

  topSkolemise (forall a. Ord a =&gt; a -&gt; a)
    =  ( wp, [a], [d:Ord a], a-&gt;a )
    where wp = /\a. \(d:Ord a). &lt;hole&gt; a d

  topSkolemise  (forall a. Ord a =&gt; forall b. Eq b =&gt; a-&gt;b-&gt;b)
    =  ( wp, [a,b], [d1:Ord a,d2:Eq b], a-&gt;b-&gt;b )
    where wp = /\a.\(d1:Ord a)./\b.\(d2:Ord b). &lt;hole&gt; a d1 b d2

This second example is the reason for the recursive 'go' function in
topSkolemise: we remove successive layers of foralls and (=&gt;).  This
is really just an optimisation; see wrinkle (SK1) in GHC.Tc.Utils.Unify
Note [Skolemisation overview].

In general,
  if      topSkolemise ty = (wrap, tvs, evs, rho)
    and   e :: rho
  then    wrap e :: ty
    and   'wrap' binds {tvs, evs}

-}</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topSkolemise"><span class="hs-identifier hs-type">topSkolemise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-174"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-175"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-176"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcInvisTVBinder"><span class="hs-identifier hs-type">TcInvisTVBinder</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- All skolemised variables</span><span>
</span><span id="line-177"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span class="hs-special">]</span><span>                      </span><span class="hs-comment">-- All &quot;given&quot;s</span><span>
</span><span id="line-178"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- See Note [Skolemisation]</span><span>
</span><span id="line-180"></span><span id="topSkolemise"><span class="annot"><span class="annottext">topSkolemise :: SkolemInfo
-&gt; Type
-&gt; TcM (HsWrapper, [(Name, TcInvisTVBinder)], [DFunId], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#topSkolemise"><span class="hs-identifier hs-var hs-var">topSkolemise</span></a></span></span><span> </span><span id="local-6989586621682801796"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682801796"><span class="hs-identifier hs-var">skolem_info</span></a></span></span><span> </span><span id="local-6989586621682801797"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801797"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst
-&gt; HsWrapper
-&gt; [(Name, TcInvisTVBinder)]
-&gt; [DFunId]
-&gt; Type
-&gt; TcM (HsWrapper, [(Name, TcInvisTVBinder)], [DFunId], Type)
</span><a href="#local-6989586621682801798"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801799"><span class="hs-identifier hs-var">init_subst</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801797"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621682801799"><span class="annot"><span class="annottext">init_subst :: Subst
</span><a href="#local-6989586621682801799"><span class="hs-identifier hs-var hs-var">init_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801797"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- Why recursive?  See Note [Skolemisation]</span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621682801798"><span class="annot"><span class="annottext">go :: Subst
-&gt; HsWrapper
-&gt; [(Name, TcInvisTVBinder)]
-&gt; [DFunId]
-&gt; Type
-&gt; TcM (HsWrapper, [(Name, TcInvisTVBinder)], [DFunId], Type)
</span><a href="#local-6989586621682801798"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682801804"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801804"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682801805"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682801805"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621682801806"><span class="annot"><span class="annottext">[(Name, TcInvisTVBinder)]
</span><a href="#local-6989586621682801806"><span class="hs-identifier hs-var">tv_prs</span></a></span></span><span> </span><span id="local-6989586621682801807"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801807"><span class="hs-identifier hs-var">ev_vars</span></a></span></span><span> </span><span id="local-6989586621682801808"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801808"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801809"><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682801809"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801810"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801810"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801811"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801811"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcInvisTVBinder], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTyBndrs"><span class="hs-identifier hs-var">tcSplitSigmaTyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801808"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682801813"><span class="annot"><span class="annottext">tvs :: [DFunId]
</span><a href="#local-6989586621682801813"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder] -&gt; [DFunId]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682801809"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DFunId] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801813"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801810"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801816"><span class="annot"><a href="#local-6989586621682801816"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801817"><span class="annot"><a href="#local-6989586621682801817"><span class="hs-identifier hs-var">bndrs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; Subst -&gt; [TcInvisTVBinder] -&gt; TcM (Subst, [TcInvisTVBinder])
forall vis.
SkolemInfo
-&gt; Subst
-&gt; [VarBndr DFunId vis]
-&gt; TcM (Subst, [VarBndr DFunId vis])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarBndrsX"><span class="hs-identifier hs-var">tcInstSkolTyVarBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682801796"><span class="hs-identifier hs-var">skolem_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801804"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682801809"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-191"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682801818"><span class="annot"><a href="#local-6989586621682801818"><span class="hs-identifier hs-var hs-var">tvs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder] -&gt; [DFunId]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682801817"><span class="hs-identifier hs-var">bndrs1</span></a></span><span>
</span><span id="line-192"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;topSkol&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801813"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-type">getSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682801813"><span class="hs-identifier hs-type">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801818"><span class="hs-identifier hs-type">tvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-type">getSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682801818"><span class="hs-identifier hs-type">tvs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682801825"><span class="annot"><a href="#local-6989586621682801825"><span class="hs-identifier hs-var">ev_vars1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-type">newEvVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-type">substTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801816"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801810"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682801798"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801816"><span class="hs-identifier hs-type">subst'</span></a></span><span>
</span><span id="line-196"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801805"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpTyLams"><span class="hs-identifier hs-type">mkWpTyLams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801818"><span class="hs-identifier hs-type">tvs1</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpEvLams"><span class="hs-identifier hs-type">mkWpEvLams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801825"><span class="hs-identifier hs-type">ev_vars1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801806"><span class="hs-identifier hs-type">tv_prs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-type">tyVarName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801813"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`zip`</span></span><span> </span><span class="annot"><a href="#local-6989586621682801817"><span class="hs-identifier hs-type">bndrs1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801807"><span class="hs-identifier hs-type">ev_vars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682801825"><span class="hs-identifier hs-type">ev_vars1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                </span><span class="annot"><a href="#local-6989586621682801811"><span class="hs-identifier hs-type">inner_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsWrapper, [(Name, TcInvisTVBinder)], [DFunId], Type)
-&gt; TcM (HsWrapper, [(Name, TcInvisTVBinder)], [DFunId], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682801805"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, TcInvisTVBinder)]
</span><a href="#local-6989586621682801806"><span class="hs-identifier hs-var">tv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801807"><span class="hs-identifier hs-var">ev_vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801804"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801808"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-comment">-- substTy is a quick no-op on an empty substitution</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- Instantiate outer invisible binders (both Inferred and Specified)</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- If    top_instantiate ty = (wrap, inner_ty)</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- then  wrap :: inner_ty &quot;-&gt;&quot; ty</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- NB: returns a type with no (=&gt;),</span><span>
</span><span id="line-210"></span><span class="hs-comment">--     and no invisible forall at the top</span><span>
</span><span id="line-211"></span><span id="topInstantiate"><span class="annot"><span class="annottext">topInstantiate :: CtOrigin -&gt; Type -&gt; TcM (HsWrapper, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var hs-var">topInstantiate</span></a></span></span><span> </span><span id="local-6989586621682801833"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801833"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682801834"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801834"><span class="hs-identifier hs-var">sigma</span></a></span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801835"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801835"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621682801836"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801836"><span class="hs-identifier hs-var">body1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ForAllTyFlag -&gt; Bool) -&gt; Type -&gt; ([DFunId], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSomeForAllTyVars"><span class="hs-identifier hs-var">tcSplitSomeForAllTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isInvisibleForAllTyFlag"><span class="hs-identifier hs-var">isInvisibleForAllTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801834"><span class="hs-identifier hs-var">sigma</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801839"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801839"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801840"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801840"><span class="hs-identifier hs-var">body2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801836"><span class="hs-identifier hs-var">body1</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DFunId] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801835"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801839"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801841"><span class="annot"><a href="#local-6989586621682801841"><span class="hs-identifier hs-var">wrap1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801842"><span class="annot"><a href="#local-6989586621682801842"><span class="hs-identifier hs-var">body3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; ConcreteTyVars
-&gt; [DFunId]
-&gt; [Type]
-&gt; Type
-&gt; TcM ([DFunId], HsWrapper, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#instantiateSigma"><span class="hs-identifier hs-var">instantiateSigma</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801833"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="GHC.Tc.Utils.TcType.html#noConcreteTyVars"><span class="hs-identifier hs-var">noConcreteTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801835"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801839"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801840"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-216"></span><span>           </span><span class="hs-comment">-- Why 'noConcreteTyVars' here?</span><span>
</span><span id="line-217"></span><span>           </span><span class="hs-comment">-- See Note [Representation-polymorphism checking built-ins]</span><span>
</span><span id="line-218"></span><span>           </span><span class="hs-comment">-- in GHC.Tc.Gen.Head.</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>       </span><span class="hs-comment">-- Loop, to account for types like</span><span>
</span><span id="line-221"></span><span>       </span><span class="hs-comment">--       forall a. Num a =&gt; forall b. Ord b =&gt; ...</span><span>
</span><span id="line-222"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801844"><span class="annot"><a href="#local-6989586621682801844"><span class="hs-identifier hs-var">wrap2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801845"><span class="annot"><a href="#local-6989586621682801845"><span class="hs-identifier hs-var">body4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801833"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801842"><span class="hs-identifier hs-type">body3</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801844"><span class="hs-identifier hs-type">wrap2</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801841"><span class="hs-identifier hs-type">wrap1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682801845"><span class="hs-identifier hs-type">body4</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsWrapper, Type) -&gt; TcM (HsWrapper, Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801834"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instantiateSigma"><span class="hs-identifier hs-type">instantiateSigma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-229"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ConcreteTyVars"><span class="hs-identifier hs-type">ConcreteTyVars</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ concreteness information</span></span><span>
</span><span id="line-230"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-232"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- (instantiate orig tvs theta ty)</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- instantiates the type variables tvs, emits the (instantiated)</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- constraints theta, and returns the (instantiated) type ty</span><span>
</span><span id="line-236"></span><span id="instantiateSigma"><span class="annot"><span class="annottext">instantiateSigma :: CtOrigin
-&gt; ConcreteTyVars
-&gt; [DFunId]
-&gt; [Type]
-&gt; Type
-&gt; TcM ([DFunId], HsWrapper, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#instantiateSigma"><span class="hs-identifier hs-var hs-var">instantiateSigma</span></a></span></span><span> </span><span id="local-6989586621682801849"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801849"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682801850"><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621682801850"><span class="hs-identifier hs-var">concs</span></a></span></span><span> </span><span id="local-6989586621682801851"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801851"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682801852"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801852"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682801853"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801853"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">rec</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801854"><span class="annot"><a href="#local-6989586621682801854"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801855"><span class="annot"><a href="#local-6989586621682801855"><span class="hs-identifier hs-var">inst_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-type">mapAccumLM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801857"><span class="hs-identifier hs-type">new_meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801854"><span class="hs-identifier hs-type">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682801858"><span class="hs-identifier hs-type">empty_subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801851"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-238"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682801859"><span class="annot"><a href="#local-6989586621682801859"><span class="hs-identifier hs-var hs-var">inst_theta</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801854"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801852"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-239"></span><span>             </span><span id="local-6989586621682801860"><span class="annot"><a href="#local-6989586621682801860"><span class="hs-identifier hs-var hs-var">inst_body</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801854"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801853"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-240"></span><span>             </span><span id="local-6989586621682801861"><span class="annot"><a href="#local-6989586621682801861"><span class="hs-identifier hs-var hs-var">inst_tv_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801855"><span class="hs-identifier hs-var">inst_tvs</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682801863"><span class="annot"><a href="#local-6989586621682801863"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-type">instCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801849"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801861"><span class="hs-identifier hs-type">inst_tv_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801859"><span class="hs-identifier hs-type">inst_theta</span></a></span><span>
</span><span id="line-243"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Instantiating&quot;</span></span><span>
</span><span id="line-244"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;origin&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#pprCtOrigin"><span class="hs-identifier hs-type">pprCtOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801849"><span class="hs-identifier hs-type">orig</span></a></span><span>
</span><span id="line-245"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tvs&quot;</span></span><span>   </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801851"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-246"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;theta&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801852"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-247"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801853"><span class="hs-identifier hs-type">body_ty</span></a></span><span>
</span><span id="line-248"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;with&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-type">debugPprType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801861"><span class="hs-identifier hs-type">inst_tv_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;theta:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801859"><span class="hs-identifier hs-type">inst_theta</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801855"><span class="hs-identifier hs-type">inst_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682801863"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682801860"><span class="hs-identifier hs-type">inst_body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621682801866"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621682801866"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DFunId] -&gt; [Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [DFunId] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkSpecSigmaTy"><span class="hs-identifier hs-var">mkSpecSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801851"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801852"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801853"><span class="hs-identifier hs-var">body_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>               </span><span class="hs-comment">-- mkSpecSigmaTy: Inferred vs Specified is not important here;</span><span>
</span><span id="line-255"></span><span>               </span><span class="hs-comment">--                We just want an accurate free-var set</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621682801858"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621682801858"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621682801866"><span class="hs-identifier hs-var">in_scope</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="#local-6989586621682801857"><span class="hs-identifier hs-type">new_meta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621682801857"><span class="annot"><span class="annottext">new_meta :: Subst
-&gt; Subst -&gt; DFunId -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, DFunId)
</span><a href="#local-6989586621682801857"><span class="hs-identifier hs-var hs-var">new_meta</span></a></span></span><span> </span><span id="local-6989586621682801868"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801868"><span class="hs-identifier hs-var">final_subst</span></a></span></span><span> </span><span id="local-6989586621682801869"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801869"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682801870"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801870"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-comment">-- Is this a type variable that must be instantiated to a concrete type?</span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-comment">-- If so, create a ConcreteTv metavariable instead of a plain TauTv.</span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-comment">-- See Note [Representation-polymorphism checking built-ins] in GHC.Tc.Gen.Head.</span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682801871"><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621682801871"><span class="hs-identifier hs-var">conc_orig0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars -&gt; Name -&gt; Maybe ConcreteTvOrigin
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTyVars
</span><a href="#local-6989586621682801850"><span class="hs-identifier hs-var">concs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801870"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682801873"><span class="annot"><span class="annottext">conc_orig :: ConcreteTvOrigin
</span><a href="#local-6989586621682801873"><span class="hs-identifier hs-var hs-var">conc_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; ConcreteTvOrigin -&gt; ConcreteTvOrigin
</span><a href="GHC.Tc.Utils.TcMType.html#substConcreteTvOrigin"><span class="hs-identifier hs-var">substConcreteTvOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801868"><span class="hs-identifier hs-var">final_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801853"><span class="hs-identifier hs-var">body_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621682801871"><span class="hs-identifier hs-var">conc_orig0</span></a></span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-comment">-- See Note [substConcreteTvOrigin].</span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin
-&gt; Subst -&gt; DFunId -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, DFunId)
</span><a href="GHC.Tc.Utils.TcMType.html#newConcreteTyVarX"><span class="hs-identifier hs-var">newConcreteTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">ConcreteTvOrigin
</span><a href="#local-6989586621682801873"><span class="hs-identifier hs-var">conc_orig</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801869"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801870"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, DFunId)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801869"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801870"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instTyVarsWith"><span class="hs-identifier hs-type">instTyVarsWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- Use this when you want to instantiate (forall a b c. ty) with</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- types [ta, tb, tc], but when the kinds of 'a' and 'ta' might</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- not yet match (perhaps because there are unsolved constraints; #14154)</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- If they don't match, emit a kind-equality to promise that they will</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- eventually do so, and thus make a kind-homogeneous substitution.</span><span>
</span><span id="line-275"></span><span id="instTyVarsWith"><span class="annot"><span class="annottext">instTyVarsWith :: CtOrigin -&gt; [DFunId] -&gt; [Type] -&gt; TcM Subst
</span><a href="GHC.Tc.Utils.Instantiate.html#instTyVarsWith"><span class="hs-identifier hs-var hs-var">instTyVarsWith</span></a></span></span><span> </span><span id="local-6989586621682801878"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801878"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682801879"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801879"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682801880"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801880"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [DFunId] -&gt; [Type] -&gt; TcM Subst
</span><a href="#local-6989586621682801881"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801879"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801880"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621682801881"><span class="annot"><span class="annottext">go :: Subst -&gt; [DFunId] -&gt; [Type] -&gt; TcM Subst
</span><a href="#local-6989586621682801881"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682801883"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801883"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcM Subst
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801883"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="#local-6989586621682801881"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682801884"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801884"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801885"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801885"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682801886"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801886"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801887"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801887"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682801888"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801888"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801889"><span class="hs-identifier hs-var">tv_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801891"><span class="hs-identifier hs-var">ty_kind</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [DFunId] -&gt; [Type] -&gt; TcM Subst
</span><a href="#local-6989586621682801881"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801884"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801885"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801887"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801886"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801888"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801893"><span class="annot"><a href="#local-6989586621682801893"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TypeOrKind -&gt; Role -&gt; Type -&gt; Type -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEq"><span class="hs-identifier hs-var">emitWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801878"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="GHC.Types.Basic.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801891"><span class="hs-identifier hs-var">ty_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801889"><span class="hs-identifier hs-var">tv_kind</span></a></span><span>
</span><span id="line-285"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682801881"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier hs-type">extendTvSubstAndInScope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801884"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801885"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801887"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-type">`mkCastTy`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801893"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682801886"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801888"><span class="hs-identifier hs-type">tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>        </span><span id="local-6989586621682801889"><span class="annot"><span class="annottext">tv_kind :: Type
</span><a href="#local-6989586621682801889"><span class="hs-identifier hs-var hs-var">tv_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801884"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801885"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621682801891"><span class="annot"><span class="annottext">ty_kind :: Type
</span><a href="#local-6989586621682801891"><span class="hs-identifier hs-var hs-var">ty_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801887"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="#local-6989586621682801881"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM Subst
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instTysWith&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DFunId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801879"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801880"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
            Instantiating a call
*                                                                      *
************************************************************************

Note [Handling boxed equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The solver deals entirely in terms of unboxed (primitive) equality.
There should never be a boxed Wanted equality. Ever. But, what if
we are calling `foo :: forall a. (F a ~ Bool) =&gt; ...`? That equality
is boxed, so naive treatment here would emit a boxed Wanted equality.

So we simply check for this case and make the right boxing of evidence.

-}</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-312"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-type">instCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-313"></span><span class="hs-comment">-- Instantiate the constraints of a call</span><span>
</span><span id="line-314"></span><span class="hs-comment">--      (instCall o tys theta)</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- (a) Makes fresh dictionaries as necessary for the constraints (theta)</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- (b) Throws these dictionaries into the LIE</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- (c) Returns an HsWrapper ([.] tys dicts)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span id="instCall"><span class="annot"><span class="annottext">instCall :: CtOrigin -&gt; [Type] -&gt; [Type] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-var hs-var">instCall</span></a></span></span><span> </span><span id="local-6989586621682801902"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801902"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682801903"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801903"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682801904"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801904"><span class="hs-identifier hs-var">theta</span></a></span></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801905"><span class="annot"><a href="#local-6989586621682801905"><span class="hs-identifier hs-var">dict_app</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [Type] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801902"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801904"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801905"><span class="hs-identifier hs-type">dict_app</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-type">mkWpTyApps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801903"><span class="hs-identifier hs-type">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-324"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier hs-type">instCallConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- Instantiates the TcTheta, puts all constraints thereby generated</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- into the LIE, and returns a HsWrapper to enclose the call site.</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span id="instCallConstraints"><span class="annot"><span class="annottext">instCallConstraints :: CtOrigin -&gt; [Type] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier hs-var hs-var">instCallConstraints</span></a></span></span><span> </span><span id="local-6989586621682801907"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801907"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682801908"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801908"><span class="hs-identifier hs-var">preds</span></a></span></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801908"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; TcM HsWrapper
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801909"><span class="annot"><a href="#local-6989586621682801909"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) EvTerm)
-&gt; [Type] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [EvTerm]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) EvTerm
</span><a href="#local-6989586621682801911"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801908"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-333"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;instCallConstraints&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801909"><span class="hs-identifier hs-type">evs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpEvApps"><span class="hs-identifier hs-type">mkWpEvApps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801909"><span class="hs-identifier hs-type">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="#local-6989586621682801911"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span id="local-6989586621682801911"><span class="annot"><span class="annottext">go :: Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) EvTerm
</span><a href="#local-6989586621682801911"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682801914"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801914"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-338"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801915"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801915"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801916"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801916"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Role, Type, Type)
</span><a href="GHC.Core.Predicate.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801914"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-comment">-- Try short-cut #1</span><span>
</span><span id="line-339"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801918"><span class="annot"><a href="#local-6989586621682801918"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing -&gt; Type -&gt; Type -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801915"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801916"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-340"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-type">evCoercion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801918"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-comment">-- Try short-cut #2</span><span>
</span><span id="line-343"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801920"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682801920"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801921"><span class="annot"><span class="annottext">args :: [Type]
</span><a href="#local-6989586621682801921"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801922"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801922"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801923"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801923"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801914"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-344"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682801920"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a></span><span>
</span><span id="line-345"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801927"><span class="annot"><a href="#local-6989586621682801927"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing -&gt; Type -&gt; Type -&gt; TcM Coercion
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TypedThing
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801922"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801923"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-346"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#evDFunApp"><span class="hs-identifier hs-type">evDFunApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-type">dataConWrapId</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#heqDataCon"><span class="hs-identifier hs-type">heqDataCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682801921"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801927"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-349"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) EvTerm
</span><a href="GHC.Tc.Utils.TcMType.html#emitWanted"><span class="hs-identifier hs-var">emitWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801907"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801914"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier hs-type">instDFunType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#DFunId"><span class="hs-identifier hs-type">DFunId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-352"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- instantiated argument types</span><span>
</span><span id="line-353"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- instantiated constraint</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- See Note [DFunInstType: instantiating types] in GHC.Core.InstEnv</span><span>
</span><span id="line-355"></span><span id="instDFunType"><span class="annot"><span class="annottext">instDFunType :: DFunId -&gt; [DFunInstType] -&gt; TcM ([Type], [Type])
</span><a href="GHC.Tc.Utils.Instantiate.html#instDFunType"><span class="hs-identifier hs-var hs-var">instDFunType</span></a></span></span><span> </span><span id="local-6989586621682801932"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801932"><span class="hs-identifier hs-var">dfun_id</span></a></span></span><span> </span><span id="local-6989586621682801933"><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621682801933"><span class="hs-identifier hs-var">dfun_inst_tys</span></a></span></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801934"><span class="annot"><a href="#local-6989586621682801934"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801935"><span class="annot"><a href="#local-6989586621682801935"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [DFunId] -&gt; [DFunInstType] -&gt; TcM (Subst, [Type])
</span><a href="#local-6989586621682801936"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801937"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801938"><span class="hs-identifier hs-var">dfun_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621682801933"><span class="hs-identifier hs-var">dfun_inst_tys</span></a></span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801935"><span class="hs-identifier hs-type">inst_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-type">substTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801934"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801939"><span class="hs-identifier hs-type">dfun_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621682801940"><span class="annot"><span class="annottext">dfun_ty :: Type
</span><a href="#local-6989586621682801940"><span class="hs-identifier hs-var hs-var">dfun_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801932"><span class="hs-identifier hs-var">dfun_id</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682801938"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801938"><span class="hs-identifier hs-var">dfun_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801939"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801939"><span class="hs-identifier hs-var">dfun_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([DFunId], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801940"><span class="hs-identifier hs-var">dfun_ty</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621682801937"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621682801937"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801940"><span class="hs-identifier hs-var">dfun_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>                  </span><span class="hs-comment">-- With quantified constraints, the</span><span>
</span><span id="line-363"></span><span>                  </span><span class="hs-comment">-- type of a dfun may not be closed</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>    </span><span class="annot"><a href="#local-6989586621682801936"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#DFunInstType"><span class="hs-identifier hs-type">DFunInstType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621682801936"><span class="annot"><span class="annottext">go :: Subst -&gt; [DFunId] -&gt; [DFunInstType] -&gt; TcM (Subst, [Type])
</span><a href="#local-6989586621682801936"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682801942"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801942"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst, [Type]) -&gt; TcM (Subst, [Type])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801942"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><a href="#local-6989586621682801936"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682801943"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801943"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801944"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801944"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682801945"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801945"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682801946"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801946"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682801947"><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621682801947"><span class="hs-identifier hs-var">mb_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801948"><span class="annot"><a href="#local-6989586621682801948"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801949"><span class="annot"><a href="#local-6989586621682801949"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; [DFunId] -&gt; [DFunInstType] -&gt; TcM (Subst, [Type])
</span><a href="#local-6989586621682801936"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801943"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801944"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801946"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                                 </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801945"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-370"></span><span>                                 </span><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621682801947"><span class="hs-identifier hs-var">mb_tys</span></a></span><span>
</span><span id="line-371"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801948"><span class="hs-identifier hs-type">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682801946"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682801949"><span class="hs-identifier hs-type">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><a href="#local-6989586621682801936"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682801950"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801950"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801951"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801951"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682801952"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682801952"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunInstType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682801953"><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621682801953"><span class="hs-identifier hs-var">mb_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801954"><span class="annot"><a href="#local-6989586621682801954"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801955"><span class="annot"><a href="#local-6989586621682801955"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, DFunId)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801950"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801951"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-374"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801956"><span class="annot"><a href="#local-6989586621682801956"><span class="hs-identifier hs-var">subst''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801957"><span class="annot"><a href="#local-6989586621682801957"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682801936"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801954"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801952"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801953"><span class="hs-identifier hs-type">mb_tys</span></a></span><span>
</span><span id="line-375"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801956"><span class="hs-identifier hs-type">subst''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801955"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682801957"><span class="hs-identifier hs-type">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><a href="#local-6989586621682801936"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DFunInstType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (Subst, [Type])
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instDFunTypes&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682801932"><span class="hs-identifier hs-var">dfun_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunInstType]
</span><a href="#local-6989586621682801933"><span class="hs-identifier hs-var">dfun_inst_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-type">instStupidTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- Similar to instCall, but only emit the constraints in the LIE</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- Used exclusively for the 'stupid theta' of a data constructor</span><span>
</span><span id="line-382"></span><span id="instStupidTheta"><span class="annot"><span class="annottext">instStupidTheta :: CtOrigin -&gt; [Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-var hs-var">instStupidTheta</span></a></span></span><span> </span><span id="local-6989586621682801959"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801959"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682801960"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801960"><span class="hs-identifier hs-var">theta</span></a></span></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682801961"><span class="annot"><a href="#local-6989586621682801961"><span class="hs-identifier hs-var">_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [Type] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682801959"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682801960"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="hs-comment">-- Discard the coercion</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
         Instantiating Kinds
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">-- | Given ty::forall k1 k2. k, instantiate all the invisible forall-binders</span><span>
</span><span id="line-394"></span><span class="hs-comment">--   returning ty @kk1 @kk2 :: k[kk1/k1, kk2/k1]</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- Called only to instantiate kinds, in user-written type signatures</span><span>
</span><span id="line-396"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinders"><span class="hs-identifier hs-type">tcInstInvisibleTyBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span id="tcInstInvisibleTyBinders"><span class="annot"><span class="annottext">tcInstInvisibleTyBinders :: Type -&gt; Type -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinders"><span class="hs-identifier hs-var hs-var">tcInstInvisibleTyBinders</span></a></span></span><span> </span><span id="local-6989586621682801963"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801963"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682801964"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801964"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801965"><span class="annot"><a href="#local-6989586621682801965"><span class="hs-identifier hs-var">extra_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801966"><span class="annot"><a href="#local-6989586621682801966"><span class="hs-identifier hs-var">kind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Type -&gt; TcM ([Type], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier hs-var">tcInstInvisibleTyBindersN</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682801967"><span class="hs-identifier hs-var">n_invis</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801964"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-399"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-type">mkAppTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801963"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801965"><span class="hs-identifier hs-type">extra_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682801966"><span class="hs-identifier hs-type">kind'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621682801967"><span class="annot"><span class="annottext">n_invis :: Arity
</span><a href="#local-6989586621682801967"><span class="hs-identifier hs-var hs-var">n_invis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Arity
</span><a href="GHC.Core.Type.html#invisibleTyBndrCount"><span class="hs-identifier hs-var">invisibleTyBndrCount</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801964"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier hs-type">tcInstInvisibleTyBindersN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- Called only to instantiate kinds, in user-written type signatures</span><span>
</span><span id="line-405"></span><span id="tcInstInvisibleTyBindersN"><span class="annot"><span class="annottext">tcInstInvisibleTyBindersN :: Arity -&gt; Type -&gt; TcM ([Type], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier hs-var hs-var">tcInstInvisibleTyBindersN</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621682801970"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801970"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Type], Type) -&gt; TcM ([Type], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801970"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBindersN"><span class="hs-identifier hs-var">tcInstInvisibleTyBindersN</span></a></span><span> </span><span id="local-6989586621682801971"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682801971"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682801972"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801972"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Subst -&gt; Type -&gt; TcM ([Type], Type)
forall {t}.
(Ord t, Num t) =&gt;
t -&gt; Subst -&gt; Type -&gt; TcM ([Type], Type)
</span><a href="#local-6989586621682801973"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682801971"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801974"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801972"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621682801974"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621682801974"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801972"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621682801973"><span class="annot"><span class="annottext">go :: t -&gt; Subst -&gt; Type -&gt; TcM ([Type], Type)
</span><a href="#local-6989586621682801973"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682801989"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682801989"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682801990"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801990"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682801991"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801991"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682801989"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801993"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621682801993"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801994"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801994"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyVarBinder, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinder_maybe"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinder_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801991"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isInvisibleForAllTyFlag"><span class="hs-identifier hs-var">isInvisibleForAllTyFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBinder -&gt; ForAllTyFlag
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderFlag"><span class="hs-identifier hs-var">binderFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621682801993"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682801997"><span class="annot"><a href="#local-6989586621682801997"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682801998"><span class="annot"><a href="#local-6989586621682801998"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; TcM (Subst, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinder"><span class="hs-identifier hs-var">tcInstInvisibleTyBinder</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarBinder -&gt; DFunId
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621682801993"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802000"><span class="annot"><a href="#local-6989586621682802000"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802001"><span class="annot"><a href="#local-6989586621682802001"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682801973"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801989"><span class="hs-identifier hs-type">n</span></a></span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682801997"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801994"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-418"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682801998"><span class="hs-identifier hs-type">arg</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682802000"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802001"><span class="hs-identifier hs-type">inner_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Type], Type) -&gt; TcM ([Type], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682801990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682801991"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinder"><span class="hs-identifier hs-type">tcInstInvisibleTyBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- Called only to instantiate kinds, in user-written type signatures</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span id="tcInstInvisibleTyBinder"><span class="annot"><span class="annottext">tcInstInvisibleTyBinder :: Subst -&gt; DFunId -&gt; TcM (Subst, Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstInvisibleTyBinder"><span class="hs-identifier hs-var hs-var">tcInstInvisibleTyBinder</span></a></span></span><span> </span><span id="local-6989586621682802002"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802002"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682802003"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802003"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802004"><span class="annot"><a href="#local-6989586621682802004"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802005"><span class="annot"><a href="#local-6989586621682802005"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, DFunId)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802002"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802003"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802004"><span class="hs-identifier hs-type">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802005"><span class="hs-identifier hs-type">tv'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        SkolemTvs (immutable)
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstType"><span class="hs-identifier hs-type">tcInstType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ How to instantiate the type variables</span></span><span>
</span><span id="line-437"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>                                           </span><span class="annot"><span class="hs-comment">-- ^ Type to instantiate</span></span><span>
</span><span id="line-438"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Result</span><span>
</span><span id="line-439"></span><span>                </span><span class="hs-comment">-- (type vars, preds (incl equalities), rho)</span><span>
</span><span id="line-440"></span><span id="tcInstType"><span class="annot"><span class="annottext">tcInstType :: ([DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId]))
-&gt; DFunId -&gt; TcM ([(Name, DFunId)], [Type], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstType"><span class="hs-identifier hs-var hs-var">tcInstType</span></a></span></span><span> </span><span id="local-6989586621682802007"><span class="annot"><span class="annottext">[DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="#local-6989586621682802007"><span class="hs-identifier hs-var">inst_tyvars</span></a></span></span><span> </span><span id="local-6989586621682802008"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802008"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802009"><span class="hs-identifier hs-var">tyvars</span></a></span><span>   </span><span class="hs-comment">-- There may be overloading despite no type variables;</span><span>
</span><span id="line-442"></span><span>                  </span><span class="hs-comment">--      (?x :: Int) =&gt; Int -&gt; Int</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Name, DFunId)], [Type], Type)
-&gt; TcM ([(Name, DFunId)], [Type], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802010"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802011"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802012"><span class="annot"><a href="#local-6989586621682802012"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802013"><span class="annot"><a href="#local-6989586621682802013"><span class="hs-identifier hs-var">tyvars'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="#local-6989586621682802007"><span class="hs-identifier hs-var">inst_tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802009"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-446"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802014"><span class="annot"><a href="#local-6989586621682802014"><span class="hs-identifier hs-var hs-var">tv_prs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DFunId -&gt; Name) -&gt; [DFunId] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802009"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [DFunId] -&gt; [(Name, DFunId)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802013"><span class="hs-identifier hs-var">tyvars'</span></a></span><span>
</span><span id="line-447"></span><span>             </span><span id="local-6989586621682802015"><span class="annot"><a href="#local-6989586621682802015"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; VarSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScopeSet"><span class="hs-identifier hs-var">extendSubstInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802012"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802017"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802014"><span class="hs-identifier hs-type">tv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-type">substTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802015"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802010"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802015"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802011"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682802009"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802009"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802017"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802017"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([DFunId], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllInvisTyVars"><span class="hs-identifier hs-var">tcSplitForAllInvisTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802008"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682802010"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802010"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802011"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802011"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802017"><span class="hs-identifier hs-var">rho</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstTypeBndrs"><span class="hs-identifier hs-type">tcInstTypeBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>                     </span><span class="hs-comment">-- (type vars, preds (incl equalities), rho)</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- Instantiate the binders of a type signature with TyVarTvs</span><span>
</span><span id="line-456"></span><span id="tcInstTypeBndrs"><span class="annot"><span class="annottext">tcInstTypeBndrs :: Type -&gt; TcM ([(Name, TcInvisTVBinder)], [Type], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstTypeBndrs"><span class="hs-identifier hs-var hs-var">tcInstTypeBndrs</span></a></span></span><span> </span><span id="local-6989586621682802020"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802020"><span class="hs-identifier hs-var">poly_ty</span></a></span></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682802021"><span class="hs-identifier hs-var">tyvars</span></a></span><span>   </span><span class="hs-comment">-- There may be overloading despite no type variables;</span><span>
</span><span id="line-458"></span><span>                  </span><span class="hs-comment">--      (?x :: Int) =&gt; Int -&gt; Int</span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Name, TcInvisTVBinder)], [Type], Type)
-&gt; TcM ([(Name, TcInvisTVBinder)], [Type], Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802022"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802023"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802024"><span class="annot"><a href="#local-6989586621682802024"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802025"><span class="annot"><a href="#local-6989586621682802025"><span class="hs-identifier hs-var">tyvars'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Subst
 -&gt; TcInvisTVBinder
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcInvisTVBinder))
-&gt; Subst -&gt; [TcInvisTVBinder] -&gt; TcM (Subst, [TcInvisTVBinder])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
-&gt; TcInvisTVBinder
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcInvisTVBinder)
</span><a href="#local-6989586621682802026"><span class="hs-identifier hs-var">inst_invis_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682802021"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-462"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802027"><span class="annot"><a href="#local-6989586621682802027"><span class="hs-identifier hs-var hs-var">tv_prs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcInvisTVBinder -&gt; Name) -&gt; [TcInvisTVBinder] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">(DFunId -&gt; Name)
-&gt; (TcInvisTVBinder -&gt; DFunId) -&gt; TcInvisTVBinder -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcInvisTVBinder -&gt; DFunId
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682802021"><span class="hs-identifier hs-var">tyvars</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [TcInvisTVBinder] -&gt; [(Name, TcInvisTVBinder)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682802025"><span class="hs-identifier hs-var">tyvars'</span></a></span><span>
</span><span id="line-463"></span><span>             </span><span id="local-6989586621682802028"><span class="annot"><a href="#local-6989586621682802028"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; VarSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendSubstInScopeSet"><span class="hs-identifier hs-var">extendSubstInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802024"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802029"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802027"><span class="hs-identifier hs-type">tv_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-type">substTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802028"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802022"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802028"><span class="hs-identifier hs-type">subst'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802023"><span class="hs-identifier hs-type">tau</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682802021"><span class="annot"><span class="annottext">[TcInvisTVBinder]
</span><a href="#local-6989586621682802021"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802029"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802029"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcInvisTVBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllInvisTVBinders"><span class="hs-identifier hs-var">tcSplitForAllInvisTVBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802020"><span class="hs-identifier hs-var">poly_ty</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682802022"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802022"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802023"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802023"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802029"><span class="hs-identifier hs-var">rho</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><a href="#local-6989586621682802026"><span class="hs-identifier hs-type">inst_invis_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span>
</span><span id="line-470"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621682802026"><span class="annot"><span class="annottext">inst_invis_bndr :: Subst
-&gt; TcInvisTVBinder
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, TcInvisTVBinder)
</span><a href="#local-6989586621682802026"><span class="hs-identifier hs-var hs-var">inst_invis_bndr</span></a></span></span><span> </span><span id="local-6989586621682802031"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802031"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682802033"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802033"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682802034"><span class="annot"><span class="annottext">Specificity
</span><a href="#local-6989586621682802034"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802035"><span class="annot"><a href="#local-6989586621682802035"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802036"><span class="annot"><a href="#local-6989586621682802036"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, DFunId)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarTyVarX"><span class="hs-identifier hs-var">newMetaTyVarTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802031"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802033"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-473"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802035"><span class="hs-identifier hs-type">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802036"><span class="hs-identifier hs-type">tv'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802034"><span class="hs-identifier hs-type">spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSkolDFunType"><span class="hs-identifier hs-type">tcSkolDFunType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfoAnon"><span class="hs-identifier hs-type">SkolemInfoAnon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- Instantiate a type signature with skolem constants.</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- This freshens the names, but no need to do so</span><span>
</span><span id="line-479"></span><span id="tcSkolDFunType"><span class="annot"><span class="annottext">tcSkolDFunType :: Type -&gt; TcM (SkolemInfoAnon, [DFunId], [Type], Class, [Type])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcSkolDFunType"><span class="hs-identifier hs-var hs-var">tcSkolDFunType</span></a></span></span><span> </span><span id="local-6989586621682802038"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802038"><span class="hs-identifier hs-var">dfun_ty</span></a></span></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802039"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802039"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802040"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802040"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802041"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682802041"><span class="hs-identifier hs-var hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802042"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802042"><span class="hs-identifier hs-var hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([DFunId], [Type], Class, [Type])
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitDFunTy"><span class="hs-identifier hs-var">tcSplitDFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802038"><span class="hs-identifier hs-var">dfun_ty</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>         </span><span class="hs-comment">-- rec {..}: see Note [Keeping SkolemInfo inside a SkolemTv]</span><span>
</span><span id="line-483"></span><span>         </span><span class="hs-comment">--           in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-484"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">rec</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802044"><span class="annot"><a href="#local-6989586621682802044"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-type">mkSkolemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802046"><span class="hs-identifier hs-type">skol_info_anon</span></a></span><span>
</span><span id="line-485"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802047"><span class="annot"><a href="#local-6989586621682802047"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802048"><span class="annot"><a href="#local-6989586621682802048"><span class="hs-identifier hs-var">inst_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVars"><span class="hs-identifier hs-type">tcInstSuperSkolTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802044"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802039"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-486"></span><span>                     </span><span class="hs-comment">-- We instantiate the dfun_tyd with superSkolems.</span><span>
</span><span id="line-487"></span><span>                     </span><span class="hs-comment">-- See Note [Subtle interaction of recursion and overlap]</span><span>
</span><span id="line-488"></span><span>                     </span><span class="hs-comment">-- and Note [Binding when looking up instances]</span><span>
</span><span id="line-489"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802050"><span class="annot"><a href="#local-6989586621682802050"><span class="hs-identifier hs-var hs-var">inst_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802047"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802042"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-490"></span><span>                   </span><span id="local-6989586621682802046"><span class="annot"><a href="#local-6989586621682802046"><span class="hs-identifier hs-var hs-var">skol_info_anon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#mkClsInstSkol"><span class="hs-identifier hs-var">mkClsInstSkol</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682802041"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802050"><span class="hs-identifier hs-var">inst_tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802053"><span class="annot"><a href="#local-6989586621682802053"><span class="hs-identifier hs-var hs-var">inst_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802047"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802040"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-493"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802046"><span class="hs-identifier hs-type">skol_info_anon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802048"><span class="hs-identifier hs-type">inst_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802053"><span class="hs-identifier hs-type">inst_theta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802041"><span class="hs-identifier hs-type">cls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802050"><span class="hs-identifier hs-type">inst_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSuperSkolTyVars"><span class="hs-identifier hs-type">tcSuperSkolTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- Make skolem constants, but do *not* give them new names, as above</span><span>
</span><span id="line-497"></span><span class="hs-comment">-- As always, allocate them one level in</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- Moreover, make them &quot;super skolems&quot;; see GHC.Core.InstEnv</span><span>
</span><span id="line-499"></span><span class="hs-comment">--    Note [Binding when looking up instances]</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- See Note [Kind substitution when instantiating]</span><span>
</span><span id="line-501"></span><span class="hs-comment">-- Precondition: tyvars should be ordered by scoping</span><span>
</span><span id="line-502"></span><span id="tcSuperSkolTyVars"><span class="annot"><span class="annottext">tcSuperSkolTyVars :: TcLevel -&gt; SkolemInfo -&gt; [DFunId] -&gt; (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcSuperSkolTyVars"><span class="hs-identifier hs-var hs-var">tcSuperSkolTyVars</span></a></span></span><span> </span><span id="local-6989586621682802054"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682802054"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span id="local-6989586621682802055"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802055"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst -&gt; DFunId -&gt; (Subst, DFunId))
-&gt; Subst -&gt; [DFunId] -&gt; (Subst, [DFunId])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; (Subst, DFunId)
</span><a href="#local-6989586621682802056"><span class="hs-identifier hs-var">do_one</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-504"></span><span>    </span><span id="local-6989586621682802057"><span class="annot"><span class="annottext">details :: TcTyVarDetails
</span><a href="#local-6989586621682802057"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcLevel -&gt; Bool -&gt; TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802055"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682802054"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>                       </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- The &quot;super&quot; bit</span><span>
</span><span id="line-506"></span><span>    </span><span id="local-6989586621682802056"><span class="annot"><span class="annottext">do_one :: Subst -&gt; DFunId -&gt; (Subst, DFunId)
</span><a href="#local-6989586621682802056"><span class="hs-identifier hs-var hs-var">do_one</span></a></span></span><span> </span><span id="local-6989586621682802060"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802060"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682802061"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802061"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; DFunId -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802060"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802061"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802063"><span class="hs-identifier hs-var">new_tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802063"><span class="hs-identifier hs-var">new_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>        </span><span id="local-6989586621682802064"><span class="annot"><span class="annottext">kind :: Type
</span><a href="#local-6989586621682802064"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802060"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802061"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>        </span><span id="local-6989586621682802063"><span class="annot"><span class="annottext">new_tv :: DFunId
</span><a href="#local-6989586621682802063"><span class="hs-identifier hs-var hs-var">new_tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; DFunId
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802061"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802064"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621682802057"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">-- | Given a list of @['TyVar']@, skolemize the type variables,</span><span>
</span><span id="line-512"></span><span class="hs-comment">-- returning a substitution mapping the original tyvars to the</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- skolems, and the list of newly bound skolems.</span><span>
</span><span id="line-514"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVars"><span class="hs-identifier hs-type">tcInstSkolTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- See Note [Skolemising type variables]</span><span>
</span><span id="line-516"></span><span id="tcInstSkolTyVars"><span class="annot"><span class="annottext">tcInstSkolTyVars :: SkolemInfo
-&gt; [DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVars"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVars</span></a></span></span><span> </span><span id="local-6989586621682802067"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802067"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802067"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSkolTyVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- See Note [Skolemising type variables]</span><span>
</span><span id="line-520"></span><span id="tcInstSkolTyVarsX"><span class="annot"><span class="annottext">tcInstSkolTyVarsX :: SkolemInfo
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVarsX</span></a></span></span><span> </span><span id="local-6989586621682802068"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802068"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; Bool
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsPushLevel"><span class="hs-identifier hs-var">tcInstSkolTyVarsPushLevel</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802068"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span id="local-6989586621682801248"><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarBndrsX"><span class="hs-identifier hs-type">tcInstSkolTyVarBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801248"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801248"><span class="hs-identifier hs-type">vis</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-523"></span><span id="tcInstSkolTyVarBndrsX"><span class="annot"><span class="annottext">tcInstSkolTyVarBndrsX :: forall vis.
SkolemInfo
-&gt; Subst
-&gt; [VarBndr DFunId vis]
-&gt; TcM (Subst, [VarBndr DFunId vis])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarBndrsX"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVarBndrsX</span></a></span></span><span> </span><span id="local-6989586621682802073"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802073"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682802074"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802074"><span class="hs-identifier hs-var">subs</span></a></span></span><span> </span><span id="local-6989586621682802075"><span class="annot"><span class="annottext">[VarBndr DFunId vis]
</span><a href="#local-6989586621682802075"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682802076"><span class="annot"><a href="#local-6989586621682802076"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802077"><span class="annot"><a href="#local-6989586621682802077"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802073"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802074"><span class="hs-identifier hs-var">subs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VarBndr DFunId vis] -&gt; [DFunId]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr DFunId vis]
</span><a href="#local-6989586621682802075"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802076"><span class="hs-identifier hs-type">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#mkForAllTyBinder"><span class="hs-identifier hs-type">mkForAllTyBinder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802080"><span class="hs-identifier hs-type">flags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802077"><span class="hs-identifier hs-type">bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-527"></span><span>    </span><span id="local-6989586621682802080"><span class="annot"><span class="annottext">flags :: [vis]
</span><a href="#local-6989586621682802080"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr DFunId vis] -&gt; [vis]
forall tv argf. [VarBndr tv argf] -&gt; [argf]
</span><a href="GHC.Types.Var.html#binderFlags"><span class="hs-identifier hs-var">binderFlags</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr DFunId vis]
</span><a href="#local-6989586621682802075"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVars"><span class="hs-identifier hs-type">tcInstSuperSkolTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span class="hs-comment">-- See Note [Skolemising type variables]</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- This version freshens the names and creates &quot;super skolems&quot;;</span><span>
</span><span id="line-532"></span><span class="hs-comment">--    see comments around superSkolemTv.</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- Must be lazy in skol_info:</span><span>
</span><span id="line-534"></span><span class="hs-comment">--   see Note [Keeping SkolemInfo inside a SkolemTv] in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-535"></span><span id="tcInstSuperSkolTyVars"><span class="annot"><span class="annottext">tcInstSuperSkolTyVars :: SkolemInfo
-&gt; [DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVars"><span class="hs-identifier hs-var hs-var">tcInstSuperSkolTyVars</span></a></span></span><span> </span><span id="local-6989586621682802082"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802082"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSuperSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802082"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSuperSkolTyVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span class="hs-comment">-- See Note [Skolemising type variables]</span><span>
</span><span id="line-539"></span><span class="hs-comment">-- This version freshens the names and creates &quot;super skolems&quot;;</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- see comments around superSkolemTv.</span><span>
</span><span id="line-541"></span><span id="tcInstSuperSkolTyVarsX"><span class="annot"><span class="annottext">tcInstSuperSkolTyVarsX :: SkolemInfo
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-var hs-var">tcInstSuperSkolTyVarsX</span></a></span></span><span> </span><span id="local-6989586621682802083"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802083"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682802084"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802084"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; Bool
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsPushLevel"><span class="hs-identifier hs-var">tcInstSkolTyVarsPushLevel</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802083"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802084"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsPushLevel"><span class="hs-identifier hs-type">tcInstSkolTyVarsPushLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- True &lt;=&gt; make &quot;super skolem&quot;</span><span>
</span><span id="line-544"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- Skolemise one level deeper, hence pushTcLevel</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- See Note [Skolemising type variables]</span><span>
</span><span id="line-548"></span><span id="tcInstSkolTyVarsPushLevel"><span class="annot"><span class="annottext">tcInstSkolTyVarsPushLevel :: SkolemInfo
-&gt; Bool
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsPushLevel"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVarsPushLevel</span></a></span></span><span> </span><span id="local-6989586621682802085"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802085"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682802086"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802086"><span class="hs-identifier hs-var">overlappable</span></a></span></span><span> </span><span id="local-6989586621682802087"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802087"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682802088"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802088"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802089"><span class="annot"><a href="#local-6989586621682802089"><span class="hs-identifier hs-var">tc_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-550"></span><span>       </span><span class="hs-comment">-- Do not retain the whole TcLclEnv</span><span>
</span><span id="line-551"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682802091"><span class="annot"><a href="#local-6989586621682802091"><span class="hs-identifier hs-var hs-var">pushed_lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682802089"><span class="hs-identifier hs-var">tc_lvl</span></a></span><span>
</span><span id="line-552"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsAt"><span class="hs-identifier hs-type">tcInstSkolTyVarsAt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802085"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802091"><span class="hs-identifier hs-type">pushed_lvl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802086"><span class="hs-identifier hs-type">overlappable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802087"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802088"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsAt"><span class="hs-identifier hs-type">tcInstSkolTyVarsAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-555"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-556"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span id="tcInstSkolTyVarsAt"><span class="annot"><span class="annottext">tcInstSkolTyVarsAt :: SkolemInfo
-&gt; TcLevel
-&gt; Bool
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSkolTyVarsAt"><span class="hs-identifier hs-var hs-var">tcInstSkolTyVarsAt</span></a></span></span><span> </span><span id="local-6989586621682802093"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802093"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682802094"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682802094"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span id="local-6989586621682802095"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802095"><span class="hs-identifier hs-var">overlappable</span></a></span></span><span> </span><span id="local-6989586621682802096"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802096"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682802097"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802097"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-558"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type -&gt; DFunId)
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVarsX"><span class="hs-identifier hs-var">freshenTyCoVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; DFunId
</span><a href="#local-6989586621682802099"><span class="hs-identifier hs-var">new_skol_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802096"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802097"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-560"></span><span>    </span><span id="local-6989586621682802100"><span class="annot"><span class="annottext">sk_details :: TcTyVarDetails
</span><a href="#local-6989586621682802100"><span class="hs-identifier hs-var hs-var">sk_details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcLevel -&gt; Bool -&gt; TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802093"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682802094"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802095"><span class="hs-identifier hs-var">overlappable</span></a></span><span>
</span><span id="line-561"></span><span>    </span><span id="local-6989586621682802099"><span class="annot"><span class="annottext">new_skol_tv :: Name -&gt; Type -&gt; DFunId
</span><a href="#local-6989586621682802099"><span class="hs-identifier hs-var hs-var">new_skol_tv</span></a></span></span><span> </span><span id="local-6989586621682802101"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802101"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682802102"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802102"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; DFunId
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802101"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802102"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621682802100"><span class="hs-identifier hs-var">sk_details</span></a></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSkolemiseInvisibleBndrs"><span class="hs-identifier hs-type">tcSkolemiseInvisibleBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfoAnon"><span class="hs-identifier hs-type">SkolemInfoAnon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span class="hs-comment">-- Skolemise the outer invisible binders of a type</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- Do /not/ freshen them, because their scope is broader than</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- just this type.  It's a bit dubious, but used in very limited ways.</span><span>
</span><span id="line-567"></span><span id="tcSkolemiseInvisibleBndrs"><span class="annot"><span class="annottext">tcSkolemiseInvisibleBndrs :: SkolemInfoAnon -&gt; Type -&gt; TcM ([DFunId], Type)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcSkolemiseInvisibleBndrs"><span class="hs-identifier hs-var hs-var">tcSkolemiseInvisibleBndrs</span></a></span></span><span> </span><span id="local-6989586621682802103"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682802103"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682802104"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802104"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802105"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802105"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802106"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802106"><span class="hs-identifier hs-var hs-var">body_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([DFunId], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllInvisTyVars"><span class="hs-identifier hs-var">tcSplitForAllInvisTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802104"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-569"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802107"><span class="annot"><a href="#local-6989586621682802107"><span class="hs-identifier hs-var">lvl</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-570"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802108"><span class="annot"><a href="#local-6989586621682802108"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-type">mkSkolemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802103"><span class="hs-identifier hs-type">skol_info</span></a></span><span>
</span><span id="line-571"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802109"><span class="annot"><a href="#local-6989586621682802109"><span class="hs-identifier hs-var hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; TcLevel -&gt; Bool -&gt; TcTyVarDetails
</span><a href="GHC.Tc.Utils.TcType.html#SkolemTv"><span class="hs-identifier hs-var">SkolemTv</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682802108"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682802107"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-572"></span><span>             </span><span id="local-6989586621682802110"><span class="annot"><a href="#local-6989586621682802110"><span class="hs-identifier hs-var hs-var">mk_skol_tv</span></a></span></span><span> </span><span id="local-6989586621682802111"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802111"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682802112"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802112"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFunId -&gt; TcM DFunId
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcTyVarDetails -&gt; DFunId
</span><a href="GHC.Types.Var.html#mkTcTyVar"><span class="hs-identifier hs-var">mkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802111"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802112"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><a href="#local-6989586621682802109"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- No freshening</span><span>
</span><span id="line-573"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802113"><span class="annot"><a href="#local-6989586621682802113"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802114"><span class="annot"><a href="#local-6989586621682802114"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instantiateTyVarsX"><span class="hs-identifier hs-type">instantiateTyVarsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802110"><span class="hs-identifier hs-type">mk_skol_tv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-type">emptySubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802105"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-574"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802114"><span class="hs-identifier hs-type">tvs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-type">substTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802113"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802106"><span class="hs-identifier hs-type">body_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instantiateTyVarsX"><span class="hs-identifier hs-type">instantiateTyVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-578"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- Instantiate each type variable in turn with the specified function</span><span>
</span><span id="line-580"></span><span id="instantiateTyVarsX"><span class="annot"><span class="annottext">instantiateTyVarsX :: (Name -&gt; Type -&gt; TcM DFunId)
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#instantiateTyVarsX"><span class="hs-identifier hs-var hs-var">instantiateTyVarsX</span></a></span></span><span> </span><span id="local-6989586621682802117"><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcM DFunId
</span><a href="#local-6989586621682802117"><span class="hs-identifier hs-var">mk_tv</span></a></span></span><span> </span><span id="local-6989586621682802118"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802118"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682802119"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802119"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802119"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Subst, [DFunId])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802118"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682802120"><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802120"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682802121"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802121"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802122"><span class="annot"><span class="annottext">kind1 :: Type
</span><a href="#local-6989586621682802122"><span class="hs-identifier hs-var hs-var hs-var">kind1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802118"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802120"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>                     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802123"><span class="annot"><a href="#local-6989586621682802123"><span class="hs-identifier hs-var">tv'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcM DFunId
</span><a href="#local-6989586621682802117"><span class="hs-identifier hs-var">mk_tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802120"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802122"><span class="hs-identifier hs-var">kind1</span></a></span><span>
</span><span id="line-585"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802124"><span class="annot"><a href="#local-6989586621682802124"><span class="hs-identifier hs-var hs-var">subst1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; DFunId -&gt; DFunId -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubstWithClone"><span class="hs-identifier hs-var">extendTCvSubstWithClone</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802118"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802120"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802123"><span class="hs-identifier hs-var">tv'</span></a></span><span>
</span><span id="line-586"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802126"><span class="annot"><a href="#local-6989586621682802126"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802127"><span class="annot"><a href="#local-6989586621682802127"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instantiateTyVarsX"><span class="hs-identifier hs-type">instantiateTyVarsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802117"><span class="hs-identifier hs-type">mk_tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802124"><span class="hs-identifier hs-type">subst1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802121"><span class="hs-identifier hs-type">tvs</span></a></span><span>
</span><span id="line-587"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802126"><span class="hs-identifier hs-type">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802123"><span class="hs-identifier hs-type">tv'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682802127"><span class="hs-identifier hs-type">tvs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-590"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier hs-type">freshenTyVarBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span class="hs-comment">-- ^ Give fresh uniques to a bunch of TyVars, but they stay</span><span>
</span><span id="line-592"></span><span class="hs-comment">--   as TyVars, rather than becoming TcTyVars</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- Used in 'GHC.Tc.Instance.Family.newFamInst', and 'GHC.Tc.Utils.Instantiate.newClsInst'</span><span>
</span><span id="line-594"></span><span id="freshenTyVarBndrs"><span class="annot"><span class="annottext">freshenTyVarBndrs :: [DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier hs-var hs-var">freshenTyVarBndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type -&gt; DFunId)
-&gt; [DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVars"><span class="hs-identifier hs-var">freshenTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; DFunId
</span><a href="GHC.Types.Var.html#mkTyVar"><span class="hs-identifier hs-var">mkTyVar</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenCoVarBndrsX"><span class="hs-identifier hs-type">freshenCoVarBndrsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span class="hs-comment">-- ^ Give fresh uniques to a bunch of CoVars</span><span>
</span><span id="line-598"></span><span class="hs-comment">-- Used in &quot;GHC.Tc.Instance.Family.newFamInst&quot;</span><span>
</span><span id="line-599"></span><span id="freshenCoVarBndrsX"><span class="annot"><span class="annottext">freshenCoVarBndrsX :: Subst
-&gt; [DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenCoVarBndrsX"><span class="hs-identifier hs-var hs-var">freshenCoVarBndrsX</span></a></span></span><span> </span><span id="local-6989586621682802131"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802131"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type -&gt; DFunId)
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVarsX"><span class="hs-identifier hs-var">freshenTyCoVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; DFunId
</span><a href="GHC.Types.Var.html#mkCoVar"><span class="hs-identifier hs-var">mkCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802131"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-602"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVars"><span class="hs-identifier hs-type">freshenTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span id="freshenTyCoVars"><span class="annot"><span class="annottext">freshenTyCoVars :: (Name -&gt; Type -&gt; DFunId)
-&gt; [DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVars"><span class="hs-identifier hs-var hs-var">freshenTyCoVars</span></a></span></span><span> </span><span id="local-6989586621682802133"><span class="annot"><span class="annottext">Name -&gt; Type -&gt; DFunId
</span><a href="#local-6989586621682802133"><span class="hs-identifier hs-var">mk_tcv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type -&gt; DFunId)
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVarsX"><span class="hs-identifier hs-var">freshenTyCoVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; DFunId
</span><a href="#local-6989586621682802133"><span class="hs-identifier hs-var">mk_tcv</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="GHC.Core.TyCo.Subst.html#emptySubst"><span class="hs-identifier hs-var">emptySubst</span></a></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVarsX"><span class="hs-identifier hs-type">freshenTyCoVarsX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-608"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- This a complete freshening operation:</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- the skolems have a fresh unique, and a location from the monad</span><span>
</span><span id="line-611"></span><span class="hs-comment">-- See Note [Skolemising type variables]</span><span>
</span><span id="line-612"></span><span id="freshenTyCoVarsX"><span class="annot"><span class="annottext">freshenTyCoVarsX :: (Name -&gt; Type -&gt; DFunId)
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyCoVarsX"><span class="hs-identifier hs-var hs-var">freshenTyCoVarsX</span></a></span></span><span> </span><span id="local-6989586621682802134"><span class="annot"><span class="annottext">Name -&gt; Type -&gt; DFunId
</span><a href="#local-6989586621682802134"><span class="hs-identifier hs-var">mk_tcv</span></a></span></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type -&gt; TcM DFunId)
-&gt; Subst
-&gt; [DFunId]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#instantiateTyVarsX"><span class="hs-identifier hs-var">instantiateTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; TcM DFunId
</span><a href="#local-6989586621682802135"><span class="hs-identifier hs-var">freshen_tcv</span></a></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><a href="#local-6989586621682802135"><span class="hs-identifier hs-type">freshen_tcv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621682802135"><span class="annot"><span class="annottext">freshen_tcv :: Name -&gt; Type -&gt; TcM DFunId
</span><a href="#local-6989586621682802135"><span class="hs-identifier hs-var hs-var">freshen_tcv</span></a></span></span><span> </span><span id="local-6989586621682802136"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802136"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682802137"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802137"><span class="hs-identifier hs-var">kind</span></a></span></span><span>
</span><span id="line-617"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802138"><span class="annot"><a href="#local-6989586621682802138"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-618"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802140"><span class="annot"><a href="#local-6989586621682802140"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span>
</span><span id="line-619"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682802142"><span class="annot"><a href="#local-6989586621682802142"><span class="hs-identifier hs-var hs-var">occ_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802136"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-620"></span><span>                    </span><span class="hs-comment">-- Force so we don't retain reference to the old</span><span>
</span><span id="line-621"></span><span>                    </span><span class="hs-comment">-- name and id.   See (#19619) for more discussion</span><span>
</span><span id="line-622"></span><span>                 </span><span id="local-6989586621682802144"><span class="annot"><a href="#local-6989586621682802144"><span class="hs-identifier hs-var hs-var">new_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682802140"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621682802142"><span class="hs-identifier hs-var">occ_name</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682802138"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-623"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802134"><span class="hs-identifier hs-type">mk_tcv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802144"><span class="hs-identifier hs-type">new_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802137"><span class="hs-identifier hs-type">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="hs-comment">{- Note [Skolemising type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The tcInstSkolTyVars family of functions instantiate a list of TyVars
to fresh skolem TcTyVars. Important notes:

a) Level allocation. We generally skolemise /before/ calling
   pushLevelAndCaptureConstraints.  So we want their level to the level
   of the soon-to-be-created implication, which has a level ONE HIGHER
   than the current level.  Hence the pushTcLevel.  It feels like a
   slight hack.

b) The [TyVar] should be ordered (kind vars first)
   See Note [Kind substitution when instantiating]

c) Clone the variable to give a fresh unique.  This is essential.
   Consider (tc160)
       type Foo x = forall a. a -&gt; x
   And typecheck the expression
       (e :: Foo (Foo ())
   We will skolemise the signature, but after expanding synonyms it
   looks like
        forall a. a -&gt; forall a. a -&gt; x
   We don't want to make two big-lambdas with the same unique!

d) We retain locations. Because the location of the variable is the correct
   location to report in errors (e.g. in the signature). We don't want the
   location to change to the body of the function, which does *not* explicitly
   bind the variable.

e) The resulting skolems are
        non-overlappable for tcInstSkolTyVars,
   but overlappable for tcInstSuperSkolTyVars
   See GHC.Tc.Deriv.Infer Note [Overlap and deriving] for an example
   of where this matters.

Note [Kind substitution when instantiating]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we instantiate a bunch of kind and type variables, first we
expect them to be topologically sorted.
Then we have to instantiate the kind variables, build a substitution
from old variables to the new variables, then instantiate the type
variables substituting the original kind.

Example: If we want to instantiate
  [(k1 :: *), (k2 :: *), (a :: k1 -&gt; k2), (b :: k1)]
we want
  [(?k1 :: *), (?k2 :: *), (?a :: ?k1 -&gt; ?k2), (?b :: ?k1)]
instead of the bogus
  [(?k1 :: *), (?k2 :: *), (?a :: k1 -&gt; k2), (?b :: k1)]
-}</span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Literals
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-comment">{-
In newOverloadedLit we convert directly to an Int or Integer if we
know that's what we want.  This may save some time, by not
temporarily generating overloaded literals, but it won't catch all
cases (the rest are caught in lookupInst).

-}</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-type">newOverloadedLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-691"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-692"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span id="newOverloadedLit"><span class="annot"><span class="annottext">newOverloadedLit :: HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var hs-var">newOverloadedLit</span></a></span></span><span> </span><span id="local-6989586621682802146"><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621682802146"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span id="local-6989586621682802147"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682802147"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802148"><span class="annot"><a href="#local-6989586621682802148"><span class="hs-identifier hs-var">mb_lit'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (Maybe (HsOverLit GhcTc))
</span><a href="GHC.Tc.Utils.TcMType.html#tcShortCutLit"><span class="hs-identifier hs-var">tcShortCutLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621682802146"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682802147"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-695"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682802148"><span class="hs-identifier hs-type">mb_lit'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-696"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682802150"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621682802150"><span class="hs-identifier hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc -&gt; TcM (HsOverLit GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621682802150"><span class="hs-identifier hs-var">lit'</span></a></span><span>
</span><span id="line-697"></span><span>            </span><span class="annot"><span class="annottext">Maybe (HsOverLit GhcTc)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newNonTrivialOverloadedLit"><span class="hs-identifier hs-var">newNonTrivialOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621682802146"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682802147"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-comment">-- Does not handle things that 'shortCutLit' can handle. See also</span><span>
</span><span id="line-700"></span><span class="hs-comment">-- newOverloadedLit in GHC.Tc.Utils.Unify</span><span>
</span><span id="line-701"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newNonTrivialOverloadedLit"><span class="hs-identifier hs-type">newNonTrivialOverloadedLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-702"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-703"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span id="newNonTrivialOverloadedLit"><span class="annot"><span class="annottext">newNonTrivialOverloadedLit :: HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newNonTrivialOverloadedLit"><span class="hs-identifier hs-var hs-var">newNonTrivialOverloadedLit</span></a></span></span><span>
</span><span id="line-705"></span><span>  </span><span id="local-6989586621682802152"><span class="annot"><span class="annottext">lit :: HsOverLit GhcRn
</span><a href="#local-6989586621682802152"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLit"><span class="hs-identifier hs-type">OverLit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ol_val :: forall p. HsOverLit p -&gt; OverLitVal
</span><a href="Language.Haskell.Syntax.Lit.html#ol_val"><span class="hs-identifier hs-var">ol_val</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682802155"><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621682802155"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ol_ext :: forall p. HsOverLit p -&gt; XOverLit p
</span><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitRn"><span class="hs-identifier hs-type">OverLitRn</span></a></span><span> </span><span id="local-6989586621682802158"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802158"><span class="hs-identifier hs-var">rebindable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682802160"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682802160"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682802161"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802161"><span class="hs-identifier hs-var">meth_name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>  </span><span id="local-6989586621682802162"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682802162"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802163"><span class="annot"><a href="#local-6989586621682802163"><span class="hs-identifier hs-var">hs_lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OverLitVal -&gt; TcM (HsLit GhcTc)
forall (p :: Pass). OverLitVal -&gt; TcM (HsLit (GhcPass p))
</span><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier hs-var">mkOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">OverLitVal
</span><a href="#local-6989586621682802155"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-708"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802164"><span class="annot"><a href="#local-6989586621682802164"><span class="hs-identifier hs-var hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLit GhcTc -&gt; Type
forall (p :: Pass). HsLit (GhcPass p) -&gt; Type
</span><a href="GHC.Hs.Syn.Type.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcTc
</span><a href="#local-6989586621682802163"><span class="hs-identifier hs-var">hs_lit</span></a></span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802165"><span class="annot"><a href="#local-6989586621682802165"><span class="hs-identifier hs-var">fi'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802166"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#mkRnSyntaxExpr"><span class="hs-identifier hs-type">mkRnSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802161"><span class="hs-identifier hs-type">meth_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>                                      </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802164"><span class="hs-identifier hs-type">lit_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682802162"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-711"></span><span>                      </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682802169"><span class="annot"><a href="#local-6989586621682802169"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsSyntaxApps"><span class="hs-identifier hs-type">mkHsSyntaxApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#l2l"><span class="hs-identifier hs-type">l2l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802160"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682802165"><span class="hs-identifier hs-type">fi'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Utils.html#nlHsLit"><span class="hs-identifier hs-type">nlHsLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802163"><span class="hs-identifier hs-type">hs_lit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-713"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802173"><span class="annot"><a href="#local-6989586621682802173"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802162"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-714"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802152"><span class="hs-identifier hs-type">lit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#ol_ext"><span class="hs-identifier hs-var">ol_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#OverLitTc"><span class="hs-identifier hs-type">OverLitTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#ol_rebindable"><span class="hs-identifier hs-var">ol_rebindable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682802158"><span class="hs-identifier hs-type">rebindable</span></a></span><span>
</span><span id="line-715"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#ol_witness"><span class="hs-identifier hs-var">ol_witness</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682802169"><span class="hs-identifier hs-type">witness</span></a></span><span>
</span><span id="line-716"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Lit.html#ol_type"><span class="hs-identifier hs-var">ol_type</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682802173"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621682802166"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621682802166"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621682802152"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">------------</span><span>
</span><span id="line-721"></span><span id="local-6989586621682801330"><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier hs-type">mkOverLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#OverLitVal"><span class="hs-identifier hs-type">OverLitVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801330"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-722"></span><span id="mkOverLit"><span class="annot"><span class="annottext">mkOverLit :: forall (p :: Pass). OverLitVal -&gt; TcM (HsLit (GhcPass p))
</span><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier hs-var hs-var">mkOverLit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIntegral"><span class="hs-identifier hs-type">HsIntegral</span></a></span><span> </span><span id="local-6989586621682802186"><span class="annot"><span class="annottext">IntegralLit
</span><a href="#local-6989586621682802186"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802187"><span class="annot"><a href="#local-6989586621682802187"><span class="hs-identifier hs-var">integer_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Types.html#integerTyConName"><span class="hs-identifier hs-var">integerTyConName</span></a></span><span>
</span><span id="line-724"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsInteger"><span class="hs-identifier hs-type">HsInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SourceText.html#il_text"><span class="hs-identifier hs-var">il_text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802186"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SourceText.html#il_value"><span class="hs-identifier hs-var">il_value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802186"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682802187"><span class="hs-identifier hs-type">integer_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier hs-var">mkOverLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsFractional"><span class="hs-identifier hs-type">HsFractional</span></a></span><span> </span><span id="local-6989586621682802193"><span class="annot"><span class="annottext">FractionalLit
</span><a href="#local-6989586621682802193"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802194"><span class="annot"><a href="#local-6989586621682802194"><span class="hs-identifier hs-var">rat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#rationalTyConName"><span class="hs-identifier hs-var">rationalTyConName</span></a></span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsRat"><span class="hs-identifier hs-type">HsRat</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802193"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802194"><span class="hs-identifier hs-type">rat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#mkOverLit"><span class="hs-identifier hs-var">mkOverLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Lit.html#HsIsString"><span class="hs-identifier hs-type">HsIsString</span></a></span><span> </span><span id="local-6989586621682802198"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621682802198"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621682802199"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682802199"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLit (GhcPass p)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsLit (GhcPass p))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsString (GhcPass p) -&gt; FastString -&gt; HsLit (GhcPass p)
forall x. XHsString x -&gt; FastString -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsString"><span class="hs-identifier hs-var">HsString</span></a></span><span> </span><span class="annot"><span class="annottext">XHsString (GhcPass p)
SourceText
</span><a href="#local-6989586621682802198"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682802199"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Re-mappable syntax

     Used only for arrow syntax -- find a way to nuke this
*                                                                      *
************************************************************************

Suppose we are doing the -XRebindableSyntax thing, and we encounter
a do-expression.  We have to find (&gt;&gt;) in the current environment, which is
done by the rename. Then we have to check that it has the same type as
Control.Monad.(&gt;&gt;).  Or, more precisely, a compatible type. One 'customer' had
this:

  (&gt;&gt;) :: HB m n mn =&gt; m a -&gt; n b -&gt; mn b

So the idea is to generate a local binding for (&gt;&gt;), thus:

        let then72 :: forall a b. m a -&gt; m b -&gt; m b
            then72 = ...something involving the user's (&gt;&gt;)...
        in
        ...the do-expression...

Now the do-expression can proceed using then72, which has exactly
the expected type.

In fact tcSyntaxName just generates the RHS for then72, because we only
want an actual binding in the do-expression case. For literals, we can
just use the expression inline.
-}</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSyntaxName"><span class="hs-identifier hs-type">tcSyntaxName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-766"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                  </span><span class="annot"><span class="hs-comment">-- ^ Type to instantiate it at</span></span><span>
</span><span id="line-767"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ (Standard name, user name)</span></span><span>
</span><span id="line-768"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>                                        </span><span class="hs-comment">-- ^ (Standard name, suitable expression)</span><span>
</span><span id="line-770"></span><span class="hs-comment">-- USED ONLY FOR CmdTop (sigh) ***</span><span>
</span><span id="line-771"></span><span class="hs-comment">-- See Note [CmdSyntaxTable] in &quot;GHC.Hs.Expr&quot;</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span id="tcSyntaxName"><span class="annot"><span class="annottext">tcSyntaxName :: CtOrigin
-&gt; Type -&gt; (Name, HsExpr GhcRn) -&gt; TcM (Name, HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#tcSyntaxName"><span class="hs-identifier hs-var hs-var">tcSyntaxName</span></a></span></span><span> </span><span id="local-6989586621682802201"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682802201"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682802202"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802202"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802203"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802203"><span class="hs-identifier hs-var">std_nm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682802204"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802204"><span class="hs-identifier hs-var">user_nm</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802203"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802204"><span class="hs-identifier hs-var">user_nm</span></a></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682802205"><span class="annot"><a href="#local-6989586621682802205"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [Type] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682802201"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802203"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802202"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-776"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802203"><span class="hs-identifier hs-type">std_nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802205"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcSyntaxName"><span class="hs-identifier hs-var">tcSyntaxName</span></a></span><span> </span><span id="local-6989586621682802206"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682802206"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682802207"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802207"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802208"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802208"><span class="hs-identifier hs-var">std_nm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802209"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682802209"><span class="hs-identifier hs-var">user_nm_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-779"></span><span>    </span><span id="local-6989586621682802210"><span class="annot"><a href="#local-6989586621682802210"><span class="hs-identifier hs-var">std_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM DFunId
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802208"><span class="hs-identifier hs-var">std_nm</span></a></span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-781"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621682802211"><span class="annot"><a href="#local-6989586621682802211"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802212"><span class="annot"><a href="#local-6989586621682802212"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-type">tcSplitSigmaTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802210"><span class="hs-identifier hs-type">std_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>        </span><span id="local-6989586621682802213"><span class="annot"><a href="#local-6989586621682802213"><span class="hs-identifier hs-var hs-var">sigma1</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; [Type] -&gt; Type -&gt; Type
HasDebugCallStack =&gt; [DFunId] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802211"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802207"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802212"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-783"></span><span>        </span><span class="hs-comment">-- Actually, the &quot;tau-type&quot; might be a sigma-type in the</span><span>
</span><span id="line-784"></span><span>        </span><span class="hs-comment">-- case of locally-polymorphic methods.</span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>    </span><span id="local-6989586621682802215"><span class="annot"><a href="#local-6989586621682802215"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-type">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#syntaxNameCtxt"><span class="hs-identifier hs-type">syntaxNameCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802209"><span class="hs-identifier hs-type">user_nm_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802206"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802213"><span class="hs-identifier hs-type">sigma1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802215"><span class="hs-identifier hs-type">span</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-comment">-- Check that the user-supplied thing has the</span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-comment">-- same type as the standard one.</span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-comment">-- Tiresome jiggling because tcCheckSigma takes a located expression</span><span>
</span><span id="line-792"></span><span>     </span><span id="local-6989586621682802218"><span class="annot"><a href="#local-6989586621682802218"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-type">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802215"><span class="hs-identifier hs-type">span</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682802209"><span class="hs-identifier hs-type">user_nm_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682802213"><span class="hs-identifier hs-type">sigma1</span></a></span><span>
</span><span id="line-793"></span><span>     </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#hasFixedRuntimeRepRes"><span class="hs-identifier hs-type">hasFixedRuntimeRepRes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802208"><span class="hs-identifier hs-type">std_nm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802209"><span class="hs-identifier hs-type">user_nm_expr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802213"><span class="hs-identifier hs-type">sigma1</span></a></span><span>
</span><span id="line-794"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802208"><span class="hs-identifier hs-type">std_nm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802218"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#syntaxNameCtxt"><span class="hs-identifier hs-type">syntaxNameCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span>
</span><span id="line-797"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.Monad.html#ZonkM"><span class="hs-identifier hs-type">ZonkM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span id="syntaxNameCtxt"><span class="annot"><span class="annottext">syntaxNameCtxt :: HsExpr GhcRn
-&gt; CtOrigin -&gt; Type -&gt; SrcSpan -&gt; TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="GHC.Tc.Utils.Instantiate.html#syntaxNameCtxt"><span class="hs-identifier hs-var hs-var">syntaxNameCtxt</span></a></span></span><span> </span><span id="local-6989586621682802222"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682802222"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682802223"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682802223"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682802224"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802224"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682802225"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682802225"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682802226"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682802226"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; ZonkM (TidyEnv, SDoc)
forall a. a -&gt; ZonkM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682802226"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682802227"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-800"></span><span>    </span><span id="local-6989586621682802227"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621682802227"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking that&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682802222"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>                          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(needed by a syntactic construct)&quot;</span></span><span>
</span><span id="line-802"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has the required type:&quot;</span></span><span>
</span><span id="line-803"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Tidy.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682802226"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802224"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CtOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682802223"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682802225"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                FixedRuntimeRep
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="hs-comment">-- | Check that the result type of an expression has a fixed runtime representation.</span><span>
</span><span id="line-815"></span><span class="hs-comment">--</span><span>
</span><span id="line-816"></span><span class="hs-comment">-- Used only for arrow operations such as 'arr', 'first', etc.</span><span>
</span><span id="line-817"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#hasFixedRuntimeRepRes"><span class="hs-identifier hs-type">hasFixedRuntimeRepRes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span id="hasFixedRuntimeRepRes"><span class="annot"><span class="annottext">hasFixedRuntimeRepRes :: Name -&gt; HsExpr GhcRn -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#hasFixedRuntimeRepRes"><span class="hs-identifier hs-var hs-var">hasFixedRuntimeRepRes</span></a></span></span><span> </span><span id="local-6989586621682802232"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span></span><span> </span><span id="local-6989586621682802233"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682802233"><span class="hs-identifier hs-var">user_expr</span></a></span></span><span> </span><span id="local-6989586621682802234"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802234"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arity -&gt; TcRn ()) -&gt; Maybe Arity -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; TcRn ()
</span><a href="#local-6989586621682802236"><span class="hs-identifier hs-var">do_check</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Arity
</span><a href="#local-6989586621682802237"><span class="hs-identifier hs-var">mb_arity</span></a></span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-820"></span><span>   </span><span class="annot"><a href="#local-6989586621682802236"><span class="hs-identifier hs-type">do_check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>   </span><span id="local-6989586621682802236"><span class="annot"><span class="annottext">do_check :: Arity -&gt; TcRn ()
</span><a href="#local-6989586621682802236"><span class="hs-identifier hs-var hs-var">do_check</span></a></span></span><span> </span><span id="local-6989586621682802238"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682802238"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-822"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802239"><span class="annot"><span class="annottext">res_ty :: Type
</span><a href="#local-6989586621682802239"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; (Type -&gt; Type) -&gt; Type -&gt; Type
forall a. Arity -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="GHC.Utils.Misc.html#nTimes"><span class="hs-identifier hs-var">nTimes</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621682802238"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PiTyBinder, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((PiTyBinder, Type) -&gt; Type)
-&gt; (Type -&gt; (PiTyBinder, Type)) -&gt; Type -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; (PiTyBinder, Type)
</span><a href="GHC.Core.Type.html#splitPiTy"><span class="hs-identifier hs-var">splitPiTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802234"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-823"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FRRArrowContext -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRArrow"><span class="hs-identifier hs-var">FRRArrow</span></a></span><span> </span><span class="annot"><span class="annottext">(FRRArrowContext -&gt; FixedRuntimeRepContext)
-&gt; FRRArrowContext -&gt; FixedRuntimeRepContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; FRRArrowContext
</span><a href="GHC.Tc.Types.Origin.html#ArrowFun"><span class="hs-identifier hs-var">ArrowFun</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682802233"><span class="hs-identifier hs-var">user_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802239"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-824"></span><span>   </span><span class="annot"><a href="#local-6989586621682802237"><span class="hs-identifier hs-type">mb_arity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span>
</span><span id="line-825"></span><span>   </span><span id="local-6989586621682802237"><span class="annot"><span class="annottext">mb_arity :: Maybe Arity
</span><a href="#local-6989586621682802237"><span class="hs-identifier hs-var hs-var">mb_arity</span></a></span></span><span> </span><span class="hs-comment">-- arity of the arrow operation, counting type-level arguments</span><span>
</span><span id="line-826"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#arrAName"><span class="hs-identifier hs-var">arrAName</span></a></span><span>     </span><span class="hs-comment">-- result used as an argument in, e.g., do_premap</span><span>
</span><span id="line-827"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">3</span></span><span>
</span><span id="line-828"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#composeAName"><span class="hs-identifier hs-var">composeAName</span></a></span><span> </span><span class="hs-comment">-- result used as an argument in, e.g., dsCmdStmt/BodyStmt</span><span>
</span><span id="line-829"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">5</span></span><span>
</span><span id="line-830"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#firstAName"><span class="hs-identifier hs-var">firstAName</span></a></span><span>   </span><span class="hs-comment">-- result used as an argument in, e.g., dsCmdStmt/BodyStmt</span><span>
</span><span id="line-831"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">4</span></span><span>
</span><span id="line-832"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#appAName"><span class="hs-identifier hs-var">appAName</span></a></span><span>     </span><span class="hs-comment">-- result used as an argument in, e.g., dsCmd/HsCmdArrApp/HsHigherOrderApp</span><span>
</span><span id="line-833"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span>
</span><span id="line-834"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#choiceAName"><span class="hs-identifier hs-var">choiceAName</span></a></span><span>  </span><span class="hs-comment">-- result used as an argument in, e.g., HsCmdIf</span><span>
</span><span id="line-835"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">5</span></span><span>
</span><span id="line-836"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802232"><span class="hs-identifier hs-var">std_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#loopAName"><span class="hs-identifier hs-var">loopAName</span></a></span><span>    </span><span class="hs-comment">-- result used as an argument in, e.g., HsCmdIf</span><span>
</span><span id="line-837"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Maybe Arity
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">4</span></span><span>
</span><span id="line-838"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-839"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Arity
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Class instances
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#getOverlapFlag"><span class="hs-identifier hs-type">getOverlapFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#OverlapFlag"><span class="hs-identifier hs-type">OverlapFlag</span></a></span><span>
</span><span id="line-850"></span><span class="hs-comment">-- Construct the OverlapFlag from the global module flags,</span><span>
</span><span id="line-851"></span><span class="hs-comment">-- but if the overlap_mode argument is (Just m),</span><span>
</span><span id="line-852"></span><span class="hs-comment">--     set the OverlapMode to 'm'</span><span>
</span><span id="line-853"></span><span id="getOverlapFlag"><span class="annot"><span class="annottext">getOverlapFlag :: Maybe OverlapMode -&gt; TcM OverlapFlag
</span><a href="GHC.Tc.Utils.Instantiate.html#getOverlapFlag"><span class="hs-identifier hs-var hs-var">getOverlapFlag</span></a></span></span><span> </span><span id="local-6989586621682802251"><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682802251"><span class="hs-identifier hs-var">overlap_mode</span></a></span></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682802252"><span class="annot"><a href="#local-6989586621682802252"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-855"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802254"><span class="annot"><a href="#local-6989586621682802254"><span class="hs-identifier hs-var hs-var">overlap_ok</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.OverlappingInstances</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682802252"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-856"></span><span>              </span><span id="local-6989586621682802257"><span class="annot"><a href="#local-6989586621682802257"><span class="hs-identifier hs-var hs-var">incoherent_ok</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.IncoherentInstances</span></span><span>  </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682802252"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-857"></span><span>              </span><span id="local-6989586621682802259"><span class="annot"><a href="#local-6989586621682802259"><span class="hs-identifier hs-var hs-var">noncanonical_incoherence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_SpecialiseIncoherents"><span class="hs-identifier hs-var">Opt_SpecialiseIncoherents</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682802252"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span>              </span><span id="local-6989586621682802262"><span class="annot"><a href="#local-6989586621682802262"><span class="hs-identifier hs-var hs-var">use</span></a></span></span><span> </span><span id="local-6989586621682802263"><span class="annot"><span class="annottext">OverlapMode
</span><a href="#local-6989586621682802263"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#OverlapFlag"><span class="hs-identifier hs-type">OverlapFlag</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">isSafeOverlap :: Bool
</span><a href="#local-6989586621682802265"><span class="hs-identifier hs-var">isSafeOverlap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeLanguageOn"><span class="hs-identifier hs-var">safeLanguageOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682802252"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-860"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">overlapMode :: OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var">overlapMode</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapMode
</span><a href="#local-6989586621682802263"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-861"></span><span>              </span><span id="local-6989586621682802268"><span class="annot"><a href="#local-6989586621682802268"><span class="hs-identifier hs-var hs-var">default_oflag</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802257"><span class="hs-identifier hs-var">incoherent_ok</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapMode -&gt; OverlapFlag
</span><a href="#local-6989586621682802262"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#Incoherent"><span class="hs-identifier hs-var">Incoherent</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802254"><span class="hs-identifier hs-var">overlap_ok</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapMode -&gt; OverlapFlag
</span><a href="#local-6989586621682802262"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#Overlaps"><span class="hs-identifier hs-var">Overlaps</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-863"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapMode -&gt; OverlapFlag
</span><a href="#local-6989586621682802262"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#NoOverlap"><span class="hs-identifier hs-var">NoOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span>              </span><span id="local-6989586621682802273"><span class="annot"><a href="#local-6989586621682802273"><span class="hs-identifier hs-var hs-var">oflag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapFlag -&gt; Maybe OverlapMode -&gt; OverlapFlag
</span><a href="GHC.Types.Basic.html#setOverlapModeMaybe"><span class="hs-identifier hs-var">setOverlapModeMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621682802268"><span class="hs-identifier hs-var">default_oflag</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682802251"><span class="hs-identifier hs-var">overlap_mode</span></a></span><span>
</span><span id="line-866"></span><span>              </span><span id="local-6989586621682802275"><span class="annot"><a href="#local-6989586621682802275"><span class="hs-identifier hs-var hs-var">final_oflag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; OverlapFlag -&gt; OverlapFlag
</span><a href="#local-6989586621682802276"><span class="hs-identifier hs-var">effective_oflag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802259"><span class="hs-identifier hs-var">noncanonical_incoherence</span></a></span><span> </span><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621682802273"><span class="hs-identifier hs-var">oflag</span></a></span><span>
</span><span id="line-867"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682802275"><span class="hs-identifier hs-type">final_oflag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-869"></span><span>    </span><span id="local-6989586621682802276"><span class="annot"><span class="annottext">effective_oflag :: Bool -&gt; OverlapFlag -&gt; OverlapFlag
</span><a href="#local-6989586621682802276"><span class="hs-identifier hs-var hs-var">effective_oflag</span></a></span></span><span> </span><span id="local-6989586621682802277"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802277"><span class="hs-identifier hs-var">noncanonical_incoherence</span></a></span></span><span> </span><span id="local-6989586621682802278"><span class="annot"><span class="annottext">oflag :: OverlapFlag
</span><a href="#local-6989586621682802278"><span class="hs-identifier hs-var">oflag</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Basic.html#OverlapFlag"><span class="hs-identifier hs-type">OverlapFlag</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">overlapMode :: OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var">overlapMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682802279"><span class="annot"><span class="annottext">OverlapMode
</span><a href="#local-6989586621682802279"><span class="hs-identifier hs-var">overlap_mode</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621682802278"><span class="hs-identifier hs-var">oflag</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var">overlapMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682802280"><span class="hs-identifier hs-type">effective_overlap_mode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802277"><span class="hs-identifier hs-type">noncanonical_incoherence</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802279"><span class="hs-identifier hs-type">overlap_mode</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span>    </span><span class="hs-comment">-- The `-fspecialise-incoherents` flag controls the meaning of the</span><span>
</span><span id="line-873"></span><span>    </span><span class="hs-comment">-- `Incoherent` overlap mode: as either an Incoherent overlap</span><span>
</span><span id="line-874"></span><span>    </span><span class="hs-comment">-- flag, or a NonCanonical overlap flag. See Note [Coherence and specialisation: overview]</span><span>
</span><span id="line-875"></span><span>    </span><span class="hs-comment">-- in GHC.Core.InstEnv for why we care about this distinction.</span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621682802280"><span class="annot"><span class="annottext">effective_overlap_mode :: Bool -&gt; OverlapMode -&gt; OverlapMode
</span><a href="#local-6989586621682802280"><span class="hs-identifier hs-var hs-var">effective_overlap_mode</span></a></span></span><span> </span><span id="local-6989586621682802281"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802281"><span class="hs-identifier hs-var">noncanonical_incoherence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-877"></span><span>        </span><span class="annot"><a href="GHC.Types.Basic.html#Incoherent"><span class="hs-identifier hs-type">Incoherent</span></a></span><span> </span><span id="local-6989586621682802282"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621682802282"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802281"><span class="hs-identifier hs-var">noncanonical_incoherence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceText -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#NonCanonical"><span class="hs-identifier hs-var">NonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621682802282"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-878"></span><span>        </span><span id="local-6989586621682802284"><span class="annot"><span class="annottext">OverlapMode
</span><a href="#local-6989586621682802284"><span class="hs-identifier hs-var">overlap_mode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OverlapMode
</span><a href="#local-6989586621682802284"><span class="hs-identifier hs-var">overlap_mode</span></a></span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcGetInsts"><span class="hs-identifier hs-type">tcGetInsts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- Gets the local class instances.</span><span>
</span><span id="line-883"></span><span id="tcGetInsts"><span class="annot"><span class="annottext">tcGetInsts :: TcM [ClsInst]
</span><a href="GHC.Tc.Utils.Instantiate.html#tcGetInsts"><span class="hs-identifier hs-var hs-var">tcGetInsts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; [ClsInst])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TcGblEnv -&gt; TcM [ClsInst]
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newClsInst"><span class="hs-identifier hs-type">newClsInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span>
</span><span id="line-886"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Warnings.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span>
</span><span id="line-887"></span><span id="newClsInst"><span class="annot"><span class="annottext">newClsInst :: Maybe OverlapMode
-&gt; Name
-&gt; [DFunId]
-&gt; [Type]
-&gt; Class
-&gt; [Type]
-&gt; Maybe (WarningTxt GhcRn)
-&gt; TcM ClsInst
</span><a href="GHC.Tc.Utils.Instantiate.html#newClsInst"><span class="hs-identifier hs-var hs-var">newClsInst</span></a></span></span><span> </span><span id="local-6989586621682802288"><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682802288"><span class="hs-identifier hs-var">overlap_mode</span></a></span></span><span> </span><span id="local-6989586621682802289"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802289"><span class="hs-identifier hs-var">dfun_name</span></a></span></span><span> </span><span id="local-6989586621682802290"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802290"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682802291"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802291"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682802292"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682802292"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621682802293"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802293"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682802294"><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621682802294"><span class="hs-identifier hs-var">warn</span></a></span></span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802295"><span class="annot"><a href="#local-6989586621682802295"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802296"><span class="annot"><a href="#local-6989586621682802296"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier hs-var">freshenTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802290"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-889"></span><span>             </span><span class="hs-comment">-- Be sure to freshen those type variables,</span><span>
</span><span id="line-890"></span><span>             </span><span class="hs-comment">-- so they are sure not to appear in any lookup</span><span>
</span><span id="line-891"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802297"><span class="annot"><a href="#local-6989586621682802297"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802295"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802293"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>             </span><span id="local-6989586621682802298"><span class="annot"><a href="#local-6989586621682802298"><span class="hs-identifier hs-var hs-var">dfun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [DFunId] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; DFunId
</span><a href="GHC.Types.Id.Make.html#mkDictFunId"><span class="hs-identifier hs-var">mkDictFunId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682802289"><span class="hs-identifier hs-var">dfun_name</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802290"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802291"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682802292"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802293"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-894"></span><span>             </span><span class="hs-comment">-- The dfun uses the original 'tvs' because</span><span>
</span><span id="line-895"></span><span>             </span><span class="hs-comment">-- (a) they don't need to be fresh</span><span>
</span><span id="line-896"></span><span>             </span><span class="hs-comment">-- (b) they may be mentioned in the ib_binds field of</span><span>
</span><span id="line-897"></span><span>             </span><span class="hs-comment">--     an InstInfo, and in GHC.Tc.Utils.Env.pprInstInfoDetails it's</span><span>
</span><span id="line-898"></span><span>             </span><span class="hs-comment">--     helpful to use the same names</span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802299"><span class="annot"><a href="#local-6989586621682802299"><span class="hs-identifier hs-var">oflag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#getOverlapFlag"><span class="hs-identifier hs-type">getOverlapFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802288"><span class="hs-identifier hs-type">overlap_mode</span></a></span><span>
</span><span id="line-901"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802300"><span class="annot"><a href="#local-6989586621682802300"><span class="hs-identifier hs-var hs-var">cls_inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DFunId
-&gt; OverlapFlag
-&gt; [DFunId]
-&gt; Class
-&gt; [Type]
-&gt; Maybe (WarningTxt GhcRn)
-&gt; ClsInst
</span><a href="GHC.Core.InstEnv.html#mkLocalClsInst"><span class="hs-identifier hs-var">mkLocalClsInst</span></a></span><span> </span><span class="annot"><span class="annottext">DFunId
</span><a href="#local-6989586621682802298"><span class="hs-identifier hs-var">dfun</span></a></span><span> </span><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621682802299"><span class="hs-identifier hs-var">oflag</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802296"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682802292"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802297"><span class="hs-identifier hs-var">tys'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WarningTxt GhcRn)
</span><a href="#local-6989586621682802294"><span class="hs-identifier hs-var">warn</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#isOrphan"><span class="hs-identifier hs-type">isOrphan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#is_orphan"><span class="hs-identifier hs-var">is_orphan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802300"><span class="hs-identifier hs-type">cls_inst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-904"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-type">addDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnOrphanInstance"><span class="hs-identifier hs-type">TcRnOrphanInstance</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><a href="#local-6989586621682802300"><span class="hs-identifier hs-type">cls_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682802300"><span class="hs-identifier hs-type">cls_inst</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span id="local-6989586621682801387"><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcExtendLocalInstEnv"><span class="hs-identifier hs-type">tcExtendLocalInstEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801387"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682801387"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-comment">-- Add new locally-defined instances</span><span>
</span><span id="line-910"></span><span id="tcExtendLocalInstEnv"><span class="annot"><span class="annottext">tcExtendLocalInstEnv :: forall a. [ClsInst] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Instantiate.html#tcExtendLocalInstEnv"><span class="hs-identifier hs-var hs-var">tcExtendLocalInstEnv</span></a></span></span><span> </span><span id="local-6989586621682802310"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802310"><span class="hs-identifier hs-var">dfuns</span></a></span></span><span> </span><span id="local-6989586621682802311"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682802311"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-911"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#traceDFuns"><span class="hs-identifier hs-var">traceDFuns</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802310"><span class="hs-identifier hs-var">dfuns</span></a></span><span>
</span><span id="line-912"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802313"><span class="annot"><a href="#local-6989586621682802313"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-913"></span><span>      </span><span class="hs-comment">-- Force the access to the TcgEnv so it isn't retained.</span><span>
</span><span id="line-914"></span><span>      </span><span class="hs-comment">-- During auditing it is much easier to observe in -hi profiles if</span><span>
</span><span id="line-915"></span><span>      </span><span class="hs-comment">-- there are a very small number of TcGblEnv. Keeping a TcGblEnv</span><span>
</span><span id="line-916"></span><span>      </span><span class="hs-comment">-- alive is quite dangerous because it contains reference to many</span><span>
</span><span id="line-917"></span><span>      </span><span class="hs-comment">-- large data structures.</span><span>
</span><span id="line-918"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682802314"><span class="annot"><a href="#local-6989586621682802314"><span class="hs-identifier hs-var hs-var">init_inst_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; InstEnv
</span><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682802313"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-919"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621682802316"><span class="annot"><a href="#local-6989586621682802316"><span class="hs-identifier hs-var hs-var">init_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682802313"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-920"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802317"><span class="annot"><a href="#local-6989586621682802317"><span class="hs-identifier hs-var">inst_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802318"><span class="annot"><a href="#local-6989586621682802318"><span class="hs-identifier hs-var">cls_insts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldlM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#addLocalInst"><span class="hs-identifier hs-type">addLocalInst</span></a></span><span>
</span><span id="line-921"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682802314"><span class="hs-identifier hs-type">init_inst_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802316"><span class="hs-identifier hs-type">init_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>                                          </span><span class="annot"><a href="#local-6989586621682802310"><span class="hs-identifier hs-type">dfuns</span></a></span><span>
</span><span id="line-923"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802321"><span class="annot"><a href="#local-6989586621682802321"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682802313"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682802318"><span class="hs-identifier hs-type">cls_insts'</span></a></span><span>
</span><span id="line-924"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682802317"><span class="hs-identifier hs-type">inst_env'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-925"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802321"><span class="hs-identifier hs-type">env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802311"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#addLocalInst"><span class="hs-identifier hs-type">addLocalInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span class="hs-comment">-- Check that the proposed new instance is OK,</span><span>
</span><span id="line-929"></span><span class="hs-comment">-- and then add it to the home inst env</span><span>
</span><span id="line-930"></span><span class="hs-comment">-- If overwrite_inst, then we can overwrite a direct match</span><span>
</span><span id="line-931"></span><span id="addLocalInst"><span class="annot"><span class="annottext">addLocalInst :: (InstEnv, [ClsInst])
-&gt; ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) (InstEnv, [ClsInst])
</span><a href="GHC.Tc.Utils.Instantiate.html#addLocalInst"><span class="hs-identifier hs-var hs-var">addLocalInst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802323"><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621682802323"><span class="hs-identifier hs-var">home_ie</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802324"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802324"><span class="hs-identifier hs-var">my_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682802325"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802325"><span class="hs-identifier hs-var">ispec</span></a></span></span><span>
</span><span id="line-932"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-933"></span><span>             </span><span class="hs-comment">-- Load imported instances, so that we report</span><span>
</span><span id="line-934"></span><span>             </span><span class="hs-comment">-- duplicates correctly</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>             </span><span class="hs-comment">-- 'matches'  are existing instance declarations that are less</span><span>
</span><span id="line-937"></span><span>             </span><span class="hs-comment">--            specific than the new one</span><span>
</span><span id="line-938"></span><span>             </span><span class="hs-comment">-- 'dups'     are those 'matches' that are equal to the new one</span><span>
</span><span id="line-939"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802326"><span class="annot"><a href="#local-6989586621682802326"><span class="hs-identifier hs-var">isGHCi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-var">getIsGHCi</span></a></span><span>
</span><span id="line-940"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802328"><span class="annot"><a href="#local-6989586621682802328"><span class="hs-identifier hs-var">eps</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-type">getEps</span></a></span><span>
</span><span id="line-941"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682802330"><span class="annot"><a href="#local-6989586621682802330"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>           </span><span class="hs-comment">-- In GHCi, we *override* any identical instances</span><span>
</span><span id="line-944"></span><span>           </span><span class="hs-comment">-- that are also defined in the interactive context</span><span>
</span><span id="line-945"></span><span>           </span><span class="hs-comment">-- See Note [Override identical instances in GHCi]</span><span>
</span><span id="line-946"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802331"><span class="annot"><a href="#local-6989586621682802331"><span class="hs-identifier hs-var hs-var">home_ie'</span></a></span></span><span>
</span><span id="line-947"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682802326"><span class="hs-identifier hs-var">isGHCi</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; ClsInst -&gt; InstEnv
</span><a href="GHC.Core.InstEnv.html#deleteFromInstEnv"><span class="hs-identifier hs-var">deleteFromInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621682802323"><span class="hs-identifier hs-var">home_ie</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802325"><span class="hs-identifier hs-var">ispec</span></a></span><span>
</span><span id="line-948"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621682802323"><span class="hs-identifier hs-var">home_ie</span></a></span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>               </span><span id="local-6989586621682802333"><span class="annot"><a href="#local-6989586621682802333"><span class="hs-identifier hs-var hs-var">global_ie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; InstEnv
</span><a href="GHC.Unit.External.html#eps_inst_env"><span class="hs-identifier hs-var">eps_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682802328"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-951"></span><span>               </span><span id="local-6989586621682802335"><span class="annot"><a href="#local-6989586621682802335"><span class="hs-identifier hs-var hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnvs"><span class="hs-identifier hs-type">InstEnvs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ie_global :: InstEnv
</span><a href="#local-6989586621682802337"><span class="hs-identifier hs-var">ie_global</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621682802333"><span class="hs-identifier hs-var">global_ie</span></a></span><span>
</span><span id="line-952"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ie_local :: InstEnv
</span><a href="#local-6989586621682802338"><span class="hs-identifier hs-var">ie_local</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621682802331"><span class="hs-identifier hs-var">home_ie'</span></a></span><span>
</span><span id="line-953"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ie_visible :: VisibleOrphanModules
</span><a href="#local-6989586621682802339"><span class="hs-identifier hs-var">ie_visible</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; VisibleOrphanModules
</span><a href="GHC.Tc.Types.html#tcVisibleOrphanMods"><span class="hs-identifier hs-var">tcVisibleOrphanMods</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682802330"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>             </span><span class="hs-comment">-- Check for inconsistent functional dependencies</span><span>
</span><span id="line-956"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802341"><span class="annot"><a href="#local-6989586621682802341"><span class="hs-identifier hs-var hs-var">inconsistent_ispecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnvs -&gt; ClsInst -&gt; [ClsInst]
</span><a href="GHC.Tc.Instance.FunDeps.html#checkFunDeps"><span class="hs-identifier hs-var">checkFunDeps</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621682802335"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802325"><span class="hs-identifier hs-var">ispec</span></a></span><span>
</span><span id="line-957"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682802341"><span class="hs-identifier hs-type">inconsistent_ispecs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-958"></span><span>           </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#funDepErr"><span class="hs-identifier hs-type">funDepErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802325"><span class="hs-identifier hs-type">ispec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802341"><span class="hs-identifier hs-type">inconsistent_ispecs</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>             </span><span class="hs-comment">-- Check for duplicate instance decls.</span><span>
</span><span id="line-961"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802344"><span class="annot"><a href="#local-6989586621682802344"><span class="hs-identifier hs-var">_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802345"><span class="annot"><a href="#local-6989586621682802345"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802346"><span class="annot"><a href="#local-6989586621682802346"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#instanceHead"><span class="hs-identifier hs-type">instanceHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802325"><span class="hs-identifier hs-type">ispec</span></a></span><span>
</span><span id="line-962"></span><span>               </span><span class="hs-special">(</span><span id="local-6989586621682802348"><span class="annot"><a href="#local-6989586621682802348"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#lookupInstEnv"><span class="hs-identifier hs-type">lookupInstEnv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="annot"><a href="#local-6989586621682802335"><span class="hs-identifier hs-type">inst_envs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802345"><span class="hs-identifier hs-type">cls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802346"><span class="hs-identifier hs-type">tys</span></a></span><span>
</span><span id="line-963"></span><span>               </span><span id="local-6989586621682802350"><span class="annot"><a href="#local-6989586621682802350"><span class="hs-identifier hs-var hs-var">dups</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; Bool) -&gt; [ClsInst] -&gt; [ClsInst]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; ClsInst -&gt; Bool
</span><a href="GHC.Core.InstEnv.html#identicalClsInstHead"><span class="hs-identifier hs-var">identicalClsInstHead</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802325"><span class="hs-identifier hs-var">ispec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InstMatch -&gt; ClsInst) -&gt; [InstMatch] -&gt; [ClsInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">InstMatch -&gt; ClsInst
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621682802348"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682802350"><span class="hs-identifier hs-type">dups</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-965"></span><span>           </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#dupInstErr"><span class="hs-identifier hs-type">dupInstErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802325"><span class="hs-identifier hs-type">ispec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Prelude.Basic.html#head"><span class="hs-identifier hs-type">head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802350"><span class="hs-identifier hs-type">dups</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#extendInstEnv"><span class="hs-identifier hs-type">extendInstEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802331"><span class="hs-identifier hs-type">home_ie'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802325"><span class="hs-identifier hs-type">ispec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682802325"><span class="hs-identifier hs-type">ispec</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682802324"><span class="hs-identifier hs-type">my_insts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span class="hs-comment">{- Note [Signature files and type class instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Instances in signature files do not have an effect when compiling:
when you compile a signature against an implementation, you will
see the instances WHETHER OR NOT the instance is declared in
the file (this is because the signatures go in the EPS and we
can't filter them out easily.)  This is also why we cannot
place the instance in the hi file: it would show up as a duplicate,
and we don't have instance reexports anyway.

However, you might find them useful when typechecking against
a signature: the instance is a way of indicating to GHC that
some instance exists, in case downstream code uses it.

Implementing this is a little tricky.  Consider the following
situation (sigof03):

 module A where
     instance C T where ...

 module ASig where
     instance C T

When compiling ASig, A.hi is loaded, which brings its instances
into the EPS.  When we process the instance declaration in ASig,
we should ignore it for the purpose of doing a duplicate check,
since it's not actually a duplicate. But don't skip the check
entirely, we still want this to fail (tcfail221):

 module ASig where
     instance C T
     instance C T

Note that in some situations, the interface containing the type
class instances may not have been loaded yet at all.  The usual
situation when A imports another module which provides the
instances (sigof02m):

 module A(module B) where
     import B

See also Note [Signature lazy interface loading].  We can't
rely on this, however, since sometimes we'll have spurious
type class instances in the EPS, see #9422 (sigof02dm)

************************************************************************
*                                                                      *
                Family instances
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span class="hs-comment">-- All type variables in a FamInst must be fresh. This function</span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- creates the fresh variables and applies the necessary substitution</span><span>
</span><span id="line-1024"></span><span class="hs-comment">-- It is defined here to avoid a dependency from FamInstEnv on the monad</span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- code.</span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#newFamInst"><span class="hs-identifier hs-type">newFamInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamFlavor"><span class="hs-identifier hs-type">FamFlavor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span>
</span><span id="line-1028"></span><span class="hs-comment">-- Freshen the type variables of the FamInst branches</span><span>
</span><span id="line-1029"></span><span id="newFamInst"><span class="annot"><span class="annottext">newFamInst :: FamFlavor -&gt; CoAxiom Unbranched -&gt; TcM FamInst
</span><a href="GHC.Tc.Utils.Instantiate.html#newFamInst"><span class="hs-identifier hs-var hs-var">newFamInst</span></a></span></span><span> </span><span id="local-6989586621682802356"><span class="annot"><span class="annottext">FamFlavor
</span><a href="#local-6989586621682802356"><span class="hs-identifier hs-var">flavor</span></a></span></span><span> </span><span id="local-6989586621682802357"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682802357"><span class="hs-identifier hs-var">axiom</span></a></span></span><span>
</span><span id="line-1030"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [DFunId]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682802360"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802360"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-1031"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_cvs :: CoAxBranch -&gt; [DFunId]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_cvs"><span class="hs-identifier hs-var">cab_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682802362"><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802362"><span class="hs-identifier hs-var">cvs</span></a></span></span><span>
</span><span id="line-1032"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682802364"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802364"><span class="hs-identifier hs-var">lhs</span></a></span></span><span>
</span><span id="line-1033"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682802366"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802366"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomSingleBranch"><span class="hs-identifier hs-var">coAxiomSingleBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682802357"><span class="hs-identifier hs-var">axiom</span></a></span><span>
</span><span id="line-1034"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Freshen the type variables</span><span>
</span><span id="line-1035"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621682802368"><span class="annot"><a href="#local-6989586621682802368"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802369"><span class="annot"><a href="#local-6989586621682802369"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DFunId] -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Subst, [DFunId])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier hs-var">freshenTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802360"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1036"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682802370"><span class="annot"><a href="#local-6989586621682802370"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682802371"><span class="annot"><a href="#local-6989586621682802371"><span class="hs-identifier hs-var">cvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#freshenCoVarBndrsX"><span class="hs-identifier hs-type">freshenCoVarBndrsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802368"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802362"><span class="hs-identifier hs-type">cvs</span></a></span><span>
</span><span id="line-1037"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802372"><span class="annot"><a href="#local-6989586621682802372"><span class="hs-identifier hs-var hs-var">lhs'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802370"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802364"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1038"></span><span>             </span><span id="local-6989586621682802373"><span class="annot"><a href="#local-6989586621682802373"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span>  </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682802370"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802366"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682802374"><span class="annot"><a href="#local-6989586621682802374"><span class="hs-identifier hs-var hs-var">fam_inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamFlavor
-&gt; CoAxiom Unbranched
-&gt; [DFunId]
-&gt; [DFunId]
-&gt; [Type]
-&gt; Type
-&gt; FamInst
</span><a href="GHC.Core.FamInstEnv.html#mkLocalFamInst"><span class="hs-identifier hs-var">mkLocalFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">FamFlavor
</span><a href="#local-6989586621682802356"><span class="hs-identifier hs-var">flavor</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682802357"><span class="hs-identifier hs-var">axiom</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802369"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[DFunId]
</span><a href="#local-6989586621682802371"><span class="hs-identifier hs-var">cvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682802372"><span class="hs-identifier hs-var">lhs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682802373"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-1041"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#isOrphan"><span class="hs-identifier hs-type">isOrphan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#fi_orphan"><span class="hs-identifier hs-var">fi_orphan</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802374"><span class="hs-identifier hs-type">fam_inst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1042"></span><span>         </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-type">addDiagnostic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnOrphanInstance"><span class="hs-identifier hs-type">TcRnOrphanInstance</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621682802374"><span class="hs-identifier hs-type">fam_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682802374"><span class="hs-identifier hs-type">fam_inst</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Errors and tracing
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#traceDFuns"><span class="hs-identifier hs-type">traceDFuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1054"></span><span id="traceDFuns"><span class="annot"><span class="annottext">traceDFuns :: [ClsInst] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#traceDFuns"><span class="hs-identifier hs-var hs-var">traceDFuns</span></a></span></span><span> </span><span id="local-6989586621682802377"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802377"><span class="hs-identifier hs-var">ispecs</span></a></span></span><span>
</span><span id="line-1055"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Adding instances:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ClsInst -&gt; SDoc) -&gt; [ClsInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; SDoc
</span><a href="#local-6989586621682802378"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802377"><span class="hs-identifier hs-var">ispecs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1057"></span><span>    </span><span id="local-6989586621682802378"><span class="annot"><span class="annottext">pp :: ClsInst -&gt; SDoc
</span><a href="#local-6989586621682802378"><span class="hs-identifier hs-var hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621682802384"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802384"><span class="hs-identifier hs-var">ispec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DFunId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; DFunId
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802384"><span class="hs-identifier hs-var">ispec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1058"></span><span>                  </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802384"><span class="hs-identifier hs-var">ispec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>        </span><span class="hs-comment">-- Print the dfun name itself too</span><span>
</span><span id="line-1060"></span><span>
</span><span id="line-1061"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#funDepErr"><span class="hs-identifier hs-type">funDepErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1062"></span><span id="funDepErr"><span class="annot"><span class="annottext">funDepErr :: ClsInst -&gt; [ClsInst] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#funDepErr"><span class="hs-identifier hs-var hs-var">funDepErr</span></a></span></span><span> </span><span id="local-6989586621682802388"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802388"><span class="hs-identifier hs-var">ispec</span></a></span></span><span> </span><span id="local-6989586621682802389"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802389"><span class="hs-identifier hs-var">ispecs</span></a></span></span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitState -&gt; NonEmpty ClsInst -&gt; TcRnMessage)
-&gt; NonEmpty ClsInst -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#addClsInstsErr"><span class="hs-identifier hs-var">addClsInstsErr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; NonEmpty ClsInst -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnFunDepConflict"><span class="hs-identifier hs-var">TcRnFunDepConflict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802388"><span class="hs-identifier hs-var">ispec</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; [ClsInst] -&gt; NonEmpty ClsInst
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682802389"><span class="hs-identifier hs-var">ispecs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1064"></span><span>
</span><span id="line-1065"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#dupInstErr"><span class="hs-identifier hs-type">dupInstErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span id="dupInstErr"><span class="annot"><span class="annottext">dupInstErr :: ClsInst -&gt; ClsInst -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#dupInstErr"><span class="hs-identifier hs-var hs-var">dupInstErr</span></a></span></span><span> </span><span id="local-6989586621682802393"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802393"><span class="hs-identifier hs-var">ispec</span></a></span></span><span> </span><span id="local-6989586621682802394"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802394"><span class="hs-identifier hs-var">dup_ispec</span></a></span></span><span>
</span><span id="line-1067"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitState -&gt; NonEmpty ClsInst -&gt; TcRnMessage)
-&gt; NonEmpty ClsInst -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#addClsInstsErr"><span class="hs-identifier hs-var">addClsInstsErr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; NonEmpty ClsInst -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnDupInstanceDecls"><span class="hs-identifier hs-var">TcRnDupInstanceDecls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802393"><span class="hs-identifier hs-var">ispec</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; [ClsInst] -&gt; NonEmpty ClsInst
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">NE.:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621682802394"><span class="hs-identifier hs-var">dup_ispec</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#addClsInstsErr"><span class="hs-identifier hs-type">addClsInstsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnMessage"><span class="hs-identifier hs-type">TcRnMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span>
</span><span id="line-1071"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span id="addClsInstsErr"><span class="annot"><span class="annottext">addClsInstsErr :: (UnitState -&gt; NonEmpty ClsInst -&gt; TcRnMessage)
-&gt; NonEmpty ClsInst -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#addClsInstsErr"><span class="hs-identifier hs-var hs-var">addClsInstsErr</span></a></span></span><span> </span><span id="local-6989586621682802396"><span class="annot"><span class="annottext">UnitState -&gt; NonEmpty ClsInst -&gt; TcRnMessage
</span><a href="#local-6989586621682802396"><span class="hs-identifier hs-var">mkErr</span></a></span></span><span> </span><span id="local-6989586621682802397"><span class="annot"><span class="annottext">NonEmpty ClsInst
</span><a href="#local-6989586621682802397"><span class="hs-identifier hs-var">ispecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1073"></span><span>   </span><span id="local-6989586621682802398"><span class="annot"><a href="#local-6989586621682802398"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; HscEnv -&gt; UnitState
HscEnv -&gt; UnitState
</span><a href="GHC.Driver.Env.html#hsc_units"><span class="hs-identifier hs-var">hsc_units</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; UnitState)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) HscEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) UnitState
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1074"></span><span>   </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-type">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-type">getSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#head"><span class="hs-identifier hs-type">NE.head</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802404"><span class="hs-identifier hs-type">sorted</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1075"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682802396"><span class="hs-identifier hs-type">mkErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802398"><span class="hs-identifier hs-type">unit_state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682802404"><span class="hs-identifier hs-type">sorted</span></a></span><span>
</span><span id="line-1076"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1077"></span><span>   </span><span id="local-6989586621682802404"><span class="annot"><span class="annottext">sorted :: NonEmpty ClsInst
</span><a href="#local-6989586621682802404"><span class="hs-identifier hs-var hs-var">sorted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; ClsInst -&gt; Ordering)
-&gt; NonEmpty ClsInst -&gt; NonEmpty ClsInst
forall a. (a -&gt; a -&gt; Ordering) -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#sortBy"><span class="hs-identifier hs-var">NE.sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpan -&gt; Ordering
</span><a href="GHC.Types.SrcLoc.html#leftmost_smallest"><span class="hs-identifier hs-var">SrcLoc.leftmost_smallest</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; SrcSpan -&gt; Ordering)
-&gt; (ClsInst -&gt; SrcSpan) -&gt; ClsInst -&gt; ClsInst -&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty ClsInst
</span><a href="#local-6989586621682802397"><span class="hs-identifier hs-var">ispecs</span></a></span><span>
</span><span id="line-1078"></span><span>   </span><span class="hs-comment">-- The sortBy just arranges that instances are displayed in order</span><span>
</span><span id="line-1079"></span><span>   </span><span class="hs-comment">-- of source location, which reduced wobbling in error messages,</span><span>
</span><span id="line-1080"></span><span>   </span><span class="hs-comment">-- and is better for users</span><span>
</span><span id="line-1081"></span></pre></body></html>