<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes       #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards  #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies     #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="annot"><span class="hs-comment">-- | Typecheck some @Matches@</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html"><span class="hs-identifier">GHC.Tc.Gen.Match</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier">tcFunBindMatches</span></a></span><span>
</span><span id="line-20"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcCaseMatches"><span class="hs-identifier">tcCaseMatches</span></a></span><span>
</span><span id="line-21"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLambdaMatches"><span class="hs-identifier">tcLambdaMatches</span></a></span><span>
</span><span id="line-22"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGRHSList"><span class="hs-identifier">tcGRHSList</span></a></span><span>
</span><span id="line-23"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGRHSsPat"><span class="hs-identifier">tcGRHSsPat</span></a></span><span>
</span><span id="line-24"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcStmtChecker"><span class="hs-identifier">TcStmtChecker</span></a></span><span>
</span><span id="line-25"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcExprStmtChecker"><span class="hs-identifier">TcExprStmtChecker</span></a></span><span>
</span><span id="line-26"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcCmdStmtChecker"><span class="hs-identifier">TcCmdStmtChecker</span></a></span><span>
</span><span id="line-27"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmts"><span class="hs-identifier">tcStmts</span></a></span><span>
</span><span id="line-28"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier">tcStmtsAndThen</span></a></span><span>
</span><span id="line-29"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier">tcDoStmts</span></a></span><span>
</span><span id="line-30"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier">tcBody</span></a></span><span>
</span><span id="line-31"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier">tcDoStmt</span></a></span><span>
</span><span id="line-32"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGuardStmt"><span class="hs-identifier">tcGuardStmt</span></a></span><span>
</span><span id="line-33"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#checkArgCounts"><span class="hs-identifier">checkArgCounts</span></a></span><span>
</span><span id="line-34"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier">tcInferRhoNC</span></a></span><span>
</span><span id="line-40"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier">tcMonoExprNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier">tcExpr</span></a></span><span>
</span><span id="line-41"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier">tcCheckMonoExprNC</span></a></span><span>
</span><span id="line-42"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier">tcPolyLExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#bindLocalNames"><span class="hs-identifier">bindLocalNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#isIrrefutableHsPat"><span class="hs-identifier">isIrrefutableHsPat</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html"><span class="hs-identifier">GHC.Tc.Gen.Pat</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Do.html"><span class="hs-identifier">GHC.Tc.Gen.Do</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html"><span class="hs-identifier">GHC.Tc.Gen.Head</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier">tcCheckId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Create chunkified tuple types for monad comprehensions</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#VisArity"><span class="hs-identifier">VisArity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#isDoExpansionGenerated"><span class="hs-identifier">isDoExpansionGenerated</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.html/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Arrow.html/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.Maybe.html/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.10.1-5e10/src//GHC.LanguageExtensions.html/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{tcFunBindMatches, tcCaseMatches}
*                                                                      *
************************************************************************

`tcFunBindMatches` typechecks a `[Match]` list which occurs in a
`FunBind`.  The second argument is the name of the function, which
is used in error messages.  It checks that all the equations have the
same number of arguments before using `tcMatches` to do the work.
-}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier hs-type">tcFunBindMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-102"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>            </span><span class="hs-comment">-- Function name</span><span>
</span><span id="line-103"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>            </span><span class="hs-comment">-- The multiplicity of the binder</span><span>
</span><span id="line-104"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Scoped skolemised binders</span><span>
</span><span id="line-106"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>      </span><span class="hs-comment">-- Expected type of function; caller</span><span>
</span><span id="line-107"></span><span>                                    </span><span class="hs-comment">-- has skolemised any outer forall's</span><span>
</span><span id="line-108"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- See Note [Skolemisation overview] in GHC.Tc.Utils.Unify</span><span>
</span><span id="line-110"></span><span id="tcFunBindMatches"><span class="annot"><span class="annottext">tcFunBindMatches :: UserTypeCtxt
-&gt; Name
-&gt; Mult
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcFunBindMatches"><span class="hs-identifier hs-var hs-var">tcFunBindMatches</span></a></span></span><span> </span><span id="local-6989586621682880761"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621682880761"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682880762"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682880762"><span class="hs-identifier hs-var">fun_name</span></a></span></span><span> </span><span id="local-6989586621682880763"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880763"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621682880764"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682880764"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span id="local-6989586621682880765"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880765"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880766"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880766"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn) -&gt; Bool
</span><a href="GHC.Tc.Gen.Match.html#funBindPrecondition"><span class="hs-identifier hs-var">funBindPrecondition</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682880764"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; SDoc
forall (idR :: Pass) body.
(OutputableBndrId idR, Outputable body) =&gt;
MatchGroup (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprMatches"><span class="hs-identifier hs-var">pprMatches</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880764"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
 -&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc)))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Check that they all have the same no of arguments</span><span>
</span><span id="line-113"></span><span>          </span><span id="local-6989586621682880770"><span class="annot"><a href="#local-6989586621682880770"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; TcM VisArity
forall (body :: * -&gt; *).
AnnoBody body =&gt;
MatchGroup GhcRn (LocatedA (body GhcRn)) -&gt; TcM VisArity
</span><a href="GHC.Tc.Gen.Match.html#checkArgCounts"><span class="hs-identifier hs-var">checkArgCounts</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880764"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcFunBindMatches 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880762"><span class="hs-identifier hs-type">fun_name</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880763"><span class="hs-identifier hs-type">mult</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880766"><span class="hs-identifier hs-type">exp_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880770"><span class="hs-identifier hs-type">arity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880774"><span class="annot"><a href="#local-6989586621682880774"><span class="hs-identifier hs-var">wrap_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880775"><span class="annot"><a href="#local-6989586621682880775"><span class="hs-identifier hs-var">wrap_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682880776"><span class="annot"><a href="#local-6989586621682880776"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#matchExpectedFunTys"><span class="hs-identifier hs-type">matchExpectedFunTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880778"><span class="hs-identifier hs-type">herald</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880761"><span class="hs-identifier hs-type">ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880770"><span class="hs-identifier hs-type">arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880766"><span class="hs-identifier hs-type">exp_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682880779"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880779"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880780"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880780"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>                </span><span class="annot"><span class="annottext">Mult
-&gt; TcM
     (HsWrapper,
      MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM
     (HsWrapper,
      MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880763"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   (HsWrapper,
    MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
 -&gt; TcM
      (HsWrapper,
       MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))))
-&gt; TcM
     (HsWrapper,
      MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM
     (HsWrapper,
      MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-120"></span><span>                   </span><span class="hs-comment">-- Makes sure that if the binding is unrestricted, it counts as</span><span>
</span><span id="line-121"></span><span>                   </span><span class="hs-comment">-- consuming its rhs Many times.</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcFunBindMatches 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; SDoc
</span><a href="GHC.Tc.Types.Origin.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621682880761"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExpPatType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880765"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span><span>
</span><span id="line-124"></span><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ExpPatType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880779"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880780"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker HsExpr
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; TcM
     (HsWrapper,
      MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall (body :: * -&gt; *).
(AnnoBody body, Outputable (body GhcTc)) =&gt;
TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatches"><span class="hs-identifier hs-var">tcMatches</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
TcMatchAltChecker HsExpr
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880765"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType] -&gt; [ExpPatType] -&gt; [ExpPatType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880779"><span class="hs-identifier hs-var">pat_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880780"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880764"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880774"><span class="hs-identifier hs-type">wrap_fun</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880775"><span class="hs-identifier hs-type">wrap_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682880776"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621682880778"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621682880778"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedThing
-&gt; MatchGroup GhcRn (LHsExpr GhcRn) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyMatches"><span class="hs-identifier hs-var">ExpectedFunTyMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TypedThing
</span><a href="GHC.Tc.Types.Origin.html#NameThing"><span class="hs-identifier hs-var">NameThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682880762"><span class="hs-identifier hs-var">fun_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682880764"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#funBindPrecondition"><span class="hs-identifier hs-type">funBindPrecondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-132"></span><span id="funBindPrecondition"><span class="annot"><span class="annottext">funBindPrecondition :: MatchGroup GhcRn (LHsExpr GhcRn) -&gt; Bool
</span><a href="GHC.Tc.Gen.Match.html#funBindPrecondition"><span class="hs-identifier hs-var hs-var">funBindPrecondition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682880791"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682880791"><span class="hs-identifier hs-var">alts</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682880791"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
 -&gt; Bool)
-&gt; [GenLocated
      SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))
-&gt; Bool
forall {l} {p} {body}. GenLocated l (Match p body) -&gt; Bool
</span><a href="#local-6989586621682880796"><span class="hs-identifier hs-var">is_fun_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Match GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682880791"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621682880796"><span class="annot"><span class="annottext">is_fun_rhs :: GenLocated l (Match p body) -&gt; Bool
</span><a href="#local-6989586621682880796"><span class="hs-identifier hs-var hs-var">is_fun_rhs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_ctxt :: forall p body. Match p body -&gt; HsMatchContext (LIdP (NoGhcTc p))
</span><a href="Language.Haskell.Syntax.Expr.html#m_ctxt"><span class="hs-identifier hs-var">m_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FunRhs"><span class="hs-identifier hs-type">FunRhs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="#local-6989586621682880796"><span class="hs-identifier hs-var">is_fun_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated l (Match p body)
</span><span class="hs-identifier">_</span></span><span>                                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLambdaMatches"><span class="hs-identifier hs-type">tcLambdaMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsLamVariant"><span class="hs-identifier hs-type">HsLamVariant</span></a></span><span>
</span><span id="line-139"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Already skolemised</span><span>
</span><span id="line-141"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>  </span><span class="hs-comment">-- NB can be a sigma-type</span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="tcLambdaMatches"><span class="annot"><span class="annottext">tcLambdaMatches :: HsExpr GhcRn
-&gt; HsLamVariant
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcLambdaMatches"><span class="hs-identifier hs-var hs-var">tcLambdaMatches</span></a></span></span><span> </span><span id="local-6989586621682880801"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682880801"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682880802"><span class="annot"><span class="annottext">HsLamVariant
</span><a href="#local-6989586621682880802"><span class="hs-identifier hs-var">lam_variant</span></a></span></span><span> </span><span id="local-6989586621682880803"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682880803"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span id="local-6989586621682880804"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880804"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880805"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880805"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682880806"><span class="annot"><a href="#local-6989586621682880806"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; TcM VisArity
forall (body :: * -&gt; *).
AnnoBody body =&gt;
MatchGroup GhcRn (LocatedA (body GhcRn)) -&gt; TcM VisArity
</span><a href="GHC.Tc.Gen.Match.html#checkArgCounts"><span class="hs-identifier hs-var">checkArgCounts</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880803"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-comment">-- Check argument counts since this is also used for \cases</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880807"><span class="annot"><a href="#local-6989586621682880807"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880808"><span class="annot"><a href="#local-6989586621682880808"><span class="hs-identifier hs-var">mult_co_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682880809"><span class="annot"><a href="#local-6989586621682880809"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#matchExpectedFunTys"><span class="hs-identifier hs-type">matchExpectedFunTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880810"><span class="hs-identifier hs-type">herald</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-type">GenSigCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880806"><span class="hs-identifier hs-type">arity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880805"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682880812"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880812"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880813"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880813"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>               </span><span class="annot"><span class="annottext">TcMatchAltChecker HsExpr
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; TcM
     (HsWrapper,
      MatchGroup GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall (body :: * -&gt; *).
(AnnoBody body, Outputable (body GhcTc)) =&gt;
TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatches"><span class="hs-identifier hs-var">tcMatches</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
TcMatchAltChecker HsExpr
</span><a href="#local-6989586621682880814"><span class="hs-identifier hs-var">tc_body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880804"><span class="hs-identifier hs-var">invis_pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType] -&gt; [ExpPatType] -&gt; [ExpPatType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880812"><span class="hs-identifier hs-var">pat_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880813"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880803"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880807"><span class="hs-identifier hs-type">wrapper</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880808"><span class="hs-identifier hs-type">mult_co_wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682880809"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621682880810"><span class="annot"><span class="annottext">herald :: ExpectedFunTyOrigin
</span><a href="#local-6989586621682880810"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLamVariant -&gt; HsExpr GhcRn -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyLam"><span class="hs-identifier hs-var">ExpectedFunTyLam</span></a></span><span> </span><span class="annot"><span class="annottext">HsLamVariant
</span><a href="#local-6989586621682880802"><span class="hs-identifier hs-var">lam_variant</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682880801"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-154"></span><span>             </span><span class="hs-comment">-- See Note [Herald for matchExpectedFunTys] in GHC.Tc.Utils.Unify</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621682880814"><span class="annot"><span class="annottext">tc_body :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621682880814"><span class="hs-identifier hs-var hs-var">tc_body</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; Bool
</span><a href="GHC.Types.Basic.html#isDoExpansionGenerated"><span class="hs-identifier hs-var">isDoExpansionGenerated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; XMG GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall p body. MatchGroup p body -&gt; XMG p body
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
MatchGroup GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880803"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>              </span><span class="hs-comment">-- See Part 3. B. of Note [Expanding HsDo with XXExprGhcRn] in</span><span>
</span><span id="line-158"></span><span>              </span><span class="hs-comment">-- `GHC.Tc.Gen.Do`. Testcase: Typeable1</span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBodyNC"><span class="hs-identifier hs-var">tcBodyNC</span></a></span><span> </span><span class="hs-comment">-- NB: Do not add any error contexts</span><span>
</span><span id="line-160"></span><span>                       </span><span class="hs-comment">-- It has already been done</span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-162"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">{-
@tcCaseMatches@ doesn't do the argument-count check because the
parser guarantees that each equation has exactly one argument.
-}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span id="local-6989586621682880298"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcCaseMatches"><span class="hs-identifier hs-type">tcCaseMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880298"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880298"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcMatchAltChecker"><span class="hs-identifier hs-type">TcMatchAltChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880298"><span class="hs-identifier hs-type">body</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Typecheck the alternative RHSS</span></span><span>
</span><span id="line-171"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Type of scrutinee</span></span><span>
</span><span id="line-172"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880298"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ The case alternatives</span></span><span>
</span><span id="line-173"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>                               </span><span class="annot"><span class="hs-comment">-- ^ Type of the whole case expression</span></span><span>
</span><span id="line-174"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880298"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-175"></span><span>                </span><span class="hs-comment">-- Translated alternatives</span><span>
</span><span id="line-176"></span><span>                </span><span class="hs-comment">-- wrapper goes from MatchGroup's ty to expected ty</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="tcCaseMatches"><span class="annot"><span class="annottext">tcCaseMatches :: forall (body :: * -&gt; *).
(AnnoBody body, Outputable (body GhcTc)) =&gt;
TcMatchAltChecker body
-&gt; Scaled Mult
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcCaseMatches"><span class="hs-identifier hs-var hs-var">tcCaseMatches</span></a></span></span><span> </span><span id="local-6989586621682880837"><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682880837"><span class="hs-identifier hs-var">tc_body</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682880839"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880839"><span class="hs-identifier hs-var">scrut_mult</span></a></span></span><span> </span><span id="local-6989586621682880840"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880840"><span class="hs-identifier hs-var">scrut_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682880841"><span class="annot"><span class="annottext">MatchGroup GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682880841"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span id="local-6989586621682880842"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880842"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LocatedA (body GhcTc)))
forall (body :: * -&gt; *).
(AnnoBody body, Outputable (body GhcTc)) =&gt;
TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatches"><span class="hs-identifier hs-var">tcMatches</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682880837"><span class="hs-identifier hs-var">tc_body</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; ExpPatType
</span><a href="GHC.Tc.Utils.TcType.html#ExpFunPatTy"><span class="hs-identifier hs-var">ExpFunPatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType -&gt; Scaled ExpRhoType
forall a. Mult -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880839"><span class="hs-identifier hs-var">scrut_mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880840"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880842"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682880841"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- @tcGRHSsPat@ typechecks @[GRHSs]@ that occur in a @PatMonoBind@.</span><span>
</span><span id="line-182"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGRHSsPat"><span class="hs-identifier hs-type">tcGRHSsPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-183"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- Used for pattern bindings</span><span>
</span><span id="line-185"></span><span id="tcGRHSsPat"><span class="annot"><span class="annottext">tcGRHSsPat :: Mult
-&gt; GRHSs GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSsPat"><span class="hs-identifier hs-var hs-var">tcGRHSsPat</span></a></span></span><span> </span><span id="local-6989586621682880845"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880845"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621682880846"><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621682880846"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span id="local-6989586621682880847"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880847"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682880845"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (GRHSs GhcTc (LHsExpr GhcTc))
 -&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc)))
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
-&gt; TcM (GRHSs GhcTc (LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880848"><span class="annot"><a href="#local-6989586621682880848"><span class="hs-identifier hs-var">mult_co_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682880849"><span class="annot"><a href="#local-6989586621682880849"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; TcMatchAltChecker HsExpr
-&gt; GRHSs GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; TcM
     (HsWrapper, GRHSs GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; GRHSs GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSs"><span class="hs-identifier hs-var">tcGRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#PatBindRhs"><span class="hs-identifier hs-var">PatBindRhs</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
TcMatchAltChecker HsExpr
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LHsExpr GhcRn)
GRHSs GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682880846"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880847"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682880852"><span class="hs-identifier hs-type">mkWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880848"><span class="hs-identifier hs-type">mult_co_wrapper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880849"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621682880852"><span class="annot"><span class="annottext">mkWrap :: HsWrapper
-&gt; GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682880852"><span class="hs-identifier hs-var hs-var">mkWrap</span></a></span></span><span> </span><span id="local-6989586621682880859"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682880859"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621682880860"><span class="annot"><span class="annottext">grhss :: GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682880860"><span class="hs-identifier hs-var">grhss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">grhssGRHSs :: forall p body. GRHSs p body -&gt; [LGRHS p body]
</span><a href="Language.Haskell.Syntax.Expr.html#grhssGRHSs"><span class="hs-identifier hs-var">grhssGRHSs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682880863"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621682880863"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span id="local-6989586621682880865"><span class="annot"><span class="annottext">XCGRHS p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682880865"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682880866"><span class="annot"><span class="annottext">[GuardLStmt p]
</span><a href="#local-6989586621682880866"><span class="hs-identifier hs-var">guards</span></a></span></span><span> </span><span id="local-6989586621682880867"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682880867"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682880868"><span class="annot"><span class="annottext">[XRec p (GRHS p (GenLocated SrcSpanAnnA (HsExpr GhcTc)))]
</span><a href="#local-6989586621682880868"><span class="hs-identifier hs-var">rhss</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="annottext">GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><a href="#local-6989586621682880860"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#grhssGRHSs"><span class="hs-identifier hs-var">grhssGRHSs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880863"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880865"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880866"><span class="hs-identifier hs-type">guards</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-type">mkLHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880859"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880867"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682880868"><span class="hs-identifier hs-type">rhss</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="#local-6989586621682880852"><span class="hs-identifier hs-var">mkWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">grhssGRHSs :: forall p body. GRHSs p body -&gt; [LGRHS p body]
</span><a href="Language.Haskell.Syntax.Expr.html#grhssGRHSs"><span class="hs-identifier hs-var">grhssGRHSs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcGRHSsPat: empty GHRSs&quot;</span></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><a href="#local-6989586621682880852"><span class="hs-identifier hs-var">mkWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; GRHSs p (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcGRHSsPat: non-empty extensions&quot;</span></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">-- Should be the following but it warns of redundant pattern and I couldn't</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- find a way to silence them</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">-- mkWrap _ (GRHSs { grhssGRHSs = L _ (XGRHS absent) : _ }) = dataConCantHappen absent</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- mkWrap _ (XGRHSs absent) = dataConCantHappen absent</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                tcMatch
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><span class="hs-comment">-- | Type checker for a body of a match alternative</span></span><span>
</span><span id="line-207"></span><span class="hs-keyword">type</span><span> </span><span id="TcMatchAltChecker"><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcMatchAltChecker"><span class="hs-identifier hs-var">TcMatchAltChecker</span></a></span></span><span> </span><span id="local-6989586621682880871"><span class="annot"><a href="#local-6989586621682880871"><span class="hs-identifier hs-type">body</span></a></span></span><span>   </span><span class="hs-comment">-- c.f. TcStmtChecker, also in this module</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880871"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880871"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">type</span><span> </span><span id="AnnoBody"><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-var">AnnoBody</span></a></span></span><span> </span><span id="local-6989586621682880872"><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnnA"><span class="hs-identifier hs-type">SrcSpanAnnA</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnnA"><span class="hs-identifier hs-type">SrcSpanAnnA</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnnL"><span class="hs-identifier hs-type">SrcSpanAnnL</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnnL"><span class="hs-identifier hs-type">SrcSpanAnnL</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnnCO"><span class="hs-identifier hs-type">EpAnnCO</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#EpAnnCO"><span class="hs-identifier hs-type">EpAnnCO</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtLR"><span class="hs-identifier hs-type">StmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnnA"><span class="hs-identifier hs-type">SrcSpanAnnA</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtLR"><span class="hs-identifier hs-type">StmtLR</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880872"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnnA"><span class="hs-identifier hs-type">SrcSpanAnnA</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><span class="hs-comment">-- | Type-check a MatchGroup.</span></span><span>
</span><span id="line-225"></span><span id="local-6989586621682880272"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMatches"><span class="hs-identifier hs-type">tcMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880272"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880272"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcMatchAltChecker"><span class="hs-identifier hs-type">TcMatchAltChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880272"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-227"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Expected pattern types.</span></span><span>
</span><span id="line-228"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Expected result-type of the Match.</span></span><span>
</span><span id="line-229"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880272"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880272"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span id="tcMatches"><span class="annot"><span class="annottext">tcMatches :: forall (body :: * -&gt; *).
(AnnoBody body, Outputable (body GhcTc)) =&gt;
TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; MatchGroup GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatches"><span class="hs-identifier hs-var hs-var">tcMatches</span></a></span></span><span> </span><span id="local-6989586621682880924"><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682880924"><span class="hs-identifier hs-var">tc_body</span></a></span></span><span> </span><span id="local-6989586621682880925"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880925"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880926"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880926"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682880927"><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682880927"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682880928"><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682880928"><span class="hs-identifier hs-var">matches</span></a></span></span><span>
</span><span id="line-233"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_ext :: forall p body. MatchGroup p body -&gt; XMG p body
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682880929"><span class="annot"><span class="annottext">XMG GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682880929"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682880928"><span class="hs-identifier hs-var">matches</span></a></span><span>  </span><span class="hs-comment">-- Deal with case e of {}</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- Since there are no branches, no one else will fill in rhs_ty</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- when in inference mode, so we must do it ourselves,</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- here, using expTypeToType</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="GHC.Core.UsageEnv.html#bottomUE"><span class="hs-identifier hs-var">bottomUE</span></a></span><span>
</span><span id="line-239"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682880932"><span class="annot"><a href="#local-6989586621682880932"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Scaled ExpRhoType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Mult))
-&gt; [Scaled ExpRhoType]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Scaled Mult]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Mult)
</span><a href="GHC.Tc.Utils.TcMType.html#scaledExpTypeToType"><span class="hs-identifier hs-var">scaledExpTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpPatType] -&gt; [Scaled ExpRhoType]
</span><a href="#local-6989586621682880935"><span class="hs-identifier hs-var">filter_out_forall_pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880925"><span class="hs-identifier hs-var">pat_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682880936"><span class="annot"><a href="#local-6989586621682880936"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-type">expTypeToType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880926"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-241"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880927"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-type">MatchGroupTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880932"><span class="hs-identifier hs-type">pat_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880936"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880929"><span class="hs-identifier hs-type">origin</span></a></span><span>
</span><span id="line-243"></span><span>                                 </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682880940"><span class="annot"><a href="#local-6989586621682880940"><span class="hs-identifier hs-var">umatches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LocatedA (Match GhcRn (LocatedA (body GhcRn)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (UsageEnv,
       (HsWrapper,
        GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc))))))
-&gt; [LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     [(UsageEnv,
       (HsWrapper,
        GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc)))))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcM
  (HsWrapper,
   GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc))))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (UsageEnv,
      (HsWrapper,
       GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc)))))
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   (HsWrapper,
    GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc))))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (UsageEnv,
       (HsWrapper,
        GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc))))))
-&gt; (LocatedA (Match GhcRn (LocatedA (body GhcRn)))
    -&gt; TcM
         (HsWrapper,
          GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc)))))
-&gt; LocatedA (Match GhcRn (LocatedA (body GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (UsageEnv,
      (HsWrapper,
       GenLocated SrcSpanAnnA (Match GhcTc (LocatedA (body GhcTc)))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; LMatch GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, LMatch GhcTc (LocatedA (body GhcTc)))
forall (body :: * -&gt; *).
AnnoBody body =&gt;
TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; LMatch GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, LMatch GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatch"><span class="hs-identifier hs-var">tcMatch</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682880924"><span class="hs-identifier hs-var">tc_body</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880925"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880926"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682880928"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-247"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880944"><span class="annot"><a href="#local-6989586621682880944"><span class="hs-identifier hs-var">usages</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682880945"><span class="annot"><a href="#local-6989586621682880945"><span class="hs-identifier hs-var">wmatches</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621682880940"><span class="hs-identifier hs-type">umatches</span></a></span><span>
</span><span id="line-248"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880947"><span class="annot"><a href="#local-6989586621682880947"><span class="hs-identifier hs-var">wrappers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682880948"><span class="annot"><a href="#local-6989586621682880948"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621682880945"><span class="hs-identifier hs-type">wmatches</span></a></span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682880949"><span class="annot"><a href="#local-6989586621682880949"><span class="hs-identifier hs-var hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsWrapper] -&gt; HsWrapper
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682880947"><span class="hs-identifier hs-var">wrappers</span></a></span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#supUEs"><span class="hs-identifier hs-type">supUEs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880944"><span class="hs-identifier hs-type">usages</span></a></span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682880951"><span class="annot"><a href="#local-6989586621682880951"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readScaledExpType"><span class="hs-identifier hs-type">readScaledExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880935"><span class="hs-identifier hs-type">filter_out_forall_pat_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880925"><span class="hs-identifier hs-type">pat_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682880953"><span class="annot"><a href="#local-6989586621682880953"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880926"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-253"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcMatches&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880948"><span class="hs-identifier hs-type">matches'</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880951"><span class="hs-identifier hs-type">pat_tys</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880953"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880949"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880927"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880948"><span class="hs-identifier hs-type">matches'</span></a></span><span>
</span><span id="line-255"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-type">MatchGroupTc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880951"><span class="hs-identifier hs-type">pat_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880953"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880929"><span class="hs-identifier hs-type">origin</span></a></span><span>
</span><span id="line-256"></span><span>                             </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- We filter out foralls because we have no use for them in HsToCore.</span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="#local-6989586621682880935"><span class="hs-identifier hs-type">filter_out_forall_pat_tys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621682880935"><span class="annot"><span class="annottext">filter_out_forall_pat_tys :: [ExpPatType] -&gt; [Scaled ExpRhoType]
</span><a href="#local-6989586621682880935"><span class="hs-identifier hs-var hs-var">filter_out_forall_pat_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExpPatType -&gt; Maybe (Scaled ExpRhoType))
-&gt; [ExpPatType] -&gt; [Scaled ExpRhoType]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">ExpPatType -&gt; Maybe (Scaled ExpRhoType)
</span><a href="#local-6989586621682880956"><span class="hs-identifier hs-var">match_fun_pat_ty</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621682880956"><span class="annot"><span class="annottext">match_fun_pat_ty :: ExpPatType -&gt; Maybe (Scaled ExpRhoType)
</span><a href="#local-6989586621682880956"><span class="hs-identifier hs-var hs-var">match_fun_pat_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpFunPatTy"><span class="hs-identifier hs-type">ExpFunPatTy</span></a></span><span> </span><span id="local-6989586621682880957"><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621682880957"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; Maybe (Scaled ExpRhoType)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621682880957"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><a href="#local-6989586621682880956"><span class="hs-identifier hs-var">match_fun_pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpForAllPatTy"><span class="hs-identifier hs-type">ExpForAllPatTy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Scaled ExpRhoType)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-266"></span><span id="local-6989586621682880333"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMatch"><span class="hs-identifier hs-type">tcMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880333"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcMatchAltChecker"><span class="hs-identifier hs-type">TcMatchAltChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880333"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- Expected pattern types</span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>            </span><span class="hs-comment">-- Expected result-type of the Match.</span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880333"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880333"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span id="tcMatch"><span class="annot"><span class="annottext">tcMatch :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
TcMatchAltChecker body
-&gt; [ExpPatType]
-&gt; ExpRhoType
-&gt; LMatch GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, LMatch GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatch"><span class="hs-identifier hs-var hs-var">tcMatch</span></a></span></span><span> </span><span id="local-6989586621682880984"><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682880984"><span class="hs-identifier hs-var">tc_body</span></a></span></span><span> </span><span id="local-6989586621682880985"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880985"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880986"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880986"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span id="local-6989586621682880987"><span class="annot"><span class="annottext">LMatch GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682880987"><span class="hs-identifier hs-var">match</span></a></span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682880988"><span class="annot"><a href="#local-6989586621682880988"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682880989"><span class="annot"><a href="#local-6989586621682880989"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682880990"><span class="annot"><a href="#local-6989586621682880990"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Match GhcRn (LocatedA (body GhcRn))
 -&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc))))
-&gt; LocatedA (Match GhcRn (LocatedA (body GhcRn)))
-&gt; TcRn
     (GenLocated
        SrcSpanAnnA (HsWrapper, Match GhcTc (LocatedA (body GhcTc))))
forall a b ann.
(a -&gt; TcM b)
-&gt; GenLocated (EpAnn ann) a -&gt; TcRn (GenLocated (EpAnn ann) b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocMA"><span class="hs-identifier hs-var">wrapLocMA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ExpPatType]
-&gt; ExpRhoType
-&gt; Match GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682880992"><span class="hs-identifier hs-var">tc_match</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880985"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880986"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LMatch GhcRn (LocatedA (body GhcRn))
LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682880987"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-275"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880989"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880988"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880990"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-277"></span><span>    </span><span id="local-6989586621682880992"><span class="annot"><span class="annottext">tc_match :: [ExpPatType]
-&gt; ExpRhoType
-&gt; Match GhcRn (LocatedA (body GhcRn))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682880992"><span class="hs-identifier hs-var hs-var">tc_match</span></a></span></span><span> </span><span id="local-6989586621682880993"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880993"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621682880994"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880994"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>
</span><span id="line-278"></span><span>             </span><span id="local-6989586621682880995"><span class="annot"><span class="annottext">match :: Match GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682880995"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_ctxt :: forall p body. Match p body -&gt; HsMatchContext (LIdP (NoGhcTc p))
</span><a href="Language.Haskell.Syntax.Expr.html#m_ctxt"><span class="hs-identifier hs-var">m_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682880996"><span class="annot"><span class="annottext">HsMatchContext (LIdP (NoGhcTc GhcRn))
</span><a href="#local-6989586621682880996"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">m_pats :: forall p body. Match p body -&gt; [LPat p]
</span><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682880998"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621682880998"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881000"><span class="annot"><span class="annottext">GRHSs GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881000"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881001"><span class="hs-identifier hs-var">add_match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
 -&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc))))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881002"><span class="annot"><a href="#local-6989586621682881002"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881003"><span class="annot"><a href="#local-6989586621682881003"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881004"><span class="annot"><a href="#local-6989586621682881004"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; [LPat GhcRn]
-&gt; [ExpPatType]
-&gt; TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
-&gt; TcM
     ([LPat GhcTc], (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc))))
forall a.
HsMatchContextRn
-&gt; [LPat GhcRn] -&gt; [ExpPatType] -&gt; TcM a -&gt; TcM ([LPat GhcTc], a)
</span><a href="GHC.Tc.Gen.Pat.html#tcMatchPats"><span class="hs-identifier hs-var">tcMatchPats</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext (LIdP (NoGhcTc GhcRn))
HsMatchContextRn
</span><a href="#local-6989586621682880996"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621682880998"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682880993"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
 -&gt; TcM
      ([LPat GhcTc], (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))))
-&gt; TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
-&gt; TcM
     ([LPat GhcTc], (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-281"></span><span>                                           </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; GRHSs GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; GRHSs GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSs"><span class="hs-identifier hs-var">tcGRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext (LIdP (NoGhcTc GhcRn))
HsMatchContextRn
</span><a href="#local-6989586621682880996"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682880984"><span class="hs-identifier hs-var">tc_body</span></a></span><span> </span><span class="annot"><span class="annottext">GRHSs GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881000"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682880994"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-282"></span><span>             </span><span class="hs-comment">-- NB: pats' are just the /value/ patterns</span><span>
</span><span id="line-283"></span><span>             </span><span class="hs-comment">-- See Note [tcMatchPats] in GHC.Tc.Gen.Pat</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881003"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#m_ext"><span class="hs-identifier hs-var">m_ext</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span>
</span><span id="line-286"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#m_ctxt"><span class="hs-identifier hs-var">m_ctxt</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682880996"><span class="hs-identifier hs-type">ctxt</span></a></span><span>
</span><span id="line-287"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881002"><span class="hs-identifier hs-type">pats'</span></a></span><span>
</span><span id="line-288"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881004"><span class="hs-identifier hs-type">grhss'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-comment">-- For (\x -&gt; e), tcExpr has already said &quot;In the expression \x-&gt;e&quot;</span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-comment">--     so we don't want to add &quot;In the lambda abstraction \x-&gt;e&quot;</span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-comment">-- But for \cases with many alternatives, it is helpful to say</span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-comment">--     which particular alternative we are looking at</span><span>
</span><span id="line-294"></span><span>        </span><span id="local-6989586621682881001"><span class="annot"><span class="annottext">add_match_ctxt :: TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881001"><span class="hs-identifier hs-var hs-var">add_match_ctxt</span></a></span></span><span> </span><span id="local-6989586621682881008"><span class="annot"><span class="annottext">TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881008"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsMatchContext (LIdP (NoGhcTc GhcRn))
</span><a href="#local-6989586621682880996"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>            </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LamAlt"><span class="hs-identifier hs-type">LamAlt</span></a></span><span> </span><span class="annot"><span class="annottext">HsLamVariant
</span><a href="Language.Haskell.Syntax.Expr.html#LamSingle"><span class="hs-identifier hs-var">LamSingle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881008"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-296"></span><span>            </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881008"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-comment">-- this is an expanded do stmt</span><span>
</span><span id="line-297"></span><span>            </span><span class="annot"><span class="annottext">HsMatchContext (LIdP (NoGhcTc GhcRn))
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
-&gt; TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Match GhcRn (LocatedA (body GhcRn)) -&gt; SDoc
forall (idR :: Pass) body.
(OutputableBndrId idR, Outputable body) =&gt;
Match (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprMatchInCtxt"><span class="hs-identifier hs-var">pprMatchInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Match GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682880995"><span class="hs-identifier hs-var">match</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM (HsWrapper, Match GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881008"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-300"></span><span id="local-6989586621682880305"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGRHSs"><span class="hs-identifier hs-type">tcGRHSs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880305"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcMatchAltChecker"><span class="hs-identifier hs-type">TcMatchAltChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880305"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880305"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880305"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- Notice that we pass in the full res_ty, so that we get</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- good inference from simple things like</span><span>
</span><span id="line-308"></span><span class="hs-comment">--      f = \(x::forall a.a-&gt;a) -&gt; &lt;stuff&gt;</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- We used to force it to be a monotype when there was more than one guard</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- but we don't need to do that any more</span><span>
</span><span id="line-311"></span><span id="tcGRHSs"><span class="annot"><span class="annottext">tcGRHSs :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; GRHSs GhcRn (LocatedA (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, GRHSs GhcTc (LocatedA (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSs"><span class="hs-identifier hs-var hs-var">tcGRHSs</span></a></span></span><span> </span><span id="local-6989586621682881033"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682881033"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682881034"><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682881034"><span class="hs-identifier hs-var">tc_body</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHSs GhcRn (LocatedA (body GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881035"><span class="annot"><span class="annottext">[LGRHS GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881035"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span id="local-6989586621682881036"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682881036"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881037"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881037"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881038"><span class="annot"><a href="#local-6989586621682881038"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881039"><span class="annot"><a href="#local-6989586621682881039"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881040"><span class="annot"><a href="#local-6989586621682881040"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
-&gt; TcM [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))]
-&gt; TcM
     (HsLocalBinds GhcTc, HsWrapper,
      [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))])
forall thing.
HsLocalBinds GhcRn
-&gt; TcM thing -&gt; TcM (HsLocalBinds GhcTc, HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682881036"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))]
 -&gt; TcM
      (HsLocalBinds GhcTc, HsWrapper,
       [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))]))
-&gt; TcM [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))]
-&gt; TcM
     (HsLocalBinds GhcTc, HsWrapper,
      [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>                                       </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; [LGRHS GhcRn (LocatedA (body GhcRn))]
-&gt; ExpRhoType
-&gt; TcM [LGRHS GhcTc (LocatedA (body GhcTc))]
forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; [LGRHS GhcRn (LocatedA (body GhcRn))]
-&gt; ExpRhoType
-&gt; TcM [LGRHS GhcTc (LocatedA (body GhcTc))]
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSList"><span class="hs-identifier hs-var">tcGRHSList</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682881033"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682881034"><span class="hs-identifier hs-var">tc_body</span></a></span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881035"><span class="hs-identifier hs-var">grhss</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881037"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881039"><span class="hs-identifier hs-type">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#emptyComments"><span class="hs-identifier hs-type">emptyComments</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881040"><span class="hs-identifier hs-type">grhss'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881038"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGRHSList"><span class="hs-identifier hs-type">tcGRHSList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682880365"><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-317"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcMatchAltChecker"><span class="hs-identifier hs-type">TcMatchAltChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-318"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LGRHS"><span class="hs-identifier hs-type">LGRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-319"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LGRHS"><span class="hs-identifier hs-type">LGRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span id="tcGRHSList"><span class="annot"><span class="annottext">tcGRHSList :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
HsMatchContextRn
-&gt; TcMatchAltChecker body
-&gt; [LGRHS GhcRn (LocatedA (body GhcRn))]
-&gt; ExpRhoType
-&gt; TcM [LGRHS GhcTc (LocatedA (body GhcTc))]
</span><a href="GHC.Tc.Gen.Match.html#tcGRHSList"><span class="hs-identifier hs-var hs-var">tcGRHSList</span></a></span></span><span> </span><span id="local-6989586621682881061"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682881061"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682881062"><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682881062"><span class="hs-identifier hs-var">tc_body</span></a></span></span><span> </span><span id="local-6989586621682881063"><span class="annot"><span class="annottext">[LGRHS GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881063"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span id="local-6989586621682881064"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881064"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-321"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881065"><span class="annot"><a href="#local-6989586621682881065"><span class="hs-identifier hs-var">usages</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881066"><span class="annot"><a href="#local-6989586621682881066"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated EpAnnCO (GRHS GhcRn (LocatedA (body GhcRn)))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (UsageEnv,
       GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))))
-&gt; [GenLocated EpAnnCO (GRHS GhcRn (LocatedA (body GhcRn)))]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([UsageEnv],
      [GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc)))])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><span class="hs-identifier hs-var">mapAndUnzipM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GRHS GhcRn (LocatedA (body GhcRn))
 -&gt; TcM (UsageEnv, GRHS GhcTc (LocatedA (body GhcTc))))
-&gt; GenLocated EpAnnCO (GRHS GhcRn (LocatedA (body GhcRn)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (UsageEnv, GenLocated EpAnnCO (GRHS GhcTc (LocatedA (body GhcTc))))
forall a b c ann.
(a -&gt; TcM (b, c))
-&gt; GenLocated (EpAnn ann) a -&gt; TcM (b, GenLocated (EpAnn ann) c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocSndMA"><span class="hs-identifier hs-var">wrapLocSndMA</span></a></span><span> </span><span class="annot"><span class="annottext">GRHS GhcRn (LocatedA (body GhcRn))
-&gt; TcM (UsageEnv, GRHS GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881069"><span class="hs-identifier hs-var">tc_alt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcRn (LocatedA (body GhcRn))]
[GenLocated EpAnnCO (GRHS GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682881063"><span class="hs-identifier hs-var">grhss</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#supUEs"><span class="hs-identifier hs-type">supUEs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881065"><span class="hs-identifier hs-type">usages</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682881066"><span class="hs-identifier hs-type">grhss'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>     </span><span id="local-6989586621682881070"><span class="annot"><span class="annottext">stmt_ctxt :: HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621682881070"><span class="hs-identifier hs-var hs-var">stmt_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext (GenLocated SrcSpanAnnN Name)
-&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsMatchContext fn -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#PatGuard"><span class="hs-identifier hs-var">PatGuard</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621682881061"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>     </span><span class="annot"><a href="#local-6989586621682881069"><span class="hs-identifier hs-type">tc_alt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880365"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>     </span><span id="local-6989586621682881069"><span class="annot"><span class="annottext">tc_alt :: GRHS GhcRn (LocatedA (body GhcRn))
-&gt; TcM (UsageEnv, GRHS GhcTc (LocatedA (body GhcTc)))
</span><a href="#local-6989586621682881069"><span class="hs-identifier hs-var hs-var">tc_alt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS GhcRn (LocatedA (body GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881072"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881072"><span class="hs-identifier hs-var">guards</span></a></span></span><span> </span><span id="local-6989586621682881073"><span class="annot"><span class="annottext">LocatedA (body GhcRn)
</span><a href="#local-6989586621682881073"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (GRHS GhcTc (LocatedA (body GhcTc)))
-&gt; TcM (UsageEnv, GRHS GhcTc (LocatedA (body GhcTc)))
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (GRHS GhcTc (LocatedA (body GhcTc)))
 -&gt; TcM (UsageEnv, GRHS GhcTc (LocatedA (body GhcTc))))
-&gt; TcM (GRHS GhcTc (LocatedA (body GhcTc)))
-&gt; TcM (UsageEnv, GRHS GhcTc (LocatedA (body GhcTc)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-331"></span><span>         </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881074"><span class="annot"><a href="#local-6989586621682881074"><span class="hs-identifier hs-var">guards'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881075"><span class="annot"><a href="#local-6989586621682881075"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>                   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM (LocatedA (body GhcTc)))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      LocatedA (body GhcTc))
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621682881070"><span class="hs-identifier hs-var">stmt_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM thing)
-&gt; TcM
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcGuardStmt"><span class="hs-identifier hs-var">tcGuardStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621682881072"><span class="hs-identifier hs-var">guards</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881064"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpRhoType -&gt; TcM (LocatedA (body GhcTc)))
 -&gt; TcM
      ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
       LocatedA (body GhcTc)))
-&gt; (ExpRhoType -&gt; TcM (LocatedA (body GhcTc)))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      LocatedA (body GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-333"></span><span>                      </span><span class="annot"><span class="annottext">TcMatchAltChecker body
</span><a href="#local-6989586621682881062"><span class="hs-identifier hs-var">tc_body</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (body GhcRn)
</span><a href="#local-6989586621682881073"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-334"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881074"><span class="hs-identifier hs-type">guards'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881075"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{@tcDoStmts@ typechecks a {\em list} of do statements}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-type">tcDoStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoFlavour"><span class="hs-identifier hs-type">HsDoFlavour</span></a></span><span>
</span><span id="line-345"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedL"><span class="hs-identifier hs-type">LocatedL</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-347"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- Returns a HsDo</span><span>
</span><span id="line-348"></span><span id="tcDoStmts"><span class="annot"><span class="annottext">tcDoStmts :: HsDoFlavour
-&gt; LocatedL [GuardLStmt GhcRn] -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var hs-var">tcDoStmts</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#ListComp"><span class="hs-identifier hs-var">ListComp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682881077"><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682881077"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682881078"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881078"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881079"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881079"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881080"><span class="annot"><a href="#local-6989586621682881080"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881079"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881081"><span class="annot"><a href="#local-6989586621682881081"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881082"><span class="annot"><a href="#local-6989586621682881082"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-type">matchExpectedListTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881080"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881084"><span class="annot"><a href="#local-6989586621682881084"><span class="hs-identifier hs-var hs-var">list_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="GHC.Builtin.Types.html#mkListTy"><span class="hs-identifier hs-var">mkListTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881082"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881086"><span class="annot"><a href="#local-6989586621682881086"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmts"><span class="hs-identifier hs-type">tcStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ListComp"><span class="hs-identifier hs-type">ListComp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-type">tcLcStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#listTyCon"><span class="hs-identifier hs-type">listTyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881078"><span class="hs-identifier hs-type">stmts</span></a></span><span>
</span><span id="line-353"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881082"><span class="hs-identifier hs-type">elt_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-type">mkHsWrapCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881081"><span class="hs-identifier hs-type">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881084"><span class="hs-identifier hs-type">list_ty</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ListComp"><span class="hs-identifier hs-type">ListComp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881077"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881086"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span id="local-6989586621682881091"><span class="annot"><span class="annottext">doExpr :: HsDoFlavour
</span><a href="#local-6989586621682881091"><span class="hs-identifier hs-var">doExpr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-type">DoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881093"><span class="annot"><span class="annottext">ss :: LocatedL [GuardLStmt GhcRn]
</span><a href="#local-6989586621682881093"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682881094"><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682881094"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682881095"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881095"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881096"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881096"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881097"><span class="annot"><a href="#local-6989586621682881097"><span class="hs-identifier hs-var">isApplicativeDo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ApplicativeDo</span></span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682881097"><span class="hs-identifier hs-type">isApplicativeDo</span></a></span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881100"><span class="annot"><a href="#local-6989586621682881100"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmts"><span class="hs-identifier hs-type">tcStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881091"><span class="hs-identifier hs-type">doExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-type">tcDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881095"><span class="hs-identifier hs-type">stmts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881096"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-360"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881101"><span class="annot"><a href="#local-6989586621682881101"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881096"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-361"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881101"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881091"><span class="hs-identifier hs-type">doExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881094"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881100"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-362"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881102"><span class="annot"><a href="#local-6989586621682881102"><span class="hs-identifier hs-var">expanded_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Do.html#expandDoStmts"><span class="hs-identifier hs-type">expandDoStmts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881091"><span class="hs-identifier hs-type">doExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881095"><span class="hs-identifier hs-type">stmts</span></a></span><span>
</span><span id="line-363"></span><span>                                               </span><span class="hs-comment">-- Do expansion on the fly</span><span>
</span><span id="line-364"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExprTc"><span class="hs-identifier hs-type">mkExpandedExprTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881091"><span class="hs-identifier hs-type">doExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881093"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-type">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881102"><span class="hs-identifier hs-type">expanded_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881096"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span id="local-6989586621682881108"><span class="annot"><span class="annottext">mDoExpr :: HsDoFlavour
</span><a href="#local-6989586621682881108"><span class="hs-identifier hs-var">mDoExpr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MDoExpr"><span class="hs-identifier hs-type">MDoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881110"><span class="annot"><span class="annottext">ss :: LocatedL [GuardLStmt GhcRn]
</span><a href="#local-6989586621682881110"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881111"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881111"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881112"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881112"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881113"><span class="annot"><a href="#local-6989586621682881113"><span class="hs-identifier hs-var">expanded_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDoFlavour -&gt; [GuardLStmt GhcRn] -&gt; TcM (LHsExpr GhcRn)
</span><a href="GHC.Tc.Gen.Do.html#expandDoStmts"><span class="hs-identifier hs-var">expandDoStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621682881108"><span class="hs-identifier hs-var">mDoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881111"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-comment">-- Do expansion on the fly</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#mkExpandedExprTc"><span class="hs-identifier hs-type">mkExpandedExprTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-type">noExtField</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881108"><span class="hs-identifier hs-type">mDoExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881110"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-type">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881113"><span class="hs-identifier hs-type">expanded_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881112"><span class="hs-identifier hs-type">res_ty</span></a></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#MonadComp"><span class="hs-identifier hs-var">MonadComp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682881115"><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682881115"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682881116"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881116"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881117"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881117"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881118"><span class="annot"><a href="#local-6989586621682881118"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; TcM [LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))]
forall (body :: * -&gt; *) rho_type.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; TcM [LStmt GhcTc (LocatedA (body GhcTc))]
</span><a href="GHC.Tc.Gen.Match.html#tcStmts"><span class="hs-identifier hs-var">tcStmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#MonadComp"><span class="hs-identifier hs-var">MonadComp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM thing)
-&gt; TcM
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621682881116"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881117"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881120"><span class="annot"><a href="#local-6989586621682881120"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881117"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881120"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MonadComp"><span class="hs-identifier hs-type">MonadComp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881115"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881118"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-375"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span id="local-6989586621682881121"><span class="annot"><span class="annottext">ctxt :: HsDoFlavour
</span><a href="#local-6989586621682881121"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#GhciStmtCtxt"><span class="hs-identifier hs-var">GhciStmtCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedL [GuardLStmt GhcRn]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcDoStmts&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprHsDoFlavour"><span class="hs-identifier hs-var">pprHsDoFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621682881121"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-type">tcBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span id="tcBody"><span class="annot"><span class="annottext">tcBody :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var hs-var">tcBody</span></a></span></span><span> </span><span id="local-6989586621682881125"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881125"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682881126"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881126"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcBody&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881126"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyLExpr"><span class="hs-identifier hs-var">tcPolyLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881125"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881126"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcBodyNC"><span class="hs-identifier hs-type">tcBodyNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span id="tcBodyNC"><span class="annot"><span class="annottext">tcBodyNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBodyNC"><span class="hs-identifier hs-var hs-var">tcBodyNC</span></a></span></span><span> </span><span id="local-6989586621682881127"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881127"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682881128"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881128"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcBodyNC&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881128"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881127"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881128"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{tcStmts}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-keyword">type</span><span> </span><span id="TcExprStmtChecker"><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcExprStmtChecker"><span class="hs-identifier hs-var">TcExprStmtChecker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcStmtChecker"><span class="hs-identifier hs-type">TcStmtChecker</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-398"></span><span class="hs-keyword">type</span><span> </span><span id="TcCmdStmtChecker"><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcCmdStmtChecker"><span class="hs-identifier hs-var">TcCmdStmtChecker</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcStmtChecker"><span class="hs-identifier hs-type">TcStmtChecker</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmd"><span class="hs-identifier hs-type">HsCmd</span></a></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-keyword">type</span><span> </span><span id="TcStmtChecker"><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcStmtChecker"><span class="hs-identifier hs-var">TcStmtChecker</span></a></span></span><span> </span><span id="local-6989586621682881131"><span class="annot"><a href="#local-6989586621682881131"><span class="hs-identifier hs-type">body</span></a></span></span><span> </span><span id="local-6989586621682881132"><span class="annot"><a href="#local-6989586621682881132"><span class="hs-identifier hs-type">rho_type</span></a></span></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682881133"><span class="annot"><a href="#local-6989586621682881133"><span class="hs-identifier hs-type">thing</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-402"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881131"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682881132"><span class="hs-identifier hs-type">rho_type</span></a></span><span>                 </span><span class="hs-comment">-- Result type for comprehension</span><span>
</span><span id="line-404"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881132"><span class="hs-identifier hs-type">rho_type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881133"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Checker for what follows the stmt</span><span>
</span><span id="line-405"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Stmt"><span class="hs-identifier hs-type">Stmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881131"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881133"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span id="local-6989586621682880394"><span id="local-6989586621682880395"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmts"><span class="hs-identifier hs-type">tcStmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880394"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcStmtChecker"><span class="hs-identifier hs-type">TcStmtChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880394"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880395"><span class="hs-identifier hs-type">rho_type</span></a></span><span>   </span><span class="hs-comment">-- NB: higher-rank type</span><span>
</span><span id="line-409"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880394"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682880395"><span class="hs-identifier hs-type">rho_type</span></a></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880394"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-412"></span><span id="tcStmts"><span class="annot"><span class="annottext">tcStmts :: forall (body :: * -&gt; *) rho_type.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; TcM [LStmt GhcTc (LocatedA (body GhcTc))]
</span><a href="GHC.Tc.Gen.Match.html#tcStmts"><span class="hs-identifier hs-var hs-var">tcStmts</span></a></span></span><span> </span><span id="local-6989586621682881153"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881153"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682881154"><span class="annot"><span class="annottext">TcStmtChecker body rho_type
</span><a href="#local-6989586621682881154"><span class="hs-identifier hs-var">stmt_chk</span></a></span></span><span> </span><span id="local-6989586621682881155"><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881155"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621682881156"><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881156"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881157"><span class="annot"><a href="#local-6989586621682881157"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcRn ())
-&gt; TcM
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], ())
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881153"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; Stmt GhcRn (LocatedA (body GhcRn))
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)), thing)
TcStmtChecker body rho_type
</span><a href="#local-6989586621682881154"><span class="hs-identifier hs-var">stmt_chk</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881155"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881156"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((rho_type -&gt; TcRn ())
 -&gt; TcM
      ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], ()))
-&gt; (rho_type -&gt; TcRn ())
-&gt; TcM
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-414"></span><span>                        </span><span class="annot"><span class="annottext">TcRn () -&gt; rho_type -&gt; TcRn ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682881157"><span class="hs-identifier hs-type">stmts'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span id="local-6989586621682880386"><span id="local-6989586621682880387"><span id="local-6989586621682880388"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-type">tcStmtsAndThen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880386"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-418"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcStmtChecker"><span class="hs-identifier hs-type">TcStmtChecker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880386"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880387"><span class="hs-identifier hs-type">rho_type</span></a></span><span>    </span><span class="hs-comment">-- NB: higher-rank type</span><span>
</span><span id="line-419"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880386"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-420"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682880387"><span class="hs-identifier hs-type">rho_type</span></a></span><span>
</span><span id="line-421"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880387"><span class="hs-identifier hs-type">rho_type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880388"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LStmt"><span class="hs-identifier hs-type">LStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880386"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682880388"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- Note the higher-rank type.  stmt_chk is applied at different</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- types in the equations for tcStmts</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span id="tcStmtsAndThen"><span class="annot"><span class="annottext">tcStmtsAndThen :: forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var hs-var">tcStmtsAndThen</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TcStmtChecker body rho_type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682881192"><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881192"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881193"><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881193"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881194"><span class="annot"><a href="#local-6989586621682881194"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881193"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881192"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881194"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- LetStmts are handled uniformly, regardless of context</span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span id="local-6989586621682881195"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881195"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682881196"><span class="annot"><span class="annottext">TcStmtChecker body rho_type
</span><a href="#local-6989586621682881196"><span class="hs-identifier hs-var">stmt_chk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682881197"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682881197"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span id="local-6989586621682881199"><span class="annot"><span class="annottext">XLetStmt GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881199"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682881200"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682881200"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682881201"><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881201"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>                                                             </span><span id="local-6989586621682881202"><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881202"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881203"><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881203"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881204"><span class="annot"><a href="#local-6989586621682881204"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881205"><span class="annot"><a href="#local-6989586621682881205"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682881206"><span class="annot"><a href="#local-6989586621682881206"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
      thing)
-&gt; TcM
     (HsLocalBinds GhcTc, HsWrapper,
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall thing.
HsLocalBinds GhcRn
-&gt; TcM thing -&gt; TcM (HsLocalBinds GhcTc, HsWrapper, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621682881200"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   ([GenLocated
       SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
    thing)
 -&gt; TcM
      (HsLocalBinds GhcTc, HsWrapper,
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing)))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
      thing)
-&gt; TcM
     (HsLocalBinds GhcTc, HsWrapper,
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-435"></span><span>              </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing)
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881195"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)), thing)
TcStmtChecker body rho_type
</span><a href="#local-6989586621682881196"><span class="hs-identifier hs-var">stmt_chk</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881201"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881202"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881203"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881197"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881199"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881204"><span class="hs-identifier hs-type">binds'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682881205"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881206"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="hs-comment">-- Don't set the error context for an ApplicativeStmt.  It ought to be</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- possible to do this with a popErrCtxt in the tcStmt case for</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- ApplicativeStmt, but it did something strange and broke a test (ado002).</span><span>
</span><span id="line-441"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span id="local-6989586621682881207"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881207"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682881208"><span class="annot"><span class="annottext">TcStmtChecker body rho_type
</span><a href="#local-6989586621682881208"><span class="hs-identifier hs-var">stmt_chk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682881209"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682881209"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682881210"><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881210"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682881211"><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881211"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881212"><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881212"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881213"><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881213"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-type">ApplicativeStmt</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881210"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881215"><span class="annot"><a href="#local-6989586621682881215"><span class="hs-identifier hs-var">stmt'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881216"><span class="annot"><a href="#local-6989586621682881216"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881217"><span class="annot"><a href="#local-6989586621682881217"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-444"></span><span>             </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
-&gt; rho_type
-&gt; (rho_type
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         ([GenLocated
             SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
          thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
TcStmtChecker body rho_type
</span><a href="#local-6989586621682881208"><span class="hs-identifier hs-var">stmt_chk</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881207"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881210"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881212"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((rho_type
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing))
 -&gt; TcM
      (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing)))
-&gt; (rho_type
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         ([GenLocated
             SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
          thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682881218"><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881218"><span class="hs-identifier hs-var">res_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>               </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing)
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881207"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)), thing)
TcStmtChecker body rho_type
</span><a href="#local-6989586621682881208"><span class="hs-identifier hs-var">stmt_chk</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881211"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881218"><span class="hs-identifier hs-var">res_ty'</span></a></span><span>  </span><span class="annot"><span class="annottext">((rho_type -&gt; TcM thing)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing))
-&gt; (rho_type -&gt; TcM thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-446"></span><span>                 </span><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881213"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881209"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881215"><span class="hs-identifier hs-type">stmt'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682881216"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881217"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- For the vanilla case, handle the location-setting part</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881219"><span class="annot"><a href="#local-6989586621682881219"><span class="hs-identifier hs-var">stmt'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881220"><span class="annot"><a href="#local-6989586621682881220"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881221"><span class="annot"><a href="#local-6989586621682881221"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-452"></span><span>                </span><span class="annot"><span class="annottext">SrcSpanAnnA
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682881209"><span class="hs-identifier hs-var">loc</span></a></span><span>                             </span><span class="annot"><span class="annottext">(TcM
   (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
    ([GenLocated
        SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
     thing))
 -&gt; TcM
      (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing)))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-453"></span><span>                </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContext (GenLocated SrcSpanAnnN Name)
-&gt; StmtLR GhcRn GhcRn (LocatedA (body GhcRn)) -&gt; SDoc
forall (idL :: Pass) (idR :: Pass) fn body.
(OutputableBndrId idL, OutputableBndrId idR, Outputable fn,
 Outputable body,
 Anno (StmtLR (GhcPass idL) (GhcPass idR) body) ~ SrcSpanAnnA) =&gt;
HsStmtContext fn -&gt; StmtLR (GhcPass idL) (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprStmtInCtxt"><span class="hs-identifier hs-var">pprStmtInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621682881207"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881210"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>        </span><span class="annot"><span class="annottext">(TcM
   (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
    ([GenLocated
        SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
     thing))
 -&gt; TcM
      (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing)))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-454"></span><span>                </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
-&gt; rho_type
-&gt; (rho_type
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         ([GenLocated
             SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
          thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
TcStmtChecker body rho_type
</span><a href="#local-6989586621682881208"><span class="hs-identifier hs-var">stmt_chk</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881207"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
</span><a href="#local-6989586621682881210"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881212"><span class="hs-identifier hs-var">res_ty</span></a></span><span>                   </span><span class="annot"><span class="annottext">((rho_type
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing))
 -&gt; TcM
      (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
       ([GenLocated
           SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
        thing)))
-&gt; (rho_type
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         ([GenLocated
             SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
          thing))
-&gt; TcM
     (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)),
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682881224"><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881224"><span class="hs-identifier hs-var">res_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-455"></span><span>                </span><span class="annot"><span class="annottext">IOEnv
  (Env TcGblEnv TcLclEnv)
  ([GenLocated
      SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
   thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
      thing)
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-var">popErrCtxt</span></a></span><span>                                  </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv)
   ([GenLocated
       SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
    thing)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      ([GenLocated
          SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
       thing))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
      thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([GenLocated
         SrcSpanAnnA (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))],
      thing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-456"></span><span>                </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing)
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881207"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; StmtLR GhcRn GhcRn (LocatedA (body GhcRn))
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)), thing)
TcStmtChecker body rho_type
</span><a href="#local-6989586621682881208"><span class="hs-identifier hs-var">stmt_chk</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (LocatedA (body GhcRn))]
</span><a href="#local-6989586621682881211"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">rho_type
</span><a href="#local-6989586621682881224"><span class="hs-identifier hs-var">res_ty'</span></a></span><span>  </span><span class="annot"><span class="annottext">((rho_type -&gt; TcM thing)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing))
-&gt; (rho_type -&gt; TcM thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([XRec GhcTc (StmtLR GhcTc GhcTc (LocatedA (body GhcTc)))], thing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-457"></span><span>                </span><span class="annot"><span class="annottext">rho_type -&gt; TcM thing
</span><a href="#local-6989586621682881213"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881209"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881219"><span class="hs-identifier hs-type">stmt'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682881220"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881221"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-461"></span><span class="hs-comment">--              Pattern guards</span><span>
</span><span id="line-462"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGuardStmt"><span class="hs-identifier hs-type">tcGuardStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcExprStmtChecker"><span class="hs-identifier hs-type">TcExprStmtChecker</span></a></span><span>
</span><span id="line-465"></span><span id="tcGuardStmt"><span class="annot"><span class="annottext">tcGuardStmt :: TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcGuardStmt"><span class="hs-identifier hs-var hs-var">tcGuardStmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881245"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881245"><span class="hs-identifier hs-var">guard</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881246"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881246"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881247"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881247"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881248"><span class="annot"><a href="#local-6989586621682881248"><span class="hs-identifier hs-var">guard'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881245"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-467"></span><span>          </span><span class="hs-comment">-- Scale the guard to Many (see #19120 and #19193)</span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881251"><span class="annot"><a href="#local-6989586621682881251"><span class="hs-identifier hs-var">thing</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881247"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881246"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-type">boolTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881248"><span class="hs-identifier hs-type">guard'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881251"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGuardStmt"><span class="hs-identifier hs-var">tcGuardStmt</span></a></span><span> </span><span id="local-6989586621682881253"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881253"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881255"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682881255"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682881256"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881256"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881257"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881257"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881258"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881258"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- The Many on the next line and the unrestricted on the line after</span><span>
</span><span id="line-473"></span><span>          </span><span class="hs-comment">-- are linked. These must be the same multiplicity. Consider</span><span>
</span><span id="line-474"></span><span>          </span><span class="hs-comment">--   x &lt;- rhs -&gt; u</span><span>
</span><span id="line-475"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-476"></span><span>          </span><span class="hs-comment">-- The multiplicity of x in u must be the same as the multiplicity at</span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-comment">-- which the rhs has been consumed. When solving #18738, we want these</span><span>
</span><span id="line-478"></span><span>          </span><span class="hs-comment">-- two multiplicity to still be the same.</span><span>
</span><span id="line-479"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682881259"><span class="annot"><a href="#local-6989586621682881259"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881260"><span class="annot"><a href="#local-6989586621682881260"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc, Mult) -&gt; TcM (LHsExpr GhcTc, Mult)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Mult) -&gt; TcM (LHsExpr GhcTc, Mult))
-&gt; TcM (LHsExpr GhcTc, Mult) -&gt; TcM (LHsExpr GhcTc, Mult)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Mult)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881256"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-480"></span><span>                                   </span><span class="hs-comment">-- Stmt has a context already</span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBindStmtGuard"><span class="hs-identifier hs-type">FRRBindStmtGuard</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881260"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-482"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881262"><span class="annot"><a href="#local-6989586621682881262"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881263"><span class="annot"><a href="#local-6989586621682881263"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-type">tcCheckPat_O</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881253"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#lexprCtOrigin"><span class="hs-identifier hs-type">lexprCtOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881256"><span class="hs-identifier hs-type">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>                                         </span><span class="annot"><a href="#local-6989586621682881255"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881260"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-484"></span><span>                            </span><span class="annot"><a href="#local-6989586621682881258"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881257"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkTcBindStmt"><span class="hs-identifier hs-type">mkTcBindStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881262"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881259"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881263"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcGuardStmt"><span class="hs-identifier hs-var">tcGuardStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881268"><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881268"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-488"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcGuardStmt: unexpected Stmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881268"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-492"></span><span class="hs-comment">--           List comprehensions</span><span>
</span><span id="line-493"></span><span class="hs-comment">--               (no rebindable syntax)</span><span>
</span><span id="line-494"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="hs-comment">-- Dealt with separately, rather than by tcMcStmt, because</span><span>
</span><span id="line-497"></span><span class="hs-comment">--   a) We have special desugaring rules for list comprehensions,</span><span>
</span><span id="line-498"></span><span class="hs-comment">--      which avoid creating intermediate lists.  They in turn</span><span>
</span><span id="line-499"></span><span class="hs-comment">--      assume that the bind/return operations are the regular</span><span>
</span><span id="line-500"></span><span class="hs-comment">--      polymorphic ones, and in particular don't have any</span><span>
</span><span id="line-501"></span><span class="hs-comment">--      coercion matching stuff in them.  It's hard to avoid the</span><span>
</span><span id="line-502"></span><span class="hs-comment">--      potential for non-trivial coercions in tcMcStmt</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-type">tcLcStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>       </span><span class="hs-comment">-- The list type constructor ([])</span><span>
</span><span id="line-505"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcExprStmtChecker"><span class="hs-identifier hs-type">TcExprStmtChecker</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span id="tcLcStmt"><span class="annot"><span class="annottext">tcLcStmt :: TyCon -&gt; TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var hs-var">tcLcStmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span id="local-6989586621682881332"><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881332"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682881333"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881333"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682881334"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682881334"><span class="hs-identifier hs-var">noret</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881335"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881335"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span> </span><span id="local-6989586621682881336"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881336"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881337"><span class="annot"><a href="#local-6989586621682881337"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881333"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881335"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-509"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881338"><span class="annot"><a href="#local-6989586621682881338"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881336"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcLcStmt: thing_inside&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881332"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881337"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881334"><span class="hs-identifier hs-type">noret</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881338"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-comment">-- A generator, pat &lt;- rhs</span><span>
</span><span id="line-513"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span id="local-6989586621682881339"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682881339"><span class="hs-identifier hs-var">m_tc</span></a></span></span><span> </span><span id="local-6989586621682881340"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881340"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881341"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682881341"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682881342"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881342"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881343"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881343"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span> </span><span id="local-6989586621682881344"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881344"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-514"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881345"><span class="annot"><a href="#local-6989586621682881345"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881348"><span class="annot"><a href="#local-6989586621682881348"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-type">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881342"><span class="hs-identifier hs-type">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881339"><span class="hs-identifier hs-type">m_tc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682881345"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881350"><span class="annot"><a href="#local-6989586621682881350"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881351"><span class="annot"><a href="#local-6989586621682881351"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881340"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881341"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881345"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-517"></span><span>                            </span><span class="annot"><a href="#local-6989586621682881344"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881343"><span class="hs-identifier hs-type">elt_ty</span></a></span><span>
</span><span id="line-518"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkTcBindStmt"><span class="hs-identifier hs-type">mkTcBindStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881350"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881348"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881351"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="hs-comment">-- A boolean guard</span><span>
</span><span id="line-521"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881353"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881353"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881354"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881354"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span> </span><span id="local-6989586621682881355"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881355"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881356"><span class="annot"><a href="#local-6989586621682881356"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881353"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881357"><span class="annot"><a href="#local-6989586621682881357"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881355"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881354"><span class="hs-identifier hs-type">elt_ty</span></a></span><span>
</span><span id="line-524"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-type">boolTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881356"><span class="hs-identifier hs-type">rhs'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881357"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="hs-comment">-- ParStmt: See notes with tcMcStmt and Note [Scoping in parallel list comprehensions]</span><span>
</span><span id="line-527"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span id="local-6989586621682881358"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682881358"><span class="hs-identifier hs-var">m_tc</span></a></span></span><span> </span><span id="local-6989586621682881359"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881359"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XParStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881361"><span class="annot"><span class="annottext">[ParStmtBlock GhcRn GhcRn]
</span><a href="#local-6989586621682881361"><span class="hs-identifier hs-var">bndr_stmts_s</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881362"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881362"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span> </span><span id="local-6989586621682881363"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881363"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881364"><span class="annot"><a href="#local-6989586621682881364"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881366"><span class="annot"><a href="#local-6989586621682881366"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881367"><span class="annot"><a href="#local-6989586621682881367"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881368"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881364"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682881361"><span class="hs-identifier hs-type">bndr_stmts_s</span></a></span><span>
</span><span id="line-530"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-type">unitTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881366"><span class="hs-identifier hs-type">pairs'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noExpr"><span class="hs-identifier hs-type">noExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881367"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-comment">-- loop :: LocalRdrEnv -- The original LocalRdrEnv</span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-comment">--      -&gt; [Name]      -- Variables bound by earlier branches</span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-comment">--      -&gt; [([LStmt GhcRn], [GhcRn])]</span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-comment">--      -&gt; TcM ([([LStmt GhcTc], [GhcTc])], thing)</span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-comment">-- Invariant: on entry to `loop`, the LocalRdrEnv is set to</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">--            origEnv, the LocalRdrEnv for the entire comprehension</span><span>
</span><span id="line-539"></span><span>    </span><span id="local-6989586621682881368"><span class="annot"><span class="annottext">loop :: LocalRdrEnv
-&gt; [Name]
-&gt; [ParStmtBlock GhcRn GhcRn]
-&gt; RnM ([ParStmtBlock GhcTc GhcTc], thing)
</span><a href="#local-6989586621682881368"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881371"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881371"><span class="hs-identifier hs-var">allBinds</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881372"><span class="annot"><a href="#local-6989586621682881372"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; TcM thing -&gt; TcM thing
forall a. [Name] -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Rename.Utils.html#bindLocalNames"><span class="hs-identifier hs-var">bindLocalNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881371"><span class="hs-identifier hs-var">allBinds</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM thing -&gt; TcM thing) -&gt; TcM thing -&gt; TcM thing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881363"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881362"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-540"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881372"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>   </span><span class="hs-comment">-- matching in the branches</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>    </span><span class="annot"><a href="#local-6989586621682881368"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621682881373"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621682881373"><span class="hs-identifier hs-var">origEnv</span></a></span></span><span> </span><span id="local-6989586621682881374"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881374"><span class="hs-identifier hs-var">priorBinds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span id="local-6989586621682881376"><span class="annot"><span class="annottext">XParStmtBlock GhcRn GhcRn
</span><a href="#local-6989586621682881376"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682881377"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881377"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621682881378"><span class="annot"><span class="annottext">[IdP GhcRn]
</span><a href="#local-6989586621682881378"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682881379"><span class="annot"><span class="annottext">[ParStmtBlock GhcRn GhcRn]
</span><a href="#local-6989586621682881379"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881380"><span class="annot"><a href="#local-6989586621682881380"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881381"><span class="annot"><a href="#local-6989586621682881381"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881382"><span class="annot"><a href="#local-6989586621682881382"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881383"><span class="annot"><a href="#local-6989586621682881383"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM ([Id], [ParStmtBlock GhcTc GhcTc], thing))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      ([Id], [ParStmtBlock GhcTc GhcTc], thing))
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881359"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682881358"><span class="hs-identifier hs-var">m_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621682881377"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881362"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpRhoType -&gt; TcM ([Id], [ParStmtBlock GhcTc GhcTc], thing))
 -&gt; TcM
      ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
       ([Id], [ParStmtBlock GhcTc GhcTc], thing)))
-&gt; (ExpRhoType -&gt; TcM ([Id], [ParStmtBlock GhcTc GhcTc], thing))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      ([Id], [ParStmtBlock GhcTc GhcTc], thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682881384"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881384"><span class="hs-identifier hs-var">_elt_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-545"></span><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881385"><span class="annot"><a href="#local-6989586621682881385"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; TcM [Id]
</span><a href="GHC.Tc.Utils.Env.html#tcLookupLocalIds"><span class="hs-identifier hs-var">tcLookupLocalIds</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621682881378"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-546"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881387"><span class="annot"><a href="#local-6989586621682881387"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881388"><span class="annot"><a href="#local-6989586621682881388"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier hs-type">setLocalRdrEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881373"><span class="hs-identifier hs-type">origEnv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-547"></span><span>                          </span><span class="annot"><a href="#local-6989586621682881368"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881373"><span class="hs-identifier hs-type">origEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881378"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621682881374"><span class="hs-identifier hs-type">priorBinds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881379"><span class="hs-identifier hs-type">pairs</span></a></span><span>
</span><span id="line-548"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881385"><span class="hs-identifier hs-type">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881387"><span class="hs-identifier hs-type">pairs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881388"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-549"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881376"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881380"><span class="hs-identifier hs-type">stmts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881381"><span class="hs-identifier hs-type">ids</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682881382"><span class="hs-identifier hs-type">pairs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881383"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span id="local-6989586621682881390"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682881390"><span class="hs-identifier hs-var">m_tc</span></a></span></span><span> </span><span id="local-6989586621682881391"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881391"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">trS_form :: forall idL idR body. StmtLR idL idR body -&gt; TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#trS_form"><span class="hs-identifier hs-var">trS_form</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881394"><span class="annot"><span class="annottext">TransForm
</span><a href="#local-6989586621682881394"><span class="hs-identifier hs-var">form</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_stmts :: forall idL idR body. StmtLR idL idR body -&gt; [ExprLStmt idL]
</span><a href="Language.Haskell.Syntax.Expr.html#trS_stmts"><span class="hs-identifier hs-var">trS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881396"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881396"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-552"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_bndrs :: forall idL idR body. StmtLR idL idR body -&gt; [(IdP idR, IdP idR)]
</span><a href="Language.Haskell.Syntax.Expr.html#trS_bndrs"><span class="hs-identifier hs-var">trS_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span id="local-6989586621682881398"><span class="annot"><span class="annottext">[(IdP GhcRn, IdP GhcRn)]
</span><a href="#local-6989586621682881398"><span class="hs-identifier hs-var">bindersMap</span></a></span></span><span>
</span><span id="line-553"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_by :: forall idL idR body. StmtLR idL idR body -&gt; Maybe (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Expr.html#trS_by"><span class="hs-identifier hs-var">trS_by</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881400"><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
</span><a href="#local-6989586621682881400"><span class="hs-identifier hs-var">by</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_using :: forall idL idR body. StmtLR idL idR body -&gt; LHsExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#trS_using"><span class="hs-identifier hs-var">trS_using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881402"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881402"><span class="hs-identifier hs-var">using</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881403"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881403"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span> </span><span id="local-6989586621682881404"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881404"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881405"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881405"><span class="hs-identifier hs-var hs-var">bndr_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881406"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881406"><span class="hs-identifier hs-var hs-var">n_bndr_names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Name)] -&gt; ([Name], [Name])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(IdP GhcRn, IdP GhcRn)]
[(Name, Name)]
</span><a href="#local-6989586621682881398"><span class="hs-identifier hs-var">bindersMap</span></a></span><span>
</span><span id="line-555"></span><span>             </span><span id="local-6989586621682881407"><span class="annot"><span class="annottext">unused_ty :: ExpRhoType
</span><a href="#local-6989586621682881407"><span class="hs-identifier hs-var hs-var hs-var">unused_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ExpRhoType
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcLcStmt: inner ty&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, Name)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[(IdP GhcRn, IdP GhcRn)]
[(Name, Name)]
</span><a href="#local-6989586621682881398"><span class="hs-identifier hs-var">bindersMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>             </span><span class="hs-comment">-- The inner 'stmts' lack a LastStmt, so the element type</span><span>
</span><span id="line-557"></span><span>             </span><span class="hs-comment">--  passed in to tcStmtsAndThen is never looked at</span><span>
</span><span id="line-558"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881408"><span class="annot"><a href="#local-6989586621682881408"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881409"><span class="annot"><a href="#local-6989586621682881409"><span class="hs-identifier hs-var">bndr_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881410"><span class="annot"><a href="#local-6989586621682881410"><span class="hs-identifier hs-var">by'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; (ExpRhoType
    -&gt; TcM ([Id], Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      ([Id], Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)))
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContext (GenLocated SrcSpanAnnN Name)
-&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsStmtContext fn -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#TransStmtCtxt"><span class="hs-identifier hs-var">TransStmtCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621682881391"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682881390"><span class="hs-identifier hs-var">m_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621682881396"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881407"><span class="hs-identifier hs-var">unused_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpRhoType
  -&gt; TcM ([Id], Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)))
 -&gt; TcM
      ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
       ([Id], Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult))))
-&gt; (ExpRhoType
    -&gt; TcM ([Id], Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      ([Id], Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>               </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881412"><span class="annot"><a href="#local-6989586621682881412"><span class="hs-identifier hs-var">by'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult))
-&gt; Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Mult)
GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
Maybe (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881400"><span class="hs-identifier hs-var">by</span></a></span><span>
</span><span id="line-561"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881414"><span class="annot"><a href="#local-6989586621682881414"><span class="hs-identifier hs-var">bndr_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupLocalIds"><span class="hs-identifier hs-type">tcLookupLocalIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881405"><span class="hs-identifier hs-type">bndr_names</span></a></span><span>
</span><span id="line-562"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881414"><span class="hs-identifier hs-type">bndr_ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881412"><span class="hs-identifier hs-type">by'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881415"><span class="annot"><a href="#local-6989586621682881415"><span class="hs-identifier hs-var hs-var">m_app</span></a></span></span><span> </span><span id="local-6989586621682881416"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881416"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Mult] -&gt; Mult
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682881390"><span class="hs-identifier hs-var">m_tc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881416"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>       </span><span class="hs-comment">--------------- Typecheck the 'using' function -------------</span><span>
</span><span id="line-567"></span><span>       </span><span class="hs-comment">-- using :: ((a,b,c)-&gt;t) -&gt; m (a,b,c) -&gt; m (a,b,c)m      (ThenForm)</span><span>
</span><span id="line-568"></span><span>       </span><span class="hs-comment">--       :: ((a,b,c)-&gt;t) -&gt; m (a,b,c) -&gt; m (m (a,b,c)))  (GroupForm)</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>         </span><span class="hs-comment">-- n_app :: Type -&gt; Type   -- Wraps a 'ty' into '[ty]' for GroupForm</span><span>
</span><span id="line-571"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881417"><span class="annot"><a href="#local-6989586621682881417"><span class="hs-identifier hs-var hs-var">n_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TransForm
</span><a href="#local-6989586621682881394"><span class="hs-identifier hs-var">form</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-572"></span><span>                       </span><span class="annot"><span class="annottext">TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#ThenForm"><span class="hs-identifier hs-var">ThenForm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682881419"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881419"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881419"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>                       </span><span class="annot"><span class="annottext">TransForm
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881415"><span class="hs-identifier hs-var">m_app</span></a></span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>             </span><span class="annot"><a href="#local-6989586621682881420"><span class="hs-identifier hs-type">by_arrow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>     </span><span class="hs-comment">-- Wraps 'ty' to '(a-&gt;t) -&gt; ty' if the By is present</span><span>
</span><span id="line-576"></span><span>             </span><span id="local-6989586621682881420"><span class="annot"><a href="#local-6989586621682881420"><span class="hs-identifier hs-var hs-var">by_arrow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)
</span><a href="#local-6989586621682881410"><span class="hs-identifier hs-var">by'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-577"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881422"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881422"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881422"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-578"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682881423"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881423"><span class="hs-identifier hs-var">e_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881424"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881424"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881423"><span class="hs-identifier hs-var">e_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881424"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>             </span><span id="local-6989586621682881427"><span class="annot"><a href="#local-6989586621682881427"><span class="hs-identifier hs-var hs-var">tup_ty</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Mult
HasDebugCallStack =&gt; [Id] -&gt; Mult
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881409"><span class="hs-identifier hs-var">bndr_ids</span></a></span><span>
</span><span id="line-581"></span><span>             </span><span id="local-6989586621682881429"><span class="annot"><a href="#local-6989586621682881429"><span class="hs-identifier hs-var hs-var">poly_arg_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881415"><span class="hs-identifier hs-var">m_app</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span>
</span><span id="line-582"></span><span>             </span><span id="local-6989586621682881430"><span class="annot"><a href="#local-6989586621682881430"><span class="hs-identifier hs-var hs-var">poly_res_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881415"><span class="hs-identifier hs-var">m_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881417"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>             </span><span id="local-6989586621682881431"><span class="annot"><a href="#local-6989586621682881431"><span class="hs-identifier hs-var hs-var">using_poly_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkInfForAllTy"><span class="hs-identifier hs-var">mkInfForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.Prim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-584"></span><span>                             </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881420"><span class="hs-identifier hs-var">by_arrow</span></a></span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-585"></span><span>                             </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881429"><span class="hs-identifier hs-var">poly_arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881430"><span class="hs-identifier hs-var">poly_res_ty</span></a></span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881434"><span class="annot"><a href="#local-6989586621682881434"><span class="hs-identifier hs-var">using'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881402"><span class="hs-identifier hs-type">using</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881431"><span class="hs-identifier hs-type">using_poly_ty</span></a></span><span>
</span><span id="line-588"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881435"><span class="annot"><a href="#local-6989586621682881435"><span class="hs-identifier hs-var hs-var">final_using</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a b.
(a -&gt; b) -&gt; GenLocated SrcSpanAnnA a -&gt; GenLocated SrcSpanAnnA b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-var">WpTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881427"><span class="hs-identifier hs-var">tup_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682881434"><span class="hs-identifier hs-var">using'</span></a></span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>             </span><span class="hs-comment">-- 'stmts' returns a result of type (m1_ty tuple_ty),</span><span>
</span><span id="line-591"></span><span>             </span><span class="hs-comment">-- typically something like [(Int,Bool,Int)]</span><span>
</span><span id="line-592"></span><span>             </span><span class="hs-comment">-- We don't know what tuple_ty is yet, so we use a variable</span><span>
</span><span id="line-593"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682881438"><span class="hs-identifier hs-type">mk_n_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-594"></span><span>             </span><span id="local-6989586621682881438"><span class="annot"><a href="#local-6989586621682881438"><span class="hs-identifier hs-var hs-var">mk_n_bndr</span></a></span></span><span> </span><span id="local-6989586621682881440"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682881440"><span class="hs-identifier hs-var">n_bndr_name</span></a></span></span><span> </span><span id="local-6989586621682881441"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682881441"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Mult -&gt; Mult -&gt; Id
Name -&gt; Mult -&gt; Mult -&gt; Id
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682881440"><span class="hs-identifier hs-var">n_bndr_name</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881417"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Mult
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682881441"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>             </span><span class="hs-comment">-- Ensure that every old binder of type `b` is linked up with its</span><span>
</span><span id="line-597"></span><span>             </span><span class="hs-comment">-- new binder which should have type `n b`</span><span>
</span><span id="line-598"></span><span>             </span><span class="hs-comment">-- See Note [TransStmt binder map] in GHC.Hs.Expr</span><span>
</span><span id="line-599"></span><span>             </span><span id="local-6989586621682881444"><span class="annot"><a href="#local-6989586621682881444"><span class="hs-identifier hs-var hs-var">n_bndr_ids</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Id -&gt; Id) -&gt; [Name] -&gt; [Id] -&gt; [Id]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Id -&gt; Id
</span><a href="#local-6989586621682881438"><span class="hs-identifier hs-var">mk_n_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881406"><span class="hs-identifier hs-var">n_bndr_names</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881409"><span class="hs-identifier hs-var">bndr_ids</span></a></span><span>
</span><span id="line-600"></span><span>             </span><span id="local-6989586621682881446"><span class="annot"><a href="#local-6989586621682881446"><span class="hs-identifier hs-var hs-var">bindersMap'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881409"><span class="hs-identifier hs-var">bndr_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [(Id, Id)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881444"><span class="hs-identifier hs-var">n_bndr_ids</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>       </span><span class="hs-comment">-- Type check the thing in the environment with</span><span>
</span><span id="line-603"></span><span>       </span><span class="hs-comment">-- these new binders and return the result</span><span>
</span><span id="line-604"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881447"><span class="annot"><a href="#local-6989586621682881447"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv"><span class="hs-identifier hs-type">tcExtendIdEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881444"><span class="hs-identifier hs-type">n_bndr_ids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881404"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881403"><span class="hs-identifier hs-type">elt_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_stmts"><span class="hs-identifier hs-var">trS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881408"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_bndrs"><span class="hs-identifier hs-var">trS_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881446"><span class="hs-identifier hs-type">bindersMap'</span></a></span><span>
</span><span id="line-607"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_by"><span class="hs-identifier hs-var">trS_by</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621682881410"><span class="hs-identifier hs-type">by'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_using"><span class="hs-identifier hs-var">trS_using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881435"><span class="hs-identifier hs-type">final_using</span></a></span><span>
</span><span id="line-608"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_ret"><span class="hs-identifier hs-var">trS_ret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span>
</span><span id="line-609"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_bind"><span class="hs-identifier hs-var">trS_bind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span>
</span><span id="line-610"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_fmap"><span class="hs-identifier hs-var">trS_fmap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noExpr"><span class="hs-identifier hs-type">noExpr</span></a></span><span>
</span><span id="line-611"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_ext"><span class="hs-identifier hs-var">trS_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-type">unitTy</span></a></span><span>
</span><span id="line-612"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_form"><span class="hs-identifier hs-var">trS_form</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881394"><span class="hs-identifier hs-type">form</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881447"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcLcStmt"><span class="hs-identifier hs-var">tcLcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881454"><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881454"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcLcStmt: unexpected Stmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881454"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-619"></span><span class="hs-comment">--           Monad comprehensions</span><span>
</span><span id="line-620"></span><span class="hs-comment">--        (supports rebindable syntax)</span><span>
</span><span id="line-621"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-type">tcMcStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcExprStmtChecker"><span class="hs-identifier hs-type">TcExprStmtChecker</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span id="tcMcStmt"><span class="annot"><span class="annottext">tcMcStmt :: TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var hs-var">tcMcStmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span id="local-6989586621682881565"><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881565"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682881566"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881566"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682881567"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682881567"><span class="hs-identifier hs-var">noret</span></a></span></span><span> </span><span id="local-6989586621682881568"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881568"><span class="hs-identifier hs-var">return_op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881569"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881569"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881570"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881570"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881571"><span class="annot"><a href="#local-6989586621682881571"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881572"><span class="annot"><a href="#local-6989586621682881572"><span class="hs-identifier hs-var">return_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-var">MCompOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881568"><span class="hs-identifier hs-var">return_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881569"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
 -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-628"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881575"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881575"><span class="hs-identifier hs-var">a_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881576"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881576"><span class="hs-identifier hs-var">mult</span></a></span></span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-629"></span><span>               </span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881576"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var">tcCheckMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881566"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881575"><span class="hs-identifier hs-var">a_ty</span></a></span><span>
</span><span id="line-630"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881577"><span class="annot"><a href="#local-6989586621682881577"><span class="hs-identifier hs-var">thing</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881570"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcMcStmt: thing_inside&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881565"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881571"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881567"><span class="hs-identifier hs-type">noret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881572"><span class="hs-identifier hs-type">return_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881577"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="hs-comment">-- Generators for monad comprehensions ( pat &lt;- rhs )</span><span>
</span><span id="line-634"></span><span class="hs-comment">--</span><span>
</span><span id="line-635"></span><span class="hs-comment">--   [ body | q &lt;- gen ]  -&gt;  gen :: m a</span><span>
</span><span id="line-636"></span><span class="hs-comment">--                            q   ::   a</span><span>
</span><span id="line-637"></span><span class="hs-comment">--</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span id="local-6989586621682881578"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881578"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span id="local-6989586621682881579"><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881579"><span class="hs-identifier hs-var">xbsrn</span></a></span></span><span> </span><span id="local-6989586621682881580"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682881580"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682881581"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881581"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881582"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881582"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881583"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881583"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-640"></span><span>           </span><span class="hs-comment">-- (&gt;&gt;=) :: rhs_ty -&gt; (pat_ty -&gt; new_res_ty) -&gt; res_ty</span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881584"><span class="annot"><a href="#local-6989586621682881584"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881585"><span class="annot"><a href="#local-6989586621682881585"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881586"><span class="annot"><a href="#local-6989586621682881586"><span class="hs-identifier hs-var">pat_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881587"><span class="annot"><a href="#local-6989586621682881587"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881588"><span class="annot"><a href="#local-6989586621682881588"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881589"><span class="annot"><a href="#local-6989586621682881589"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881590"><span class="annot"><a href="#local-6989586621682881590"><span class="hs-identifier hs-var">bind_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM
         (Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
          GenLocated SrcSpanAnnA (Pat GhcTc), thing, Mult))
-&gt; TcM
     ((Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
       GenLocated SrcSpanAnnA (Pat GhcTc), thing, Mult),
      SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-var">MCompOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBindStmtRn -&gt; SyntaxExpr GhcRn
</span><a href="GHC.Hs.Expr.html#xbsrn_bindOp"><span class="hs-identifier hs-var">xbsrn_bindOp</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
XBindStmtRn
</span><a href="#local-6989586621682881579"><span class="hs-identifier hs-var">xbsrn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>                          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType -&gt; SyntaxOpType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-var">SynFun</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881582"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; TcM
       (Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
        GenLocated SrcSpanAnnA (Pat GhcTc), thing, Mult))
 -&gt; TcM
      ((Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
        GenLocated SrcSpanAnnA (Pat GhcTc), thing, Mult),
       SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM
         (Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
          GenLocated SrcSpanAnnA (Pat GhcTc), thing, Mult))
-&gt; TcM
     ((Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
       GenLocated SrcSpanAnnA (Pat GhcTc), thing, Mult),
      SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-644"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881594"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881594"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881595"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881595"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881596"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881596"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881597"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881597"><span class="hs-identifier hs-var">rhs_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881598"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881598"><span class="hs-identifier hs-var">fun_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881599"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881599"><span class="hs-identifier hs-var">pat_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-645"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881600"><span class="annot"><a href="#local-6989586621682881600"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881597"><span class="hs-identifier hs-var">rhs_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var">tcCheckMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881581"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881594"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-646"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881601"><span class="annot"><a href="#local-6989586621682881601"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881602"><span class="annot"><a href="#local-6989586621682881602"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881598"><span class="hs-identifier hs-type">fun_mult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881578"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881580"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881599"><span class="hs-identifier hs-type">pat_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881595"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-647"></span><span>                                     </span><span class="annot"><a href="#local-6989586621682881583"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881596"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881594"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881600"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881599"><span class="hs-identifier hs-type">pat_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881601"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881602"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881596"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBindStmt"><span class="hs-identifier hs-type">FRRBindStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MonadComprehension"><span class="hs-identifier hs-type">MonadComprehension</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881584"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>        </span><span class="hs-comment">-- If (but only if) the pattern can fail, typecheck the 'fail' operator</span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881605"><span class="annot"><a href="#local-6989586621682881605"><span class="hs-identifier hs-var">fail_op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">join</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881579"><span class="hs-identifier hs-type">xbsrn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881608"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682881608"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="annottext">CtOrigin
-&gt; LPat GhcTc
-&gt; SyntaxExpr GhcRn
-&gt; Mult
-&gt; TcRn (FailOperator GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcMonadFailOp"><span class="hs-identifier hs-var">tcMonadFailOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#MCompPatOrigin"><span class="hs-identifier hs-var">MCompPatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682881580"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621682881587"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881608"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881589"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881611"><span class="annot"><a href="#local-6989586621682881611"><span class="hs-identifier hs-var hs-var">xbstc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#XBindStmtTc"><span class="hs-identifier hs-type">XBindStmtTc</span></a></span><span>
</span><span id="line-657"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xbstc_bindOp :: SyntaxExpr GhcTc
</span><a href="#local-6989586621682881613"><span class="hs-identifier hs-var">xbstc_bindOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
SyntaxExprTc
</span><a href="#local-6989586621682881590"><span class="hs-identifier hs-var">bind_op'</span></a></span><span>
</span><span id="line-658"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbstc_boundResultType :: Mult
</span><a href="#local-6989586621682881614"><span class="hs-identifier hs-var">xbstc_boundResultType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881589"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span>
</span><span id="line-659"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbstc_boundResultMult :: Mult
</span><a href="#local-6989586621682881615"><span class="hs-identifier hs-var">xbstc_boundResultMult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881586"><span class="hs-identifier hs-var">pat_mult</span></a></span><span>
</span><span id="line-660"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbstc_failOp :: FailOperator GhcTc
</span><a href="#local-6989586621682881616"><span class="hs-identifier hs-var">xbstc_failOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FailOperator GhcTc
Maybe SyntaxExprTc
</span><a href="#local-6989586621682881605"><span class="hs-identifier hs-var">fail_op'</span></a></span><span>
</span><span id="line-661"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-662"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881611"><span class="hs-identifier hs-type">xbstc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881587"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881585"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881588"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="hs-comment">-- Boolean expressions.</span><span>
</span><span id="line-665"></span><span class="hs-comment">--</span><span>
</span><span id="line-666"></span><span class="hs-comment">--   [ body | stmts, expr ]  -&gt;  expr :: m Bool</span><span>
</span><span id="line-667"></span><span class="hs-comment">--</span><span>
</span><span id="line-668"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881617"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881617"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682881618"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881618"><span class="hs-identifier hs-var">then_op</span></a></span></span><span> </span><span id="local-6989586621682881619"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881619"><span class="hs-identifier hs-var">guard_op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881620"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881620"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881621"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881621"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Deal with rebindable syntax:</span><span>
</span><span id="line-670"></span><span>          </span><span class="hs-comment">--    guard_op :: test_ty -&gt; rhs_ty</span><span>
</span><span id="line-671"></span><span>          </span><span class="hs-comment">--    then_op  :: rhs_ty -&gt; new_res_ty -&gt; res_ty</span><span>
</span><span id="line-672"></span><span>          </span><span class="hs-comment">-- Where test_ty is, for example, Bool</span><span>
</span><span id="line-673"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881622"><span class="annot"><a href="#local-6989586621682881622"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881623"><span class="annot"><a href="#local-6989586621682881623"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881624"><span class="annot"><a href="#local-6989586621682881624"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881625"><span class="annot"><a href="#local-6989586621682881625"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881626"><span class="annot"><a href="#local-6989586621682881626"><span class="hs-identifier hs-var">test_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881627"><span class="annot"><a href="#local-6989586621682881627"><span class="hs-identifier hs-var">guard_op'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881628"><span class="annot"><a href="#local-6989586621682881628"><span class="hs-identifier hs-var">then_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM
         (thing, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, Mult,
          SyntaxExprTc))
-&gt; TcM
     ((thing, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, Mult,
       SyntaxExprTc),
      SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-var">MCompOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881618"><span class="hs-identifier hs-var">then_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881620"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; TcM
       (thing, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, Mult,
        SyntaxExprTc))
 -&gt; TcM
      ((thing, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, Mult,
        SyntaxExprTc),
       SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM
         (thing, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, Mult,
          SyntaxExprTc))
-&gt; TcM
     ((thing, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, Mult,
       SyntaxExprTc),
      SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-675"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881629"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881629"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881630"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881630"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881631"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881631"><span class="hs-identifier hs-var">rhs_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881632"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881632"><span class="hs-identifier hs-var">fun_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-676"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881633"><span class="annot"><a href="#local-6989586621682881633"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881634"><span class="annot"><a href="#local-6989586621682881634"><span class="hs-identifier hs-var">test_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881635"><span class="annot"><a href="#local-6989586621682881635"><span class="hs-identifier hs-var">guard_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>                      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881631"><span class="hs-identifier hs-var">rhs_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
 -&gt; TcM
      ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc))
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-678"></span><span>                         </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult))
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-var">MCompOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881619"><span class="hs-identifier hs-var">guard_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-679"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881629"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult))
 -&gt; TcM
      ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult))
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-680"></span><span>                         </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881636"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881636"><span class="hs-identifier hs-var">test_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881637"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881637"><span class="hs-identifier hs-var">test_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-681"></span><span>                           </span><span id="local-6989586621682881638"><span class="annot"><a href="#local-6989586621682881638"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881637"><span class="hs-identifier hs-var">test_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881617"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881636"><span class="hs-identifier hs-var">test_ty</span></a></span><span>
</span><span id="line-682"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881638"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881636"><span class="hs-identifier hs-type">test_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881639"><span class="annot"><a href="#local-6989586621682881639"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881632"><span class="hs-identifier hs-type">fun_mult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682881621"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881630"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881639"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881633"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881629"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881630"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881634"><span class="hs-identifier hs-type">test_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881635"><span class="hs-identifier hs-type">guard_op'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBodyStmtGuard"><span class="hs-identifier hs-type">FRRBodyStmtGuard</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881626"><span class="hs-identifier hs-type">test_ty</span></a></span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBodyStmt"><span class="hs-identifier hs-type">FRRBodyStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MonadComprehension"><span class="hs-identifier hs-type">MonadComprehension</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881624"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBodyStmt"><span class="hs-identifier hs-type">FRRBodyStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MonadComprehension"><span class="hs-identifier hs-type">MonadComprehension</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881625"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881624"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881623"><span class="hs-identifier hs-type">rhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881628"><span class="hs-identifier hs-type">then_op'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881627"><span class="hs-identifier hs-type">guard_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881622"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">-- Grouping statements</span><span>
</span><span id="line-693"></span><span class="hs-comment">--</span><span>
</span><span id="line-694"></span><span class="hs-comment">--   [ body | stmts, then group by e using f ]</span><span>
</span><span id="line-695"></span><span class="hs-comment">--     -&gt;  e :: t</span><span>
</span><span id="line-696"></span><span class="hs-comment">--         f :: forall a. (a -&gt; t) -&gt; m a -&gt; m (m a)</span><span>
</span><span id="line-697"></span><span class="hs-comment">--   [ body | stmts, then group using f ]</span><span>
</span><span id="line-698"></span><span class="hs-comment">--     -&gt;  f :: forall a. m a -&gt; m (m a)</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-comment">-- We type [ body | (stmts, group by e using f), ... ]</span><span>
</span><span id="line-701"></span><span class="hs-comment">--     f &lt;optional by&gt; [ (a,b,c) | stmts ] &gt;&gt;= \(a,b,c) -&gt; ...body....</span><span>
</span><span id="line-702"></span><span class="hs-comment">--</span><span>
</span><span id="line-703"></span><span class="hs-comment">-- We type the functions as follows:</span><span>
</span><span id="line-704"></span><span class="hs-comment">--     f &lt;optional by&gt; :: m1 (a,b,c) -&gt; m2 (a,b,c)              (ThenForm)</span><span>
</span><span id="line-705"></span><span class="hs-comment">--                     :: m1 (a,b,c) -&gt; m2 (n (a,b,c))          (GroupForm)</span><span>
</span><span id="line-706"></span><span class="hs-comment">--     (&gt;&gt;=) :: m2 (a,b,c)     -&gt; ((a,b,c)   -&gt; res) -&gt; res     (ThenForm)</span><span>
</span><span id="line-707"></span><span class="hs-comment">--           :: m2 (n (a,b,c)) -&gt; (n (a,b,c) -&gt; res) -&gt; res     (GroupForm)</span><span>
</span><span id="line-708"></span><span class="hs-comment">--</span><span>
</span><span id="line-709"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span id="local-6989586621682881642"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881642"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">trS_stmts :: forall idL idR body. StmtLR idL idR body -&gt; [ExprLStmt idL]
</span><a href="Language.Haskell.Syntax.Expr.html#trS_stmts"><span class="hs-identifier hs-var">trS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881643"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881643"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_bndrs :: forall idL idR body. StmtLR idL idR body -&gt; [(IdP idR, IdP idR)]
</span><a href="Language.Haskell.Syntax.Expr.html#trS_bndrs"><span class="hs-identifier hs-var">trS_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881644"><span class="annot"><span class="annottext">[(IdP GhcRn, IdP GhcRn)]
</span><a href="#local-6989586621682881644"><span class="hs-identifier hs-var">bindersMap</span></a></span></span><span>
</span><span id="line-710"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_by :: forall idL idR body. StmtLR idL idR body -&gt; Maybe (LHsExpr idR)
</span><a href="Language.Haskell.Syntax.Expr.html#trS_by"><span class="hs-identifier hs-var">trS_by</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881645"><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
</span><a href="#local-6989586621682881645"><span class="hs-identifier hs-var">by</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_using :: forall idL idR body. StmtLR idL idR body -&gt; LHsExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#trS_using"><span class="hs-identifier hs-var">trS_using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881646"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881646"><span class="hs-identifier hs-var">using</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_form :: forall idL idR body. StmtLR idL idR body -&gt; TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#trS_form"><span class="hs-identifier hs-var">trS_form</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881647"><span class="annot"><span class="annottext">TransForm
</span><a href="#local-6989586621682881647"><span class="hs-identifier hs-var">form</span></a></span></span><span>
</span><span id="line-711"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_ret :: forall idL idR body. StmtLR idL idR body -&gt; SyntaxExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#trS_ret"><span class="hs-identifier hs-var">trS_ret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881648"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881648"><span class="hs-identifier hs-var">return_op</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_bind :: forall idL idR body. StmtLR idL idR body -&gt; SyntaxExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#trS_bind"><span class="hs-identifier hs-var">trS_bind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881649"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881649"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span>
</span><span id="line-712"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">trS_fmap :: forall idL idR body. StmtLR idL idR body -&gt; HsExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#trS_fmap"><span class="hs-identifier hs-var">trS_fmap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881650"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682881650"><span class="hs-identifier hs-var">fmap_op</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881651"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881651"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881652"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881652"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881653"><span class="annot"><a href="#local-6989586621682881653"><span class="hs-identifier hs-var">m1_ty</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#typeToTypeKind"><span class="hs-identifier hs-var">typeToTypeKind</span></a></span><span>
</span><span id="line-714"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881655"><span class="annot"><a href="#local-6989586621682881655"><span class="hs-identifier hs-var">m2_ty</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#typeToTypeKind"><span class="hs-identifier hs-type">typeToTypeKind</span></a></span><span>
</span><span id="line-715"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881656"><span class="annot"><a href="#local-6989586621682881656"><span class="hs-identifier hs-var">tup_ty</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-716"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881657"><span class="annot"><a href="#local-6989586621682881657"><span class="hs-identifier hs-var">by_e_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>  </span><span class="hs-comment">-- The type of the 'by' expression (if any)</span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span>         </span><span class="hs-comment">-- n_app :: Type -&gt; Type   -- Wraps a 'ty' into '(n ty)' for GroupForm</span><span>
</span><span id="line-719"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881658"><span class="annot"><a href="#local-6989586621682881658"><span class="hs-identifier hs-var">n_app</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682881647"><span class="hs-identifier hs-type">form</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-720"></span><span>                    </span><span class="annot"><span class="annottext">TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#ThenForm"><span class="hs-identifier hs-var">ThenForm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Mult -&gt; Mult)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682881659"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881659"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881659"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>                    </span><span class="annot"><span class="annottext">TransForm
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881660"><span class="annot"><a href="#local-6989586621682881660"><span class="hs-identifier hs-var">n_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#typeToTypeKind"><span class="hs-identifier hs-var">typeToTypeKind</span></a></span><span>
</span><span id="line-722"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">n_ty</span></span><span> </span><span class="annot"><span class="hs-operator">`mkAppTy`</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-723"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682881662"><span class="hs-identifier hs-type">by_arrow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-724"></span><span>             </span><span class="hs-comment">-- (by_arrow res) produces ((alpha-&gt;e_ty) -&gt; res)     ('by' present)</span><span>
</span><span id="line-725"></span><span>             </span><span class="hs-comment">--                          or res                    ('by' absent)</span><span>
</span><span id="line-726"></span><span>             </span><span id="local-6989586621682881662"><span class="annot"><a href="#local-6989586621682881662"><span class="hs-identifier hs-var hs-var">by_arrow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
</span><a href="#local-6989586621682881645"><span class="hs-identifier hs-var">by</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-727"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881663"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881663"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881663"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-728"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881664"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881664"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881657"><span class="hs-identifier hs-var">by_e_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881664"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>             </span><span id="local-6989586621682881665"><span class="annot"><a href="#local-6989586621682881665"><span class="hs-identifier hs-var hs-var">poly_arg_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881653"><span class="hs-identifier hs-var">m1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span>
</span><span id="line-731"></span><span>             </span><span id="local-6989586621682881666"><span class="annot"><a href="#local-6989586621682881666"><span class="hs-identifier hs-var hs-var">using_arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881653"><span class="hs-identifier hs-var">m1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881656"><span class="hs-identifier hs-var">tup_ty</span></a></span><span>
</span><span id="line-732"></span><span>             </span><span id="local-6989586621682881667"><span class="annot"><a href="#local-6989586621682881667"><span class="hs-identifier hs-var hs-var">poly_res_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881655"><span class="hs-identifier hs-var">m2_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881658"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span>
</span><span id="line-733"></span><span>             </span><span id="local-6989586621682881668"><span class="annot"><a href="#local-6989586621682881668"><span class="hs-identifier hs-var hs-var">using_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881655"><span class="hs-identifier hs-var">m2_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881658"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881656"><span class="hs-identifier hs-var">tup_ty</span></a></span><span>
</span><span id="line-734"></span><span>             </span><span id="local-6989586621682881669"><span class="annot"><a href="#local-6989586621682881669"><span class="hs-identifier hs-var hs-var">using_poly_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkInfForAllTy"><span class="hs-identifier hs-var">mkInfForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.Prim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-735"></span><span>                             </span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881662"><span class="hs-identifier hs-var">by_arrow</span></a></span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-736"></span><span>                             </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881665"><span class="hs-identifier hs-var">poly_arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881667"><span class="hs-identifier hs-var">poly_res_ty</span></a></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span>             </span><span class="hs-comment">-- 'stmts' returns a result of type (m1_ty tuple_ty),</span><span>
</span><span id="line-739"></span><span>             </span><span class="hs-comment">-- typically something like [(Int,Bool,Int)]</span><span>
</span><span id="line-740"></span><span>             </span><span class="hs-comment">-- We don't know what tuple_ty is yet, so we use a variable</span><span>
</span><span id="line-741"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881670"><span class="annot"><a href="#local-6989586621682881670"><span class="hs-identifier hs-var">bndr_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881671"><span class="annot"><a href="#local-6989586621682881671"><span class="hs-identifier hs-var">n_bndr_names</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621682881644"><span class="hs-identifier hs-type">bindersMap</span></a></span><span>
</span><span id="line-742"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881672"><span class="annot"><a href="#local-6989586621682881672"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881673"><span class="annot"><a href="#local-6989586621682881673"><span class="hs-identifier hs-var">bndr_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881674"><span class="annot"><a href="#local-6989586621682881674"><span class="hs-identifier hs-var">by'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881675"><span class="annot"><a href="#local-6989586621682881675"><span class="hs-identifier hs-var">return_op'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-743"></span><span>            </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-type">tcStmtsAndThen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmtCtxt"><span class="hs-identifier hs-type">TransStmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881642"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-type">tcMcStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881643"><span class="hs-identifier hs-type">stmts</span></a></span><span>
</span><span id="line-744"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881666"><span class="hs-identifier hs-type">using_arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881676"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881676"><span class="hs-identifier hs-var">res_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-745"></span><span>                </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881677"><span class="annot"><a href="#local-6989586621682881677"><span class="hs-identifier hs-var">by'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
</span><a href="#local-6989586621682881645"><span class="hs-identifier hs-var">by</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-746"></span><span>                           </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcRn)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpanAnnA (HsExpr GhcTc))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-747"></span><span>                           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682881678"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881678"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881679"><span class="annot"><a href="#local-6989586621682881679"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682881678"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881657"><span class="hs-identifier hs-var">by_e_ty</span></a></span><span>
</span><span id="line-748"></span><span>                                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682881679"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>                </span><span class="hs-comment">-- Find the Ids (and hence types) of all old binders</span><span>
</span><span id="line-751"></span><span>                </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881680"><span class="annot"><a href="#local-6989586621682881680"><span class="hs-identifier hs-var">bndr_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupLocalIds"><span class="hs-identifier hs-type">tcLookupLocalIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881670"><span class="hs-identifier hs-type">bndr_names</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>                </span><span class="hs-comment">-- 'return' is only used for the binders, so we know its type.</span><span>
</span><span id="line-754"></span><span>                </span><span class="hs-comment">--   return :: (a,b,c,..) -&gt; m (a,b,c,..)</span><span>
</span><span id="line-755"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881681"><span class="annot"><a href="#local-6989586621682881681"><span class="hs-identifier hs-var">return_op'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-type">MCompOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881648"><span class="hs-identifier hs-type">return_op</span></a></span><span>
</span><span id="line-756"></span><span>                                       </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-type">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881680"><span class="hs-identifier hs-type">bndr_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-757"></span><span>                                       </span><span class="annot"><a href="#local-6989586621682881676"><span class="hs-identifier hs-type">res_ty'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881680"><span class="hs-identifier hs-type">bndr_ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881677"><span class="hs-identifier hs-type">by'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881681"><span class="hs-identifier hs-type">return_op'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>       </span><span class="hs-comment">--------------- Typecheck the 'bind' function -------------</span><span>
</span><span id="line-762"></span><span>       </span><span class="hs-comment">-- (&gt;&gt;=) :: m2 (n (a,b,c)) -&gt; ( n (a,b,c) -&gt; new_res_ty ) -&gt; res_ty</span><span>
</span><span id="line-763"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881683"><span class="annot"><a href="#local-6989586621682881683"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-764"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881684"><span class="annot"><a href="#local-6989586621682881684"><span class="hs-identifier hs-var">bind_op'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-type">MCompOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881649"><span class="hs-identifier hs-type">bind_op</span></a></span><span>
</span><span id="line-765"></span><span>                             </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881668"><span class="hs-identifier hs-type">using_res_ty</span></a></span><span>
</span><span id="line-766"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881658"><span class="hs-identifier hs-type">n_app</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881656"><span class="hs-identifier hs-type">tup_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-type">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881683"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-767"></span><span>                             </span><span class="annot"><a href="#local-6989586621682881651"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>       </span><span class="hs-comment">--------------- Typecheck the 'fmap' function -------------</span><span>
</span><span id="line-770"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881685"><span class="annot"><a href="#local-6989586621682881685"><span class="hs-identifier hs-var">fmap_op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682881647"><span class="hs-identifier hs-type">form</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-771"></span><span>                       </span><span class="annot"><span class="annottext">TransForm
</span><a href="Language.Haskell.Syntax.Expr.html#ThenForm"><span class="hs-identifier hs-var">ThenForm</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
forall (p :: Pass). HsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#noExpr"><span class="hs-identifier hs-var">noExpr</span></a></span><span>
</span><span id="line-772"></span><span>                       </span><span class="annot"><span class="annottext">TransForm
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; HsExpr GhcTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc)
forall a b.
(a -&gt; b)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc) -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv
   (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc))
 -&gt; TcM (HsExpr GhcTc))
-&gt; (Mult
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (HsExpr GhcTc)))
-&gt; Mult
-&gt; TcM (HsExpr GhcTc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682881650"><span class="hs-identifier hs-var">fmap_op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; TcM (HsExpr GhcTc)) -&gt; Mult -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-773"></span><span>                            </span><span class="annot"><span class="annottext">Id -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkInfForAllTy"><span class="hs-identifier hs-var">mkInfForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.Prim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-774"></span><span>                            </span><span class="annot"><span class="annottext">Id -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkInfForAllTy"><span class="hs-identifier hs-var">mkInfForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.Prim.html#betaTyVar"><span class="hs-identifier hs-var">betaTyVar</span></a></span><span>  </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-775"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#betaTy"><span class="hs-identifier hs-var">betaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>                            </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881658"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>                            </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881658"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#betaTy"><span class="hs-identifier hs-var">betaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span>       </span><span class="hs-comment">--------------- Typecheck the 'using' function -------------</span><span>
</span><span id="line-780"></span><span>       </span><span class="hs-comment">-- using :: ((a,b,c)-&gt;t) -&gt; m1 (a,b,c) -&gt; m2 (n (a,b,c))</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881689"><span class="annot"><a href="#local-6989586621682881689"><span class="hs-identifier hs-var">using'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881646"><span class="hs-identifier hs-type">using</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881669"><span class="hs-identifier hs-type">using_poly_ty</span></a></span><span>
</span><span id="line-783"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881690"><span class="annot"><a href="#local-6989586621682881690"><span class="hs-identifier hs-var hs-var">final_using</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcTc)
forall a b.
(a -&gt; b) -&gt; GenLocated SrcSpanAnnA a -&gt; GenLocated SrcSpanAnnA b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-var">WpTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881656"><span class="hs-identifier hs-var">tup_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621682881689"><span class="hs-identifier hs-var">using'</span></a></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>       </span><span class="hs-comment">--------------- Building the bindersMap ----------------</span><span>
</span><span id="line-786"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682881691"><span class="hs-identifier hs-type">mk_n_bndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-787"></span><span>             </span><span id="local-6989586621682881691"><span class="annot"><a href="#local-6989586621682881691"><span class="hs-identifier hs-var hs-var">mk_n_bndr</span></a></span></span><span> </span><span id="local-6989586621682881692"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682881692"><span class="hs-identifier hs-var">n_bndr_name</span></a></span></span><span> </span><span id="local-6989586621682881693"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682881693"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Mult -&gt; Mult -&gt; Id
Name -&gt; Mult -&gt; Mult -&gt; Id
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682881692"><span class="hs-identifier hs-var">n_bndr_name</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; Mult
</span><a href="#local-6989586621682881658"><span class="hs-identifier hs-var">n_app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Mult
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682881693"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span>             </span><span class="hs-comment">-- Ensure that every old binder of type `b` is linked up with its</span><span>
</span><span id="line-790"></span><span>             </span><span class="hs-comment">-- new binder which should have type `n b`</span><span>
</span><span id="line-791"></span><span>             </span><span class="hs-comment">-- See Note [TransStmt binder map] in GHC.Hs.Expr</span><span>
</span><span id="line-792"></span><span>             </span><span id="local-6989586621682881694"><span class="annot"><a href="#local-6989586621682881694"><span class="hs-identifier hs-var hs-var">n_bndr_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Name -&gt; Id -&gt; Id) -&gt; [Name] -&gt; [Id] -&gt; [Id]
forall a b c.
HasDebugCallStack =&gt;
String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcMcStmt&quot;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Id -&gt; Id
</span><a href="#local-6989586621682881691"><span class="hs-identifier hs-var">mk_n_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881671"><span class="hs-identifier hs-var">n_bndr_names</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881673"><span class="hs-identifier hs-var">bndr_ids</span></a></span><span>
</span><span id="line-793"></span><span>             </span><span id="local-6989586621682881696"><span class="annot"><a href="#local-6989586621682881696"><span class="hs-identifier hs-var hs-var">bindersMap'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881673"><span class="hs-identifier hs-var">bndr_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [(Id, Id)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881694"><span class="hs-identifier hs-var">n_bndr_ids</span></a></span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span>       </span><span class="hs-comment">-- Type check the thing in the environment with</span><span>
</span><span id="line-796"></span><span>       </span><span class="hs-comment">-- these new binders and return the result</span><span>
</span><span id="line-797"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881697"><span class="annot"><a href="#local-6989586621682881697"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv"><span class="hs-identifier hs-type">tcExtendIdEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881694"><span class="hs-identifier hs-type">n_bndr_ids</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-798"></span><span>                  </span><span class="annot"><a href="#local-6989586621682881652"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881683"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TransStmt"><span class="hs-identifier hs-type">TransStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_stmts"><span class="hs-identifier hs-var">trS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881672"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_bndrs"><span class="hs-identifier hs-var">trS_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881696"><span class="hs-identifier hs-type">bindersMap'</span></a></span><span>
</span><span id="line-801"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_by"><span class="hs-identifier hs-var">trS_by</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881674"><span class="hs-identifier hs-type">by'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_using"><span class="hs-identifier hs-var">trS_using</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881690"><span class="hs-identifier hs-type">final_using</span></a></span><span>
</span><span id="line-802"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_ret"><span class="hs-identifier hs-var">trS_ret</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881675"><span class="hs-identifier hs-type">return_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_bind"><span class="hs-identifier hs-var">trS_bind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881684"><span class="hs-identifier hs-type">bind_op'</span></a></span><span>
</span><span id="line-803"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_ext"><span class="hs-identifier hs-var">trS_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881658"><span class="hs-identifier hs-type">n_app</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881656"><span class="hs-identifier hs-type">tup_ty</span></a></span><span>
</span><span id="line-804"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_fmap"><span class="hs-identifier hs-var">trS_fmap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881685"><span class="hs-identifier hs-type">fmap_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#trS_form"><span class="hs-identifier hs-var">trS_form</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881647"><span class="hs-identifier hs-type">form</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881697"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span class="hs-comment">-- A parallel set of comprehensions</span><span>
</span><span id="line-807"></span><span class="hs-comment">--      [ (g x, h x) | ... ; let g v = ...</span><span>
</span><span id="line-808"></span><span class="hs-comment">--                   | ... ; let h v = ... ]</span><span>
</span><span id="line-809"></span><span class="hs-comment">--</span><span>
</span><span id="line-810"></span><span class="hs-comment">-- It's possible that g,h are overloaded, so we need to feed the LIE from the</span><span>
</span><span id="line-811"></span><span class="hs-comment">-- (g x, h x) up through both lots of bindings (so we get the bindLocalMethods).</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- Similarly if we had an existential pattern match:</span><span>
</span><span id="line-813"></span><span class="hs-comment">--</span><span>
</span><span id="line-814"></span><span class="hs-comment">--      data T = forall a. Show a =&gt; C a</span><span>
</span><span id="line-815"></span><span class="hs-comment">--</span><span>
</span><span id="line-816"></span><span class="hs-comment">--      [ (show x, show y) | ... ; C x &lt;- ...</span><span>
</span><span id="line-817"></span><span class="hs-comment">--                         | ... ; C y &lt;- ... ]</span><span>
</span><span id="line-818"></span><span class="hs-comment">--</span><span>
</span><span id="line-819"></span><span class="hs-comment">-- Then we need the LIE from (show x, show y) to be simplified against</span><span>
</span><span id="line-820"></span><span class="hs-comment">-- the bindings for x and y.</span><span>
</span><span id="line-821"></span><span class="hs-comment">--</span><span>
</span><span id="line-822"></span><span class="hs-comment">-- It's difficult to do this in parallel, so we rely on the renamer to</span><span>
</span><span id="line-823"></span><span class="hs-comment">-- ensure that g,h and x,y don't duplicate, and simply grow the environment.</span><span>
</span><span id="line-824"></span><span class="hs-comment">-- So the binders of the first parallel group will be in scope in the second</span><span>
</span><span id="line-825"></span><span class="hs-comment">-- group.  But that's fine; there's no shadowing to worry about.</span><span>
</span><span id="line-826"></span><span class="hs-comment">--</span><span>
</span><span id="line-827"></span><span class="hs-comment">-- Note: The `mzip` function will get typechecked via:</span><span>
</span><span id="line-828"></span><span class="hs-comment">--</span><span>
</span><span id="line-829"></span><span class="hs-comment">--   ParStmt [st1::t1, st2::t2, st3::t3]</span><span>
</span><span id="line-830"></span><span class="hs-comment">--</span><span>
</span><span id="line-831"></span><span class="hs-comment">--   mzip :: m st1</span><span>
</span><span id="line-832"></span><span class="hs-comment">--        -&gt; (m st2 -&gt; m st3 -&gt; m (st2, st3))   -- recursive call</span><span>
</span><span id="line-833"></span><span class="hs-comment">--        -&gt; m (st1, (st2, st3))</span><span>
</span><span id="line-834"></span><span class="hs-comment">--</span><span>
</span><span id="line-835"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span id="local-6989586621682881698"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881698"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XParStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881699"><span class="annot"><span class="annottext">[ParStmtBlock GhcRn GhcRn]
</span><a href="#local-6989586621682881699"><span class="hs-identifier hs-var">bndr_stmts_s</span></a></span></span><span> </span><span id="local-6989586621682881700"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682881700"><span class="hs-identifier hs-var">mzip_op</span></a></span></span><span> </span><span id="local-6989586621682881701"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881701"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881702"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881702"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881703"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881703"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881704"><span class="annot"><a href="#local-6989586621682881704"><span class="hs-identifier hs-var">m_ty</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#typeToTypeKind"><span class="hs-identifier hs-var">typeToTypeKind</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881705"><span class="annot"><a href="#local-6989586621682881705"><span class="hs-identifier hs-var hs-var">mzip_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkInfForAllTys"><span class="hs-identifier hs-var">mkInfForAllTys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.Prim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Builtin.Types.Prim.html#betaTyVar"><span class="hs-identifier hs-var">betaTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult) -&gt; Mult -&gt; Mult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-839"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881704"><span class="hs-identifier hs-var">m_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>                        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span>
</span><span id="line-841"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881704"><span class="hs-identifier hs-var">m_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#betaTy"><span class="hs-identifier hs-var">betaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>                        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-operator hs-var">`mkVisFunTyMany`</span></a></span><span>
</span><span id="line-843"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881704"><span class="hs-identifier hs-var">m_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult] -&gt; Mult
</span><a href="GHC.Builtin.Types.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.Prim.html#betaTy"><span class="hs-identifier hs-var">betaTy</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881708"><span class="annot"><a href="#local-6989586621682881708"><span class="hs-identifier hs-var">mzip_op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`fmap`</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881700"><span class="hs-identifier hs-type">mzip_op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881705"><span class="hs-identifier hs-type">mzip_ty</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>        </span><span class="hs-comment">-- type dummies since we don't know all binder types yet</span><span>
</span><span id="line-847"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881709"><span class="annot"><a href="#local-6989586621682881709"><span class="hs-identifier hs-var">id_tys_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-848"></span><span>                       </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="#local-6989586621682881710"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881710"><span class="annot"><a href="#local-6989586621682881710"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881699"><span class="hs-identifier hs-type">bndr_stmts_s</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span>       </span><span class="hs-comment">-- Typecheck bind:</span><span>
</span><span id="line-851"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881711"><span class="annot"><a href="#local-6989586621682881711"><span class="hs-identifier hs-var hs-var">tup_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Mult] -&gt; Mult
HasDebugCallStack =&gt; [Mult] -&gt; Mult
</span><a href="GHC.Core.Make.html#mkBigCoreTupTy"><span class="hs-identifier hs-var">mkBigCoreTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881713"><span class="hs-identifier hs-var">id_tys</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682881713"><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881713"><span class="hs-identifier hs-var">id_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Mult]]
</span><a href="#local-6989586621682881709"><span class="hs-identifier hs-var">id_tys_s</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-852"></span><span>             </span><span id="local-6989586621682881714"><span class="annot"><a href="#local-6989586621682881714"><span class="hs-identifier hs-var hs-var">tuple_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Mult] -&gt; Mult
forall {t :: * -&gt; *}. Foldable t =&gt; t Mult -&gt; Mult
</span><a href="#local-6989586621682881715"><span class="hs-identifier hs-var">mk_tuple_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881711"><span class="hs-identifier hs-var">tup_tys</span></a></span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881716"><span class="annot"><a href="#local-6989586621682881716"><span class="hs-identifier hs-var">blocks'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881717"><span class="annot"><a href="#local-6989586621682881717"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881718"><span class="annot"><a href="#local-6989586621682881718"><span class="hs-identifier hs-var">inner_res_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881719"><span class="annot"><a href="#local-6989586621682881719"><span class="hs-identifier hs-var">bind_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-type">MCompOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881701"><span class="hs-identifier hs-type">bind_op</span></a></span><span>
</span><span id="line-856"></span><span>                         </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881704"><span class="hs-identifier hs-type">m_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-type">`mkAppTy`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881714"><span class="hs-identifier hs-type">tuple_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881714"><span class="hs-identifier hs-type">tuple_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-type">SynRho</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682881702"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-858"></span><span>              </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881720"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881720"><span class="hs-identifier hs-var">inner_res_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-859"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881721"><span class="annot"><a href="#local-6989586621682881721"><span class="hs-identifier hs-var">stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult
-&gt; ExpRhoType
-&gt; [Mult]
-&gt; [ParStmtBlock GhcRn GhcRn]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ([ParStmtBlock GhcTc GhcTc], thing)
</span><a href="#local-6989586621682881722"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881704"><span class="hs-identifier hs-var">m_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881720"><span class="hs-identifier hs-var">inner_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>                                 </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881711"><span class="hs-identifier hs-var">tup_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[ParStmtBlock GhcRn GhcRn]
</span><a href="#local-6989586621682881699"><span class="hs-identifier hs-var">bndr_stmts_s</span></a></span><span>
</span><span id="line-861"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881721"><span class="hs-identifier hs-type">stuff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881720"><span class="hs-identifier hs-type">inner_res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmt"><span class="hs-identifier hs-type">ParStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881718"><span class="hs-identifier hs-type">inner_res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881716"><span class="hs-identifier hs-type">blocks'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881708"><span class="hs-identifier hs-type">mzip_op'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881719"><span class="hs-identifier hs-type">bind_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881717"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-866"></span><span>    </span><span id="local-6989586621682881715"><span class="annot"><span class="annottext">mk_tuple_ty :: t Mult -&gt; Mult
</span><a href="#local-6989586621682881715"><span class="hs-identifier hs-var hs-var">mk_tuple_ty</span></a></span></span><span> </span><span id="local-6989586621682881725"><span class="annot"><span class="annottext">t Mult
</span><a href="#local-6989586621682881725"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Mult -&gt; Mult -&gt; Mult) -&gt; t Mult -&gt; Mult
forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682881727"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881727"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621682881728"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881728"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Mult] -&gt; Mult
</span><a href="GHC.Builtin.Types.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881727"><span class="hs-identifier hs-var">tn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881728"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t Mult
</span><a href="#local-6989586621682881725"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span>       </span><span class="hs-comment">-- loop :: Type                                  -- m_ty</span><span>
</span><span id="line-869"></span><span>       </span><span class="hs-comment">--      -&gt; ExpRhoType                            -- inner_res_ty</span><span>
</span><span id="line-870"></span><span>       </span><span class="hs-comment">--      -&gt; [TcType]                              -- tup_tys</span><span>
</span><span id="line-871"></span><span>       </span><span class="hs-comment">--      -&gt; [ParStmtBlock Name]</span><span>
</span><span id="line-872"></span><span>       </span><span class="hs-comment">--      -&gt; TcM ([([LStmt GhcTc], [TcId])], thing)</span><span>
</span><span id="line-873"></span><span>    </span><span id="local-6989586621682881722"><span class="annot"><span class="annottext">loop :: Mult
-&gt; ExpRhoType
-&gt; [Mult]
-&gt; [ParStmtBlock GhcRn GhcRn]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ([ParStmtBlock GhcTc GhcTc], thing)
</span><a href="#local-6989586621682881722"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">Mult
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881729"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881729"><span class="hs-identifier hs-var">inner_res_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881730"><span class="annot"><a href="#local-6989586621682881730"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881703"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881729"><span class="hs-identifier hs-var">inner_res_ty</span></a></span><span>
</span><span id="line-874"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881730"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-875"></span><span>                                   </span><span class="hs-comment">-- matching in the branches</span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><a href="#local-6989586621682881722"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621682881731"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881731"><span class="hs-identifier hs-var">m_ty</span></a></span></span><span> </span><span id="local-6989586621682881732"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881732"><span class="hs-identifier hs-var">inner_res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881733"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881733"><span class="hs-identifier hs-var">tup_ty_in</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682881734"><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881734"><span class="hs-identifier hs-var">tup_tys_in</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span id="local-6989586621682881735"><span class="annot"><span class="annottext">XParStmtBlock GhcRn GhcRn
</span><a href="#local-6989586621682881735"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682881736"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682881736"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621682881737"><span class="annot"><span class="annottext">[IdP GhcRn]
</span><a href="#local-6989586621682881737"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621682881738"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881738"><span class="hs-identifier hs-var">return_op</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682881739"><span class="annot"><span class="annottext">[ParStmtBlock GhcRn GhcRn]
</span><a href="#local-6989586621682881739"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881740"><span class="annot"><span class="annottext">m_tup_ty :: Mult
</span><a href="#local-6989586621682881740"><span class="hs-identifier hs-var hs-var hs-var">m_tup_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881731"><span class="hs-identifier hs-var">m_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881733"><span class="hs-identifier hs-var">tup_ty_in</span></a></span><span>
</span><span id="line-880"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881741"><span class="annot"><a href="#local-6989586621682881741"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881742"><span class="annot"><a href="#local-6989586621682881742"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881743"><span class="annot"><a href="#local-6989586621682881743"><span class="hs-identifier hs-var">return_op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881744"><span class="annot"><a href="#local-6989586621682881744"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881745"><span class="annot"><a href="#local-6989586621682881745"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; (ExpRhoType
    -&gt; TcM ([Id], SyntaxExprTc, [ParStmtBlock GhcTc GhcTc], thing))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      ([Id], SyntaxExprTc, [ParStmtBlock GhcTc GhcTc], thing))
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881698"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM thing)
-&gt; TcM
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621682881736"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881740"><span class="hs-identifier hs-var">m_tup_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ExpRhoType
  -&gt; TcM ([Id], SyntaxExprTc, [ParStmtBlock GhcTc GhcTc], thing))
 -&gt; TcM
      ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
       ([Id], SyntaxExprTc, [ParStmtBlock GhcTc GhcTc], thing)))
-&gt; (ExpRhoType
    -&gt; TcM ([Id], SyntaxExprTc, [ParStmtBlock GhcTc GhcTc], thing))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      ([Id], SyntaxExprTc, [ParStmtBlock GhcTc GhcTc], thing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-882"></span><span>                   </span><span class="hs-glyph">\</span><span id="local-6989586621682881746"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881746"><span class="hs-identifier hs-var">m_tup_ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-883"></span><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881747"><span class="annot"><a href="#local-6989586621682881747"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; TcM [Id]
</span><a href="GHC.Tc.Utils.Env.html#tcLookupLocalIds"><span class="hs-identifier hs-var">tcLookupLocalIds</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621682881737"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-884"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881748"><span class="annot"><a href="#local-6989586621682881748"><span class="hs-identifier hs-var hs-var">tup_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Mult
HasDebugCallStack =&gt; [Id] -&gt; Mult
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881747"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-885"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881749"><span class="annot"><a href="#local-6989586621682881749"><span class="hs-identifier hs-var">return_op'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-886"></span><span>                          </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#MCompOrigin"><span class="hs-identifier hs-type">MCompOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881738"><span class="hs-identifier hs-type">return_op</span></a></span><span>
</span><span id="line-887"></span><span>                                     </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881748"><span class="hs-identifier hs-type">tup_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621682881746"><span class="hs-identifier hs-type">m_tup_ty'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-888"></span><span>                                     </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881750"><span class="annot"><a href="#local-6989586621682881750"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881751"><span class="annot"><a href="#local-6989586621682881751"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881722"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881731"><span class="hs-identifier hs-type">m_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881732"><span class="hs-identifier hs-type">inner_res_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881734"><span class="hs-identifier hs-type">tup_tys_in</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881739"><span class="hs-identifier hs-type">pairs</span></a></span><span>
</span><span id="line-890"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881747"><span class="hs-identifier hs-type">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881749"><span class="hs-identifier hs-type">return_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881750"><span class="hs-identifier hs-type">pairs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881751"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-891"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ParStmtBlock"><span class="hs-identifier hs-type">ParStmtBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881735"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881741"><span class="hs-identifier hs-type">stmts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881742"><span class="hs-identifier hs-type">ids</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881743"><span class="hs-identifier hs-type">return_op'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682881744"><span class="hs-identifier hs-type">pairs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881745"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-892"></span><span>    </span><span class="annot"><a href="#local-6989586621682881722"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[ParStmtBlock GhcRn GhcRn]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ([ParStmtBlock GhcTc GhcTc], thing)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcMcStmt.loop&quot;</span></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMcStmt"><span class="hs-identifier hs-var">tcMcStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881752"><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881752"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcMcStmt: unexpected Stmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881752"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-899"></span><span class="hs-comment">--           Do-notation</span><span>
</span><span id="line-900"></span><span class="hs-comment">--        (supports rebindable syntax)</span><span>
</span><span id="line-901"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-type">tcDoStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#TcExprStmtChecker"><span class="hs-identifier hs-type">TcExprStmtChecker</span></a></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span id="tcDoStmt"><span class="annot"><span class="annottext">tcDoStmt :: TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var hs-var">tcDoStmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span id="local-6989586621682881826"><span class="annot"><span class="annottext">XLastStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881826"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682881827"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881827"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682881828"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621682881828"><span class="hs-identifier hs-var">noret</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881829"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881829"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881830"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881830"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881831"><span class="annot"><a href="#local-6989586621682881831"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881827"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881829"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-907"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881832"><span class="annot"><a href="#local-6989586621682881832"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682881830"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-type">panic</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcDoStmt: thing_inside&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881826"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881831"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881828"><span class="hs-identifier hs-type">noret</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881832"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-909"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span id="local-6989586621682881833"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881833"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span id="local-6989586621682881834"><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881834"><span class="hs-identifier hs-var">xbsrn</span></a></span></span><span> </span><span id="local-6989586621682881835"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682881835"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682881836"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881836"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881837"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881837"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881838"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881838"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-910"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Deal with rebindable syntax:</span><span>
</span><span id="line-911"></span><span>                </span><span class="hs-comment">--       (&gt;&gt;=) :: rhs_ty -&gt;_rhs_mult (pat_ty -&gt;_pat_mult new_res_ty) -&gt;_fun_mult res_ty</span><span>
</span><span id="line-912"></span><span>                </span><span class="hs-comment">-- This level of generality is needed for using do-notation</span><span>
</span><span id="line-913"></span><span>                </span><span class="hs-comment">-- in full generality; see #1537</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881839"><span class="annot"><a href="#local-6989586621682881839"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881840"><span class="annot"><a href="#local-6989586621682881840"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881841"><span class="annot"><a href="#local-6989586621682881841"><span class="hs-identifier hs-var">pat_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881842"><span class="annot"><a href="#local-6989586621682881842"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881843"><span class="annot"><a href="#local-6989586621682881843"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881844"><span class="annot"><a href="#local-6989586621682881844"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881845"><span class="annot"><a href="#local-6989586621682881845"><span class="hs-identifier hs-var">bind_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM
         (Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
          GenLocated SrcSpanAnnA (Pat GhcTc), Mult, thing))
-&gt; TcM
     ((Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
       GenLocated SrcSpanAnnA (Pat GhcTc), Mult, thing),
      SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XBindStmtRn -&gt; SyntaxExpr GhcRn
</span><a href="GHC.Hs.Expr.html#xbsrn_bindOp"><span class="hs-identifier hs-var">xbsrn_bindOp</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
XBindStmtRn
</span><a href="#local-6989586621682881834"><span class="hs-identifier hs-var">xbsrn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType -&gt; SyntaxOpType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-var">SynFun</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881837"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; TcM
       (Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
        GenLocated SrcSpanAnnA (Pat GhcTc), Mult, thing))
 -&gt; TcM
      ((Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
        GenLocated SrcSpanAnnA (Pat GhcTc), Mult, thing),
       SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM
         (Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
          GenLocated SrcSpanAnnA (Pat GhcTc), Mult, thing))
-&gt; TcM
     ((Mult, GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult,
       GenLocated SrcSpanAnnA (Pat GhcTc), Mult, thing),
      SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-917"></span><span>                </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881847"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881847"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881848"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881848"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881849"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881849"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881850"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881850"><span class="hs-identifier hs-var">rhs_mult</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682881851"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881851"><span class="hs-identifier hs-var">fun_mult</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682881852"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881852"><span class="hs-identifier hs-var">pat_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-918"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881853"><span class="annot"><a href="#local-6989586621682881853"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881850"><span class="hs-identifier hs-var">rhs_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var">tcCheckMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881836"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881847"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-919"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881854"><span class="annot"><a href="#local-6989586621682881854"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881855"><span class="annot"><a href="#local-6989586621682881855"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881851"><span class="hs-identifier hs-type">fun_mult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881833"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881835"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881852"><span class="hs-identifier hs-type">pat_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881848"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-920"></span><span>                                      </span><span class="annot"><a href="#local-6989586621682881838"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881849"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881847"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881853"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881852"><span class="hs-identifier hs-type">pat_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881854"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881849"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881855"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-922"></span><span>
</span><span id="line-923"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBindStmt"><span class="hs-identifier hs-type">FRRBindStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DoNotation"><span class="hs-identifier hs-type">DoNotation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881839"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-comment">-- If (but only if) the pattern can fail, typecheck the 'fail' operator</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881857"><span class="annot"><a href="#local-6989586621682881857"><span class="hs-identifier hs-var">fail_op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">join</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#xbsrn_failOp"><span class="hs-identifier hs-var">xbsrn_failOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881834"><span class="hs-identifier hs-type">xbsrn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682881858"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682881858"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-927"></span><span>            </span><span class="annot"><span class="annottext">CtOrigin
-&gt; LPat GhcTc
-&gt; SyntaxExpr GhcRn
-&gt; Mult
-&gt; TcRn (FailOperator GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcMonadFailOp"><span class="hs-identifier hs-var">tcMonadFailOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoPatOrigin"><span class="hs-identifier hs-var">DoPatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682881835"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621682881842"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881858"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881843"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span>
</span><span id="line-928"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881860"><span class="annot"><a href="#local-6989586621682881860"><span class="hs-identifier hs-var hs-var">xbstc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#XBindStmtTc"><span class="hs-identifier hs-type">XBindStmtTc</span></a></span><span>
</span><span id="line-929"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xbstc_bindOp :: SyntaxExpr GhcTc
</span><a href="#local-6989586621682881613"><span class="hs-identifier hs-var">xbstc_bindOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
SyntaxExprTc
</span><a href="#local-6989586621682881845"><span class="hs-identifier hs-var">bind_op'</span></a></span><span>
</span><span id="line-930"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbstc_boundResultType :: Mult
</span><a href="#local-6989586621682881614"><span class="hs-identifier hs-var">xbstc_boundResultType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881843"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span>
</span><span id="line-931"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbstc_boundResultMult :: Mult
</span><a href="#local-6989586621682881615"><span class="hs-identifier hs-var">xbstc_boundResultMult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881841"><span class="hs-identifier hs-var">pat_mult</span></a></span><span>
</span><span id="line-932"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">xbstc_failOp :: FailOperator GhcTc
</span><a href="#local-6989586621682881616"><span class="hs-identifier hs-var">xbstc_failOp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FailOperator GhcTc
Maybe SyntaxExprTc
</span><a href="#local-6989586621682881857"><span class="hs-identifier hs-var">fail_op'</span></a></span><span>
</span><span id="line-933"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-934"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881860"><span class="hs-identifier hs-type">xbstc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881842"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881840"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881844"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span id="local-6989586621682881861"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881861"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-type">ApplicativeStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XApplicativeStmt
  GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881862"><span class="annot"><span class="annottext">[(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
</span><a href="#local-6989586621682881862"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span id="local-6989586621682881863"><span class="annot"><span class="annottext">FailOperator GhcRn
</span><a href="#local-6989586621682881863"><span class="hs-identifier hs-var">mb_join</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881864"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881864"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881865"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881865"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-937"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881866"><span class="annot"><span class="annottext">tc_app_stmts :: ExpRhoType
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
</span><a href="#local-6989586621682881866"><span class="hs-identifier hs-var hs-var hs-var">tc_app_stmts</span></a></span></span><span> </span><span id="local-6989586621682881867"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881867"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; [(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
-&gt; ExpRhoType
-&gt; (Mult -&gt; TcM thing)
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
forall t.
HsStmtContextRn
-&gt; [(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
-&gt; ExpRhoType
-&gt; (Mult -&gt; TcM t)
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, t)
</span><a href="GHC.Tc.Gen.Match.html#tcApplicativeStmts"><span class="hs-identifier hs-var">tcApplicativeStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881861"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
</span><a href="#local-6989586621682881862"><span class="hs-identifier hs-var">pairs</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881867"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">((Mult -&gt; TcM thing)
 -&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing))
-&gt; (Mult -&gt; TcM thing)
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-938"></span><span>                                </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881865"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpRhoType -&gt; TcM thing)
-&gt; (Mult -&gt; ExpRhoType) -&gt; Mult -&gt; TcM thing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span>
</span><span id="line-939"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881869"><span class="annot"><a href="#local-6989586621682881869"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881870"><span class="annot"><a href="#local-6989586621682881870"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881871"><span class="annot"><a href="#local-6989586621682881871"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881872"><span class="annot"><a href="#local-6989586621682881872"><span class="hs-identifier hs-var">mb_join'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FailOperator GhcRn
</span><a href="#local-6989586621682881863"><span class="hs-identifier hs-var">mb_join</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-940"></span><span>            </span><span class="annot"><span class="annottext">FailOperator GhcRn
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing)
 -&gt; (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
     Maybe SyntaxExprTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     ([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
      Maybe SyntaxExprTc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
</span><a href="#local-6989586621682881866"><span class="hs-identifier hs-var">tc_app_stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881864"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-941"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682881873"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881873"><span class="hs-identifier hs-var">join_op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-942"></span><span>              </span><span class="annot"><span class="annottext">(SyntaxExprTc -&gt; Maybe SyntaxExprTc)
-&gt; (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
    SyntaxExprTc)
-&gt; (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
    Maybe SyntaxExprTc)
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc -&gt; Maybe SyntaxExprTc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
  SyntaxExprTc)
 -&gt; (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
     Maybe SyntaxExprTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
      SyntaxExprTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
      Maybe SyntaxExprTc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-943"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         ([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
      SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881873"><span class="hs-identifier hs-var">join_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881864"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; IOEnv
       (Env TcGblEnv TcLclEnv)
       ([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing))
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
       SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; IOEnv
         (Env TcGblEnv TcLclEnv)
         ([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (([(SyntaxExprTc, ApplicativeArg GhcTc)], Mult, thing),
      SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-944"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881874"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881874"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881875"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881875"><span class="hs-identifier hs-var">rhs_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881875"><span class="hs-identifier hs-var">rhs_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
 -&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing))
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, thing)
</span><a href="#local-6989586621682881866"><span class="hs-identifier hs-var">tc_app_stmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881874"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeStmt"><span class="hs-identifier hs-type">ApplicativeStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881870"><span class="hs-identifier hs-type">body_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881869"><span class="hs-identifier hs-type">pairs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881872"><span class="hs-identifier hs-type">mb_join'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881871"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-947"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcRn GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881876"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881876"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682881877"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881877"><span class="hs-identifier hs-var">then_op</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682881878"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881878"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881879"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881879"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-948"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Deal with rebindable syntax;</span><span>
</span><span id="line-949"></span><span>                </span><span class="hs-comment">--   (&gt;&gt;) :: rhs_ty -&gt; new_res_ty -&gt; res_ty</span><span>
</span><span id="line-950"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881880"><span class="annot"><a href="#local-6989586621682881880"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881881"><span class="annot"><a href="#local-6989586621682881881"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881882"><span class="annot"><a href="#local-6989586621682881882"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881883"><span class="annot"><a href="#local-6989586621682881883"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881884"><span class="annot"><a href="#local-6989586621682881884"><span class="hs-identifier hs-var">then_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, thing))
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, thing),
      SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881877"><span class="hs-identifier hs-var">then_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881878"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult]
  -&gt; [Mult]
  -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, thing))
 -&gt; TcM
      ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, thing),
       SyntaxExprTc))
-&gt; ([Mult]
    -&gt; [Mult]
    -&gt; TcM (GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, thing))
-&gt; TcM
     ((GenLocated SrcSpanAnnA (HsExpr GhcTc), Mult, Mult, thing),
      SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-952"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881885"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881885"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881886"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881886"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881887"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881887"><span class="hs-identifier hs-var">rhs_mult</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682881888"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881888"><span class="hs-identifier hs-var">fun_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-953"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881889"><span class="annot"><a href="#local-6989586621682881889"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Mult -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881887"><span class="hs-identifier hs-var">rhs_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var">tcCheckMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682881876"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881885"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-954"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881890"><span class="annot"><a href="#local-6989586621682881890"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881888"><span class="hs-identifier hs-type">fun_mult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682881879"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881886"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881889"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881885"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881886"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881890"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-956"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBodyStmt"><span class="hs-identifier hs-type">FRRBodyStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DoNotation"><span class="hs-identifier hs-type">DoNotation</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881881"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span>
</span><span id="line-957"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-type">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FRRBodyStmt"><span class="hs-identifier hs-type">FRRBodyStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DoNotation"><span class="hs-identifier hs-type">DoNotation</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682881882"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span>
</span><span id="line-958"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881881"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881880"><span class="hs-identifier hs-type">rhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881884"><span class="hs-identifier hs-type">then_op'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#noSyntaxExpr"><span class="hs-identifier hs-type">noSyntaxExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881883"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-959"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span id="local-6989586621682881891"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881891"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recS_stmts :: forall idL idR body.
StmtLR idL idR body -&gt; XRec idR [LStmtLR idL idR body]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682881894"><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682881894"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682881895"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA (Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682881895"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_later_ids :: forall idL idR body. StmtLR idL idR body -&gt; [IdP idR]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_later_ids"><span class="hs-identifier hs-var">recS_later_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881897"><span class="annot"><span class="annottext">[IdP GhcRn]
</span><a href="#local-6989586621682881897"><span class="hs-identifier hs-var">later_names</span></a></span></span><span>
</span><span id="line-960"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_rec_ids :: forall idL idR body. StmtLR idL idR body -&gt; [IdP idR]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_rec_ids"><span class="hs-identifier hs-var">recS_rec_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881899"><span class="annot"><span class="annottext">[IdP GhcRn]
</span><a href="#local-6989586621682881899"><span class="hs-identifier hs-var">rec_names</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_ret_fn :: forall idL idR body. StmtLR idL idR body -&gt; SyntaxExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#recS_ret_fn"><span class="hs-identifier hs-var">recS_ret_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881901"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881901"><span class="hs-identifier hs-var">ret_op</span></a></span></span><span>
</span><span id="line-961"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_mfix_fn :: forall idL idR body. StmtLR idL idR body -&gt; SyntaxExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#recS_mfix_fn"><span class="hs-identifier hs-var">recS_mfix_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881903"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881903"><span class="hs-identifier hs-var">mfix_op</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_bind_fn :: forall idL idR body. StmtLR idL idR body -&gt; SyntaxExpr idR
</span><a href="Language.Haskell.Syntax.Expr.html#recS_bind_fn"><span class="hs-identifier hs-var">recS_bind_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682881905"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881905"><span class="hs-identifier hs-var">bind_op</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>         </span><span id="local-6989586621682881906"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881906"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682881907"><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881907"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881908"><span class="annot"><span class="annottext">tup_names :: [Name]
</span><a href="#local-6989586621682881908"><span class="hs-identifier hs-var hs-var hs-var">tup_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621682881899"><span class="hs-identifier hs-var">rec_names</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; [Name] -&gt; [Name]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcRn -&gt; [IdP GhcRn] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
</span><a href="#local-6989586621682881899"><span class="hs-identifier hs-var">rec_names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621682881897"><span class="hs-identifier hs-var">later_names</span></a></span><span>
</span><span id="line-964"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881911"><span class="annot"><a href="#local-6989586621682881911"><span class="hs-identifier hs-var">tup_elt_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VisArity -&gt; Mult -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Mult]
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; VisArity
forall a. [a] -&gt; VisArity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; VisArity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881908"><span class="hs-identifier hs-var">tup_names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881914"><span class="annot"><a href="#local-6989586621682881914"><span class="hs-identifier hs-var hs-var">tup_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Mult -&gt; Id) -&gt; [Name] -&gt; [Mult] -&gt; [Id]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682881915"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682881915"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682881916"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881916"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Mult -&gt; Mult -&gt; Id
Name -&gt; Mult -&gt; Mult -&gt; Id
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682881915"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881916"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881908"><span class="hs-identifier hs-var">tup_names</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881911"><span class="hs-identifier hs-var">tup_elt_tys</span></a></span><span>
</span><span id="line-966"></span><span>                </span><span class="hs-comment">-- Many because it's a recursive definition</span><span>
</span><span id="line-967"></span><span>              </span><span id="local-6989586621682881917"><span class="annot"><a href="#local-6989586621682881917"><span class="hs-identifier hs-var hs-var">tup_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Mult] -&gt; Mult
HasDebugCallStack =&gt; [Mult] -&gt; Mult
</span><a href="GHC.Core.Make.html#mkBigCoreTupTy"><span class="hs-identifier hs-var">mkBigCoreTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881911"><span class="hs-identifier hs-var">tup_elt_tys</span></a></span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv"><span class="hs-identifier hs-type">tcExtendIdEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881914"><span class="hs-identifier hs-type">tup_ids</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-970"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881918"><span class="annot"><a href="#local-6989586621682881918"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682881919"><span class="annot"><a href="#local-6989586621682881919"><span class="hs-identifier hs-var">ret_op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881920"><span class="annot"><a href="#local-6989586621682881920"><span class="hs-identifier hs-var">tup_rets</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881921"><span class="annot"><a href="#local-6989586621682881921"><span class="hs-identifier hs-var">stmts_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-971"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-type">tcInfer</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682881923"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881923"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-972"></span><span>                   </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM (SyntaxExprTc, [HsExpr GhcTc]))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      (SyntaxExprTc, [HsExpr GhcTc]))
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682881891"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM thing)
-&gt; TcM
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
[GenLocated
   SrcSpanAnnA (Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)))]
</span><a href="#local-6989586621682881895"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881923"><span class="hs-identifier hs-var">exp_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpRhoType -&gt; TcM (SyntaxExprTc, [HsExpr GhcTc]))
 -&gt; TcM
      ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
       (SyntaxExprTc, [HsExpr GhcTc])))
-&gt; (ExpRhoType -&gt; TcM (SyntaxExprTc, [HsExpr GhcTc]))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      (SyntaxExprTc, [HsExpr GhcTc]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682881924"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881924"><span class="hs-identifier hs-var">inner_res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-973"></span><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881925"><span class="annot"><a href="#local-6989586621682881925"><span class="hs-identifier hs-var">tup_rets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc))
-&gt; [Name]
-&gt; [ExpRhoType]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [HsExpr GhcTc]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><span class="hs-identifier hs-var">zipWithM</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Head.html#tcCheckId"><span class="hs-identifier hs-var">tcCheckId</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682881908"><span class="hs-identifier hs-var">tup_names</span></a></span><span>
</span><span id="line-974"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Mult -&gt; ExpRhoType) -&gt; [Mult] -&gt; [ExpRhoType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682881911"><span class="hs-identifier hs-var">tup_elt_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>                             </span><span class="hs-comment">-- Unify the types of the &quot;final&quot; Ids (which may</span><span>
</span><span id="line-976"></span><span>                             </span><span class="hs-comment">-- be polymorphic) with those of &quot;knot-tied&quot; Ids</span><span>
</span><span id="line-977"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881927"><span class="annot"><a href="#local-6989586621682881927"><span class="hs-identifier hs-var">ret_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-978"></span><span>                          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-type">DoOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881901"><span class="hs-identifier hs-type">ret_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881917"><span class="hs-identifier hs-type">tup_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-979"></span><span>                                        </span><span class="annot"><a href="#local-6989586621682881924"><span class="hs-identifier hs-type">inner_res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881927"><span class="hs-identifier hs-type">ret_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881925"><span class="hs-identifier hs-type">tup_rets</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881928"><span class="annot"><a href="#local-6989586621682881928"><span class="hs-identifier hs-var">mfix_op'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881929"><span class="annot"><a href="#local-6989586621682881929"><span class="hs-identifier hs-var">mfix_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-type">tcInfer</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682881930"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881930"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-984"></span><span>               </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcRn ())
-&gt; TcM ((), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682881903"><span class="hs-identifier hs-var">mfix_op</span></a></span><span>
</span><span id="line-985"></span><span>                          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mult -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-var">synKnownType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Mult -&gt; Mult -&gt; Mult
Mult -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881917"><span class="hs-identifier hs-var">tup_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881921"><span class="hs-identifier hs-var">stmts_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682881930"><span class="hs-identifier hs-var">exp_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult] -&gt; [Mult] -&gt; TcRn ()) -&gt; TcM ((), SyntaxExprTc))
-&gt; ([Mult] -&gt; [Mult] -&gt; TcRn ()) -&gt; TcM ((), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-986"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682881931"><span class="annot"><a href="#local-6989586621682881931"><span class="hs-identifier hs-var">thing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881932"><span class="annot"><a href="#local-6989586621682881932"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682881933"><span class="annot"><a href="#local-6989586621682881933"><span class="hs-identifier hs-var">bind_op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-type">DoOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881905"><span class="hs-identifier hs-type">bind_op</span></a></span><span>
</span><span id="line-990"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881929"><span class="hs-identifier hs-type">mfix_res_ty</span></a></span><span>
</span><span id="line-991"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881917"><span class="hs-identifier hs-type">tup_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-type">SynRho</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-992"></span><span>                          </span><span class="annot"><a href="#local-6989586621682881906"><span class="hs-identifier hs-type">res_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-993"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682881934"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881934"><span class="hs-identifier hs-var">new_res_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-994"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682881935"><span class="annot"><a href="#local-6989586621682881935"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><a href="#local-6989586621682881907"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881934"><span class="hs-identifier hs-var">new_res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682881935"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881934"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682881936"><span class="annot"><a href="#local-6989586621682881936"><span class="hs-identifier hs-var hs-var">rec_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Id] -&gt; [Id]
forall b a. [b] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#takeList"><span class="hs-identifier hs-var">takeList</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP GhcRn]
[Name]
</span><a href="#local-6989586621682881899"><span class="hs-identifier hs-var">rec_names</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682881914"><span class="hs-identifier hs-var">tup_ids</span></a></span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682881938"><span class="annot"><a href="#local-6989586621682881938"><span class="hs-identifier hs-var">later_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupLocalIds"><span class="hs-identifier hs-type">tcLookupLocalIds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881897"><span class="hs-identifier hs-type">later_names</span></a></span><span>
</span><span id="line-999"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcdo&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881936"><span class="hs-identifier hs-type">rec_ids</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881936"><span class="hs-identifier hs-type">rec_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1000"></span><span>                                 </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881938"><span class="hs-identifier hs-type">later_ids</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881938"><span class="hs-identifier hs-type">later_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1001"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881894"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881918"><span class="hs-identifier hs-type">stmts'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_later_ids"><span class="hs-identifier hs-var">recS_later_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881938"><span class="hs-identifier hs-type">later_ids</span></a></span><span>
</span><span id="line-1002"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_rec_ids"><span class="hs-identifier hs-var">recS_rec_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881936"><span class="hs-identifier hs-type">rec_ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_ret_fn"><span class="hs-identifier hs-var">recS_ret_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881919"><span class="hs-identifier hs-type">ret_op'</span></a></span><span>
</span><span id="line-1003"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_mfix_fn"><span class="hs-identifier hs-var">recS_mfix_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881928"><span class="hs-identifier hs-type">mfix_op'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_bind_fn"><span class="hs-identifier hs-var">recS_bind_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881933"><span class="hs-identifier hs-type">bind_op'</span></a></span><span>
</span><span id="line-1004"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#recS_ext"><span class="hs-identifier hs-var">recS_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#RecStmtTc"><span class="hs-identifier hs-type">RecStmtTc</span></a></span><span>
</span><span id="line-1005"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#recS_bind_ty"><span class="hs-identifier hs-var">recS_bind_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881932"><span class="hs-identifier hs-type">new_res_ty</span></a></span><span>
</span><span id="line-1006"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#recS_later_rets"><span class="hs-identifier hs-var">recS_later_rets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1007"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#recS_rec_rets"><span class="hs-identifier hs-var">recS_rec_rets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881920"><span class="hs-identifier hs-type">tup_rets</span></a></span><span>
</span><span id="line-1008"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#recS_ret_ty"><span class="hs-identifier hs-var">recS_ret_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682881921"><span class="hs-identifier hs-type">stmts_ty</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682881931"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1010"></span><span>
</span><span id="line-1011"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682881946"><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881946"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM thing
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcDoStmt: unexpected Stmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
</span><a href="#local-6989586621682881946"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-1017"></span><span class="hs-comment">-- MonadFail Proposal warnings</span><span>
</span><span id="line-1018"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="hs-comment">-- The idea behind issuing MonadFail warnings is that we add them whenever a</span><span>
</span><span id="line-1021"></span><span class="hs-comment">-- failable pattern is encountered. However, instead of throwing a type error</span><span>
</span><span id="line-1022"></span><span class="hs-comment">-- when the constraint cannot be satisfied, we only issue a warning in</span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- &quot;GHC.Tc.Errors&quot;.</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcMonadFailOp"><span class="hs-identifier hs-type">tcMonadFailOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1026"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-1027"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>    </span><span class="hs-comment">-- The fail op</span><span>
</span><span id="line-1028"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>              </span><span class="hs-comment">-- Type of the whole do-expression</span><span>
</span><span id="line-1029"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#FailOperator"><span class="hs-identifier hs-type">FailOperator</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Typechecked fail op</span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- Get a 'fail' operator expression, to use if the pattern match fails.</span><span>
</span><span id="line-1031"></span><span class="hs-comment">-- This won't be used in cases where we've already determined the pattern</span><span>
</span><span id="line-1032"></span><span class="hs-comment">-- match can't fail (so the fail op is Nothing), however, it seems that the</span><span>
</span><span id="line-1033"></span><span class="hs-comment">-- isIrrefutableHsPat test is still required here for some reason I haven't</span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- yet determined.</span><span>
</span><span id="line-1035"></span><span id="tcMonadFailOp"><span class="annot"><span class="annottext">tcMonadFailOp :: CtOrigin
-&gt; LPat GhcTc
-&gt; SyntaxExpr GhcRn
-&gt; Mult
-&gt; TcRn (FailOperator GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcMonadFailOp"><span class="hs-identifier hs-var hs-var">tcMonadFailOp</span></a></span></span><span> </span><span id="local-6989586621682881948"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682881948"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682881949"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621682881949"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682881950"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621682881950"><span class="hs-identifier hs-var">fail_op</span></a></span></span><span> </span><span id="local-6989586621682881951"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682881951"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1036"></span><span>    </span><span id="local-6989586621682881952"><span class="annot"><a href="#local-6989586621682881952"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1037"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#isIrrefutableHsPat"><span class="hs-identifier hs-type">isIrrefutableHsPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881952"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881949"><span class="hs-identifier hs-type">pat</span></a></span><span>
</span><span id="line-1038"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-1039"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881948"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881950"><span class="hs-identifier hs-type">fail_op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-type">synKnownType</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#stringTy"><span class="hs-identifier hs-type">stringTy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1040"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682881951"><span class="hs-identifier hs-type">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span class="hs-comment">{-
Note [Treat rebindable syntax first]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When typechecking
        do { bar; ... } :: IO ()
we want to typecheck 'bar' in the knowledge that it should be an IO thing,
pushing info from the context into the RHS.  To do this, we check the
rebindable syntax first, and push that information into (tcLExprNC rhs).
Otherwise the error shows up when checking the rebindable syntax, and
the expected/inferred stuff is back to front (see #3613).

Note [typechecking ApplicativeStmt]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
join ((\pat1 ... patn -&gt; body) &lt;$&gt; e1 &lt;*&gt; ... &lt;*&gt; en)

fresh type variables:
   pat_ty_1..pat_ty_n
   exp_ty_1..exp_ty_n
   t_1..t_(n-1)

body  :: body_ty
(\pat1 ... patn -&gt; body) :: pat_ty_1 -&gt; ... -&gt; pat_ty_n -&gt; body_ty
pat_i :: pat_ty_i
e_i   :: exp_ty_i
&lt;$&gt;   :: (pat_ty_1 -&gt; ... -&gt; pat_ty_n -&gt; body_ty) -&gt; exp_ty_1 -&gt; t_1
&lt;*&gt;_i :: t_(i-1) -&gt; exp_ty_i -&gt; t_i
join :: tn -&gt; res_ty

Note [Scoping in parallel list comprehensions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In a parallel list comprehension like [ ebody | a &lt;- blah1; e1 | b &lt;- blah2; e2 ]
we want to ensure that in the lexical environment, tcl_rdr :: LocalRdrEnv, we have
  * 'a' in scope in e1, but not 'b'
  * 'b' in scope in e2, but not 'a'
  * Both in scope in ebody
We don't want too /many/ variables in the LocalRdrEnv, else we make stupid
suggestions for an out-of-scope variable (#22940).

To achieve this we:
  * At the start of each branch, reset the LocalRdrEnv to the outer scope.
  * Before typechecking ebody, add to LocalRdrEnv all the variables bound in
    all branches. This step is done with bindLocalNames.
-}</span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span id="local-6989586621682880539"><span class="annot"><a href="GHC.Tc.Gen.Match.html#tcApplicativeStmts"><span class="hs-identifier hs-type">tcApplicativeStmts</span></a></span><span>
</span><span id="line-1087"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsStmtContextRn"><span class="hs-identifier hs-type">HsStmtContextRn</span></a></span><span>
</span><span id="line-1088"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1089"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>                         </span><span class="hs-comment">-- rhs_ty</span><span>
</span><span id="line-1090"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880539"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>               </span><span class="hs-comment">-- thing_inside</span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682880539"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span id="tcApplicativeStmts"><span class="annot"><span class="annottext">tcApplicativeStmts :: forall t.
HsStmtContextRn
-&gt; [(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
-&gt; ExpRhoType
-&gt; (Mult -&gt; TcM t)
-&gt; TcM ([(SyntaxExpr GhcTc, ApplicativeArg GhcTc)], Mult, t)
</span><a href="GHC.Tc.Gen.Match.html#tcApplicativeStmts"><span class="hs-identifier hs-var hs-var">tcApplicativeStmts</span></a></span></span><span> </span><span id="local-6989586621682882001"><span class="annot"><span class="annottext">HsStmtContextRn
</span><a href="#local-6989586621682882001"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682882002"><span class="annot"><span class="annottext">[(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
</span><a href="#local-6989586621682882002"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span id="local-6989586621682882003"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682882003"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span id="local-6989586621682882004"><span class="annot"><span class="annottext">Mult -&gt; TcM t
</span><a href="#local-6989586621682882004"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1094"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682882005"><span class="annot"><a href="#local-6989586621682882005"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; TcM Mult
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1095"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882006"><span class="annot"><a href="#local-6989586621682882006"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SyntaxExprRn, ApplicativeArg GhcRn)] -&gt; VisArity
forall a. [a] -&gt; VisArity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; VisArity
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(SyntaxExpr GhcRn, ApplicativeArg GhcRn)]
[(SyntaxExprRn, ApplicativeArg GhcRn)]
</span><a href="#local-6989586621682882002"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-1096"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882007"><span class="annot"><a href="#local-6989586621682882007"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">replicateM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682882006"><span class="hs-identifier hs-type">arity</span></a></span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newInferExpType"><span class="hs-identifier hs-type">newInferExpType</span></a></span><span>
</span><span id="line-1097"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882010"><span class="annot"><a href="#local-6989586621682882010"><span class="hs-identifier hs-var">exp_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">replicateM</span></span><span> </span><span class="annot"><a href="#local-6989586621682882006"><span class="hs-identifier hs-type">arity</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-1098"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882011"><span class="annot"><a href="#local-6989586621682882011"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">replicateM</span></span><span> </span><span class="annot"><a href="#local-6989586621682882006"><span class="hs-identifier hs-type">arity</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-type">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-1099"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682882012"><span class="annot"><a href="#local-6989586621682882012"><span class="hs-identifier hs-var hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Mult] -&gt; Mult -&gt; Mult
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTysMany"><span class="hs-identifier hs-var">mkVisFunTysMany</span></a></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><a href="#local-6989586621682882011"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882005"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-1100"></span><span>
</span><span id="line-1101"></span><span>       </span><span class="hs-comment">-- NB. do the &lt;$&gt;,&lt;*&gt; operators first, we don't want type errors here</span><span>
</span><span id="line-1102"></span><span>       </span><span class="hs-comment">--     i.e. goOps before goArgs</span><span>
</span><span id="line-1103"></span><span>       </span><span class="hs-comment">-- See Note [Treat rebindable syntax first]</span><span>
</span><span id="line-1104"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882014"><span class="annot"><a href="#local-6989586621682882014"><span class="hs-identifier hs-var">ops</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882015"><span class="annot"><a href="#local-6989586621682882015"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span> </span><span class="annot"><a href="#local-6989586621682882002"><span class="hs-identifier hs-type">pairs</span></a></span><span>
</span><span id="line-1105"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882016"><span class="annot"><a href="#local-6989586621682882016"><span class="hs-identifier hs-var">ops'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682882017"><span class="hs-identifier hs-type">goOps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882012"><span class="hs-identifier hs-type">fun_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip3</span></span><span> </span><span class="annot"><a href="#local-6989586621682882014"><span class="hs-identifier hs-type">ops</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682882007"><span class="hs-identifier hs-type">ts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682882003"><span class="hs-identifier hs-type">rhs_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882010"><span class="hs-identifier hs-type">exp_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>
</span><span id="line-1107"></span><span>      </span><span class="hs-comment">-- Typecheck each ApplicativeArg separately</span><span>
</span><span id="line-1108"></span><span>      </span><span class="hs-comment">-- See Note [ApplicativeDo and constraints]</span><span>
</span><span id="line-1109"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882019"><span class="annot"><a href="#local-6989586621682882019"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682882020"><span class="hs-identifier hs-type">goArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882005"><span class="hs-identifier hs-type">body_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip3</span></span><span> </span><span class="annot"><a href="#local-6989586621682882015"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882011"><span class="hs-identifier hs-type">pat_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882010"><span class="hs-identifier hs-type">exp_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span>      </span><span class="hs-comment">-- Bring into scope all the things bound by the args,</span><span>
</span><span id="line-1112"></span><span>      </span><span class="hs-comment">-- and typecheck the thing_inside</span><span>
</span><span id="line-1113"></span><span>      </span><span class="hs-comment">-- See Note [ApplicativeDo and constraints]</span><span>
</span><span id="line-1114"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882021"><span class="annot"><a href="#local-6989586621682882021"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv"><span class="hs-identifier hs-type">tcExtendIdEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">concatMap</span></span><span> </span><span class="annot"><a href="#local-6989586621682882023"><span class="hs-identifier hs-type">get_arg_bndrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882019"><span class="hs-identifier hs-type">args'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1115"></span><span>               </span><span class="annot"><a href="#local-6989586621682882004"><span class="hs-identifier hs-type">thing_inside</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882005"><span class="hs-identifier hs-type">body_ty</span></a></span><span>
</span><span id="line-1116"></span><span>
</span><span id="line-1117"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621682882016"><span class="hs-identifier hs-type">ops'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882019"><span class="hs-identifier hs-type">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882005"><span class="hs-identifier hs-type">body_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882021"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1119"></span><span>    </span><span id="local-6989586621682882017"><span class="annot"><span class="annottext">goOps :: Mult
-&gt; [(SyntaxExprRn, ExpRhoType, Mult)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [SyntaxExprTc]
</span><a href="#local-6989586621682882017"><span class="hs-identifier hs-var hs-var">goOps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Mult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SyntaxExprTc] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [SyntaxExprTc]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1120"></span><span>    </span><span class="annot"><a href="#local-6989586621682882017"><span class="hs-identifier hs-var">goOps</span></a></span><span> </span><span id="local-6989586621682882031"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882031"><span class="hs-identifier hs-var">t_left</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682882032"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682882032"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682882033"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682882033"><span class="hs-identifier hs-var">t_i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682882034"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882034"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682882035"><span class="annot"><span class="annottext">[(SyntaxExprRn, ExpRhoType, Mult)]
</span><a href="#local-6989586621682882035"><span class="hs-identifier hs-var">ops</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882036"><span class="annot"><a href="#local-6989586621682882036"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcRn ())
-&gt; TcM ((), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([Mult] -&gt; [Mult] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682882032"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1123"></span><span>                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mult -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-var">synKnownType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882031"><span class="hs-identifier hs-var">t_left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-var">synKnownType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882034"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682882033"><span class="hs-identifier hs-var">t_i</span></a></span><span> </span><span class="annot"><span class="annottext">(([Mult] -&gt; [Mult] -&gt; TcRn ()) -&gt; TcM ((), SyntaxExprTc))
-&gt; ([Mult] -&gt; [Mult] -&gt; TcRn ()) -&gt; TcM ((), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1124"></span><span>                   </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Mult]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882037"><span class="annot"><a href="#local-6989586621682882037"><span class="hs-identifier hs-var">t_i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882033"><span class="hs-identifier hs-type">t_i</span></a></span><span>
</span><span id="line-1126"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882038"><span class="annot"><a href="#local-6989586621682882038"><span class="hs-identifier hs-var">ops'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682882017"><span class="hs-identifier hs-type">goOps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882037"><span class="hs-identifier hs-type">t_i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882035"><span class="hs-identifier hs-type">ops</span></a></span><span>
</span><span id="line-1127"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682882036"><span class="hs-identifier hs-type">op'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682882038"><span class="hs-identifier hs-type">ops'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>    </span><span class="annot"><a href="#local-6989586621682882020"><span class="hs-identifier hs-type">goArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span>    </span><span id="local-6989586621682882020"><span class="annot"><span class="annottext">goArg :: Mult
-&gt; (ApplicativeArg GhcRn, Mult, Mult)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
</span><a href="#local-6989586621682882020"><span class="hs-identifier hs-var hs-var">goArg</span></a></span></span><span> </span><span id="local-6989586621682882039"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882039"><span class="hs-identifier hs-var">body_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span>
</span><span id="line-1133"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">xarg_app_arg_one :: forall idL. ApplicativeArg idL -&gt; XApplicativeArgOne idL
</span><a href="Language.Haskell.Syntax.Expr.html#xarg_app_arg_one"><span class="hs-identifier hs-var">xarg_app_arg_one</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682882042"><span class="annot"><span class="annottext">XApplicativeArgOne GhcRn
</span><a href="#local-6989586621682882042"><span class="hs-identifier hs-var">fail_op</span></a></span></span><span>
</span><span id="line-1134"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: forall idL. ApplicativeArg idL -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682882044"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682882044"><span class="hs-identifier hs-var">pat</span></a></span></span><span>
</span><span id="line-1135"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">arg_expr :: forall idL. ApplicativeArg idL -&gt; LHsExpr idL
</span><a href="Language.Haskell.Syntax.Expr.html#arg_expr"><span class="hs-identifier hs-var">arg_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682882046"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682882046"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-1136"></span><span>                    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882047"><span class="annot"><span class="annottext">Bool
is_body_stmt :: Bool
is_body_stmt :: forall idL. ApplicativeArg idL -&gt; Bool
</span><a href="#local-6989586621682882047"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span>
</span><span id="line-1137"></span><span>                    </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882049"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882049"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882050"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882050"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#combineSrcSpans"><span class="hs-identifier hs-var">combineSrcSpans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcRn) -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
GenLocated SrcSpanAnnA (Pat GhcRn)
</span><a href="#local-6989586621682882044"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcRn) -&gt; SrcSpan
forall a e. HasLoc a =&gt; GenLocated a e -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#getLocA"><span class="hs-identifier hs-var">getLocA</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682882046"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1139"></span><span>        </span><span class="annot"><span class="annottext">SDoc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContext (GenLocated SrcSpanAnnN Name)
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn)) -&gt; SDoc
forall (idL :: Pass) (idR :: Pass) fn body.
(OutputableBndrId idL, OutputableBndrId idR, Outputable fn,
 Outputable body,
 Anno (StmtLR (GhcPass idL) (GhcPass idR) body) ~ SrcSpanAnnA) =&gt;
HsStmtContext fn -&gt; StmtLR (GhcPass idL) (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprStmtInCtxt"><span class="hs-identifier hs-var">pprStmtInCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
HsStmtContext (GenLocated SrcSpanAnnN Name)
</span><a href="#local-6989586621682882001"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn
-&gt; GenLocated SrcSpanAnnA (HsExpr GhcRn)
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
forall (bodyR :: * -&gt; *).
LPat GhcRn
-&gt; LocatedA (bodyR GhcRn)
-&gt; StmtLR GhcRn GhcRn (LocatedA (bodyR GhcRn))
</span><a href="GHC.Hs.Utils.html#mkRnBindStmt"><span class="hs-identifier hs-var">mkRnBindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682882044"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
GenLocated SrcSpanAnnA (HsExpr GhcRn)
</span><a href="#local-6989586621682882046"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ApplicativeArg GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1140"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682882055"><span class="annot"><a href="#local-6989586621682882055"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Mult -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var">tcCheckMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621682882046"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882050"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-1141"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882056"><span class="annot"><a href="#local-6989586621682882056"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882001"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882044"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882049"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1142"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1143"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682882057"><span class="annot"><a href="#local-6989586621682882057"><span class="hs-identifier hs-var">fail_op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">join</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682882042"><span class="hs-identifier hs-type">fail_op</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682882058"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621682882058"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1144"></span><span>               </span><span class="annot"><span class="annottext">CtOrigin
-&gt; LPat GhcTc
-&gt; SyntaxExpr GhcRn
-&gt; Mult
-&gt; TcRn (FailOperator GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcMonadFailOp"><span class="hs-identifier hs-var">tcMonadFailOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DoPatOrigin"><span class="hs-identifier hs-var">DoPatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682882044"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
GenLocated SrcSpanAnnA (Pat GhcTc)
</span><a href="#local-6989586621682882056"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621682882058"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882039"><span class="hs-identifier hs-var">body_ty</span></a></span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span>
</span><span id="line-1147"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#xarg_app_arg_one"><span class="hs-identifier hs-var">xarg_app_arg_one</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882057"><span class="hs-identifier hs-type">fail_op'</span></a></span><span>
</span><span id="line-1148"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882056"><span class="hs-identifier hs-type">pat'</span></a></span><span>
</span><span id="line-1149"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#arg_expr"><span class="hs-identifier hs-var">arg_expr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682882055"><span class="hs-identifier hs-type">rhs'</span></a></span><span>
</span><span id="line-1150"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882047"><span class="hs-glyph hs-type hs-var">..</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1151"></span><span>                    </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span>    </span><span class="annot"><a href="#local-6989586621682882020"><span class="hs-identifier hs-var">goArg</span></a></span><span> </span><span id="local-6989586621682882059"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882059"><span class="hs-identifier hs-var">_body_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArgMany"><span class="hs-identifier hs-type">ApplicativeArgMany</span></a></span><span> </span><span id="local-6989586621682882061"><span class="annot"><span class="annottext">XApplicativeArgMany GhcRn
</span><a href="#local-6989586621682882061"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682882062"><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
</span><a href="#local-6989586621682882062"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621682882063"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682882063"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span id="local-6989586621682882064"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621682882064"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682882065"><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621682882065"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882066"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882066"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682882067"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882067"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882068"><span class="annot"><a href="#local-6989586621682882068"><span class="hs-identifier hs-var">stmts'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882069"><span class="annot"><a href="#local-6989586621682882069"><span class="hs-identifier hs-var">ret'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682882070"><span class="annot"><a href="#local-6989586621682882070"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1155"></span><span>                </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; TcStmtChecker HsExpr ExpRhoType
-&gt; [LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
-&gt; ExpRhoType
-&gt; (ExpRhoType
    -&gt; TcM (HsExpr GhcTc, GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      (HsExpr GhcTc, GenLocated SrcSpanAnnA (Pat GhcTc)))
forall (body :: * -&gt; *) rho_type thing.
AnnoBody body =&gt;
HsStmtContextRn
-&gt; TcStmtChecker body rho_type
-&gt; [LStmt GhcRn (LocatedA (body GhcRn))]
-&gt; rho_type
-&gt; (rho_type -&gt; TcM thing)
-&gt; TcM ([LStmt GhcTc (LocatedA (body GhcTc))], thing)
</span><a href="GHC.Tc.Gen.Match.html#tcStmtsAndThen"><span class="hs-identifier hs-var">tcStmtsAndThen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext (GenLocated SrcSpanAnnN Name)
forall fn. HsDoFlavour -&gt; HsStmtContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HsDoFlavour
</span><a href="#local-6989586621682882065"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsStmtContextRn
-&gt; Stmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM thing)
-&gt; TcM
     (StmtLR GhcTc GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc)), thing)
TcStmtChecker HsExpr ExpRhoType
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmt"><span class="hs-identifier hs-var">tcDoStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt GhcRn]
[LStmt GhcRn (GenLocated SrcSpanAnnA (HsExpr GhcRn))]
</span><a href="#local-6989586621682882062"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mult -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682882067"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ExpRhoType
  -&gt; TcM (HsExpr GhcTc, GenLocated SrcSpanAnnA (Pat GhcTc)))
 -&gt; TcM
      ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
       (HsExpr GhcTc, GenLocated SrcSpanAnnA (Pat GhcTc))))
-&gt; (ExpRhoType
    -&gt; TcM (HsExpr GhcTc, GenLocated SrcSpanAnnA (Pat GhcTc)))
-&gt; TcM
     ([LStmt GhcTc (GenLocated SrcSpanAnnA (HsExpr GhcTc))],
      (HsExpr GhcTc, GenLocated SrcSpanAnnA (Pat GhcTc)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1156"></span><span>                </span><span class="hs-glyph">\</span><span id="local-6989586621682882071"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682882071"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1157"></span><span>                  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682882072"><span class="annot"><a href="#local-6989586621682882072"><span class="hs-identifier hs-var">ret'</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621682882063"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621682882071"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1158"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882073"><span class="annot"><a href="#local-6989586621682882073"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-type">StmtCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-type">HsDoStmt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882065"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682882064"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882066"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1159"></span><span>                                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682882072"><span class="hs-identifier hs-type">ret'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682882073"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1162"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArgMany"><span class="hs-identifier hs-type">ApplicativeArgMany</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882061"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882068"><span class="hs-identifier hs-type">stmts'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882069"><span class="hs-identifier hs-type">ret'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882070"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682882065"><span class="hs-identifier hs-type">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span>    </span><span class="annot"><a href="#local-6989586621682882023"><span class="hs-identifier hs-type">get_arg_bndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArg"><span class="hs-identifier hs-type">ApplicativeArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1165"></span><span>    </span><span id="local-6989586621682882023"><span class="annot"><span class="annottext">get_arg_bndrs :: ApplicativeArg GhcTc -&gt; [Id]
</span><a href="#local-6989586621682882023"><span class="hs-identifier hs-var hs-var">get_arg_bndrs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArgOne"><span class="hs-identifier hs-type">ApplicativeArgOne</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">app_arg_pattern :: forall idL. ApplicativeArg idL -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Expr.html#app_arg_pattern"><span class="hs-identifier hs-var">app_arg_pattern</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682882074"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621682882074"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc -&gt; LPat GhcTc -&gt; [IdP GhcTc]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621682882074"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-1166"></span><span>    </span><span class="annot"><a href="#local-6989586621682882023"><span class="hs-identifier hs-var">get_arg_bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ApplicativeArgMany"><span class="hs-identifier hs-type">ApplicativeArgMany</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bv_pattern :: forall idL. ApplicativeArg idL -&gt; LPat idL
</span><a href="Language.Haskell.Syntax.Expr.html#bv_pattern"><span class="hs-identifier hs-var">bv_pattern</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span id="local-6989586621682882078"><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621682882078"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc -&gt; LPat GhcTc -&gt; [IdP GhcTc]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag GhcTc
forall p. CollectFlag p
</span><a href="GHC.Hs.Utils.html#CollNoDictBinders"><span class="hs-identifier hs-var">CollNoDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcTc
</span><a href="#local-6989586621682882078"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span class="hs-comment">{- Note [ApplicativeDo and constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
An applicative-do is supposed to take place in parallel, so
constraints bound in one arm can't possibly be available in another
(#13242).  Our current rule is this (more details and discussion
on the ticket). Consider

   ...stmts...
   ApplicativeStmts [arg1, arg2, ... argN]
   ...more stmts...

where argi :: ApplicativeArg. Each 'argi' itself contains one or more Stmts.
Now, we say that:

* Constraints required by the argi can be solved from
  constraint bound by ...stmts...

* Constraints and existentials bound by the argi are not available
  to solve constraints required either by argj (where i /= j),
  or by ...more stmts....

* Within the stmts of each 'argi' individually, however, constraints bound
  by earlier stmts can be used to solve later ones.

To achieve this, we just typecheck each 'argi' separately, bring all
the variables they bind into scope, and typecheck the thing_inside.

************************************************************************
*                                                                      *
\subsection{Errors and contexts}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span class="hs-comment">-- | @checkArgCounts@ takes a @[RenamedMatch]@ and decides whether the same</span><span>
</span><span id="line-1203"></span><span class="hs-comment">-- number of /required/ args are used in each equation.</span><span>
</span><span id="line-1204"></span><span class="hs-comment">-- Returns the arity, the number of required args</span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- E.g.  f @a True  y = ...</span><span>
</span><span id="line-1206"></span><span class="hs-comment">--       f    False z = ...</span><span>
</span><span id="line-1207"></span><span class="hs-comment">--       The MatchGroup for `f` has arity 2, not 3</span><span>
</span><span id="line-1208"></span><span id="local-6989586621682880263"><span class="annot"><a href="GHC.Tc.Gen.Match.html#checkArgCounts"><span class="hs-identifier hs-type">checkArgCounts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html#AnnoBody"><span class="hs-identifier hs-type">AnnoBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880263"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-1209"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682880263"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#VisArity"><span class="hs-identifier hs-type">VisArity</span></a></span></span><span>
</span><span id="line-1211"></span><span id="checkArgCounts"><span class="annot"><span class="annottext">checkArgCounts :: forall (body :: * -&gt; *).
AnnoBody body =&gt;
MatchGroup GhcRn (LocatedA (body GhcRn)) -&gt; TcM VisArity
</span><a href="GHC.Tc.Gen.Match.html#checkArgCounts"><span class="hs-identifier hs-var hs-var">checkArgCounts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisArity -&gt; TcM VisArity
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VisArity
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- See Note [Empty MatchGroups] in GHC.Rename.Bind</span><span>
</span><span id="line-1213"></span><span>               </span><span class="hs-comment">--   case e of {} or \case {}</span><span>
</span><span id="line-1214"></span><span>               </span><span class="hs-comment">-- Both have arity 1</span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span class="annot"><a href="GHC.Tc.Gen.Match.html#checkArgCounts"><span class="hs-identifier hs-var">checkArgCounts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682882092"><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882092"><span class="hs-identifier hs-var">match1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682882093"><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682882093"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682882093"><span class="hs-identifier hs-var">matches</span></a></span><span>  </span><span class="hs-comment">-- There was only one match; nothing to check</span><span>
</span><span id="line-1218"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisArity -&gt; TcM VisArity
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VisArity
</span><a href="#local-6989586621682882094"><span class="hs-identifier hs-var">n_args1</span></a></span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span>    </span><span class="hs-comment">-- Two or more matches: check that they agree on arity</span><span>
</span><span id="line-1221"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682882095"><span class="annot"><span class="annottext">NonEmpty (LocatedA (Match GhcRn (LocatedA (body GhcRn))))
</span><a href="#local-6989586621682882095"><span class="hs-identifier hs-var">bad_matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (LocatedA (Match GhcRn (LocatedA (body GhcRn)))))
</span><a href="#local-6989586621682882096"><span class="hs-identifier hs-var">mb_bad_matches</span></a></span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM VisArity
forall a. TcRnMessage -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM VisArity) -&gt; TcRnMessage -&gt; TcM VisArity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn -&gt; MatchArgBadMatches -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnMatchesHaveDiffNumArgs"><span class="hs-identifier hs-var">TcRnMatchesHaveDiffNumArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Match GhcRn (LocatedA (body GhcRn))
-&gt; HsMatchContext (LIdP (NoGhcTc GhcRn))
forall p body. Match p body -&gt; HsMatchContext (LIdP (NoGhcTc p))
</span><a href="Language.Haskell.Syntax.Expr.html#m_ctxt"><span class="hs-identifier hs-var">m_ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
-&gt; Match GhcRn (LocatedA (body GhcRn))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882092"><span class="hs-identifier hs-var">match1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>                 </span><span class="annot"><span class="annottext">(MatchArgBadMatches -&gt; TcRnMessage)
-&gt; MatchArgBadMatches -&gt; TcRnMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
-&gt; NonEmpty (LocatedA (Match GhcRn (LocatedA (body GhcRn))))
-&gt; MatchArgBadMatches
forall body.
LocatedA (Match GhcRn body)
-&gt; NonEmpty (LocatedA (Match GhcRn body)) -&gt; MatchArgBadMatches
</span><a href="GHC.Tc.Errors.Types.html#MatchArgMatches"><span class="hs-identifier hs-var">MatchArgMatches</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882092"><span class="hs-identifier hs-var">match1</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (LocatedA (Match GhcRn (LocatedA (body GhcRn))))
</span><a href="#local-6989586621682882095"><span class="hs-identifier hs-var">bad_matches</span></a></span><span>
</span><span id="line-1224"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1225"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisArity -&gt; TcM VisArity
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">VisArity
</span><a href="#local-6989586621682882094"><span class="hs-identifier hs-var">n_args1</span></a></span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1227"></span><span>    </span><span id="local-6989586621682882094"><span class="annot"><span class="annottext">n_args1 :: VisArity
</span><a href="#local-6989586621682882094"><span class="hs-identifier hs-var hs-var">n_args1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn))) -&gt; VisArity
forall body1. LocatedA (Match GhcRn body1) -&gt; VisArity
</span><a href="#local-6989586621682882100"><span class="hs-identifier hs-var">reqd_args_in_match</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882092"><span class="hs-identifier hs-var">match1</span></a></span><span>
</span><span id="line-1228"></span><span>    </span><span id="local-6989586621682882096"><span class="annot"><span class="annottext">mb_bad_matches :: Maybe (NonEmpty (LocatedA (Match GhcRn (LocatedA (body GhcRn)))))
</span><a href="#local-6989586621682882096"><span class="hs-identifier hs-var hs-var">mb_bad_matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
-&gt; Maybe
     (NonEmpty (LocatedA (Match GhcRn (LocatedA (body GhcRn)))))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">NE.nonEmpty</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882102"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682882102"><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882102"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LocatedA (Match GhcRn (LocatedA (body GhcRn)))]
</span><a href="#local-6989586621682882093"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn))) -&gt; VisArity
forall body1. LocatedA (Match GhcRn body1) -&gt; VisArity
</span><a href="#local-6989586621682882100"><span class="hs-identifier hs-var">reqd_args_in_match</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (Match GhcRn (LocatedA (body GhcRn)))
</span><a href="#local-6989586621682882102"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">VisArity -&gt; VisArity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">VisArity
</span><a href="#local-6989586621682882094"><span class="hs-identifier hs-var">n_args1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span>    </span><span id="local-6989586621682880607"><span class="annot"><a href="#local-6989586621682882100"><span class="hs-identifier hs-type">reqd_args_in_match</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682880607"><span class="hs-identifier hs-type">body1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#VisArity"><span class="hs-identifier hs-type">VisArity</span></a></span></span><span>
</span><span id="line-1231"></span><span>    </span><span class="hs-comment">-- Counts the number of /required/ args in the match</span><span>
</span><span id="line-1232"></span><span>    </span><span id="local-6989586621682882100"><span class="annot"><span class="annottext">reqd_args_in_match :: forall body1. LocatedA (Match GhcRn body1) -&gt; VisArity
</span><a href="#local-6989586621682882100"><span class="hs-identifier hs-var hs-var">reqd_args_in_match</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_pats :: forall p body. Match p body -&gt; [LPat p]
</span><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682882104"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621682882104"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat GhcRn) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (Pat GhcRn)] -&gt; VisArity
forall a. (a -&gt; Bool) -&gt; [a] -&gt; VisArity
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat GhcRn -&gt; Bool
forall p. Pat p -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#isVisArgPat"><span class="hs-identifier hs-var">isVisArgPat</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat GhcRn -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (Pat GhcRn) -&gt; Pat GhcRn)
-&gt; GenLocated SrcSpanAnnA (Pat GhcRn)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcRn) -&gt; Pat GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
[GenLocated SrcSpanAnnA (Pat GhcRn)]
</span><a href="#local-6989586621682882104"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-1233"></span></pre></body></html>