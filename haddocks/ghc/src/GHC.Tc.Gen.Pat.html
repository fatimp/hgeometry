<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="annot"><span class="hs-comment">-- | Typechecking patterns</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html"><span class="hs-identifier">GHC.Tc.Gen.Pat</span></a></span><span>
</span><span id="line-18"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier">tcLetPat</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier">newLetBndr</span></a></span><span>
</span><span id="line-20"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier">LetBndrSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier">tcCheckPat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier">tcCheckPat_O</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcInferPat"><span class="hs-identifier">tcInferPat</span></a></span><span>
</span><span id="line-22"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcMatchPats"><span class="hs-identifier">tcMatchPats</span></a></span><span>
</span><span id="line-23"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier">addDataConStupidTheta</span></a></span><span>
</span><span id="line-24"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#isIrrefutableHsPatRnTcM"><span class="hs-identifier">isIrrefutableHsPatRnTcM</span></a></span><span>
</span><span id="line-25"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier">tcSyntaxOpGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier">tcInferRho</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html"><span class="hs-identifier">GHC.Hs.Syn.Type</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html"><span class="hs-identifier">GHC.Tc.Gen.Sig</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier">TcPragEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier">lookupPragEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier">addInlinePrags</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html"><span class="hs-identifier">GHC.Types.FieldLabel</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html"><span class="hs-identifier">GHC.Tc.Utils.Concrete</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier">hasFixedRuntimeRep_syntactic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html"><span class="hs-identifier">GHC.Tc.Zonk.TcType</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier">pprTyVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier">SuccessFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html"><span class="hs-identifier">GHC.Driver.DynFlags</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.10.1-5e10/src//GHC.LanguageExtensions.html/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Arrow.html/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.html/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-identifier">getNth</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html"><span class="hs-identifier">Language.Haskell.Syntax.Basic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier">FieldLabelString</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.html/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.Maybe.html/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                External interface
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621682862477"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier hs-type">tcLetPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span>
</span><span id="line-92"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>
</span><span id="line-93"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862477"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-94"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862477"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-95"></span><span id="tcLetPat"><span class="annot"><span class="annottext">tcLetPat :: forall a.
(Name -&gt; Maybe TyCoVar)
-&gt; LetBndrSpec
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier hs-var hs-var">tcLetPat</span></a></span></span><span> </span><span id="local-6989586621682863005"><span class="annot"><span class="annottext">Name -&gt; Maybe TyCoVar
</span><a href="#local-6989586621682863005"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621682863006"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621682863006"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span id="local-6989586621682863007"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863007"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863008"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863008"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621682863009"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863009"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863010"><span class="annot"><a href="#local-6989586621682863010"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-97"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863012"><span class="annot"><a href="#local-6989586621682863012"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pc_lvl :: TcLevel
</span><a href="GHC.Tc.Gen.Pat.html#pc_lvl"><span class="hs-identifier hs-var">pc_lvl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682863010"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-98"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_sig_fn :: Name -&gt; Maybe TyCoVar
</span><a href="GHC.Tc.Gen.Pat.html#pc_sig_fn"><span class="hs-identifier hs-var">pc_sig_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyCoVar
</span><a href="#local-6989586621682863005"><span class="hs-identifier hs-var">sig_fn</span></a></span><span>
</span><span id="line-99"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_new :: LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#pc_new"><span class="hs-identifier hs-var">pc_new</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621682863006"><span class="hs-identifier hs-var">no_gen</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-100"></span><span>             </span><span id="local-6989586621682863017"><span class="annot"><a href="#local-6989586621682863017"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-101"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatCtxt
</span><a href="#local-6989586621682863012"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-102"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-103"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863023"><span class="annot"><a href="#local-6989586621682863023"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-104"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863025"><span class="annot"><a href="#local-6989586621682863025"><span class="hs-identifier hs-var">mult_co_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682863026"><span class="hs-identifier hs-type">manyIfLazy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863023"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863007"><span class="hs-identifier hs-type">pat</span></a></span><span>
</span><span id="line-105"></span><span>       </span><span class="hs-comment">-- The wrapper checks for correct multiplicities.</span><span>
</span><span id="line-106"></span><span>       </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-107"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863027"><span class="annot"><a href="#local-6989586621682863027"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863028"><span class="annot"><a href="#local-6989586621682863028"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863008"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863017"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863007"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863009"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-108"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863030"><span class="annot"><a href="#local-6989586621682863030"><span class="hs-identifier hs-var">pat_ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863008"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkLHsWrapPat"><span class="hs-identifier hs-type">mkLHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863025"><span class="hs-identifier hs-type">mult_co_wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863027"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863030"><span class="hs-identifier hs-type">pat_ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863028"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- The logic is partly duplicated from decideBangHood in</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- GHC.HsToCore.Utils. Ugh&#8230;</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621682863026"><span class="annot"><span class="annottext">manyIfLazy :: DynFlags
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863026"><span class="hs-identifier hs-var hs-var">manyIfLazy</span></a></span></span><span> </span><span id="local-6989586621682863034"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682863034"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682863035"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863035"><span class="hs-identifier hs-var">lpat</span></a></span></span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.Strict</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682863034"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863038"><span class="hs-identifier hs-var">xstrict</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863035"><span class="hs-identifier hs-var">lpat</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863039"><span class="hs-identifier hs-var">not_xstrict</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863035"><span class="hs-identifier hs-var">lpat</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>        </span><span id="local-6989586621682863038"><span class="annot"><span class="annottext">xstrict :: GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863038"><span class="hs-identifier hs-var hs-var">xstrict</span></a></span></span><span> </span><span id="local-6989586621682863040"><span class="annot"><span class="annottext">p :: GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863040"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLazyPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#LazyPatternReason"><span class="hs-identifier hs-var">LazyPatternReason</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863040"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863008"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="#local-6989586621682863038"><span class="hs-identifier hs-var">xstrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863046"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863046"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863038"><span class="hs-identifier hs-var">xstrict</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863046"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><a href="#local-6989586621682863038"><span class="hs-identifier hs-var">xstrict</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; TcM HsWrapper
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-var">WpHole</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621682863039"><span class="annot"><span class="annottext">not_xstrict :: GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863039"><span class="hs-identifier hs-var hs-var">not_xstrict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; TcM HsWrapper
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-var">WpHole</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><a href="#local-6989586621682863039"><span class="hs-identifier hs-var">not_xstrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; TcM HsWrapper
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-var">WpHole</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><a href="#local-6989586621682863039"><span class="hs-identifier hs-var">not_xstrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863050"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863050"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; TcM HsWrapper
</span><a href="#local-6989586621682863039"><span class="hs-identifier hs-var">not_xstrict</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863050"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="#local-6989586621682863039"><span class="hs-identifier hs-var">not_xstrict</span></a></span><span> </span><span id="local-6989586621682863051"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863051"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#LazyPatternReason"><span class="hs-identifier hs-var">LazyPatternReason</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863051"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863008"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-127"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcMatchPats"><span class="hs-identifier hs-type">tcMatchPats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682862508"><span class="annot"><a href="#local-6989586621682862508"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-128"></span><span>               </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>          </span><span class="annot"><span class="hs-comment">-- ^ patterns</span></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span>             </span><span class="annot"><span class="hs-comment">-- ^ types of the patterns</span></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862508"><span class="hs-identifier hs-type">a</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ checker for the body</span></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862508"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- See Note [tcMatchPats]</span><span>
</span><span id="line-134"></span><span class="hs-comment">--</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- PRECONDITION:</span><span>
</span><span id="line-136"></span><span class="hs-comment">--    number of visible pats::[LPat GhcRn]   (p is visible, @p is invisible)</span><span>
</span><span id="line-137"></span><span class="hs-comment">--      ==</span><span>
</span><span id="line-138"></span><span class="hs-comment">--    number of visible pat_tys::[ExpPatType]   (ExpFunPatTy is visible,</span><span>
</span><span id="line-139"></span><span class="hs-comment">--                                               ExpForAllPatTy b is visible iff b is Required)</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- POSTCONDITION:</span><span>
</span><span id="line-142"></span><span class="hs-comment">--   Returns only the /value/ patterns; see Note [tcMatchPats]</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span id="tcMatchPats"><span class="annot"><span class="annottext">tcMatchPats :: forall a.
HsMatchContextRn
-&gt; [LPat (GhcPass 'Renamed)]
-&gt; [ExpPatType]
-&gt; TcM a
-&gt; TcM ([LPat GhcTc], a)
</span><a href="GHC.Tc.Gen.Pat.html#tcMatchPats"><span class="hs-identifier hs-var hs-var">tcMatchPats</span></a></span></span><span> </span><span id="local-6989586621682863087"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863087"><span class="hs-identifier hs-var">match_ctxt</span></a></span></span><span> </span><span id="local-6989586621682863088"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863088"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621682863089"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863089"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621682863090"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863090"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcM ([LPat GhcTc], a) -&gt; TcM ([LPat GhcTc], a)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ExpPatType -&gt; Bool) -&gt; [ExpPatType] -&gt; Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Int
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">ExpPatType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isVisibleExpPatType"><span class="hs-identifier hs-var">isVisibleExpPatType</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863089"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)) -&gt; Bool)
-&gt; [GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; Int
forall a. (a -&gt; Bool) -&gt; [a] -&gt; Int
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; Bool
forall p. Pat p -&gt; Bool
</span><a href="Language.Haskell.Syntax.Pat.html#isVisArgPat"><span class="hs-identifier hs-var">isVisArgPat</span></a></span><span> </span><span class="annot"><span class="annottext">(Pat (GhcPass 'Renamed) -&gt; Bool)
-&gt; (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
    -&gt; Pat (GhcPass 'Renamed))
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
-&gt; Pat (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863088"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863088"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863089"><span class="hs-identifier hs-var">pat_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM ([LPat GhcTc], a) -&gt; TcM ([LPat GhcTc], a))
-&gt; TcM ([LPat GhcTc], a) -&gt; TcM ([LPat GhcTc], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-147"></span><span>       </span><span class="hs-comment">-- Check PRECONDITION</span><span>
</span><span id="line-148"></span><span>       </span><span class="hs-comment">-- When we get @patterns the (length pats) will change</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863099"><span class="annot"><a href="#local-6989586621682863099"><span class="hs-identifier hs-var">err_ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span>
</span><span id="line-150"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpPatType"><span class="hs-identifier hs-type">ExpPatType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862508"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>             </span><span class="hs-comment">-- No more patterns.  Discard excess pat_tys;</span><span>
</span><span id="line-153"></span><span>             </span><span class="hs-comment">-- they should all be invisible.  Example:</span><span>
</span><span id="line-154"></span><span>             </span><span class="hs-comment">--    f :: Int -&gt; forall a b. blah</span><span>
</span><span id="line-155"></span><span>             </span><span class="hs-comment">--    f x @p = rhs</span><span>
</span><span id="line-156"></span><span>             </span><span class="hs-comment">-- We will call tcMatchPats with</span><span>
</span><span id="line-157"></span><span>             </span><span class="hs-comment">--   pats = [x, @p]</span><span>
</span><span id="line-158"></span><span>             </span><span class="hs-comment">--   pat_tys = [Int, @a, @b]</span><span>
</span><span id="line-159"></span><span>             </span><span id="local-6989586621682863101"><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682863102"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863102"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span>
</span><span id="line-160"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcM ([LPat GhcTc], a) -&gt; TcM ([LPat GhcTc], a)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ExpPatType -&gt; Bool) -&gt; [ExpPatType] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">ExpPatType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isVisibleExpPatType"><span class="hs-identifier hs-var">isVisibleExpPatType</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863102"><span class="hs-identifier hs-var">pat_tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863088"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863102"><span class="hs-identifier hs-var">pat_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM ([LPat GhcTc], a) -&gt; TcM ([LPat GhcTc], a))
-&gt; TcM ([LPat GhcTc], a) -&gt; TcM ([LPat GhcTc], a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-161"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863105"><span class="annot"><a href="#local-6989586621682863105"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcM a -&gt; TcM a
forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var">setErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682863099"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863090"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-162"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863105"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>             </span><span class="hs-comment">-- ExpForAllPat: expecting a type pattern</span><span>
</span><span id="line-165"></span><span>             </span><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621682863107"><span class="annot"><span class="annottext">all_pats :: [LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863107"><span class="hs-identifier hs-var">all_pats</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682863108"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863108"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682863109"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863109"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpForAllPatTy"><span class="hs-identifier hs-type">ExpForAllPatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682863112"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863112"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682863113"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682863113"><span class="hs-identifier hs-var">vis</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682863114"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863114"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleForAllTyFlag"><span class="hs-identifier hs-var">isVisibleForAllTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682863113"><span class="hs-identifier hs-var">vis</span></a></span><span>
</span><span id="line-167"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863116"><span class="annot"><a href="#local-6989586621682863116"><span class="hs-identifier hs-var">_p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863117"><span class="annot"><a href="#local-6989586621682863117"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863118"><span class="annot"><a href="#local-6989586621682863118"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_forall_lpat"><span class="hs-identifier hs-var">tc_forall_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863112"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863120"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863108"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([LPat GhcTc], a) -&gt; TcM (LPat GhcTc, ([LPat GhcTc], a)))
-&gt; TcM ([LPat GhcTc], a) -&gt; TcM (LPat GhcTc, ([LPat GhcTc], a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-168"></span><span>                                         </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)] -&gt; [ExpPatType] -&gt; TcM ([LPat GhcTc], a)
</span><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863109"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863114"><span class="hs-identifier hs-var">pat_tys</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863117"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863118"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-171"></span><span>                    </span><span class="hs-comment">-- This VisPat is Erased.</span><span>
</span><span id="line-172"></span><span>                    </span><span class="hs-comment">-- See Note [Invisible binders in functions] in GHC.Hs.Pat</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>               </span><span class="hs-comment">-- Invisible (Specified) forall in type, and an @a type pattern</span><span>
</span><span id="line-175"></span><span>               </span><span class="hs-comment">-- E.g.    f :: forall a. Bool -&gt; a -&gt; blah</span><span>
</span><span id="line-176"></span><span>               </span><span class="hs-comment">--         f @b True  x = rhs1  -- b is bound to skolem a</span><span>
</span><span id="line-177"></span><span>               </span><span class="hs-comment">--         f @c False y = rhs2  -- c is bound to skolem a</span><span>
</span><span id="line-178"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#InvisPat"><span class="hs-identifier hs-type">InvisPat</span></a></span><span> </span><span class="annot"><span class="annottext">XInvisPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863122"><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621682863122"><span class="hs-identifier hs-var">tp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863108"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-179"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isSpecifiedForAllTyFlag"><span class="hs-identifier hs-var">isSpecifiedForAllTyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682863113"><span class="hs-identifier hs-var">vis</span></a></span><span>
</span><span id="line-180"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863124"><span class="annot"><a href="#local-6989586621682863124"><span class="hs-identifier hs-var">_p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863125"><span class="annot"><a href="#local-6989586621682863125"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863126"><span class="annot"><a href="#local-6989586621682863126"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
-&gt; TyCoVar
-&gt; TcM ([LPat GhcTc], a)
-&gt; TcM (Type, ([LPat GhcTc], a))
forall r.
HsTyPat (GhcPass 'Renamed) -&gt; TyCoVar -&gt; TcM r -&gt; TcM (Type, r)
</span><a href="GHC.Tc.Gen.Pat.html#tc_ty_pat"><span class="hs-identifier hs-var">tc_ty_pat</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863122"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863112"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([LPat GhcTc], a) -&gt; TcM (Type, ([LPat GhcTc], a)))
-&gt; TcM ([LPat GhcTc], a) -&gt; TcM (Type, ([LPat GhcTc], a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-181"></span><span>                                         </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)] -&gt; [ExpPatType] -&gt; TcM ([LPat GhcTc], a)
</span><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863109"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863114"><span class="hs-identifier hs-var">pat_tys</span></a></span><span>
</span><span id="line-182"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863125"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863126"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-comment">-- Discard invisible pat_ty</span><span>
</span><span id="line-185"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)] -&gt; [ExpPatType] -&gt; TcM ([LPat GhcTc], a)
</span><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863107"><span class="hs-identifier hs-var">all_pats</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863114"><span class="hs-identifier hs-var">pat_tys</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>             </span><span class="hs-comment">-- This case handles the user error when an InvisPat is used</span><span>
</span><span id="line-188"></span><span>             </span><span class="hs-comment">-- without a corresponding invisible (Specified) forall in the type</span><span>
</span><span id="line-189"></span><span>             </span><span class="hs-comment">-- E.g. 1.  f :: Int</span><span>
</span><span id="line-190"></span><span>             </span><span class="hs-comment">--          f @a = ...   -- loop (InvisPat{} : _) []</span><span>
</span><span id="line-191"></span><span>             </span><span class="hs-comment">--      2.  f :: Int -&gt; Int</span><span>
</span><span id="line-192"></span><span>             </span><span class="hs-comment">--          f @a x = ... -- loop (InvisPat{} : _) (ExpFunPatTy{} : _)</span><span>
</span><span id="line-193"></span><span>             </span><span class="hs-comment">--      3.  f :: forall a -&gt; Int</span><span>
</span><span id="line-194"></span><span>             </span><span class="hs-comment">--          f @a t = ... -- loop (InvisPat{} : _) (ExpForAllPatTy (Bndr _ Required) : _)</span><span>
</span><span id="line-195"></span><span>             </span><span class="hs-comment">--      4.  f :: forall {a}. Int</span><span>
</span><span id="line-196"></span><span>             </span><span class="hs-comment">--          f @a t = ... -- loop (InvisPat{} : _) (ExpForAllPatTy (Bndr _ Inferred) : _)</span><span>
</span><span id="line-197"></span><span>             </span><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863128"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682863128"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#InvisPat"><span class="hs-identifier hs-type">InvisPat</span></a></span><span> </span><span class="annot"><span class="annottext">XInvisPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863129"><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621682863129"><span class="hs-identifier hs-var">tp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>                </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcRnMessage
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ([GenLocated SrcSpanAnnA (Pat GhcTc)], a)
forall a. SrcSpan -&gt; TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier hs-var">failAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; SrcSpan
forall a. HasLoc a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682863128"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnInvisPatWithNoForAll"><span class="hs-identifier hs-var">TcRnInvisPatWithNoForAll</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863129"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>             </span><span class="hs-comment">-- ExpFunPatTy: expecting a value pattern</span><span>
</span><span id="line-201"></span><span>             </span><span class="hs-comment">-- tc_lpat will error if it sees a @t type pattern</span><span>
</span><span id="line-202"></span><span>             </span><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863133"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863133"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682863134"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863134"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpFunPatTy"><span class="hs-identifier hs-type">ExpFunPatTy</span></a></span><span> </span><span id="local-6989586621682863136"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863136"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682863137"><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863137"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863138"><span class="annot"><a href="#local-6989586621682863138"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863139"><span class="annot"><a href="#local-6989586621682863139"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863140"><span class="annot"><a href="#local-6989586621682863140"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863136"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863120"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863133"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([LPat GhcTc], a) -&gt; TcM (LPat GhcTc, ([LPat GhcTc], a)))
-&gt; TcM ([LPat GhcTc], a) -&gt; TcM (LPat GhcTc, ([LPat GhcTc], a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-204"></span><span>                                        </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)] -&gt; [ExpPatType] -&gt; TcM ([LPat GhcTc], a)
</span><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863134"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[ExpPatType]
</span><a href="#local-6989586621682863137"><span class="hs-identifier hs-var">pat_tys</span></a></span><span>
</span><span id="line-205"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863138"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682863139"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863140"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span>                    </span><span class="hs-comment">-- This VisPat is Retained.</span><span>
</span><span id="line-207"></span><span>                    </span><span class="hs-comment">-- See Note [Invisible binders in functions] in GHC.Hs.Pat</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>             </span><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621682863141"><span class="annot"><span class="annottext">pats :: [LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863141"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) ([GenLocated SrcSpanAnnA (Pat GhcTc)], a)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcMatchPats&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863141"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>                    </span><span class="hs-comment">-- Failure of PRECONDITION</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682863101"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863088"><span class="hs-identifier hs-type">pats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863089"><span class="hs-identifier hs-type">pat_tys</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621682863120"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621682863120"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863087"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span id="local-6989586621682862546"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcInferPat"><span class="hs-identifier hs-type">tcInferPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#FixedRuntimeRepContext"><span class="hs-identifier hs-type">FixedRuntimeRepContext</span></a></span><span>
</span><span id="line-218"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>
</span><span id="line-219"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-220"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862546"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-221"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862546"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-222"></span><span id="tcInferPat"><span class="annot"><span class="annottext">tcInferPat :: forall a.
FixedRuntimeRepContext
-&gt; HsMatchContextRn
-&gt; LPat (GhcPass 'Renamed)
-&gt; TcM a
-&gt; TcM ((LPat GhcTc, a), Type)
</span><a href="GHC.Tc.Gen.Pat.html#tcInferPat"><span class="hs-identifier hs-var hs-var">tcInferPat</span></a></span></span><span> </span><span id="local-6989586621682863145"><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682863145"><span class="hs-identifier hs-var">frr_orig</span></a></span></span><span> </span><span id="local-6989586621682863146"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863146"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682863147"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863147"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863148"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863148"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
-&gt; (ExpSigmaTypeFRR -&gt; TcM (LPat GhcTc, a))
-&gt; TcM ((LPat GhcTc, a), Type)
forall a.
FixedRuntimeRepContext
-&gt; (ExpSigmaTypeFRR -&gt; TcM a) -&gt; TcM (a, Type)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInferFRR"><span class="hs-identifier hs-var">tcInferFRR</span></a></span><span> </span><span class="annot"><span class="annottext">FixedRuntimeRepContext
</span><a href="#local-6989586621682863145"><span class="hs-identifier hs-var">frr_orig</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpSigmaTypeFRR -&gt; TcM (LPat GhcTc, a))
 -&gt; TcM ((LPat GhcTc, a), Type))
-&gt; (ExpSigmaTypeFRR -&gt; TcM (LPat GhcTc, a))
-&gt; TcM ((LPat GhcTc, a), Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682863150"><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863150"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpSigmaTypeFRR -&gt; Scaled ExpSigmaTypeFRR
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863150"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863152"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863147"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863148"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-225"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621682863152"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621682863152"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863146"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span id="local-6989586621682862550"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>
</span><span id="line-229"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span>
</span><span id="line-230"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862550"><span class="hs-identifier hs-type">a</span></a></span><span>                     </span><span class="hs-comment">-- Checker for body</span><span>
</span><span id="line-231"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862550"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-232"></span><span id="tcCheckPat"><span class="annot"><span class="annottext">tcCheckPat :: forall a.
HsMatchContextRn
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled Type
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-var hs-var">tcCheckPat</span></a></span></span><span> </span><span id="local-6989586621682863153"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863153"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
-&gt; CtOrigin
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled Type
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
forall a.
HsMatchContextRn
-&gt; CtOrigin
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled Type
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-var">tcCheckPat_O</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863153"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><span class="hs-comment">-- | A variant of 'tcPat' that takes a custom origin</span></span><span>
</span><span id="line-235"></span><span id="local-6989586621682862552"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-type">tcCheckPat_O</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>
</span><span id="line-236"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ origin to use if the type needs inst'ing</span></span><span>
</span><span id="line-237"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span>
</span><span id="line-238"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862552"><span class="hs-identifier hs-type">a</span></a></span><span>                 </span><span class="hs-comment">-- Checker for body</span><span>
</span><span id="line-239"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862552"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-240"></span><span id="tcCheckPat_O"><span class="annot"><span class="annottext">tcCheckPat_O :: forall a.
HsMatchContextRn
-&gt; CtOrigin
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled Type
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-var hs-var">tcCheckPat_O</span></a></span></span><span> </span><span id="local-6989586621682863154"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863154"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621682863155"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682863155"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621682863156"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863156"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682863158"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863158"><span class="hs-identifier hs-var">pat_mult</span></a></span></span><span> </span><span id="local-6989586621682863159"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863159"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863160"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863160"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR -&gt; Scaled ExpSigmaTypeFRR
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863158"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863159"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863162"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863156"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863160"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621682863162"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621682863162"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863154"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682863155"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">{- Note [tcMatchPats]
~~~~~~~~~~~~~~~~~~~~~
tcMatchPats is the externally-callable wrapper function for
  function definitions  f p1 .. pn = rhs
  lambdas               \p1 .. pn -&gt; body
Typecheck the patterns, extend the environment to bind the variables, do the
thing inside, use any existentially-bound dictionaries to discharge parts of
the returning LIE, and deal with pattern type signatures

It takes the list of patterns writen by the user, but it returns only the
/value/ patterns.  For example:
     f :: forall a. forall b -&gt; a -&gt; Mabye b -&gt; blah
     f @a w x (Just y) = ....
tcMatchPats returns only the /value/ patterns [x, Just y].  Why?  The
desugarer expects only value patterns.  (We could change that, but we would
have to do so carefullly.)  However, distinguishing value patterns from type
patterns is a bit tricky; e.g. the `w` in this example.  So it's very
convenient to filter them out right here.


************************************************************************
*                                                                      *
                PatEnv, PatCtxt, LetBndrSpec
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-keyword">data</span><span> </span><span id="PatEnv"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-var">PatEnv</span></a></span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="PE"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-var">PE</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="pe_lazy"><span class="annot"><span class="annottext">PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var hs-var">pe_lazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>        </span><span class="hs-comment">-- True &lt;=&gt; lazy context, so no existentials allowed</span><span>
</span><span id="line-275"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pe_ctxt"><span class="annot"><span class="annottext">PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var hs-var">pe_ctxt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatCtxt"><span class="hs-identifier hs-type">PatCtxt</span></a></span><span>     </span><span class="hs-comment">-- Context in which the whole pattern appears</span><span>
</span><span id="line-276"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pe_orig"><span class="annot"><span class="annottext">PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var hs-var">pe_orig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>    </span><span class="hs-comment">-- origin to use if the pat_ty needs inst'ing</span><span>
</span><span id="line-277"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-keyword">data</span><span> </span><span id="PatCtxt"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatCtxt"><span class="hs-identifier hs-var">PatCtxt</span></a></span></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LamPat"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span></span><span>   </span><span class="hs-comment">-- Used for lambdas, case etc</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><a href="GHC.Hs.Expr.html#HsMatchContextRn"><span class="hs-identifier hs-type">HsMatchContextRn</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LetPat"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-var">LetPat</span></a></span></span><span>   </span><span class="hs-comment">-- Used only for let(rec) pattern bindings</span><span>
</span><span id="line-284"></span><span>             </span><span class="hs-comment">-- See Note [Typing patterns in pattern bindings]</span><span>
</span><span id="line-285"></span><span>       </span><span class="hs-special">{</span><span> </span><span id="pc_lvl"><span class="annot"><span class="annottext">PatCtxt -&gt; TcLevel
</span><a href="GHC.Tc.Gen.Pat.html#pc_lvl"><span class="hs-identifier hs-var hs-var">pc_lvl</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-286"></span><span>                   </span><span class="hs-comment">-- Level of the binding group</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pc_sig_fn"><span class="annot"><span class="annottext">PatCtxt -&gt; Name -&gt; Maybe TyCoVar
</span><a href="GHC.Tc.Gen.Pat.html#pc_sig_fn"><span class="hs-identifier hs-var hs-var">pc_sig_fn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-289"></span><span>                   </span><span class="hs-comment">-- Tells the expected type</span><span>
</span><span id="line-290"></span><span>                   </span><span class="hs-comment">-- for binders with a signature</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pc_new"><span class="annot"><span class="annottext">PatCtxt -&gt; LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#pc_new"><span class="hs-identifier hs-var hs-var">pc_new</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span>
</span><span id="line-293"></span><span>                </span><span class="hs-comment">-- How to make a new binder</span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-special">}</span><span>        </span><span class="hs-comment">-- for binders without signatures</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-keyword">data</span><span> </span><span id="LetBndrSpec"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-var">LetBndrSpec</span></a></span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LetLclBndr"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span></span><span>            </span><span class="hs-comment">-- We are going to generalise, and wrap in an AbsBinds</span><span>
</span><span id="line-298"></span><span>                          </span><span class="hs-comment">-- so clone a fresh binder for the local monomorphic Id</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LetGblBndr"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-var">LetGblBndr</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>  </span><span class="hs-comment">-- Generalisation plan is NoGen, so there isn't going</span><span>
</span><span id="line-301"></span><span>                          </span><span class="hs-comment">-- to be an AbsBinds; So we must bind the global version</span><span>
</span><span id="line-302"></span><span>                          </span><span class="hs-comment">-- of the binder right away.</span><span>
</span><span id="line-303"></span><span>                          </span><span class="hs-comment">-- And here is the inline-pragma information</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-306"></span><span>  </span><span id="local-6989586621682863170"><span class="annot"><span class="annottext">ppr :: LetBndrSpec -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LetLclBndr&quot;</span></span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-type">LetGblBndr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LetGblBndr&quot;</span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#makeLazy"><span class="hs-identifier hs-type">makeLazy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-310"></span><span id="makeLazy"><span class="annot"><span class="annottext">makeLazy :: PatEnv -&gt; PatEnv
</span><a href="GHC.Tc.Gen.Pat.html#makeLazy"><span class="hs-identifier hs-var hs-var">makeLazy</span></a></span></span><span> </span><span id="local-6989586621682863173"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863173"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863173"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-type">inPatBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-313"></span><span id="inPatBind"><span class="annot"><span class="annottext">inPatBind :: PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var hs-var">inPatBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-314"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var">inPatBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Binders
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-type">tcPatBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span class="hs-comment">-- (coi, xp) = tcPatBndr penv x pat_ty</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- Then coi : pat_ty ~ typeof(xp)</span><span>
</span><span id="line-325"></span><span class="hs-comment">--</span><span>
</span><span id="line-326"></span><span id="tcPatBndr"><span class="annot"><span class="annottext">tcPatBndr :: PatEnv
-&gt; Name -&gt; Scaled ExpSigmaTypeFRR -&gt; TcM (HsWrapper, TyCoVar)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var hs-var">tcPatBndr</span></a></span></span><span> </span><span id="local-6989586621682863176"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621682863176"><span class="hs-identifier hs-var">penv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pc_lvl :: PatCtxt -&gt; TcLevel
</span><a href="GHC.Tc.Gen.Pat.html#pc_lvl"><span class="hs-identifier hs-var">pc_lvl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682863177"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682863177"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span>
</span><span id="line-327"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_sig_fn :: PatCtxt -&gt; Name -&gt; Maybe TyCoVar
</span><a href="GHC.Tc.Gen.Pat.html#pc_sig_fn"><span class="hs-identifier hs-var">pc_sig_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682863178"><span class="annot"><span class="annottext">Name -&gt; Maybe TyCoVar
</span><a href="#local-6989586621682863178"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span>
</span><span id="line-328"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_new :: PatCtxt -&gt; LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#pc_new"><span class="hs-identifier hs-var">pc_new</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682863179"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621682863179"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>          </span><span id="local-6989586621682863180"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863180"><span class="hs-identifier hs-var">bndr_name</span></a></span></span><span> </span><span id="local-6989586621682863181"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863181"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-comment">-- For the LetPat cases, see</span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-comment">-- Note [Typechecking pattern bindings] in GHC.Tc.Gen.Bind</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682863182"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863182"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyCoVar
</span><a href="#local-6989586621682863178"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863180"><span class="hs-identifier hs-var">bndr_name</span></a></span><span>   </span><span class="hs-comment">-- There is a signature</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863183"><span class="annot"><a href="#local-6989586621682863183"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; ExpSigmaTypeFRR -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var">tc_sub_type</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863176"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863181"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863182"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>           </span><span class="hs-comment">-- See Note [Subsumption check at pattern variables]</span><span>
</span><span id="line-336"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcPatBndr(sig)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863182"><span class="hs-identifier hs-type">bndr_id</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863182"><span class="hs-identifier hs-type">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863181"><span class="hs-identifier hs-type">exp_pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863183"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863182"><span class="hs-identifier hs-type">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                          </span><span class="hs-comment">-- No signature</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863187"><span class="annot"><a href="#local-6989586621682863187"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863188"><span class="annot"><a href="#local-6989586621682863188"><span class="hs-identifier hs-var">bndr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863181"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-341"></span><span>             </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621682863190"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863190"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLevel
-&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
</span><a href="GHC.Tc.Utils.TcMType.html#promoteTcType"><span class="hs-identifier hs-var">promoteTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682863177"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863190"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-342"></span><span>             </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span id="local-6989586621682863193"><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621682863193"><span class="hs-identifier hs-var">infer_res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682863177"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">InferResult -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#ir_lvl"><span class="hs-identifier hs-var">ir_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621682863193"><span class="hs-identifier hs-var">infer_res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-343"></span><span>                                </span><span class="hs-comment">-- If we were under a constructor that bumped the</span><span>
</span><span id="line-344"></span><span>                                </span><span class="hs-comment">-- level, we'd be in checking mode (see tcConArg)</span><span>
</span><span id="line-345"></span><span>                                </span><span class="hs-comment">-- hence this assertion</span><span>
</span><span id="line-346"></span><span>                                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863196"><span class="annot"><a href="#local-6989586621682863196"><span class="hs-identifier hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InferResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#inferResultToType"><span class="hs-identifier hs-var">inferResultToType</span></a></span><span> </span><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621682863193"><span class="hs-identifier hs-var">infer_res</span></a></span><span>
</span><span id="line-347"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-type">mkNomReflCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863196"><span class="hs-identifier hs-type">bndr_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863196"><span class="hs-identifier hs-type">bndr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-348"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863199"><span class="annot"><a href="#local-6989586621682863199"><span class="hs-identifier hs-var hs-var">bndr_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863181"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span>
</span><span id="line-349"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863201"><span class="annot"><a href="#local-6989586621682863201"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-type">newLetBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863179"><span class="hs-identifier hs-type">no_gen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863180"><span class="hs-identifier hs-type">bndr_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863199"><span class="hs-identifier hs-type">bndr_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863188"><span class="hs-identifier hs-type">bndr_ty</span></a></span><span>
</span><span id="line-350"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcPatBndr(nosig)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863177"><span class="hs-identifier hs-type">bind_lvl</span></a></span><span>
</span><span id="line-351"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863181"><span class="hs-identifier hs-type">exp_pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863188"><span class="hs-identifier hs-type">bndr_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863187"><span class="hs-identifier hs-type">co</span></a></span><span>
</span><span id="line-352"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863201"><span class="hs-identifier hs-type">bndr_id</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-type">mkWpCastN</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863187"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863201"><span class="hs-identifier hs-type">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var">tcPatBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863204"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863204"><span class="hs-identifier hs-var">bndr_name</span></a></span></span><span> </span><span id="local-6989586621682863205"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863205"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863206"><span class="annot"><span class="annottext">pat_mult :: Type
</span><a href="#local-6989586621682863206"><span class="hs-identifier hs-var hs-var hs-var">pat_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863205"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-357"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863207"><span class="annot"><a href="#local-6989586621682863207"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863205"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcPatBndr(not let)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863204"><span class="hs-identifier hs-type">bndr_name</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863207"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-type">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-type">mkLocalIdOrCoVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863204"><span class="hs-identifier hs-type">bndr_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863206"><span class="hs-identifier hs-type">pat_mult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863207"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-360"></span><span>               </span><span class="hs-comment">-- We should not have &quot;OrCoVar&quot; here, this is a bug (#17545)</span><span>
</span><span id="line-361"></span><span>               </span><span class="hs-comment">-- Whether or not there is a sig is irrelevant,</span><span>
</span><span id="line-362"></span><span>               </span><span class="hs-comment">-- as this is local</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-type">newLetBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.BasicTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-365"></span><span class="hs-comment">-- Make up a suitable Id for the pattern-binder.</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- See Note [Typechecking pattern bindings], item (4) in GHC.Tc.Gen.Bind</span><span>
</span><span id="line-367"></span><span class="hs-comment">--</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- In the polymorphic case when we are going to generalise</span><span>
</span><span id="line-369"></span><span class="hs-comment">--    (plan InferGen, no_gen = LetLclBndr), generate a &quot;monomorphic version&quot;</span><span>
</span><span id="line-370"></span><span class="hs-comment">--    of the Id; the original name will be bound to the polymorphic version</span><span>
</span><span id="line-371"></span><span class="hs-comment">--    by the AbsBinds</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- In the monomorphic case when we are not going to generalise</span><span>
</span><span id="line-373"></span><span class="hs-comment">--    (plan NoGen, no_gen = LetGblBndr) there is no AbsBinds,</span><span>
</span><span id="line-374"></span><span class="hs-comment">--    and we use the original name directly</span><span>
</span><span id="line-375"></span><span id="newLetBndr"><span class="annot"><span class="annottext">newLetBndr :: LetBndrSpec -&gt; Name -&gt; Type -&gt; Type -&gt; TcM TyCoVar
</span><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-var hs-var">newLetBndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span><span> </span><span id="local-6989586621682863213"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863213"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682863214"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863214"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682863215"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863215"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863216"><span class="annot"><a href="#local-6989586621682863216"><span class="hs-identifier hs-var">mono_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier hs-var">cloneLocalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863213"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-377"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-type">mkLocalId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863216"><span class="hs-identifier hs-type">mono_name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863214"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863215"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-378"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-var">newLetBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-type">LetGblBndr</span></a></span><span> </span><span id="local-6989586621682863219"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621682863219"><span class="hs-identifier hs-var">prags</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863220"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863220"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682863221"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863221"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682863222"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863222"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; [LSig (GhcPass 'Renamed)] -&gt; TcM TyCoVar
</span><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier hs-var">addInlinePrags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; Type -&gt; Type -&gt; TyCoVar
Name -&gt; Type -&gt; Type -&gt; TyCoVar
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863220"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863221"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863222"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPragEnv -&gt; Name -&gt; [LSig (GhcPass 'Renamed)]
</span><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621682863219"><span class="hs-identifier hs-var">prags</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863220"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-type">tc_sub_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-382"></span><span class="hs-comment">-- tcSubTypeET with the UserTypeCtxt specialised to GenSigCtxt</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- Used during typechecking patterns</span><span>
</span><span id="line-384"></span><span id="tc_sub_type"><span class="annot"><span class="annottext">tc_sub_type :: PatEnv -&gt; ExpSigmaTypeFRR -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var hs-var">tc_sub_type</span></a></span></span><span> </span><span id="local-6989586621682863225"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863225"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863226"><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863226"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682863227"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863227"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; UserTypeCtxt -&gt; ExpSigmaTypeFRR -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863225"><span class="hs-identifier hs-var">penv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863226"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863227"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">{- Note [Subsumption check at pattern variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we come across a variable with a type signature, we need to do a
subsumption, not equality, check against the context type.  e.g.

    data T = MkT (forall a. a-&gt;a)
      f :: forall b. [b]-&gt;[b]
      MkT f = blah

Since 'blah' returns a value of type T, its payload is a polymorphic
function of type (forall a. a-&gt;a).  And that's enough to bind the
less-polymorphic function 'f', but we need some impedance matching
to witness the instantiation.


************************************************************************
*                                                                      *
                The main worker functions
*                                                                      *
************************************************************************

Note [Nesting]
~~~~~~~~~~~~~~
tcPat takes a &quot;thing inside&quot; over which the pattern scopes.  This is partly
so that tcPat can extend the environment for the thing_inside, but also
so that constraints arising in the thing_inside can be discharged by the
pattern.

This does not work so well for the ErrCtxt carried by the monad: we don't
want the error-context for the pattern to scope over the RHS.
Hence the getErrCtxt/setErrCtxt stuff in tcMultiple
-}</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-keyword">type</span><span> </span><span id="Checker"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-var">Checker</span></a></span></span><span> </span><span id="local-6989586621682863230"><span class="annot"><a href="#local-6989586621682863230"><span class="hs-identifier hs-type">inp</span></a></span></span><span> </span><span id="local-6989586621682863231"><span class="annot"><a href="#local-6989586621682863231"><span class="hs-identifier hs-type">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682863232"><span class="annot"><a href="#local-6989586621682863232"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-422"></span><span>                          </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-423"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682863230"><span class="hs-identifier hs-type">inp</span></a></span><span>
</span><span id="line-424"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863232"><span class="hs-identifier hs-type">r</span></a></span><span>      </span><span class="hs-comment">-- Thing inside</span><span>
</span><span id="line-425"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621682863231"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-426"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863232"><span class="hs-identifier hs-type">r</span></a></span><span>    </span><span class="hs-comment">-- Result of thing inside</span><span>
</span><span id="line-427"></span><span>                              </span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span id="local-6989586621682862562"><span id="local-6989586621682862563"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcMultiple_"><span class="hs-identifier hs-type">tcMultiple_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862562"><span class="hs-identifier hs-type">inp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682862562"><span class="hs-identifier hs-type">inp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862563"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862563"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-430"></span><span id="tcMultiple_"><span class="annot"><span class="annottext">tcMultiple_ :: forall inp r. Checker inp () -&gt; PatEnv -&gt; [inp] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple_"><span class="hs-identifier hs-var hs-var">tcMultiple_</span></a></span></span><span> </span><span id="local-6989586621682863236"><span class="annot"><span class="annottext">Checker inp ()
</span><a href="#local-6989586621682863236"><span class="hs-identifier hs-var">tc_pat</span></a></span></span><span> </span><span id="local-6989586621682863237"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863237"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863238"><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621682863238"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682863239"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863239"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863240"><span class="annot"><a href="#local-6989586621682863240"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checker inp () -&gt; Checker [inp] [()]
forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; inp -&gt; TcM r -&gt; TcM ((), r)
Checker inp ()
</span><a href="#local-6989586621682863236"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863237"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621682863238"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863239"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-432"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682863240"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span id="local-6989586621682862566"><span id="local-6989586621682862567"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-type">tcMultiple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862566"><span class="hs-identifier hs-type">inp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862567"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682862566"><span class="hs-identifier hs-type">inp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682862567"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-435"></span><span id="tcMultiple"><span class="annot"><span class="annottext">tcMultiple :: forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var hs-var">tcMultiple</span></a></span></span><span> </span><span id="local-6989586621682863247"><span class="annot"><span class="annottext">Checker inp out
</span><a href="#local-6989586621682863247"><span class="hs-identifier hs-var">tc_pat</span></a></span></span><span> </span><span id="local-6989586621682863248"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863248"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863249"><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621682863249"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682863250"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863250"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863251"><span class="annot"><a href="#local-6989586621682863251"><span class="hs-identifier hs-var">err_ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863252"><span class="annot"><a href="#local-6989586621682863252"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-438"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863253"><span class="annot"><a href="#local-6989586621682863253"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863250"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-439"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863253"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>              </span><span class="annot"><a href="#local-6989586621682863252"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863254"><span class="annot"><span class="annottext">inp
</span><a href="#local-6989586621682863254"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682863255"><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621682863255"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863256"><span class="annot"><a href="#local-6989586621682863256"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863257"><span class="annot"><a href="#local-6989586621682863257"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863258"><span class="annot"><a href="#local-6989586621682863258"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>                                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; inp -&gt; TcM ([out], r) -&gt; TcM (out, ([out], r))
Checker inp out
</span><a href="#local-6989586621682863247"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863248"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">inp
</span><a href="#local-6989586621682863254"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([out], r) -&gt; TcM (out, ([out], r)))
-&gt; TcM ([out], r) -&gt; TcM (out, ([out], r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-444"></span><span>                                   </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcM ([out], r) -&gt; TcM ([out], r)
forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var">setErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621682863251"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([out], r) -&gt; TcM ([out], r))
-&gt; TcM ([out], r) -&gt; TcM ([out], r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-445"></span><span>                                   </span><span class="annot"><span class="annottext">[inp] -&gt; TcM ([out], r)
</span><a href="#local-6989586621682863252"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621682863255"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-446"></span><span>                </span><span class="hs-comment">-- setErrCtxt: restore context before doing the next pattern</span><span>
</span><span id="line-447"></span><span>                </span><span class="hs-comment">-- See Note [Nesting] above</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863256"><span class="hs-identifier hs-type">p'</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="#local-6989586621682863257"><span class="hs-identifier hs-type">ps'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863258"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="#local-6989586621682863252"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863249"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-454"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="tc_lpat"><span class="annot"><span class="annottext">tc_lpat :: Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var hs-var">tc_lpat</span></a></span></span><span> </span><span id="local-6989586621682863261"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863261"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621682863262"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863262"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863263"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682863263"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621682863264"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863264"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863265"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863265"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcRn (LPat GhcTc, r) -&gt; TcRn (LPat GhcTc, r)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682863263"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (LPat GhcTc, r) -&gt; TcRn (LPat GhcTc, r))
-&gt; TcRn (LPat GhcTc, r) -&gt; TcRn (LPat GhcTc, r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863267"><span class="annot"><a href="#local-6989586621682863267"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863268"><span class="annot"><a href="#local-6989586621682863268"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; (TcM r -&gt; TcM (Pat GhcTc, r)) -&gt; TcM r -&gt; TcM (Pat GhcTc, r)
forall a b.
Pat (GhcPass 'Renamed) -&gt; (TcM a -&gt; TcM b) -&gt; TcM a -&gt; TcM b
</span><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-var">maybeWrapPatCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863264"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (Pat (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863261"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863262"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863264"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>                                          </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863265"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863263"><span class="hs-identifier hs-type">span</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863267"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863268"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-type">tc_lpats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-463"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-464"></span><span id="tc_lpats"><span class="annot"><span class="annottext">tc_lpats :: [Scaled ExpSigmaTypeFRR]
-&gt; Checker [LPat (GhcPass 'Renamed)] [LPat GhcTc]
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-var hs-var">tc_lpats</span></a></span></span><span> </span><span id="local-6989586621682863282"><span class="annot"><span class="annottext">[Scaled ExpSigmaTypeFRR]
</span><a href="#local-6989586621682863282"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682863283"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863283"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863284"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863284"><span class="hs-identifier hs-var">pats</span></a></span></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc
-&gt; (TcM r -&gt; TcM ([LPat GhcTc], r))
-&gt; TcM r
-&gt; TcM ([LPat GhcTc], r)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
-&gt; [Scaled ExpSigmaTypeFRR] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863284"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaTypeFRR]
</span><a href="#local-6989586621682863282"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863284"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaTypeFRR] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaTypeFRR]
</span><a href="#local-6989586621682863282"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((TcM r -&gt; TcM ([LPat GhcTc], r))
 -&gt; TcM r -&gt; TcM ([LPat GhcTc], r))
-&gt; (TcM r -&gt; TcM ([LPat GhcTc], r))
-&gt; TcM r
-&gt; TcM ([LPat GhcTc], r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">Checker
  (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)),
   Scaled ExpSigmaTypeFRR)
  (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; Checker
     [(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)),
       Scaled ExpSigmaTypeFRR)]
     [GenLocated SrcSpanAnnA (Pat GhcTc)]
forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682863286"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863286"><span class="hs-identifier hs-var">penv'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863287"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863287"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682863288"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863288"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863288"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863286"><span class="hs-identifier hs-var">penv'</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863287"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>               </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863283"><span class="hs-identifier hs-var">penv</span></a></span><span>
</span><span id="line-468"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; [GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
-&gt; [Scaled ExpSigmaTypeFRR]
-&gt; [(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)),
     Scaled ExpSigmaTypeFRR)]
forall a b. HasDebugCallStack =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_lpats&quot;</span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863284"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaTypeFRR]
</span><a href="#local-6989586621682863282"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-471"></span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-472"></span><span id="local-6989586621682862501"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-type">checkManyPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#NonLinearPatternReason"><span class="hs-identifier hs-type">NonLinearPatternReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862501"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span></span><span>
</span><span id="line-473"></span><span id="checkManyPattern"><span class="annot"><span class="annottext">checkManyPattern :: forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var hs-var">checkManyPattern</span></a></span></span><span> </span><span id="local-6989586621682863290"><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="#local-6989586621682863290"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621682863291"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863291"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863292"><span class="annot"><span class="annottext">Scaled a
</span><a href="#local-6989586621682863292"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier hs-var">tcSubMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonLinearPatternReason -&gt; LPat (GhcPass 'Renamed) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#NonLinearPatternOrigin"><span class="hs-identifier hs-var">NonLinearPatternOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="#local-6989586621682863290"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863291"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled a -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled a
</span><a href="#local-6989586621682863292"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_forall_lpat"><span class="hs-identifier hs-type">tc_forall_lpat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span id="tc_forall_lpat"><span class="annot"><span class="annottext">tc_forall_lpat :: TyCoVar -&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_forall_lpat"><span class="hs-identifier hs-var hs-var">tc_forall_lpat</span></a></span></span><span> </span><span id="local-6989586621682863299"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863299"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682863300"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863300"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863301"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682863301"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621682863302"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863302"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863303"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863303"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA -&gt; TcRn (LPat GhcTc, r) -&gt; TcRn (LPat GhcTc, r)
forall ann a. EpAnn ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682863301"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (LPat GhcTc, r) -&gt; TcRn (LPat GhcTc, r))
-&gt; TcRn (LPat GhcTc, r) -&gt; TcRn (LPat GhcTc, r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863304"><span class="annot"><a href="#local-6989586621682863304"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863305"><span class="annot"><a href="#local-6989586621682863305"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; (TcM r -&gt; TcM (Pat GhcTc, r)) -&gt; TcM r -&gt; TcM (Pat GhcTc, r)
forall a b.
Pat (GhcPass 'Renamed) -&gt; (TcM a -&gt; TcM b) -&gt; TcM a -&gt; TcM b
</span><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-var">maybeWrapPatCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863302"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Checker (Pat (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_forall_pat"><span class="hs-identifier hs-var">tc_forall_pat</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863299"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863300"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863302"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>                                          </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863303"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863301"><span class="hs-identifier hs-type">span</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863304"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863305"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_forall_pat"><span class="hs-identifier hs-type">tc_forall_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span id="tc_forall_pat"><span class="annot"><span class="annottext">tc_forall_pat :: TyCoVar -&gt; Checker (Pat (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_forall_pat"><span class="hs-identifier hs-var hs-var">tc_forall_pat</span></a></span></span><span> </span><span id="local-6989586621682863314"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863314"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682863315"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863315"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span id="local-6989586621682863316"><span class="annot"><span class="annottext">XParPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863316"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863317"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863317"><span class="hs-identifier hs-var">lpat</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863318"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863318"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863319"><span class="annot"><a href="#local-6989586621682863319"><span class="hs-identifier hs-var">lpat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863320"><span class="annot"><a href="#local-6989586621682863320"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_forall_lpat"><span class="hs-identifier hs-var">tc_forall_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863314"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863315"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863317"><span class="hs-identifier hs-var">lpat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863318"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-486"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863316"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863319"><span class="hs-identifier hs-type">lpat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863320"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_forall_pat"><span class="hs-identifier hs-var">tc_forall_pat</span></a></span><span> </span><span id="local-6989586621682863321"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863321"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-type">EmbTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTyPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863323"><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621682863323"><span class="hs-identifier hs-var">tp</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863324"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863324"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-comment">-- The entire type pattern is guarded with the `type` herald:</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-comment">--    f (type t) (x :: t) = ...</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-comment">-- This special case is not necessary for correctness but avoids</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-comment">-- a redundant `ExpansionPat` node.</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863325"><span class="annot"><a href="#local-6989586621682863325"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863326"><span class="annot"><a href="#local-6989586621682863326"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed) -&gt; TyCoVar -&gt; TcM r -&gt; TcM (Type, r)
forall r.
HsTyPat (GhcPass 'Renamed) -&gt; TyCoVar -&gt; TcM r -&gt; TcM (Type, r)
</span><a href="GHC.Tc.Gen.Pat.html#tc_ty_pat"><span class="hs-identifier hs-var">tc_ty_pat</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863323"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863321"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863324"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-494"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-type">EmbTyPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863325"><span class="hs-identifier hs-type">arg_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863323"><span class="hs-identifier hs-type">tp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863326"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_forall_pat"><span class="hs-identifier hs-var">tc_forall_pat</span></a></span><span> </span><span id="local-6989586621682863327"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863327"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863328"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863328"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863329"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863329"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-comment">-- The type pattern is not guarded with the `type` herald, or perhaps</span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-comment">-- only parts of it are, e.g.</span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-comment">--    f (t :: Type)        (x :: t) = ...    -- no `type` herald</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-comment">--    f ((type t) :: Type) (x :: t) = ...    -- nested `type` herald</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-comment">-- Apply a recursive T2T transformation.</span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863330"><span class="annot"><a href="#local-6989586621682863330"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863328"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-503"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863332"><span class="annot"><a href="#local-6989586621682863332"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863333"><span class="annot"><a href="#local-6989586621682863333"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_ty_pat"><span class="hs-identifier hs-type">tc_ty_pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863330"><span class="hs-identifier hs-type">tp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863327"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863329"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-504"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863334"><span class="annot"><a href="#local-6989586621682863334"><span class="hs-identifier hs-var hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XXPat GhcTc -&gt; Pat GhcTc
forall p. XXPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#XPat"><span class="hs-identifier hs-var">XPat</span></a></span><span> </span><span class="annot"><span class="annottext">(XXPat GhcTc -&gt; Pat GhcTc) -&gt; XXPat GhcTc -&gt; Pat GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; Pat GhcTc -&gt; XXPatGhcTc
</span><a href="GHC.Hs.Pat.html#ExpansionPat"><span class="hs-identifier hs-var">ExpansionPat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863328"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XEmbTyPat GhcTc -&gt; HsTyPat (NoGhcTc GhcTc) -&gt; Pat GhcTc
forall p. XEmbTyPat p -&gt; HsTyPat (NoGhcTc p) -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-var">EmbTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTyPat GhcTc
Type
</span><a href="#local-6989586621682863332"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc GhcTc)
HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863330"><span class="hs-identifier hs-var">tp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863334"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863333"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">-- Convert a Pat into the equivalent HsTyPat.</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- See `expr_to_type` (GHC.Tc.Gen.App) for the HsExpr counterpart.</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- The `TcM` monad is only used to fail on ill-formed type patterns.</span><span>
</span><span id="line-510"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-type">pat_to_type_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyPat"><span class="hs-identifier hs-type">HsTyPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span id="pat_to_type_pat"><span class="annot"><span class="annottext">pat_to_type_pat :: Pat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var hs-var">pat_to_type_pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-type">EmbTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTyPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863337"><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621682863337"><span class="hs-identifier hs-var">tp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863337"><span class="hs-identifier hs-var">tp</span></a></span><span>
</span><span id="line-512"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863338"><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><a href="#local-6989586621682863338"><span class="hs-identifier hs-var">lname</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsTP (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed) -&gt; HsTyPat (GhcPass 'Renamed)
forall pass. XHsTP pass -&gt; LHsType pass -&gt; HsTyPat pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-var">HsTP</span></a></span><span> </span><span class="annot"><span class="annottext">XHsTP (GhcPass 'Renamed)
HsTyPatRn
</span><a href="#local-6989586621682863340"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621682863341"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682863341"><span class="annot"><span class="annottext">b :: GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621682863341"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyVar (GhcPass 'Renamed)
-&gt; PromotionFlag
-&gt; LIdP (GhcPass 'Renamed)
-&gt; HsType (GhcPass 'Renamed)
forall pass.
XTyVar pass -&gt; PromotionFlag -&gt; LIdP pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTyVar"><span class="hs-identifier hs-var">HsTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVar (GhcPass 'Renamed)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionFlag
</span><a href="Language.Haskell.Syntax.Type.html#NotPromoted"><span class="hs-identifier hs-var">NotPromoted</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
</span><a href="#local-6989586621682863338"><span class="hs-identifier hs-var">lname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>        </span><span id="local-6989586621682863340"><span class="annot"><span class="annottext">x :: HsTyPatRn
</span><a href="#local-6989586621682863340"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsTPRn"><span class="hs-identifier hs-type">HsTPRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hstp_nwcs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_nwcs"><span class="hs-identifier hs-var">hstp_nwcs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-515"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_imp_tvs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_imp_tvs"><span class="hs-identifier hs-var">hstp_imp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-516"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_exp_tvs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_exp_tvs"><span class="hs-identifier hs-var">hstp_exp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP (GhcPass 'Renamed)
GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621682863338"><span class="hs-identifier hs-var">lname</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-517"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span> </span><span class="annot"><span class="annottext">XWildPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XHsTP (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed) -&gt; HsTyPat (GhcPass 'Renamed)
forall pass. XHsTP pass -&gt; LHsType pass -&gt; HsTyPat pass
</span><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-var">HsTP</span></a></span><span> </span><span class="annot"><span class="annottext">XHsTP (GhcPass 'Renamed)
HsTyPatRn
</span><a href="#local-6989586621682863351"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621682863352"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682863352"><span class="annot"><span class="annottext">b :: GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621682863352"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XWildCardTy (GhcPass 'Renamed) -&gt; HsType (GhcPass 'Renamed)
forall pass. XWildCardTy pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsWildCardTy"><span class="hs-identifier hs-var">HsWildCardTy</span></a></span><span> </span><span class="annot"><span class="annottext">XWildCardTy (GhcPass 'Renamed)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>        </span><span id="local-6989586621682863351"><span class="annot"><span class="annottext">x :: HsTyPatRn
</span><a href="#local-6989586621682863351"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsTPRn"><span class="hs-identifier hs-type">HsTPRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hstp_nwcs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_nwcs"><span class="hs-identifier hs-var">hstp_nwcs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-520"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_imp_tvs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_imp_tvs"><span class="hs-identifier hs-var">hstp_imp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-521"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_exp_tvs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_exp_tvs"><span class="hs-identifier hs-var">hstp_exp_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-type">SigPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSigPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863357"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863357"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863358"><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621682863358"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span> </span><span id="local-6989586621682863359"><span class="annot"><a href="#local-6989586621682863359"><span class="hs-identifier hs-var">x_hstp</span></a></span></span><span> </span><span id="local-6989586621682863360"><span class="annot"><a href="#local-6989586621682863360"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
-&gt; Pat (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863357"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsPS"><span class="hs-identifier hs-type">HsPS</span></a></span><span> </span><span id="local-6989586621682863362"><span class="annot"><a href="#local-6989586621682863362"><span class="hs-identifier hs-var">x_hsps</span></a></span></span><span> </span><span id="local-6989586621682863363"><span class="annot"><a href="#local-6989586621682863363"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682863358"><span class="hs-identifier hs-type">sig_ty</span></a></span><span>
</span><span id="line-525"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863364"><span class="annot"><a href="#local-6989586621682863364"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPatRn -&gt; HsPSRn -&gt; HsTyPatRn
</span><a href="#local-6989586621682863365"><span class="hs-identifier hs-var">append_hstp_hsps</span></a></span><span> </span><span class="annot"><span class="annottext">XHsTP (GhcPass 'Renamed)
HsTyPatRn
</span><a href="#local-6989586621682863359"><span class="hs-identifier hs-var">x_hstp</span></a></span><span> </span><span class="annot"><span class="annottext">XHsPS (NoGhcTc (GhcPass 'Renamed))
HsPSRn
</span><a href="#local-6989586621682863362"><span class="hs-identifier hs-var">x_hsps</span></a></span><span>
</span><span id="line-526"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863366"><span class="annot"><a href="#local-6989586621682863366"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsType (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XKindSig (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed)
-&gt; LHsType (GhcPass 'Renamed)
-&gt; HsType (GhcPass 'Renamed)
forall pass.
XKindSig pass -&gt; LHsType pass -&gt; LHsType pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsKindSig"><span class="hs-identifier hs-var">HsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">XKindSig (GhcPass 'Renamed)
forall a. NoAnn a =&gt; a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621682863360"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType (NoGhcTc (GhcPass 'Renamed))
LHsType (GhcPass 'Renamed)
</span><a href="#local-6989586621682863363"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-527"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863364"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863366"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-comment">-- Quadratic for nested signatures ((p :: t1) :: t2)</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-comment">-- but those are unlikely to occur in practice.</span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><a href="#local-6989586621682863365"><span class="hs-identifier hs-type">append_hstp_hsps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsTyPatRn"><span class="hs-identifier hs-type">HsTyPatRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsPSRn"><span class="hs-identifier hs-type">HsPSRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsTyPatRn"><span class="hs-identifier hs-type">HsTyPatRn</span></a></span><span>
</span><span id="line-532"></span><span>    </span><span id="local-6989586621682863365"><span class="annot"><span class="annottext">append_hstp_hsps :: HsTyPatRn -&gt; HsPSRn -&gt; HsTyPatRn
</span><a href="#local-6989586621682863365"><span class="hs-identifier hs-var hs-var">append_hstp_hsps</span></a></span></span><span> </span><span id="local-6989586621682863368"><span class="annot"><span class="annottext">HsTyPatRn
</span><a href="#local-6989586621682863368"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682863369"><span class="annot"><span class="annottext">HsPSRn
</span><a href="#local-6989586621682863369"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-533"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsTPRn"><span class="hs-identifier hs-type">HsTPRn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hstp_nwcs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_nwcs"><span class="hs-identifier hs-var">hstp_nwcs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPatRn -&gt; [Name]
</span><a href="GHC.Hs.Type.html#hstp_nwcs"><span class="hs-identifier hs-var">hstp_nwcs</span></a></span><span>    </span><span class="annot"><span class="annottext">HsTyPatRn
</span><a href="#local-6989586621682863368"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HsPSRn -&gt; [Name]
</span><a href="GHC.Hs.Type.html#hsps_nwcs"><span class="hs-identifier hs-var">hsps_nwcs</span></a></span><span>    </span><span class="annot"><span class="annottext">HsPSRn
</span><a href="#local-6989586621682863369"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-534"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_imp_tvs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_imp_tvs"><span class="hs-identifier hs-var">hstp_imp_tvs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPatRn -&gt; [Name]
</span><a href="GHC.Hs.Type.html#hstp_imp_tvs"><span class="hs-identifier hs-var">hstp_imp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPatRn
</span><a href="#local-6989586621682863368"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; [Name]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HsPSRn -&gt; [Name]
</span><a href="GHC.Hs.Type.html#hsps_imp_tvs"><span class="hs-identifier hs-var">hsps_imp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">HsPSRn
</span><a href="#local-6989586621682863369"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-535"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hstp_exp_tvs :: [Name]
</span><a href="GHC.Hs.Type.html#hstp_exp_tvs"><span class="hs-identifier hs-var">hstp_exp_tvs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPatRn -&gt; [Name]
</span><a href="GHC.Hs.Type.html#hstp_exp_tvs"><span class="hs-identifier hs-var">hstp_exp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPatRn
</span><a href="#local-6989586621682863368"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863372"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863372"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span> </span><span id="local-6989586621682863373"><span class="annot"><a href="#local-6989586621682863373"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863374"><span class="annot"><a href="#local-6989586621682863374"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
-&gt; Pat (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682863372"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863373"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-type">HsParTy</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863374"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-539"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-type">SplicePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-type">HsUntypedSpliceTop</span></a></span><span> </span><span id="local-6989586621682863378"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682863378"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span id="local-6989586621682863379"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863379"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863380"><span class="annot"><span class="annottext">HsUntypedSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621682863380"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-540"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span> </span><span id="local-6989586621682863381"><span class="annot"><a href="#local-6989586621682863381"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863382"><span class="annot"><a href="#local-6989586621682863382"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; TcM (HsTyPat (GhcPass 'Renamed))
</span><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863379"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-541"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTP"><span class="hs-identifier hs-type">HsTP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863381"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-type">noLocA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsSpliceTy"><span class="hs-identifier hs-type">HsSpliceTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-type">HsUntypedSpliceTop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863378"><span class="hs-identifier hs-type">mod_finalizers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863382"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863380"><span class="hs-identifier hs-type">splice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-542"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pat_to_type_pat"><span class="hs-identifier hs-var">pat_to_type_pat</span></a></span><span> </span><span id="local-6989586621682863384"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863384"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-comment">-- There are other cases to handle (ConPat, ListPat, TuplePat, etc), but these</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-comment">-- would always be rejected by the unification in `tcHsTyPat`, so it's fine to</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-comment">-- skip them here. This won't continue to be the case when visible forall is</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-comment">-- permitted in data constructors:</span><span>
</span><span id="line-547"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-comment">--   data T a where { Typed :: forall a -&gt; a -&gt; T a }</span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-comment">--   g :: T Int -&gt; Int</span><span>
</span><span id="line-550"></span><span>  </span><span class="hs-comment">--   g (Typed Int x) = x   -- Note the `Int` type pattern</span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-comment">-- See ticket #18389. When this feature lands, it would be best to extend</span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-comment">-- `pat_to_type_pat` to handle as many pattern forms as possible.</span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (HsTyPat (GhcPass 'Renamed))
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnMessage -&gt; TcM (HsTyPat (GhcPass 'Renamed)))
-&gt; TcRnMessage -&gt; TcM (HsTyPat (GhcPass 'Renamed))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllformedTypePattern"><span class="hs-identifier hs-var">TcRnIllformedTypePattern</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863384"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-comment">-- This failure is the only use of the TcM monad in `pat_to_type_pat`</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span id="local-6989586621682862538"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_ty_pat"><span class="hs-identifier hs-type">tc_ty_pat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsTyPat"><span class="hs-identifier hs-type">HsTyPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862538"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862538"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-558"></span><span id="tc_ty_pat"><span class="annot"><span class="annottext">tc_ty_pat :: forall r.
HsTyPat (GhcPass 'Renamed) -&gt; TyCoVar -&gt; TcM r -&gt; TcM (Type, r)
</span><a href="GHC.Tc.Gen.Pat.html#tc_ty_pat"><span class="hs-identifier hs-var hs-var">tc_ty_pat</span></a></span></span><span> </span><span id="local-6989586621682863391"><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863391"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span id="local-6989586621682863392"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863392"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682863393"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863393"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863394"><span class="annot"><a href="#local-6989586621682863394"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863395"><span class="annot"><a href="#local-6989586621682863395"><span class="hs-identifier hs-var">sig_ibs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863396"><span class="annot"><a href="#local-6989586621682863396"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
-&gt; Type -&gt; TcM ([(Name, TyCoVar)], [(Name, TyCoVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTyPat"><span class="hs-identifier hs-var">tcHsTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863391"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863392"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682863396"><span class="hs-identifier hs-type">arg_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-type">mkTyVarTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863392"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863401"><span class="annot"><a href="#local-6989586621682863401"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863394"><span class="hs-identifier hs-type">sig_wcs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-562"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863395"><span class="hs-identifier hs-type">sig_ibs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-563"></span><span>                   </span><span class="annot"><a href="#local-6989586621682863393"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-564"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863396"><span class="hs-identifier hs-type">arg_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863401"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-type">tc_pat</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Fully refined result type</span></span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Translated pattern</span></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span id="tc_pat"><span class="annot"><span class="annottext">tc_pat :: Scaled ExpSigmaTypeFRR
-&gt; Checker (Pat (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var hs-var">tc_pat</span></a></span></span><span> </span><span id="local-6989586621682863517"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621682863518"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863519"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span></span><span> </span><span id="local-6989586621682863520"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863520"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span id="local-6989586621682863521"><span class="annot"><span class="annottext">XVarPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863521"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863522"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682863522"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682863523"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863523"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863524"><span class="annot"><a href="#local-6989586621682863524"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863525"><span class="annot"><a href="#local-6989586621682863525"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv
-&gt; Name -&gt; Scaled ExpSigmaTypeFRR -&gt; TcM (HsWrapper, TyCoVar)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var">tcPatBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863523"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863526"><span class="annot"><a href="#local-6989586621682863526"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863527"><span class="annot"><a href="#local-6989586621682863527"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#tcCheckUsage"><span class="hs-identifier hs-type">tcCheckUsage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863523"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-type">scaledMult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-576"></span><span>                              </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv1"><span class="hs-identifier hs-type">tcExtendIdEnv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863523"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863525"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-577"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863530"><span class="annot"><a href="#local-6989586621682863530"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863524"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863527"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863521"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863522"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863525"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863530"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863526"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span id="local-6989586621682863533"><span class="annot"><span class="annottext">XParPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863533"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863534"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863534"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863535"><span class="annot"><a href="#local-6989586621682863535"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863536"><span class="annot"><a href="#local-6989586621682863536"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863534"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863520"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863533"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863535"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863536"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span id="local-6989586621682863537"><span class="annot"><span class="annottext">XBangPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863537"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863538"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863538"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863539"><span class="annot"><a href="#local-6989586621682863539"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863540"><span class="annot"><a href="#local-6989586621682863540"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863538"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863520"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-587"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863537"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863539"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863540"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span id="local-6989586621682863541"><span class="annot"><span class="annottext">XLazyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863541"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863542"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863542"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-590"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863543"><span class="annot"><a href="#local-6989586621682863543"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#LazyPatternReason"><span class="hs-identifier hs-var">LazyPatternReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-591"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863544"><span class="annot"><a href="#local-6989586621682863544"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863545"><span class="annot"><a href="#local-6989586621682863545"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863546"><span class="annot"><a href="#local-6989586621682863546"><span class="hs-identifier hs-var">pat_ct</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#makeLazy"><span class="hs-identifier hs-type">makeLazy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863542"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-594"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-595"></span><span>                </span><span class="hs-comment">-- Ignore refined penv', revert to penv</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-type">emitConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863546"><span class="hs-identifier hs-type">pat_ct</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-comment">-- captureConstraints/extendConstraints:</span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-comment">--   see Note [Hopping the LIE in lazy patterns]</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-comment">-- Check that the expected pattern type is itself lifted</span><span>
</span><span id="line-602"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863549"><span class="annot"><a href="#local-6989586621682863549"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-type">typeKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863549"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-type">liftedTypeKind</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863543"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863541"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863544"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863549"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863545"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span> </span><span class="annot"><span class="annottext">XWildPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863552"><span class="annot"><a href="#local-6989586621682863552"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#OtherPatternReason"><span class="hs-identifier hs-var">OtherPatternReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-609"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863554"><span class="annot"><a href="#local-6989586621682863554"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-611"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863555"><span class="annot"><a href="#local-6989586621682863555"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-type">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863552"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863555"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863555"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863554"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span id="local-6989586621682863557"><span class="annot"><span class="annottext">XAsPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863557"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863558"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682863558"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621682863559"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863559"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863560"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863560"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863561"><span class="annot"><a href="#local-6989586621682863561"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#OtherPatternReason"><span class="hs-identifier hs-var">OtherPatternReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-616"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863562"><span class="annot"><a href="#local-6989586621682863562"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863563"><span class="annot"><a href="#local-6989586621682863563"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-type">setSrcSpanA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863558"><span class="hs-identifier hs-type">nm_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-type">tcPatBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863559"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863564"><span class="annot"><a href="#local-6989586621682863564"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863565"><span class="annot"><a href="#local-6989586621682863565"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv1"><span class="hs-identifier hs-type">tcExtendIdEnv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863559"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863563"><span class="hs-identifier hs-type">bndr_id</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-619"></span><span>                         </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-type">`scaledSet`</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-type">idType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863563"><span class="hs-identifier hs-type">bndr_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>                                 </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863560"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-621"></span><span>            </span><span class="hs-comment">-- NB: if we do inference on:</span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-comment">--          \ (y@(x::forall a. a-&gt;a)) = e</span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-comment">-- we'll fail.  The as-pattern infers a monotype for 'y', which then</span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-comment">-- fails to unify with the polymorphic type for 'x'.  This could</span><span>
</span><span id="line-625"></span><span>            </span><span class="hs-comment">-- perhaps be fixed, but only with a bit more work.</span><span>
</span><span id="line-626"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-627"></span><span>            </span><span class="hs-comment">-- If you fix it, don't forget the bindInstsOfPatIds!</span><span>
</span><span id="line-628"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863567"><span class="annot"><a href="#local-6989586621682863567"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863562"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863561"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863557"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863558"><span class="hs-identifier hs-type">nm_loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863563"><span class="hs-identifier hs-type">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863564"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863567"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863565"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-type">ViewPat</span></a></span><span> </span><span class="annot"><span class="annottext">XViewPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863569"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621682863569"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621682863570"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863570"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863571"><span class="annot"><a href="#local-6989586621682863571"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#ViewPatternReason"><span class="hs-identifier hs-var">ViewPatternReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-633"></span><span>         </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-634"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-635"></span><span>         </span><span class="hs-comment">-- It should be possible to have view patterns at linear (or otherwise</span><span>
</span><span id="line-636"></span><span>         </span><span class="hs-comment">-- non-Many) multiplicity. But it is not clear at the moment what</span><span>
</span><span id="line-637"></span><span>         </span><span class="hs-comment">-- restriction need to be put in place, if any, for linear view</span><span>
</span><span id="line-638"></span><span>         </span><span class="hs-comment">-- patterns to desugar to type-correct Core.</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863573"><span class="annot"><a href="#local-6989586621682863573"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682863574"><span class="annot"><a href="#local-6989586621682863574"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-type">tcInferRho</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863569"><span class="hs-identifier hs-type">expr</span></a></span><span>
</span><span id="line-641"></span><span>               </span><span class="hs-comment">-- Note [View patterns and polymorphism]</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>         </span><span class="hs-comment">-- Expression must be a function</span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863575"><span class="annot"><a href="#local-6989586621682863575"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed) -&gt; ExpectedFunTyOrigin
</span><a href="GHC.Tc.Types.Origin.html#ExpectedFunTyViewPat"><span class="hs-identifier hs-var">ExpectedFunTyViewPat</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Renamed) -&gt; ExpectedFunTyOrigin)
-&gt; HsExpr (GhcPass 'Renamed) -&gt; ExpectedFunTyOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
-&gt; HsExpr (GhcPass 'Renamed)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621682863569"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863577"><span class="annot"><a href="#local-6989586621682863577"><span class="hs-identifier hs-var">expr_wrap1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682863578"><span class="annot"><a href="#local-6989586621682863578"><span class="hs-identifier hs-var">_mult</span></a></span></span><span> </span><span id="local-6989586621682863579"><span class="annot"><a href="#local-6989586621682863579"><span class="hs-identifier hs-var">inf_arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863580"><span class="annot"><a href="#local-6989586621682863580"><span class="hs-identifier hs-var">inf_res_sigma</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#matchActualFunTy"><span class="hs-identifier hs-type">matchActualFunTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863575"><span class="hs-identifier hs-type">herald</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#HsExprRnThing"><span class="hs-identifier hs-type">HsExprRnThing</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-type">unLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863569"><span class="hs-identifier hs-type">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682863574"><span class="hs-identifier hs-type">expr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863574"><span class="hs-identifier hs-type">expr_ty</span></a></span><span>
</span><span id="line-647"></span><span>               </span><span class="hs-comment">-- See Note [View patterns and polymorphism]</span><span>
</span><span id="line-648"></span><span>               </span><span class="hs-comment">-- expr_wrap1 :: expr_ty &quot;-&gt;&quot; (inf_arg_ty -&gt; inf_res_sigma)</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span>         </span><span class="hs-comment">-- Check that overall pattern is more polymorphic than arg type</span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863583"><span class="annot"><a href="#local-6989586621682863583"><span class="hs-identifier hs-var">expr_wrap2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-type">tc_sub_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863579"><span class="hs-identifier hs-type">inf_arg_ty</span></a></span><span>
</span><span id="line-652"></span><span>            </span><span class="hs-comment">-- expr_wrap2 :: pat_ty &quot;-&gt;&quot; inf_arg_ty</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>         </span><span class="hs-comment">-- Pattern must have inf_res_sigma</span><span>
</span><span id="line-655"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863584"><span class="annot"><a href="#local-6989586621682863584"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863585"><span class="annot"><a href="#local-6989586621682863585"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-type">`scaledSet`</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863580"><span class="hs-identifier hs-type">inf_res_sigma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863570"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682863586"><span class="annot"><a href="#local-6989586621682863586"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682863587"><span class="annot"><a href="#local-6989586621682863587"><span class="hs-identifier hs-var">h_pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863588"><span class="annot"><a href="#local-6989586621682863588"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863587"><span class="hs-identifier hs-type">h_pat_ty</span></a></span><span>
</span><span id="line-659"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863589"><span class="annot"><a href="#local-6989586621682863589"><span class="hs-identifier hs-var hs-var">expr_wrap2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; Scaled Type -&gt; Type -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpFun"><span class="hs-identifier hs-var">mkWpFun</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863583"><span class="hs-identifier hs-var">expr_wrap2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-660"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863586"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863588"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863580"><span class="hs-identifier hs-var">inf_res_sigma</span></a></span><span>
</span><span id="line-661"></span><span>          </span><span class="hs-comment">-- expr_wrap2' :: (inf_arg_ty -&gt; inf_res_sigma) &quot;-&gt;&quot;</span><span>
</span><span id="line-662"></span><span>          </span><span class="hs-comment">--                (pat_ty -&gt; inf_res_sigma)</span><span>
</span><span id="line-663"></span><span>          </span><span class="hs-comment">-- NB: pat_ty comes from matchActualFunTy, so it has a</span><span>
</span><span id="line-664"></span><span>          </span><span class="hs-comment">-- fixed RuntimeRep, as needed to call mkWpFun.</span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-666"></span><span>              </span><span id="local-6989586621682863591"><span class="annot"><a href="#local-6989586621682863591"><span class="hs-identifier hs-var hs-var">expr_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863589"><span class="hs-identifier hs-var">expr_wrap2'</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863577"><span class="hs-identifier hs-var">expr_wrap1</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863571"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-type">ViewPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863588"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-type">mkLHsWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863591"><span class="hs-identifier hs-type">expr_wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863573"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863584"><span class="hs-identifier hs-type">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863585"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span class="hs-comment">{- Note [View patterns and polymorphism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this exotic example:
   pair :: forall a. Bool -&gt; a -&gt; forall b. b -&gt; (a,b)

   f :: Int -&gt; blah
   f (pair True -&gt; x) = ...here (x :: forall b. b -&gt; (Int,b))

The expression (pair True) should have type
    pair True :: Int -&gt; forall b. b -&gt; (Int,b)
so that it is ready to consume the incoming Int. It should be an
arrow type (t1 -&gt; t2); hence using (tcInferRho expr).

Then, when taking that arrow apart we want to get a *sigma* type
(forall b. b-&gt;(Int,b)), because that's what we want to bind 'x' to.
Fortunately that's what matchActualFunTy returns anyway.
-}</span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span class="hs-comment">-- Type signatures in patterns</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- See Note [Pattern coercions] below</span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-type">SigPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSigPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863593"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863593"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863594"><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc (GhcPass 'Renamed))
</span><a href="#local-6989586621682863594"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-691"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863595"><span class="annot"><a href="#local-6989586621682863595"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863596"><span class="annot"><a href="#local-6989586621682863596"><span class="hs-identifier hs-var">tv_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863597"><span class="annot"><a href="#local-6989586621682863597"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863598"><span class="annot"><a href="#local-6989586621682863598"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; HsPatSigType (GhcPass 'Renamed)
-&gt; ExpSigmaTypeFRR
-&gt; TcM (Type, [(Name, TyCoVar)], [(Name, TyCoVar)], HsWrapper)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSig"><span class="hs-identifier hs-var">tcPatSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var">inPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>                                                            </span><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc (GhcPass 'Renamed))
HsPatSigType (GhcPass 'Renamed)
</span><a href="#local-6989586621682863594"><span class="hs-identifier hs-var">sig_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>                </span><span class="hs-comment">-- Using tcExtendNameTyVarEnv is appropriate here</span><span>
</span><span id="line-694"></span><span>                </span><span class="hs-comment">-- because we're not really bringing fresh tyvars into scope.</span><span>
</span><span id="line-695"></span><span>                </span><span class="hs-comment">-- We're *naming* existing tyvars. Note that it is OK for a tyvar</span><span>
</span><span id="line-696"></span><span>                </span><span class="hs-comment">-- from an outer scope to mention one of these tyvars in its kind.</span><span>
</span><span id="line-697"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863600"><span class="annot"><a href="#local-6989586621682863600"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863601"><span class="annot"><a href="#local-6989586621682863601"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863597"><span class="hs-identifier hs-type">wcs</span></a></span><span>      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-698"></span><span>                         </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863596"><span class="hs-identifier hs-type">tv_binds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-699"></span><span>                         </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-type">`scaledSet`</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863595"><span class="hs-identifier hs-type">inner_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863593"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-700"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863602"><span class="annot"><a href="#local-6989586621682863602"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863598"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-type">SigPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863595"><span class="hs-identifier hs-type">inner_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863600"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863594"><span class="hs-identifier hs-type">sig_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863602"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863601"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-704"></span><span class="hs-comment">-- Lists, tuples, arrays</span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-comment">-- Necessarily a built-in list pattern, not an overloaded list pattern.</span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-comment">-- See Note [Desugaring overloaded list patterns].</span><span>
</span><span id="line-708"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span> </span><span class="annot"><span class="annottext">XListPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863604"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863604"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863605"><span class="annot"><a href="#local-6989586621682863605"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863606"><span class="annot"><a href="#local-6989586621682863606"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, Type)
forall a.
(Type -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var">matchExpectedPatTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, Type)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863609"><span class="annot"><a href="#local-6989586621682863609"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863610"><span class="annot"><a href="#local-6989586621682863610"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-type">tcMultiple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-type">`scaledSet`</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863606"><span class="hs-identifier hs-type">elt_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>                                     </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863604"><span class="hs-identifier hs-type">pats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-712"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863611"><span class="annot"><a href="#local-6989586621682863611"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863605"><span class="hs-identifier hs-type">coi</span></a></span><span>
</span><span id="line-714"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863606"><span class="hs-identifier hs-type">elt_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863609"><span class="hs-identifier hs-type">pats'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863611"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863610"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span class="hs-special">}</span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">XTuplePat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863613"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682863613"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621682863614"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682863614"><span class="hs-identifier hs-var">boxity</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863615"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621682863615"><span class="hs-identifier hs-var hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682863613"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-719"></span><span>              </span><span id="local-6989586621682863617"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621682863617"><span class="hs-identifier hs-var hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682863614"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863615"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-720"></span><span>              </span><span class="hs-comment">-- NB: tupleTyCon does not flatten 1-tuples</span><span>
</span><span id="line-721"></span><span>              </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-722"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcRn ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863615"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-723"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863620"><span class="annot"><a href="#local-6989586621682863620"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863621"><span class="annot"><a href="#local-6989586621682863621"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM (TcCoercionN, [Type]))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, [Type])
forall a.
(Type -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var">matchExpectedPatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; TcM (TcCoercionN, [Type])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682863617"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>                                               </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>                     </span><span class="hs-comment">-- Unboxed tuples have RuntimeRep vars, which we discard:</span><span>
</span><span id="line-726"></span><span>                     </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-727"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863623"><span class="annot"><a href="#local-6989586621682863623"><span class="hs-identifier hs-var hs-var">con_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682863614"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863615"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863621"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-728"></span><span>                                           </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863621"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863627"><span class="annot"><a href="#local-6989586621682863627"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863628"><span class="annot"><a href="#local-6989586621682863628"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-type">tc_lpats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#scaledSet"><span class="hs-identifier hs-type">scaledSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863623"><span class="hs-identifier hs-type">con_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>                                   </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863613"><span class="hs-identifier hs-type">pats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863629"><span class="annot"><a href="#local-6989586621682863629"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Driver.DynFlags.html#getDynFlags"><span class="hs-identifier hs-type">getDynFlags</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-comment">-- Under flag control turn a pattern (x,y,z) into ~(x,y,z)</span><span>
</span><span id="line-735"></span><span>        </span><span class="hs-comment">-- so that we can experiment with lazy tuple-matching.</span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-comment">-- This is a pretty odd place to make the switch, but</span><span>
</span><span id="line-737"></span><span>        </span><span class="hs-comment">-- it was easy to do.</span><span>
</span><span id="line-738"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-739"></span><span>              </span><span id="local-6989586621682863630"><span class="annot"><a href="#local-6989586621682863630"><span class="hs-identifier hs-var hs-var">unmangled_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XTuplePat GhcTc -&gt; [LPat GhcTc] -&gt; Boxity -&gt; Pat GhcTc
forall p. XTuplePat p -&gt; [LPat p] -&gt; Boxity -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-var">TuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
XTuplePat GhcTc
</span><a href="#local-6989586621682863623"><span class="hs-identifier hs-var">con_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcTc]
[GenLocated SrcSpanAnnA (Pat GhcTc)]
</span><a href="#local-6989586621682863627"><span class="hs-identifier hs-var">pats'</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682863614"><span class="hs-identifier hs-var">boxity</span></a></span><span>
</span><span id="line-740"></span><span>                                 </span><span class="hs-comment">-- pat_ty /= pat_ty iff coi /= IdCo</span><span>
</span><span id="line-741"></span><span>              </span><span id="local-6989586621682863631"><span class="annot"><a href="#local-6989586621682863631"><span class="hs-identifier hs-var hs-var">possibly_mangled_result</span></a></span></span><span>
</span><span id="line-742"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_IrrefutableTuples"><span class="hs-identifier hs-var">Opt_IrrefutableTuples</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682863629"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-743"></span><span>                  </span><span class="annot"><span class="annottext">Boxity -&gt; Bool
</span><a href="Language.Haskell.Syntax.Basic.html#isBoxed"><span class="hs-identifier hs-var">isBoxed</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621682863614"><span class="hs-identifier hs-var">boxity</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XLazyPat GhcTc -&gt; LPat GhcTc -&gt; Pat GhcTc
forall p. XLazyPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-var">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLazyPat GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat GhcTc -&gt; GenLocated SrcSpanAnnA (Pat GhcTc)
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621682863630"><span class="hs-identifier hs-var">unmangled_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621682863630"><span class="hs-identifier hs-var">unmangled_result</span></a></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863636"><span class="annot"><a href="#local-6989586621682863636"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-type">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863623"><span class="hs-identifier hs-type">con_arg_tys</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-type">`equalLength`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863613"><span class="hs-identifier hs-type">pats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Syntactically enforced</span><span>
</span><span id="line-748"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863620"><span class="hs-identifier hs-type">coi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863631"><span class="hs-identifier hs-type">possibly_mangled_result</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863636"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863628"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SumPat"><span class="hs-identifier hs-type">SumPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSumPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863639"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863639"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682863640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863640"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621682863641"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863641"><span class="hs-identifier hs-var">arity</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863642"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621682863642"><span class="hs-identifier hs-var hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863641"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-753"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863644"><span class="annot"><a href="#local-6989586621682863644"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863645"><span class="annot"><a href="#local-6989586621682863645"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM (TcCoercionN, [Type]))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, [Type])
forall a.
(Type -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var">matchExpectedPatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type -&gt; TcM (TcCoercionN, [Type])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682863642"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>                                               </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Drop levity vars, we don't care about them here</span><span>
</span><span id="line-756"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863646"><span class="annot"><a href="#local-6989586621682863646"><span class="hs-identifier hs-var hs-var">con_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682863641"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863645"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863647"><span class="annot"><a href="#local-6989586621682863647"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863648"><span class="annot"><a href="#local-6989586621682863648"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-type">`scaledSet`</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863646"><span class="hs-identifier hs-type">con_arg_tys</span></a></span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-type">`getNth`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863640"><span class="hs-identifier hs-type">alt</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>                                 </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863639"><span class="hs-identifier hs-type">pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-759"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863649"><span class="annot"><a href="#local-6989586621682863649"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863644"><span class="hs-identifier hs-type">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SumPat"><span class="hs-identifier hs-type">SumPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863646"><span class="hs-identifier hs-type">con_arg_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863647"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863640"><span class="hs-identifier hs-type">alt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863641"><span class="hs-identifier hs-type">arity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863649"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-761"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863648"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-765"></span><span class="hs-comment">-- Data constructors</span><span>
</span><span id="line-766"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="annot"><span class="annottext">XConPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863651"><span class="annot"><span class="annottext">XRec (GhcPass 'Renamed) (ConLikeP (GhcPass 'Renamed))
</span><a href="#local-6989586621682863651"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621682863652"><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682863652"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-767"></span><span>    </span><span class="annot"><span class="annottext">PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; Scaled ExpSigmaTypeFRR
-&gt; HsConPatDetails (GhcPass 'Renamed)
-&gt; TcM r
-&gt; TcM (Pat GhcTc, r)
forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; Scaled ExpSigmaTypeFRR
-&gt; HsConPatDetails (GhcPass 'Renamed)
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcConPat"><span class="hs-identifier hs-var">tcConPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">XRec (GhcPass 'Renamed) (ConLikeP (GhcPass 'Renamed))
GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621682863651"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682863652"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863520"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-770"></span><span class="hs-comment">-- Literal patterns</span><span>
</span><span id="line-771"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LitPat"><span class="hs-identifier hs-type">LitPat</span></a></span><span> </span><span id="local-6989586621682863655"><span class="annot"><span class="annottext">XLitPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863655"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682863656"><span class="annot"><span class="annottext">HsLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863656"><span class="hs-identifier hs-var">simple_lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-772"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863657"><span class="annot"><span class="annottext">lit_ty :: Type
</span><a href="#local-6989586621682863657"><span class="hs-identifier hs-var hs-var hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLit (GhcPass 'Renamed) -&gt; Type
forall (p :: Pass). HsLit (GhcPass p) -&gt; Type
</span><a href="GHC.Hs.Syn.Type.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863656"><span class="hs-identifier hs-var">simple_lit</span></a></span><span>
</span><span id="line-773"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863659"><span class="annot"><a href="#local-6989586621682863659"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; ExpSigmaTypeFRR -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var">tc_sub_type</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863657"><span class="hs-identifier hs-var">lit_ty</span></a></span><span>
</span><span id="line-774"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863660"><span class="annot"><a href="#local-6989586621682863660"><span class="hs-identifier hs-var">res</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-775"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863661"><span class="annot"><a href="#local-6989586621682863661"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-776"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863659"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LitPat"><span class="hs-identifier hs-type">LitPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863655"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-type">convertLit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863656"><span class="hs-identifier hs-type">simple_lit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863661"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-777"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863660"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-780"></span><span class="hs-comment">-- Overloaded patterns: n, and n+k</span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span class="hs-comment">-- In the case of a negative literal (the more complicated case),</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- we get</span><span>
</span><span id="line-784"></span><span class="hs-comment">--</span><span>
</span><span id="line-785"></span><span class="hs-comment">--   case v of (-5) -&gt; blah</span><span>
</span><span id="line-786"></span><span class="hs-comment">--</span><span>
</span><span id="line-787"></span><span class="hs-comment">-- becoming</span><span>
</span><span id="line-788"></span><span class="hs-comment">--</span><span>
</span><span id="line-789"></span><span class="hs-comment">--   if v == (negate (fromInteger 5)) then blah else ...</span><span>
</span><span id="line-790"></span><span class="hs-comment">--</span><span>
</span><span id="line-791"></span><span class="hs-comment">-- There are two bits of rebindable syntax:</span><span>
</span><span id="line-792"></span><span class="hs-comment">--   (==)   :: pat_ty -&gt; neg_lit_ty -&gt; Bool</span><span>
</span><span id="line-793"></span><span class="hs-comment">--   negate :: lit_ty -&gt; neg_lit_ty</span><span>
</span><span id="line-794"></span><span class="hs-comment">-- where lit_ty is the type of the overloaded literal 5.</span><span>
</span><span id="line-795"></span><span class="hs-comment">--</span><span>
</span><span id="line-796"></span><span class="hs-comment">-- When there is no negation, neg_lit_ty and lit_ty are the same</span><span>
</span><span id="line-797"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPat"><span class="hs-identifier hs-type">NPat</span></a></span><span> </span><span class="annot"><span class="annottext">XNPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863664"><span class="annot"><span class="annottext">EpAnnCO
</span><a href="#local-6989586621682863664"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682863665"><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863665"><span class="hs-identifier hs-var">over_lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863666"><span class="annot"><span class="annottext">Maybe (SyntaxExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621682863666"><span class="hs-identifier hs-var">mb_neg</span></a></span></span><span> </span><span id="local-6989586621682863667"><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621682863667"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-798"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863668"><span class="annot"><a href="#local-6989586621682863668"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#OtherPatternReason"><span class="hs-identifier hs-var">OtherPatternReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-799"></span><span>          </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-800"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-801"></span><span>          </span><span class="hs-comment">-- It may be possible to refine linear pattern so that they work in</span><span>
</span><span id="line-802"></span><span>          </span><span class="hs-comment">-- linear environments. But it is not clear how useful this is.</span><span>
</span><span id="line-803"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863669"><span class="annot"><a href="#local-6989586621682863669"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863665"><span class="hs-identifier hs-var">over_lit</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682863671"><span class="annot"><a href="#local-6989586621682863671"><span class="hs-identifier hs-var">lit'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863672"><span class="annot"><a href="#local-6989586621682863672"><span class="hs-identifier hs-var">mb_neg'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863673"><span class="annot"><a href="#local-6989586621682863673"><span class="hs-identifier hs-var">eq'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863669"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863667"><span class="hs-identifier hs-type">eq</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-type">SynAny</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-806"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-type">boolTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-807"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682863677"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863677"><span class="hs-identifier hs-var">neg_lit_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-808"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863678"><span class="annot"><span class="annottext">new_over_lit :: Type -&gt; TcM (HsOverLit GhcTc)
</span><a href="#local-6989586621682863678"><span class="hs-identifier hs-var hs-var">new_over_lit</span></a></span></span><span> </span><span id="local-6989586621682863679"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863679"><span class="hs-identifier hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
-&gt; ExpSigmaTypeFRR -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863665"><span class="hs-identifier hs-var">over_lit</span></a></span><span>
</span><span id="line-809"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863679"><span class="hs-identifier hs-var">lit_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621682863666"><span class="hs-identifier hs-var">mb_neg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-811"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr (GhcPass 'Renamed))
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HsOverLit GhcTc -&gt; (HsOverLit GhcTc, Maybe SyntaxExprTc))
-&gt; TcM (HsOverLit GhcTc)
-&gt; TcM (HsOverLit GhcTc, Maybe SyntaxExprTc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (HsOverLit GhcTc)
</span><a href="#local-6989586621682863678"><span class="hs-identifier hs-var">new_over_lit</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863677"><span class="hs-identifier hs-var">neg_lit_ty</span></a></span><span>
</span><span id="line-812"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682863682"><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621682863682"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Negative literal</span><span>
</span><span id="line-813"></span><span>                             </span><span class="hs-comment">-- The 'negate' is re-mappable syntax</span><span>
</span><span id="line-814"></span><span>                   </span><span class="annot"><span class="annottext">(SyntaxExprTc -&gt; Maybe SyntaxExprTc)
-&gt; (HsOverLit GhcTc, SyntaxExprTc)
-&gt; (HsOverLit GhcTc, Maybe SyntaxExprTc)
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc -&gt; Maybe SyntaxExprTc
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((HsOverLit GhcTc, SyntaxExprTc)
 -&gt; (HsOverLit GhcTc, Maybe SyntaxExprTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsOverLit GhcTc, SyntaxExprTc)
-&gt; TcM (HsOverLit GhcTc, Maybe SyntaxExprTc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-815"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpSigmaTypeFRR
-&gt; ([Type] -&gt; [Type] -&gt; TcM (HsOverLit GhcTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsOverLit GhcTc, SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpSigmaTypeFRR
-&gt; ([Type] -&gt; [Type] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682863669"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
SyntaxExprRn
</span><a href="#local-6989586621682863682"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863677"><span class="hs-identifier hs-var">neg_lit_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Type] -&gt; [Type] -&gt; TcM (HsOverLit GhcTc))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsOverLit GhcTc, SyntaxExprTc))
-&gt; ([Type] -&gt; [Type] -&gt; TcM (HsOverLit GhcTc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsOverLit GhcTc, SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-816"></span><span>                    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682863684"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863684"><span class="hs-identifier hs-var">lit_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (HsOverLit GhcTc)
</span><a href="#local-6989586621682863678"><span class="hs-identifier hs-var">new_over_lit</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863684"><span class="hs-identifier hs-var">lit_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>                     </span><span class="hs-comment">-- applied to a closed literal: linearity doesn't matter as</span><span>
</span><span id="line-818"></span><span>                     </span><span class="hs-comment">-- literals are typed in an empty environment, hence have</span><span>
</span><span id="line-819"></span><span>                     </span><span class="hs-comment">-- all multiplicities.</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863685"><span class="annot"><a href="#local-6989586621682863685"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-822"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863686"><span class="annot"><a href="#local-6989586621682863686"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863517"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863668"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPat"><span class="hs-identifier hs-type">NPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863686"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863664"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863671"><span class="hs-identifier hs-type">lit'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863672"><span class="hs-identifier hs-type">mb_neg'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863673"><span class="hs-identifier hs-type">eq'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863686"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863685"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span class="hs-comment">{-
Note [NPlusK patterns]
~~~~~~~~~~~~~~~~~~~~~~
From

  case v of x + 5 -&gt; blah

we get

  if v &gt;= 5 then (\x -&gt; blah) (v - 5) else ...

There are two bits of rebindable syntax:
  (&gt;=) :: pat_ty -&gt; lit1_ty -&gt; Bool
  (-)  :: pat_ty -&gt; lit2_ty -&gt; var_ty

lit1_ty and lit2_ty could conceivably be different.
var_ty is the type inferred for x, the variable in the pattern.

Note that we need to type-check the literal twice, because it is used
twice, and may be used at different types. The second HsOverLit stored in the
AST is used for the subtraction operation.
-}</span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="hs-comment">-- See Note [NPlusK patterns]</span><span>
</span><span id="line-849"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPlusKPat"><span class="hs-identifier hs-type">NPlusKPat</span></a></span><span> </span><span class="annot"><span class="annottext">XNPlusKPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863688"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682863688"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621682863689"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863689"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863690"><span class="annot"><span class="annottext">EpAnnCO
</span><a href="#local-6989586621682863690"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682863691"><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863691"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863692"><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621682863692"><span class="hs-identifier hs-var">ge</span></a></span></span><span> </span><span id="local-6989586621682863693"><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621682863693"><span class="hs-identifier hs-var">minus</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-851"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863694"><span class="annot"><a href="#local-6989586621682863694"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed)
-&gt; Scaled ExpSigmaTypeFRR
-&gt; TcM HsWrapper
forall a.
NonLinearPatternReason
-&gt; LPat (GhcPass 'Renamed) -&gt; Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">NonLinearPatternReason
</span><a href="GHC.Tc.Types.Origin.html#OtherPatternReason"><span class="hs-identifier hs-var">OtherPatternReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
forall e a. HasAnnotation e =&gt; a -&gt; GenLocated e a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863519"><span class="hs-identifier hs-var">ps_pat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-852"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-853"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863695"><span class="annot"><a href="#local-6989586621682863695"><span class="hs-identifier hs-var hs-var">pat_exp_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-854"></span><span>              </span><span id="local-6989586621682863696"><span class="annot"><a href="#local-6989586621682863696"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed) -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863691"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-855"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863697"><span class="annot"><a href="#local-6989586621682863697"><span class="hs-identifier hs-var">lit1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863698"><span class="annot"><a href="#local-6989586621682863698"><span class="hs-identifier hs-var">ge'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863696"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863692"><span class="hs-identifier hs-type">ge</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863695"><span class="hs-identifier hs-type">pat_exp_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-type">SynRho</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-857"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-type">boolTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-858"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682863699"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863699"><span class="hs-identifier hs-var">lit1_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-859"></span><span>               </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
-&gt; ExpSigmaTypeFRR -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863691"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863699"><span class="hs-identifier hs-var">lit1_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682863700"><span class="annot"><a href="#local-6989586621682863700"><span class="hs-identifier hs-var">lit2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863701"><span class="annot"><a href="#local-6989586621682863701"><span class="hs-identifier hs-var">minus_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863702"><span class="annot"><a href="#local-6989586621682863702"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863703"><span class="annot"><a href="#local-6989586621682863703"><span class="hs-identifier hs-var">minus'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-type">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863696"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863693"><span class="hs-identifier hs-type">minus</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863695"><span class="hs-identifier hs-type">pat_exp_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-type">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-type">SynAny</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-862"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682863704"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863704"><span class="hs-identifier hs-var">lit2_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863705"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863705"><span class="hs-identifier hs-var">var_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-863"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863706"><span class="annot"><a href="#local-6989586621682863706"><span class="hs-identifier hs-var">lit2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
-&gt; ExpSigmaTypeFRR -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit (GhcPass 'Renamed)
</span><a href="#local-6989586621682863691"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863704"><span class="hs-identifier hs-var">lit2_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863707"><span class="annot"><a href="#local-6989586621682863707"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863708"><span class="annot"><a href="#local-6989586621682863708"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-type">setSrcSpanA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863688"><span class="hs-identifier hs-type">nm_loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-865"></span><span>                                     </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-type">tcPatBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863518"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863689"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-type">unrestricted</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-type">mkCheckExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863705"><span class="hs-identifier hs-type">var_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>                           </span><span class="hs-comment">-- co :: var_ty ~ idType bndr_id</span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span>                           </span><span class="hs-comment">-- minus_wrap is applicable to minus'</span><span>
</span><span id="line-869"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863706"><span class="hs-identifier hs-type">lit2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863707"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863708"><span class="hs-identifier hs-type">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863709"><span class="annot"><a href="#local-6989586621682863709"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863695"><span class="hs-identifier hs-type">pat_exp_ty</span></a></span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>        </span><span class="hs-comment">-- The Report says that n+k patterns must be in Integral</span><span>
</span><span id="line-874"></span><span>        </span><span class="hs-comment">-- but it's silly to insist on this in the RebindableSyntax case</span><span>
</span><span id="line-875"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#unlessM"><span class="hs-identifier hs-type">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.RebindableSyntax</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-876"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863713"><span class="annot"><a href="#local-6989586621682863713"><span class="hs-identifier hs-var">icls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-type">tcLookupClass</span></a></span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#integralClassName"><span class="hs-identifier hs-type">integralClassName</span></a></span><span>
</span><span id="line-877"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-type">instStupidTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863696"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-type">mkClassPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863713"><span class="hs-identifier hs-type">icls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682863709"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863718"><span class="annot"><a href="#local-6989586621682863718"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv1"><span class="hs-identifier hs-type">tcExtendIdEnv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863689"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863702"><span class="hs-identifier hs-type">bndr_id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863520"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863719"><span class="annot"><a href="#local-6989586621682863719"><span class="hs-identifier hs-var hs-var">minus''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621682863703"><span class="hs-identifier hs-var">minus'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-882"></span><span>                          </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprTc"><span class="hs-identifier hs-var">NoSyntaxExprTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; SyntaxExprTc
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_pat NoSyntaxExprTc&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyntaxExprTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621682863703"><span class="hs-identifier hs-var">minus'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>                                   </span><span class="hs-comment">-- this should be statically avoidable</span><span>
</span><span id="line-884"></span><span>                                   </span><span class="hs-comment">-- Case (3) from Note [NoSyntaxExpr] in &quot;GHC.Hs.Expr&quot;</span><span>
</span><span id="line-885"></span><span>                          </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: SyntaxExprTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682863723"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682863723"><span class="hs-identifier hs-var">minus'_expr</span></a></span></span><span>
</span><span id="line-886"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: SyntaxExprTc -&gt; [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682863725"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682863725"><span class="hs-identifier hs-var">minus'_arg_wraps</span></a></span></span><span>
</span><span id="line-887"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: SyntaxExprTc -&gt; HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682863727"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863727"><span class="hs-identifier hs-var">minus'_res_wrap</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-888"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621682863723"><span class="hs-identifier hs-var">minus'_expr</span></a></span><span>
</span><span id="line-889"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621682863725"><span class="hs-identifier hs-var">minus'_arg_wraps</span></a></span><span>
</span><span id="line-890"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863701"><span class="hs-identifier hs-var">minus_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682863727"><span class="hs-identifier hs-var">minus'_res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-891"></span><span>                             </span><span class="hs-comment">-- Oy. This should really be a record update, but</span><span>
</span><span id="line-892"></span><span>                             </span><span class="hs-comment">-- we get warnings if we try. #17783</span><span>
</span><span id="line-893"></span><span>              </span><span id="local-6989586621682863728"><span class="annot"><a href="#local-6989586621682863728"><span class="hs-identifier hs-var hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XNPlusKPat GhcTc
-&gt; LIdP GhcTc
-&gt; XRec GhcTc (HsOverLit GhcTc)
-&gt; HsOverLit GhcTc
-&gt; SyntaxExpr GhcTc
-&gt; SyntaxExpr GhcTc
-&gt; Pat GhcTc
forall p.
XNPlusKPat p
-&gt; LIdP p
-&gt; XRec p (HsOverLit p)
-&gt; HsOverLit p
-&gt; SyntaxExpr p
-&gt; SyntaxExpr p
-&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#NPlusKPat"><span class="hs-identifier hs-var">NPlusKPat</span></a></span><span> </span><span class="annot"><span class="annottext">XNPlusKPat GhcTc
Type
</span><a href="#local-6989586621682863709"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; TyCoVar -&gt; GenLocated SrcSpanAnnN TyCoVar
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682863688"><span class="hs-identifier hs-var">nm_loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682863702"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpAnnCO -&gt; HsOverLit GhcTc -&gt; GenLocated EpAnnCO (HsOverLit GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><a href="#local-6989586621682863690"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621682863697"><span class="hs-identifier hs-var">lit1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621682863700"><span class="hs-identifier hs-var">lit2'</span></a></span><span>
</span><span id="line-894"></span><span>                               </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
SyntaxExprTc
</span><a href="#local-6989586621682863698"><span class="hs-identifier hs-var">ge'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
SyntaxExprTc
</span><a href="#local-6989586621682863719"><span class="hs-identifier hs-var">minus''</span></a></span><span>
</span><span id="line-895"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863694"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863728"><span class="hs-identifier hs-type">pat'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863709"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863718"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment.</span><span>
</span><span id="line-898"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-899"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-type">SplicePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceTop"><span class="hs-identifier hs-type">HsUntypedSpliceTop</span></a></span><span> </span><span id="local-6989586621682863729"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682863729"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span id="local-6989586621682863730"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863730"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-900"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621682863729"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-901"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (Pat (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863730"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863520"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-type">SplicePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUntypedSpliceNested"><span class="hs-identifier hs-type">HsUntypedSpliceNested</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsUntypedSplice (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (Pat GhcTc, r)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_pat: nested splice in splice pat&quot;</span></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#EmbTyPat"><span class="hs-identifier hs-type">EmbTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XEmbTyPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcM (Pat GhcTc, r)
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnIllegalTypePattern"><span class="hs-identifier hs-var">TcRnIllegalTypePattern</span></a></span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#InvisPat"><span class="hs-identifier hs-type">InvisPat</span></a></span><span> </span><span class="annot"><span class="annottext">XInvisPat (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsTyPat (NoGhcTc (GhcPass 'Renamed))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (Pat GhcTc, r)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_pat: invisible pattern appears recursively in the pattern&quot;</span></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#XPat"><span class="hs-identifier hs-type">XPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#HsPatExpanded"><span class="hs-identifier hs-type">HsPatExpanded</span></a></span><span> </span><span id="local-6989586621682863736"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863736"><span class="hs-identifier hs-var">lpat</span></a></span></span><span> </span><span id="local-6989586621682863737"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863737"><span class="hs-identifier hs-var">rpat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863738"><span class="annot"><a href="#local-6989586621682863738"><span class="hs-identifier hs-var">rpat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863739"><span class="annot"><a href="#local-6989586621682863739"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (Pat (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863517"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863518"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682863737"><span class="hs-identifier hs-var">rpat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863520"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-911"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#XPat"><span class="hs-identifier hs-type">XPat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ExpansionPat"><span class="hs-identifier hs-type">ExpansionPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863736"><span class="hs-identifier hs-type">lpat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863738"><span class="hs-identifier hs-type">rpat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863739"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="hs-comment">{-
Note [Hopping the LIE in lazy patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In a lazy pattern, we must *not* discharge constraints from the RHS
from dictionaries bound in the pattern.  E.g.
        f ~(C x) = 3
We can't discharge the Num constraint from dictionaries bound by
the pattern C!

So we have to make the constraints from thing_inside &quot;hop around&quot;
the pattern.  Hence the captureConstraints and emitConstraints.

The same thing ensures that equality constraints in a lazy match
are not made available in the RHS of the match. For example
        data T a where { T1 :: Int -&gt; T Int; ... }
        f :: T a -&gt; Int -&gt; a
        f ~(T1 i) y = y
It's obviously not sound to refine a to Int in the right
hand side, because the argument might not match T1 at all!

Finally, a lazy pattern should not bind any existential type variables
because they won't be in scope when we do the desugaring


************************************************************************
*                                                                      *
            Pattern signatures   (pat :: type)
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatSig"><span class="hs-identifier hs-type">tcPatSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                    </span><span class="hs-comment">-- True &lt;=&gt; pattern binding</span><span>
</span><span id="line-945"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsPatSigType"><span class="hs-identifier hs-type">HsPatSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-946"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-947"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- The type to use for &quot;inside&quot; the signature</span><span>
</span><span id="line-948"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><span id="line-949"></span><span>                                    </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><span id="line-950"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The wildcards</span><span>
</span><span id="line-951"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Coercion due to unification with actual ty</span><span>
</span><span id="line-952"></span><span>                                    </span><span class="hs-comment">-- Of shape:  res_ty ~ sig_ty</span><span>
</span><span id="line-953"></span><span id="tcPatSig"><span class="annot"><span class="annottext">tcPatSig :: Bool
-&gt; HsPatSigType (GhcPass 'Renamed)
-&gt; ExpSigmaTypeFRR
-&gt; TcM (Type, [(Name, TyCoVar)], [(Name, TyCoVar)], HsWrapper)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSig"><span class="hs-identifier hs-var hs-var">tcPatSig</span></a></span></span><span> </span><span id="local-6989586621682863740"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682863740"><span class="hs-identifier hs-var">in_pat_bind</span></a></span></span><span> </span><span id="local-6989586621682863741"><span class="annot"><span class="annottext">HsPatSigType (GhcPass 'Renamed)
</span><a href="#local-6989586621682863741"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621682863742"><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863742"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-954"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863743"><span class="annot"><a href="#local-6989586621682863743"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863744"><span class="annot"><a href="#local-6989586621682863744"><span class="hs-identifier hs-var">sig_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863745"><span class="annot"><a href="#local-6989586621682863745"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; HoleMode
-&gt; HsPatSigType (GhcPass 'Renamed)
-&gt; ContextKind
-&gt; TcM ([(Name, TyCoVar)], [(Name, TyCoVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span> </span><span class="annot"><span class="annottext">HsPatSigType (GhcPass 'Renamed)
</span><a href="#local-6989586621682863741"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span>
</span><span id="line-955"></span><span>        </span><span class="hs-comment">-- sig_tvs are the type variables free in 'sig',</span><span>
</span><span id="line-956"></span><span>        </span><span class="hs-comment">-- and not already in scope. These are the ones</span><span>
</span><span id="line-957"></span><span>        </span><span class="hs-comment">-- that should be brought into scope</span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-type">NE.nonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863744"><span class="hs-identifier hs-type">sig_tvs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-960"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty (Name, TyCoVar))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-961"></span><span>                </span><span class="hs-comment">-- Just do the subsumption check and return</span><span>
</span><span id="line-962"></span><span>                  </span><span id="local-6989586621682863751"><span class="annot"><a href="#local-6989586621682863751"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; ZonkM (TidyEnv, SDoc))
-&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a. (TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682863753"><span class="hs-identifier hs-var">mk_msg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863745"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM HsWrapper -&gt; TcM HsWrapper) -&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-963"></span><span>                          </span><span class="annot"><span class="annottext">CtOrigin
-&gt; UserTypeCtxt -&gt; ExpSigmaTypeFRR -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863742"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863745"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-964"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863745"><span class="hs-identifier hs-type">sig_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863743"><span class="hs-identifier hs-type">sig_wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863751"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-966"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682863755"><span class="annot"><span class="annottext">NonEmpty (Name, TyCoVar)
</span><a href="#local-6989586621682863755"><span class="hs-identifier hs-var">sig_tvs_ne</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-967"></span><span>                </span><span class="hs-comment">-- Type signature binds at least one scoped type variable</span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span>                </span><span class="hs-comment">-- A pattern binding cannot bind scoped type variables</span><span>
</span><span id="line-970"></span><span>                </span><span class="hs-comment">-- It is more convenient to make the test here</span><span>
</span><span id="line-971"></span><span>                </span><span class="hs-comment">-- than in the renamer</span><span>
</span><span id="line-972"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682863740"><span class="hs-identifier hs-var">in_pat_bind</span></a></span><span>
</span><span id="line-973"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Name, TyCoVar) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotBindScopedTyVarInPatSig"><span class="hs-identifier hs-var">TcRnCannotBindScopedTyVarInPatSig</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Name, TyCoVar)
</span><a href="#local-6989586621682863755"><span class="hs-identifier hs-var">sig_tvs_ne</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span>              </span><span class="hs-comment">-- Now do a subsumption check of the pattern signature against res_ty</span><span>
</span><span id="line-976"></span><span>              </span><span id="local-6989586621682863759"><span class="annot"><a href="#local-6989586621682863759"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; ZonkM (TidyEnv, SDoc))
-&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a. (TidyEnv -&gt; ZonkM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682863753"><span class="hs-identifier hs-var">mk_msg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863745"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM HsWrapper -&gt; TcM HsWrapper) -&gt; TcM HsWrapper -&gt; TcM HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-977"></span><span>                      </span><span class="annot"><span class="annottext">CtOrigin
-&gt; UserTypeCtxt -&gt; ExpSigmaTypeFRR -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682863742"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863745"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span>              </span><span class="hs-comment">-- Phew!</span><span>
</span><span id="line-980"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863745"><span class="hs-identifier hs-type">sig_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863744"><span class="hs-identifier hs-type">sig_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863743"><span class="hs-identifier hs-type">sig_wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863759"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-983"></span><span>    </span><span id="local-6989586621682863753"><span class="annot"><span class="annottext">mk_msg :: Type -&gt; TidyEnv -&gt; ZonkM (TidyEnv, SDoc)
</span><a href="#local-6989586621682863753"><span class="hs-identifier hs-var hs-var">mk_msg</span></a></span></span><span> </span><span id="local-6989586621682863760"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863760"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span id="local-6989586621682863761"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682863761"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span>
</span><span id="line-984"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863762"><span class="annot"><a href="#local-6989586621682863762"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863763"><span class="annot"><a href="#local-6989586621682863763"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; ZonkM (TidyEnv, Type)
</span><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621682863761"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863760"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-985"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863765"><span class="annot"><a href="#local-6989586621682863765"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863742"><span class="hs-identifier hs-type">res_ty</span></a></span><span>   </span><span class="hs-comment">-- should be filled in by now</span><span>
</span><span id="line-986"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863766"><span class="annot"><a href="#local-6989586621682863766"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863767"><span class="annot"><a href="#local-6989586621682863767"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Zonk.TcType.html#zonkTidyTcType"><span class="hs-identifier hs-type">zonkTidyTcType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863762"><span class="hs-identifier hs-type">tidy_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863765"><span class="hs-identifier hs-type">res_ty</span></a></span><span>
</span><span id="line-987"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863768"><span class="annot"><a href="#local-6989586621682863768"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking that the pattern signature:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span>                                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863763"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fits the type of its context:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span>                                          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863767"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-991"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682863766"><span class="hs-identifier hs-type">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863768"><span class="hs-identifier hs-type">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Most of the work for constructors is here
        (the rest is in the ConPatIn case of tc_pat)
*                                                                      *
************************************************************************

[Pattern matching indexed data types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following declarations:

  data family Map k :: * -&gt; *
  data instance Map (a, b) v = MapPair (Map a (Pair b v))

and a case expression

  case x :: Map (Int, c) w of MapPair m -&gt; ...

As explained by [Wrappers for data instance tycons] in GHC.Types.Id.Make, the
worker/wrapper types for MapPair are

  $WMapPair :: forall a b v. Map a (Map a b v) -&gt; Map (a, b) v
  $wMapPair :: forall a b v. Map a (Map a b v) -&gt; :R123Map a b v

So, the type of the scrutinee is Map (Int, c) w, but the tycon of MapPair is
:R123Map, which means the straight use of boxySplitTyConApp would give a type
error.  Hence, the smart wrapper function boxySplitTyConAppWithFamily calls
boxySplitTyConApp with the family tycon Map instead, which gives us the family
type list {(Int, c), w}.  To get the correct split for :R123Map, we need to
unify the family type list {(Int, c), w} with the instance types {(a, b), v}
(provided by tyConFamInst_maybe together with the family tycon).  This
unification yields the substitution [a -&gt; Int, b -&gt; c, v -&gt; w], which gives us
the split arguments for the representation tycon :R123Map as {Int, c, w}

In other words, boxySplitTyConAppWithFamily implicitly takes the coercion

  Co123Map a b v :: {Map (a, b) v ~ :R123Map a b v}

moving between representation and family type into account.  To produce type
correct Core, this coercion needs to be used to case the type of the scrutinee
from the family to the representation type.  This is achieved by
unwrapFamInstScrutinee using a CoPat around the result pattern.

Now it might appear seem as if we could have used the previous GADT type
refinement infrastructure of refineAlt and friends instead of the explicit
unification and CoPat generation.  However, that would be wrong.  Why?  The
whole point of GADT refinement is that the refinement is local to the case
alternative.  In contrast, the substitution generated by the unification of
the family type list and instance types needs to be propagated to the outside.
Imagine that in the above example, the type of the scrutinee would have been
(Map x w), then we would have unified {x, w} with {(a, b), v}, yielding the
substitution [x -&gt; (a, b), v -&gt; w].  In contrast to GADT matching, the
instantiation of x with (a, b) must be global; ie, it must be valid in *all*
alternatives of the case expression, whereas in the GADT case it might vary
between alternatives.

RIP GADT refinement: refinements have been replaced by the use of explicit
equality constraints that are used in conjunction with implication constraints
to express the local scope of GADT refinements.

Note [Freshen existentials]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
It is essential that these existentials are freshened.
Otherwise, if we have something like
  case (a :: Ex, b :: Ex) of (MkEx ..., MkEx ...) -&gt; ...
we'll give both unpacked existential variables the
same name, leading to shadowing.

-}</span></span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span class="hs-comment">--      Running example:</span><span>
</span><span id="line-1065"></span><span class="hs-comment">-- MkT :: forall a b c. (a~[b]) =&gt; b -&gt; c -&gt; T a</span><span>
</span><span id="line-1066"></span><span class="hs-comment">--       with scrutinee of type (T ty)</span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span id="local-6989586621682862654"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConPat"><span class="hs-identifier hs-type">tcConPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1069"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>    </span><span class="hs-comment">-- Type of the pattern</span><span>
</span><span id="line-1070"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862654"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1071"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862654"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1072"></span><span id="tcConPat"><span class="annot"><span class="annottext">tcConPat :: forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; Scaled ExpSigmaTypeFRR
-&gt; HsConPatDetails (GhcPass 'Renamed)
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcConPat"><span class="hs-identifier hs-var hs-var">tcConPat</span></a></span></span><span> </span><span id="local-6989586621682863773"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863773"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863774"><span class="annot"><span class="annottext">con_lname :: GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621682863774"><span class="hs-identifier hs-var">con_lname</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682863775"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863775"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863776"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863776"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621682863777"><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682863777"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span id="local-6989586621682863778"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863778"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863779"><span class="annot"><a href="#local-6989586621682863779"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM ConLike
</span><a href="GHC.Tc.Utils.Env.html#tcLookupConLike"><span class="hs-identifier hs-var">tcLookupConLike</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863775"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682863779"><span class="hs-identifier hs-type">con_like</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1075"></span><span>            </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621682863782"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863782"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
-&gt; DataCon
-&gt; Scaled ExpSigmaTypeFRR
-&gt; Checker (HsConPatDetails (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcDataConPat"><span class="hs-identifier hs-var">tcDataConPat</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621682863774"><span class="hs-identifier hs-var">con_lname</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863782"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863776"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1076"></span><span>                                                 </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863773"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682863777"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863778"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1077"></span><span>            </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621682863785"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682863785"><span class="hs-identifier hs-var">pat_syn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
-&gt; PatSyn
-&gt; Scaled ExpSigmaTypeFRR
-&gt; Checker (HsConPatDetails (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSynPat"><span class="hs-identifier hs-var">tcPatSynPat</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621682863774"><span class="hs-identifier hs-var">con_lname</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682863785"><span class="hs-identifier hs-var">pat_syn</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863776"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1078"></span><span>                                             </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863773"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682863777"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682863778"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1079"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span class="hs-comment">-- Warn when pattern matching on a GADT or a pattern synonym</span><span>
</span><span id="line-1082"></span><span class="hs-comment">-- when MonoLocalBinds is off.</span><span>
</span><span id="line-1083"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#warnMonoLocalBinds"><span class="hs-identifier hs-type">warnMonoLocalBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span id="warnMonoLocalBinds"><span class="annot"><span class="annottext">warnMonoLocalBinds :: TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#warnMonoLocalBinds"><span class="hs-identifier hs-var hs-var">warnMonoLocalBinds</span></a></span></span><span>
</span><span id="line-1085"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682863788"><span class="annot"><a href="#local-6989586621682863788"><span class="hs-identifier hs-var">mono_local_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.MonoLocalBinds</span></span><span>
</span><span id="line-1086"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="annot"><a href="#local-6989586621682863788"><span class="hs-identifier hs-type">mono_local_binds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1087"></span><span>           </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDiagnostic"><span class="hs-identifier hs-type">addDiagnostic</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#TcRnGADTMonoLocalBinds"><span class="hs-identifier hs-type">TcRnGADTMonoLocalBinds</span></a></span><span>
</span><span id="line-1088"></span><span>           </span><span class="hs-comment">-- We used to require the GADTs or TypeFamilies extension</span><span>
</span><span id="line-1089"></span><span>           </span><span class="hs-comment">-- to pattern match on a GADT (#2905, #7156)</span><span>
</span><span id="line-1090"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-1091"></span><span>           </span><span class="hs-comment">-- In #20485 this was made into a warning.</span><span>
</span><span id="line-1092"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcDataConPat"><span class="hs-identifier hs-type">tcDataConPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-1095"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>        </span><span class="hs-comment">-- Type of the pattern</span><span>
</span><span id="line-1096"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span id="tcDataConPat"><span class="annot"><span class="annottext">tcDataConPat :: GenLocated SrcSpanAnnN Name
-&gt; DataCon
-&gt; Scaled ExpSigmaTypeFRR
-&gt; Checker (HsConPatDetails (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcDataConPat"><span class="hs-identifier hs-var hs-var">tcDataConPat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682863885"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682863885"><span class="hs-identifier hs-var">con_span</span></a></span></span><span> </span><span id="local-6989586621682863886"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682863886"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682863887"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863887"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621682863888"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863888"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span></span><span>
</span><span id="line-1098"></span><span>             </span><span id="local-6989586621682863889"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863889"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682863890"><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682863890"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span id="local-6989586621682863891"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682863891"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1099"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863892"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621682863892"><span class="hs-identifier hs-var hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863887"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1100"></span><span>                  </span><span class="hs-comment">-- For data families this is the representation tycon</span><span>
</span><span id="line-1101"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682863894"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682863894"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863895"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682863895"><span class="hs-identifier hs-var hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863896"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682863896"><span class="hs-identifier hs-var hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863897"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863897"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863898"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682863898"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyCoVar], [TyCoVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863887"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1103"></span><span>              </span><span id="local-6989586621682863900"><span class="annot"><span class="annottext">header :: GenLocated SrcSpanAnnN ConLike
</span><a href="#local-6989586621682863900"><span class="hs-identifier hs-var hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; ConLike -&gt; GenLocated SrcSpanAnnN ConLike
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682863885"><span class="hs-identifier hs-var">con_span</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863887"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span>          </span><span class="hs-comment">-- Instantiate the constructor type variables [a-&gt;ty]</span><span>
</span><span id="line-1106"></span><span>          </span><span class="hs-comment">-- This may involve doing a family-instance coercion,</span><span>
</span><span id="line-1107"></span><span>          </span><span class="hs-comment">-- and building a wrapper</span><span>
</span><span id="line-1108"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863901"><span class="annot"><a href="#local-6989586621682863901"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863902"><span class="annot"><a href="#local-6989586621682863902"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv
-&gt; TyCon -&gt; Scaled ExpSigmaTypeFRR -&gt; TcM (HsWrapper, [Type])
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedConTy"><span class="hs-identifier hs-var">matchExpectedConTy</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863889"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682863892"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863888"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span><span>
</span><span id="line-1109"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863904"><span class="annot"><a href="#local-6989586621682863904"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863888"><span class="hs-identifier hs-type">pat_ty_scaled</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span>          </span><span class="hs-comment">-- Add the stupid theta</span><span>
</span><span id="line-1112"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-type">setSrcSpanA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863885"><span class="hs-identifier hs-type">con_span</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-type">addDataConStupidTheta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863887"><span class="hs-identifier hs-type">data_con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863902"><span class="hs-identifier hs-type">ctxt_res_tys</span></a></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span>        </span><span class="hs-comment">-- Check that this isn't a GADT pattern match</span><span>
</span><span id="line-1115"></span><span>        </span><span class="hs-comment">-- in situations in which that isn't allowed.</span><span>
</span><span id="line-1116"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863905"><span class="annot"><a href="#local-6989586621682863905"><span class="hs-identifier hs-var hs-var">all_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EqSpec] -&gt; [Type]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682863896"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863897"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682863898"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-type">checkGADT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863887"><span class="hs-identifier hs-type">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863895"><span class="hs-identifier hs-type">ex_tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863905"><span class="hs-identifier hs-type">all_arg_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863889"><span class="hs-identifier hs-type">penv</span></a></span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863908"><span class="annot"><a href="#local-6989586621682863908"><span class="hs-identifier hs-var">tenv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instTyVarsWith"><span class="hs-identifier hs-type">instTyVarsWith</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-type">PatOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863894"><span class="hs-identifier hs-type">univ_tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863902"><span class="hs-identifier hs-type">ctxt_res_tys</span></a></span><span>
</span><span id="line-1120"></span><span>                  </span><span class="hs-comment">-- NB: Do not use zipTvSubst!  See #14154</span><span>
</span><span id="line-1121"></span><span>                  </span><span class="hs-comment">-- We want to create a well-kinded substitution, so</span><span>
</span><span id="line-1122"></span><span>                  </span><span class="hs-comment">-- that the instantiated type is well-kinded</span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863910"><span class="annot"><a href="#local-6989586621682863910"><span class="hs-identifier hs-var hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682863889"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1125"></span><span>                     </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span id="local-6989586621682863911"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863911"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682863911"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-1126"></span><span>                     </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
HsMatchContext (GenLocated SrcSpanAnnN Name)
forall fn. HsMatchContext fn
</span><a href="Language.Haskell.Syntax.Expr.html#PatBindRhs"><span class="hs-identifier hs-var">PatBindRhs</span></a></span><span>
</span><span id="line-1127"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863913"><span class="annot"><a href="#local-6989586621682863913"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-type">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#PatSkol"><span class="hs-identifier hs-type">PatSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863887"><span class="hs-identifier hs-type">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863910"><span class="hs-identifier hs-type">mc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863916"><span class="annot"><a href="#local-6989586621682863916"><span class="hs-identifier hs-var">tenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863917"><span class="annot"><a href="#local-6989586621682863917"><span class="hs-identifier hs-var">ex_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSuperSkolTyVarsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863913"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863908"><span class="hs-identifier hs-type">tenv1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863895"><span class="hs-identifier hs-type">ex_tvs</span></a></span><span>
</span><span id="line-1129"></span><span>                     </span><span class="hs-comment">-- Get location from monad, not from ex_tvs</span><span>
</span><span id="line-1130"></span><span>                     </span><span class="hs-comment">-- This freshens: See Note [Freshen existentials]</span><span>
</span><span id="line-1131"></span><span>                     </span><span class="hs-comment">-- Why &quot;super&quot;? See Note [Binding when looking up instances]</span><span>
</span><span id="line-1132"></span><span>                     </span><span class="hs-comment">-- in GHC.Core.InstEnv.</span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863919"><span class="annot"><a href="#local-6989586621682863919"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Scaled Type] -&gt; [Scaled Type]
Subst -&gt; [Scaled Type] -&gt; [Scaled Type]
</span><a href="GHC.Core.TyCo.Subst.html#substScaledTys"><span class="hs-identifier hs-var">substScaledTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682863916"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682863898"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1135"></span><span>              </span><span id="local-6989586621682863921"><span class="annot"><a href="#local-6989586621682863921"><span class="hs-identifier hs-var hs-var">pat_mult</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682863888"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span><span>
</span><span id="line-1136"></span><span>              </span><span id="local-6989586621682863922"><span class="annot"><a href="#local-6989586621682863922"><span class="hs-identifier hs-var hs-var">arg_tys_scaled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled Type -&gt; Scaled Type) -&gt; [Scaled Type] -&gt; [Scaled Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type -&gt; Scaled Type
forall a. Type -&gt; Scaled a -&gt; Scaled a
</span><a href="GHC.Core.Multiplicity.html#scaleScaled"><span class="hs-identifier hs-var">scaleScaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682863921"><span class="hs-identifier hs-var">pat_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682863919"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-1137"></span><span>              </span><span id="local-6989586621682863924"><span class="annot"><a href="#local-6989586621682863924"><span class="hs-identifier hs-var hs-var">con_like</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682863887"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span>        </span><span class="hs-comment">-- This check is necessary to uphold the invariant that 'tcConArgs'</span><span>
</span><span id="line-1140"></span><span>        </span><span class="hs-comment">-- is given argument types with a fixed runtime representation.</span><span>
</span><span id="line-1141"></span><span>        </span><span class="hs-comment">-- See test case T20363.</span><span>
</span><span id="line-1142"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkFixedRuntimeRep"><span class="hs-identifier hs-type">checkFixedRuntimeRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863887"><span class="hs-identifier hs-type">data_con</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863919"><span class="hs-identifier hs-type">arg_tys'</span></a></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcConPat&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;con_name:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863886"><span class="hs-identifier hs-type">con_name</span></a></span><span>
</span><span id="line-1145"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;univ_tvs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863894"><span class="hs-identifier hs-type">univ_tvs</span></a></span><span>
</span><span id="line-1146"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ex_tvs:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863895"><span class="hs-identifier hs-type">ex_tvs</span></a></span><span>
</span><span id="line-1147"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;eq_spec:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863896"><span class="hs-identifier hs-type">eq_spec</span></a></span><span>
</span><span id="line-1148"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;theta:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863897"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-1149"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ex_tvs':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863917"><span class="hs-identifier hs-type">ex_tvs'</span></a></span><span>
</span><span id="line-1150"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ctxt_res_tys:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863902"><span class="hs-identifier hs-type">ctxt_res_tys</span></a></span><span>
</span><span id="line-1151"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;pat_ty:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863904"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-1152"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;arg_tys':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863919"><span class="hs-identifier hs-type">arg_tys'</span></a></span><span>
</span><span id="line-1153"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;arg_pats&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863890"><span class="hs-identifier hs-type">arg_pats</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863927"><span class="annot"><a href="#local-6989586621682863927"><span class="hs-identifier hs-var">univ_ty_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863928"><span class="annot"><a href="#local-6989586621682863928"><span class="hs-identifier hs-var">ex_ty_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#splitConTyArgs"><span class="hs-identifier hs-type">splitConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863924"><span class="hs-identifier hs-type">con_like</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863890"><span class="hs-identifier hs-type">arg_pats</span></a></span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682863895"><span class="hs-identifier hs-type">ex_tvs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682863896"><span class="hs-identifier hs-type">eq_spec</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682863897"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-1158"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- The common case; no class bindings etc</span><span>
</span><span id="line-1159"></span><span>                    </span><span class="hs-comment">-- (see Note [Arrows and patterns])</span><span>
</span><span id="line-1160"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682863931"><span class="annot"><a href="#local-6989586621682863931"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863932"><span class="annot"><a href="#local-6989586621682863932"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-type">tcConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863916"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863889"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863927"><span class="hs-identifier hs-type">univ_ty_args</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1161"></span><span>                                        </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConValArgs"><span class="hs-identifier hs-type">tcConValArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863924"><span class="hs-identifier hs-type">con_like</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863922"><span class="hs-identifier hs-type">arg_tys_scaled</span></a></span><span>
</span><span id="line-1162"></span><span>                                                     </span><span class="annot"><a href="#local-6989586621682863889"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863890"><span class="hs-identifier hs-type">arg_pats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863891"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1163"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863935"><span class="annot"><a href="#local-6989586621682863935"><span class="hs-identifier hs-var hs-var">res_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="#local-6989586621682863936"><span class="hs-identifier hs-var">pat_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (ConLikeP GhcTc)
GenLocated SrcSpanAnnN ConLike
</span><a href="#local-6989586621682863900"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-1164"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: HsConPatDetails GhcTc
</span><a href="#local-6989586621682863937"><span class="hs-identifier hs-var">pat_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcTc
HsConDetails
  (HsConPatTyArg (GhcPass 'Renamed))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
  (HsRecFields GhcTc (GenLocated SrcSpanAnnA (Pat GhcTc)))
</span><a href="#local-6989586621682863931"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span>
</span><span id="line-1165"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: XConPat GhcTc
</span><a href="#local-6989586621682863938"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-1166"></span><span>                                           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: [TyCoVar]
</span><a href="#local-6989586621682863940"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: [TyCoVar]
</span><a href="#local-6989586621682863941"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1167"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_binds :: TcEvBinds
</span><a href="#local-6989586621682863942"><span class="hs-identifier hs-var">cpt_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#emptyTcEvBinds"><span class="hs-identifier hs-var">emptyTcEvBinds</span></a></span><span>
</span><span id="line-1168"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: [Type]
</span><a href="#local-6989586621682863944"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863902"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-1169"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_wrap :: HsWrapper
</span><a href="#local-6989586621682863945"><span class="hs-identifier hs-var">cpt_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-1170"></span><span>                                           </span><span class="hs-special">}</span><span>
</span><span id="line-1171"></span><span>                                         </span><span class="hs-special">}</span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863901"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863935"><span class="hs-identifier hs-type">res_pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863904"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863932"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-comment">-- The general case, with existential,</span><span>
</span><span id="line-1176"></span><span>                    </span><span class="hs-comment">-- and local equality constraints</span><span>
</span><span id="line-1177"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863946"><span class="annot"><a href="#local-6989586621682863946"><span class="hs-identifier hs-var hs-var">theta'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682863916"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; [Type]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682863896"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863897"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1178"></span><span>                           </span><span class="hs-comment">-- order is *important* as we generate the list of</span><span>
</span><span id="line-1179"></span><span>                           </span><span class="hs-comment">-- dictionary binders from theta'</span><span>
</span><span id="line-1180"></span><span>
</span><span id="line-1181"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682863896"><span class="hs-identifier hs-type">eq_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#isEqPred"><span class="hs-identifier hs-type">isEqPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863897"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#warnMonoLocalBinds"><span class="hs-identifier hs-type">warnMonoLocalBinds</span></a></span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682863950"><span class="annot"><a href="#local-6989586621682863950"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-type">newEvVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863946"><span class="hs-identifier hs-type">theta'</span></a></span><span>
</span><span id="line-1184"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863952"><span class="annot"><a href="#local-6989586621682863952"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682863953"><span class="annot"><a href="#local-6989586621682863953"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682863954"><span class="annot"><a href="#local-6989586621682863954"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1185"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-comment">-- See Note [Type applications in patterns] (W4)</span><span>
</span><span id="line-1186"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-type">tcConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863916"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863889"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863927"><span class="hs-identifier hs-type">univ_ty_args</span></a></span><span>                       </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1187"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier hs-type">checkConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#getSkolemInfo"><span class="hs-identifier hs-type">getSkolemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863913"><span class="hs-identifier hs-type">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682863917"><span class="hs-identifier hs-type">ex_tvs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863950"><span class="hs-identifier hs-type">given</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1188"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-type">tcConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863916"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863889"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863928"><span class="hs-identifier hs-type">ex_ty_args</span></a></span><span>                         </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1189"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConValArgs"><span class="hs-identifier hs-type">tcConValArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863924"><span class="hs-identifier hs-type">con_like</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863922"><span class="hs-identifier hs-type">arg_tys_scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863889"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863890"><span class="hs-identifier hs-type">arg_pats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863891"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1190"></span><span>
</span><span id="line-1191"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682863957"><span class="annot"><a href="#local-6989586621682863957"><span class="hs-identifier hs-var hs-var">res_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span>
</span><span id="line-1192"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="#local-6989586621682863936"><span class="hs-identifier hs-var">pat_con</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRec GhcTc (ConLikeP GhcTc)
GenLocated SrcSpanAnnN ConLike
</span><a href="#local-6989586621682863900"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-1193"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: HsConPatDetails GhcTc
</span><a href="#local-6989586621682863937"><span class="hs-identifier hs-var">pat_args</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcTc
HsConDetails
  (HsConPatTyArg (GhcPass 'Renamed))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
  (HsRecFields GhcTc (GenLocated SrcSpanAnnA (Pat GhcTc)))
</span><a href="#local-6989586621682863953"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span>
</span><span id="line-1194"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: XConPat GhcTc
</span><a href="#local-6989586621682863938"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-1195"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: [TyCoVar]
</span><a href="#local-6989586621682863940"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682863917"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-1196"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: [TyCoVar]
</span><a href="#local-6989586621682863941"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682863950"><span class="hs-identifier hs-var">given</span></a></span><span>
</span><span id="line-1197"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_binds :: TcEvBinds
</span><a href="#local-6989586621682863942"><span class="hs-identifier hs-var">cpt_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621682863952"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1198"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: [Type]
</span><a href="#local-6989586621682863944"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682863902"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-1199"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_wrap :: HsWrapper
</span><a href="#local-6989586621682863945"><span class="hs-identifier hs-var">cpt_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-1200"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1201"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1202"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863901"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863957"><span class="hs-identifier hs-type">res_pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682863904"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682863954"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatSynPat"><span class="hs-identifier hs-type">tcPatSynPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span>
</span><span id="line-1206"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Type of the pattern</span></span><span>
</span><span id="line-1207"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span id="tcPatSynPat"><span class="annot"><span class="annottext">tcPatSynPat :: GenLocated SrcSpanAnnN Name
-&gt; PatSyn
-&gt; Scaled ExpSigmaTypeFRR
-&gt; Checker (HsConPatDetails (GhcPass 'Renamed)) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSynPat"><span class="hs-identifier hs-var hs-var">tcPatSynPat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682864041"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682864041"><span class="hs-identifier hs-var">con_span</span></a></span></span><span> </span><span id="local-6989586621682864042"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682864042"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682864043"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682864043"><span class="hs-identifier hs-var">pat_syn</span></a></span></span><span> </span><span id="local-6989586621682864044"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682864044"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621682864045"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864045"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682864046"><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682864046"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span id="local-6989586621682864047"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864047"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1209"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864048"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864048"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864049"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864049"><span class="hs-identifier hs-var hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864050"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864050"><span class="hs-identifier hs-var hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864051"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864051"><span class="hs-identifier hs-var hs-var">prov_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864052"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864052"><span class="hs-identifier hs-var hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864053"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864053"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn
-&gt; ([TyCoVar], [Type], [TyCoVar], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.PatSyn.html#patSynSig"><span class="hs-identifier hs-var">patSynSig</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682864043"><span class="hs-identifier hs-var">pat_syn</span></a></span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864055"><span class="annot"><a href="#local-6989586621682864055"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864056"><span class="annot"><a href="#local-6989586621682864056"><span class="hs-identifier hs-var">univ_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; TcM (Subst, [TyCoVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864048"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span>        </span><span class="hs-comment">-- Check that we aren't matching on a GADT-like pattern synonym</span><span>
</span><span id="line-1214"></span><span>        </span><span class="hs-comment">-- in situations in which that isn't allowed.</span><span>
</span><span id="line-1215"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682864058"><span class="annot"><a href="#local-6989586621682864058"><span class="hs-identifier hs-var hs-var">all_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864053"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864051"><span class="hs-identifier hs-var">prov_theta</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864052"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-type">checkGADT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864043"><span class="hs-identifier hs-type">pat_syn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864050"><span class="hs-identifier hs-type">ex_tvs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864058"><span class="hs-identifier hs-type">all_arg_tys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864045"><span class="hs-identifier hs-type">penv</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864059"><span class="annot"><a href="#local-6989586621682864059"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864045"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1219"></span><span>                            </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span id="local-6989586621682864060"><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682864060"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; HsMatchContextRn -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#PatSkol"><span class="hs-identifier hs-var">PatSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682864043"><span class="hs-identifier hs-var">pat_syn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsMatchContextRn
</span><a href="#local-6989586621682864060"><span class="hs-identifier hs-var">mc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1220"></span><span>                            </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) SkolemInfo
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
HasCallStack =&gt; SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#unkSkol"><span class="hs-identifier hs-var">unkSkol</span></a></span><span> </span><span class="hs-comment">-- Doesn't matter</span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864062"><span class="annot"><a href="#local-6989586621682864062"><span class="hs-identifier hs-var">tenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864063"><span class="annot"><a href="#local-6989586621682864063"><span class="hs-identifier hs-var">ex_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-type">tcInstSuperSkolTyVarsX</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864059"><span class="hs-identifier hs-type">skol_info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864055"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864050"><span class="hs-identifier hs-type">ex_tvs</span></a></span><span>
</span><span id="line-1223"></span><span>           </span><span class="hs-comment">-- This freshens: Note [Freshen existentials]</span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682864064"><span class="annot"><a href="#local-6989586621682864064"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864062"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864053"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1226"></span><span>              </span><span id="local-6989586621682864066"><span class="annot"><a href="#local-6989586621682864066"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Scaled Type] -&gt; [Scaled Type]
Subst -&gt; [Scaled Type] -&gt; [Scaled Type]
</span><a href="GHC.Core.TyCo.Subst.html#substScaledTys"><span class="hs-identifier hs-var">substScaledTys</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864062"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864052"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1227"></span><span>              </span><span id="local-6989586621682864067"><span class="annot"><a href="#local-6989586621682864067"><span class="hs-identifier hs-var hs-var">pat_mult</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682864044"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1228"></span><span>              </span><span id="local-6989586621682864068"><span class="annot"><a href="#local-6989586621682864068"><span class="hs-identifier hs-var hs-var">arg_tys_scaled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled Type -&gt; Scaled Type) -&gt; [Scaled Type] -&gt; [Scaled Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Scaled Type -&gt; Scaled Type
forall a. Type -&gt; Scaled a -&gt; Scaled a
</span><a href="GHC.Core.Multiplicity.html#scaleScaled"><span class="hs-identifier hs-var">scaleScaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864067"><span class="hs-identifier hs-var">pat_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864066"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-1229"></span><span>              </span><span id="local-6989586621682864069"><span class="annot"><a href="#local-6989586621682864069"><span class="hs-identifier hs-var hs-var">prov_theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864062"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864051"><span class="hs-identifier hs-var">prov_theta</span></a></span><span>
</span><span id="line-1230"></span><span>              </span><span id="local-6989586621682864070"><span class="annot"><a href="#local-6989586621682864070"><span class="hs-identifier hs-var hs-var">req_theta'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864062"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864049"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-1231"></span><span>              </span><span id="local-6989586621682864071"><span class="annot"><a href="#local-6989586621682864071"><span class="hs-identifier hs-var hs-var">con_like</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682864043"><span class="hs-identifier hs-var">pat_syn</span></a></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#isEqPred"><span class="hs-identifier hs-type">isEqPred</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864051"><span class="hs-identifier hs-type">prov_theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#warnMonoLocalBinds"><span class="hs-identifier hs-type">warnMonoLocalBinds</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864072"><span class="annot"><a href="#local-6989586621682864072"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-type">checkManyPattern</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#PatternSynonymReason"><span class="hs-identifier hs-type">PatternSynonymReason</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Utils.html#nlWildPatName"><span class="hs-identifier hs-type">nlWildPatName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864044"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-1236"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864075"><span class="annot"><a href="#local-6989586621682864075"><span class="hs-identifier hs-var">univ_ty_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864076"><span class="annot"><a href="#local-6989586621682864076"><span class="hs-identifier hs-var">ex_ty_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#splitConTyArgs"><span class="hs-identifier hs-type">splitConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864071"><span class="hs-identifier hs-type">con_like</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864046"><span class="hs-identifier hs-type">arg_pats</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864077"><span class="annot"><a href="#local-6989586621682864077"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-type">tc_sub_type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864045"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864044"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864064"><span class="hs-identifier hs-type">ty'</span></a></span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcPatSynPat&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1243"></span><span>          </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Pat syn:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864043"><span class="hs-identifier hs-type">pat_syn</span></a></span><span>
</span><span id="line-1244"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Expected type:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864044"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-1245"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Pat res ty:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864064"><span class="hs-identifier hs-type">ty'</span></a></span><span>
</span><span id="line-1246"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ex_tvs':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-type">pprTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864063"><span class="hs-identifier hs-type">ex_tvs'</span></a></span><span>
</span><span id="line-1247"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;prov_theta':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864069"><span class="hs-identifier hs-type">prov_theta'</span></a></span><span>
</span><span id="line-1248"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;req_theta':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864070"><span class="hs-identifier hs-type">req_theta'</span></a></span><span>
</span><span id="line-1249"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;arg_tys':&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864066"><span class="hs-identifier hs-type">arg_tys'</span></a></span><span>
</span><span id="line-1250"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;univ_ty_args:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864075"><span class="hs-identifier hs-type">univ_ty_args</span></a></span><span>
</span><span id="line-1251"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ex_ty_args:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864076"><span class="hs-identifier hs-type">ex_ty_args</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864078"><span class="annot"><a href="#local-6989586621682864078"><span class="hs-identifier hs-var">req_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-type">instCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-type">OccurrenceOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864042"><span class="hs-identifier hs-type">con_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-type">mkTyVarTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864056"><span class="hs-identifier hs-type">univ_tvs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864070"><span class="hs-identifier hs-type">req_theta'</span></a></span><span>
</span><span id="line-1254"></span><span>                      </span><span class="hs-comment">-- Origin (OccurrenceOf con_name):</span><span>
</span><span id="line-1255"></span><span>                      </span><span class="hs-comment">-- see Note [Call-stack tracing of pattern synonyms]</span><span>
</span><span id="line-1256"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;instCall&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864078"><span class="hs-identifier hs-type">req_wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span>          </span><span class="hs-comment">-- Pattern synonyms can never have representation-polymorphic argument types,</span><span>
</span><span id="line-1259"></span><span>          </span><span class="hs-comment">-- as checked in 'GHC.Tc.Gen.Sig.tcPatSynSig' (see use of 'FixedRuntimeRepPatSynSigArg')</span><span>
</span><span id="line-1260"></span><span>          </span><span class="hs-comment">-- and 'GHC.Tc.TyCl.PatSyn.tcInferPatSynDecl'.</span><span>
</span><span id="line-1261"></span><span>          </span><span class="hs-comment">-- (If you want to lift this restriction, use 'hasFixedRuntimeRep' here, to match</span><span>
</span><span id="line-1262"></span><span>          </span><span class="hs-comment">-- 'tcDataConPat'.)</span><span>
</span><span id="line-1263"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1264"></span><span>            </span><span class="annot"><a href="#local-6989586621682864082"><span class="hs-identifier hs-type">bad_arg_tys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1265"></span><span>            </span><span id="local-6989586621682864082"><span class="annot"><a href="#local-6989586621682864082"><span class="hs-identifier hs-var hs-var">bad_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Scaled Type) -&gt; Bool)
-&gt; [(Int, Scaled Type)] -&gt; [(Int, Scaled Type)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682864083"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864083"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#typeHasFixedRuntimeRep"><span class="hs-identifier hs-var">typeHasFixedRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864083"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>                        </span><span class="annot"><span class="annottext">([(Int, Scaled Type)] -&gt; [(Int, Scaled Type)])
-&gt; [(Int, Scaled Type)] -&gt; [(Int, Scaled Type)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Scaled Type] -&gt; [(Int, Scaled Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864066"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-type">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621682864082"><span class="hs-identifier hs-type">bad_arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1268"></span><span>            </span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcPatSynPat: pattern arguments do not have a fixed RuntimeRep&quot;</span></span><span>
</span><span id="line-1269"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bad_arg_tys:&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864082"><span class="hs-identifier hs-type">bad_arg_tys</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkConstraints {&quot;</span></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-type">Outputable.empty</span></a></span><span>
</span><span id="line-1272"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864087"><span class="annot"><a href="#local-6989586621682864087"><span class="hs-identifier hs-var">prov_dicts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-type">newEvVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864069"><span class="hs-identifier hs-type">prov_theta'</span></a></span><span>
</span><span id="line-1273"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864088"><span class="annot"><a href="#local-6989586621682864088"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864089"><span class="annot"><a href="#local-6989586621682864089"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864090"><span class="annot"><a href="#local-6989586621682864090"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-comment">-- See Note [Type applications in patterns] (W4)</span><span>
</span><span id="line-1275"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-type">tcConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864062"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864045"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864075"><span class="hs-identifier hs-type">univ_ty_args</span></a></span><span>                             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1276"></span><span>                </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier hs-type">checkConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#getSkolemInfo"><span class="hs-identifier hs-type">getSkolemInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864059"><span class="hs-identifier hs-type">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864063"><span class="hs-identifier hs-type">ex_tvs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864087"><span class="hs-identifier hs-type">prov_dicts'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1277"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-type">tcConTyArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864062"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864045"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864076"><span class="hs-identifier hs-type">ex_ty_args</span></a></span><span>                               </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1278"></span><span>                </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConValArgs"><span class="hs-identifier hs-type">tcConValArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864071"><span class="hs-identifier hs-type">con_like</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864068"><span class="hs-identifier hs-type">arg_tys_scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864045"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864046"><span class="hs-identifier hs-type">arg_pats</span></a></span><span>             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1279"></span><span>                </span><span class="annot"><a href="#local-6989586621682864047"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1280"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;checkConstraints }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864088"><span class="hs-identifier hs-type">ev_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682864091"><span class="annot"><a href="#local-6989586621682864091"><span class="hs-identifier hs-var hs-var">res_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="#local-6989586621682863936"><span class="hs-identifier hs-var">pat_con</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN -&gt; ConLike -&gt; GenLocated SrcSpanAnnN ConLike
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682864041"><span class="hs-identifier hs-var">con_span</span></a></span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; GenLocated SrcSpanAnnN ConLike)
-&gt; ConLike -&gt; GenLocated SrcSpanAnnN ConLike
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682864043"><span class="hs-identifier hs-var">pat_syn</span></a></span><span>
</span><span id="line-1283"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: HsConPatDetails GhcTc
</span><a href="#local-6989586621682863937"><span class="hs-identifier hs-var">pat_args</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcTc
HsConDetails
  (HsConPatTyArg (GhcPass 'Renamed))
  (GenLocated SrcSpanAnnA (Pat GhcTc))
  (HsRecFields GhcTc (GenLocated SrcSpanAnnA (Pat GhcTc)))
</span><a href="#local-6989586621682864089"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span>
</span><span id="line-1284"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: XConPat GhcTc
</span><a href="#local-6989586621682863938"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-1285"></span><span>                                 </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: [TyCoVar]
</span><a href="#local-6989586621682863940"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864063"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-1286"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: [TyCoVar]
</span><a href="#local-6989586621682863941"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864087"><span class="hs-identifier hs-var">prov_dicts'</span></a></span><span>
</span><span id="line-1287"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_binds :: TcEvBinds
</span><a href="#local-6989586621682863942"><span class="hs-identifier hs-var">cpt_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621682864088"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1288"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: [Type]
</span><a href="#local-6989586621682863944"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864056"><span class="hs-identifier hs-var">univ_tvs'</span></a></span><span>
</span><span id="line-1289"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_wrap :: HsWrapper
</span><a href="#local-6989586621682863945"><span class="hs-identifier hs-var">cpt_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682864078"><span class="hs-identifier hs-var">req_wrap</span></a></span><span>
</span><span id="line-1290"></span><span>                                 </span><span class="hs-special">}</span><span>
</span><span id="line-1291"></span><span>                               </span><span class="hs-special">}</span><span>
</span><span id="line-1292"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864092"><span class="annot"><a href="#local-6989586621682864092"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-type">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-type">scaledThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864044"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-type">mkHsWrapPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682864077"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864072"><span class="hs-identifier hs-type">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864091"><span class="hs-identifier hs-type">res_pat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864092"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864090"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1294"></span><span>
</span><span id="line-1295"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkFixedRuntimeRep"><span class="hs-identifier hs-type">checkFixedRuntimeRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1296"></span><span id="checkFixedRuntimeRep"><span class="annot"><span class="annottext">checkFixedRuntimeRep :: DataCon -&gt; [Scaled Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#checkFixedRuntimeRep"><span class="hs-identifier hs-var hs-var">checkFixedRuntimeRep</span></a></span></span><span> </span><span id="local-6989586621682864093"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864093"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621682864094"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864094"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>
</span><span id="line-1297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Scaled Type -&gt; TcRn ())
-&gt; [Int] -&gt; [Scaled Type] -&gt; TcRn ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><span class="hs-identifier hs-var">zipWithM_</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Scaled Type -&gt; TcRn ()
</span><a href="#local-6989586621682864096"><span class="hs-identifier hs-var">check_one</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864094"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1299"></span><span>    </span><span id="local-6989586621682864096"><span class="annot"><span class="annottext">check_one :: Int -&gt; Scaled Type -&gt; TcRn ()
</span><a href="#local-6989586621682864096"><span class="hs-identifier hs-var hs-var">check_one</span></a></span></span><span> </span><span id="local-6989586621682864097"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864097"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682864098"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864098"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
FixedRuntimeRepContext -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Concrete.html#hasFixedRuntimeRep_syntactic"><span class="hs-identifier hs-var">hasFixedRuntimeRep_syntactic</span></a></span><span>
</span><span id="line-1300"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Int -&gt; FixedRuntimeRepContext
</span><a href="GHC.Tc.Types.Origin.html#FRRDataConPatArg"><span class="hs-identifier hs-var">FRRDataConPatArg</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864093"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864097"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864098"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span class="hs-comment">{- Note [Call-stack tracing of pattern synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   f :: HasCallStack =&gt; blah

   pattern Annotated :: HasCallStack =&gt; (CallStack, a) -&gt; a
   pattern Annotated x &lt;- (f -&gt; x)

When we pattern-match against `Annotated` we will call `f`, and must
pass a call-stack.  We may want `Annotated` itself to propagate the call
stack, so we give it a HasCallStack constraint too.  But then we expect
to see `Annotated` in the call stack.

This is achieve easily, but a bit trickily.  When we instantiate
Annotated's &quot;required&quot; constraints, in tcPatSynPat, give them a
CtOrigin of (OccurrenceOf &quot;Annotated&quot;). That way the special magic
in GHC.Tc.Solver.Dict.solveCallStack which deals with CallStack
constraints will kick in: that logic only fires on constraints
whose Origin is (OccurrenceOf f).

See also Note [Overview of implicit CallStacks] in GHC.Tc.Types.Evidence
and Note [Solving CallStack constraints] in GHC.Tc.Solver.Types
-}</span><span>
</span><span id="line-1326"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1327"></span><span class="annot"><span class="hs-comment">-- | Convenient wrapper for calling a matchExpectedXXX function</span></span><span>
</span><span id="line-1328"></span><span id="local-6989586621682862637"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-type">matchExpectedPatTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercionN"><span class="hs-identifier hs-type">TcCoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862637"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1329"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682862637"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1330"></span><span class="hs-comment">-- See Note [Matching polytyped patterns]</span><span>
</span><span id="line-1331"></span><span class="hs-comment">-- Returns a wrapper : pat_ty ~R inner_ty</span><span>
</span><span id="line-1332"></span><span id="matchExpectedPatTy"><span class="annot"><span class="annottext">matchExpectedPatTy :: forall a.
(Type -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaTypeFRR -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var hs-var">matchExpectedPatTy</span></a></span></span><span> </span><span id="local-6989586621682864109"><span class="annot"><span class="annottext">Type -&gt; TcM (TcCoercionN, a)
</span><a href="#local-6989586621682864109"><span class="hs-identifier hs-var">inner_match</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_orig :: PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682864110"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682864110"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682864111"><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682864111"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span>
</span><span id="line-1333"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682864112"><span class="annot"><a href="#local-6989586621682864112"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR
</span><a href="#local-6989586621682864111"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1334"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864113"><span class="annot"><a href="#local-6989586621682864113"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864114"><span class="annot"><a href="#local-6989586621682864114"><span class="hs-identifier hs-var">pat_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864110"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864112"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-1335"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864116"><span class="annot"><a href="#local-6989586621682864116"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864117"><span class="annot"><a href="#local-6989586621682864117"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682864109"><span class="hs-identifier hs-type">inner_match</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864114"><span class="hs-identifier hs-type">pat_rho</span></a></span><span>
</span><span id="line-1336"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;matchExpectedPatTy&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864112"><span class="hs-identifier hs-type">pat_ty</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-type">$$</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864113"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1337"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-type">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864116"><span class="hs-identifier hs-type">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864113"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864117"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1340"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#matchExpectedConTy"><span class="hs-identifier hs-type">matchExpectedConTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-1341"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-1342"></span><span>                       </span><span class="hs-comment">-- ^ The TyCon that this data constructor actually returns.</span><span>
</span><span id="line-1343"></span><span>                       </span><span class="hs-comment">-- In the case of a data family, this is</span><span>
</span><span id="line-1344"></span><span>                       </span><span class="hs-comment">-- the /representation/ TyCon.</span><span>
</span><span id="line-1345"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaTypeFRR"><span class="hs-identifier hs-type">ExpSigmaTypeFRR</span></a></span><span>
</span><span id="line-1346"></span><span>                       </span><span class="hs-comment">-- ^ The type of the pattern.</span><span>
</span><span id="line-1347"></span><span>                       </span><span class="hs-comment">-- In the case of a data family, this would</span><span>
</span><span id="line-1348"></span><span>                       </span><span class="hs-comment">-- mention the /family/ TyCon</span><span>
</span><span id="line-1349"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span class="hs-comment">-- See Note [Matching constructor patterns]</span><span>
</span><span id="line-1351"></span><span class="hs-comment">-- Returns a wrapper : pat_ty &quot;-&gt;&quot; T ty1 ... tyn</span><span>
</span><span id="line-1352"></span><span id="matchExpectedConTy"><span class="annot"><span class="annottext">matchExpectedConTy :: PatEnv
-&gt; TyCon -&gt; Scaled ExpSigmaTypeFRR -&gt; TcM (HsWrapper, [Type])
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedConTy"><span class="hs-identifier hs-var hs-var">matchExpectedConTy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_orig :: PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682864119"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682864119"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682864120"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864120"><span class="hs-identifier hs-var">data_tc</span></a></span></span><span> </span><span id="local-6989586621682864121"><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682864121"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span></span><span>
</span><span id="line-1353"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864122"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864122"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864123"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864123"><span class="hs-identifier hs-var">fam_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864124"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682864124"><span class="hs-identifier hs-var">co_tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (TyCon, [Type], CoAxiom Unbranched)
</span><a href="GHC.Core.TyCon.html#tyConFamInstSig_maybe"><span class="hs-identifier hs-var">tyConFamInstSig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864120"><span class="hs-identifier hs-var">data_tc</span></a></span><span>
</span><span id="line-1354"></span><span>         </span><span class="hs-comment">-- Comments refer to Note [Matching constructor patterns]</span><span>
</span><span id="line-1355"></span><span>         </span><span class="hs-comment">-- co_tc :: forall a. T [a] ~ T7 a</span><span>
</span><span id="line-1356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682864126"><span class="annot"><a href="#local-6989586621682864126"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682864121"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1357"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864127"><span class="annot"><a href="#local-6989586621682864127"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864128"><span class="annot"><a href="#local-6989586621682864128"><span class="hs-identifier hs-var">pat_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864119"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864126"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-1358"></span><span>
</span><span id="line-1359"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864129"><span class="annot"><a href="#local-6989586621682864129"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864130"><span class="annot"><a href="#local-6989586621682864130"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-type">newMetaTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864120"><span class="hs-identifier hs-type">data_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>             </span><span class="hs-comment">-- tys = [ty1,ty2]</span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;matchExpectedConTy&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864120"><span class="hs-identifier hs-type">data_tc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1363"></span><span>                                             </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864120"><span class="hs-identifier hs-type">data_tc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1364"></span><span>                                             </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864122"><span class="hs-identifier hs-type">fam_tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864123"><span class="hs-identifier hs-type">fam_args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1365"></span><span>                                             </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864121"><span class="hs-identifier hs-type">exp_pat_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1366"></span><span>                                             </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864126"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1367"></span><span>                                             </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864128"><span class="hs-identifier hs-type">pat_rho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-type">ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864127"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1368"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864132"><span class="annot"><a href="#local-6989586621682864132"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-type">mkTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864122"><span class="hs-identifier hs-type">fam_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-type">substTys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864129"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864123"><span class="hs-identifier hs-type">fam_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864128"><span class="hs-identifier hs-type">pat_rho</span></a></span><span>
</span><span id="line-1369"></span><span>             </span><span class="hs-comment">-- co1 : T (ty1,ty2) ~N pat_rho</span><span>
</span><span id="line-1370"></span><span>             </span><span class="hs-comment">-- could use tcSubType here... but it's the wrong way round</span><span>
</span><span id="line-1371"></span><span>             </span><span class="hs-comment">-- for actual vs. expected in error messages.</span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682864135"><span class="annot"><a href="#local-6989586621682864135"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864130"><span class="hs-identifier hs-var">tvs'</span></a></span><span>
</span><span id="line-1374"></span><span>             </span><span id="local-6989586621682864136"><span class="annot"><a href="#local-6989586621682864136"><span class="hs-identifier hs-var hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
-&gt; CoAxiom Unbranched -&gt; [Type] -&gt; [TcCoercionN] -&gt; TcCoercionN
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621682864124"><span class="hs-identifier hs-var">co_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864135"><span class="hs-identifier hs-var">tys'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1375"></span><span>             </span><span class="hs-comment">-- co2 : T (ty1,ty2) ~R T7 ty1 ty2</span><span>
</span><span id="line-1376"></span><span>
</span><span id="line-1377"></span><span>             </span><span id="local-6989586621682864139"><span class="annot"><a href="#local-6989586621682864139"><span class="hs-identifier hs-var hs-var">full_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercionN -&gt; TcCoercionN
TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621682864132"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621682864136"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1378"></span><span>             </span><span class="hs-comment">-- full_co :: pat_rho ~R T7 ty1 ty2</span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-type">mkWpCastR</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864139"><span class="hs-identifier hs-type">full_co</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864127"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864135"><span class="hs-identifier hs-type">tys'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1381"></span><span>
</span><span id="line-1382"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682864143"><span class="annot"><a href="#local-6989586621682864143"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaTypeFRR -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR -&gt; ExpSigmaTypeFRR
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
</span><a href="#local-6989586621682864121"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1384"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864144"><span class="annot"><a href="#local-6989586621682864144"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864145"><span class="annot"><a href="#local-6989586621682864145"><span class="hs-identifier hs-var">pat_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-type">topInstantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864119"><span class="hs-identifier hs-type">orig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864143"><span class="hs-identifier hs-type">pat_ty</span></a></span><span>
</span><span id="line-1385"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864146"><span class="annot"><a href="#local-6989586621682864146"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864147"><span class="annot"><a href="#local-6989586621682864147"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-type">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864120"><span class="hs-identifier hs-type">data_tc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864145"><span class="hs-identifier hs-type">pat_rho</span></a></span><span>
</span><span id="line-1386"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-type">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864146"><span class="hs-identifier hs-type">coi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-type">&lt;.&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864144"><span class="hs-identifier hs-type">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864147"><span class="hs-identifier hs-type">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1387"></span><span>
</span><span id="line-1388"></span><span class="hs-comment">{-
Note [Matching constructor patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose (coi, tys) = matchExpectedConType data_tc pat_ty

 * In the simple case, pat_ty = tc tys

 * If pat_ty is a polytype, we want to instantiate it
   This is like part of a subsumption check.  Eg
      f :: (forall a. [a]) -&gt; blah
      f [] = blah

 * In a type family case, suppose we have
          data family T a
          data instance T (p,q) = A p | B q
       Then we'll have internally generated
              data T7 p q = A p | B q
              axiom coT7 p q :: T (p,q) ~ T7 p q

       So if pat_ty = T (ty1,ty2), we return (coi, [ty1,ty2]) such that
           coi = coi2 . coi1 : T7 t ~ pat_ty
           coi1 : T (ty1,ty2) ~ pat_ty
           coi2 : T7 ty1 ty2 ~ T (ty1,ty2)

   For families we do all this matching here, not in the unifier,
   because we never want a whisper of the data_tycon to appear in
   error messages; it's a purely internal thing
-}</span><span>
</span><span id="line-1416"></span><span>
</span><span id="line-1417"></span><span class="hs-comment">{- Note [Type applications in patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Type applications in patterns are enabled by -XTypeAbstractions.
For example:
   f :: Either (Maybe a) [b] -&gt; blah
   f (Left @x @[y] (v::Maybe x)) = blah

How should we typecheck them?  The basic plan is pretty simple, and is
all done in tcConTyArgs. For each type argument:

* Step 1:
    * bind the newly-in-scope type variables (here `x` or `y`) to
      unification variables, say `x0` or `y0`

    * typecheck the type argument, `@x` or `@[y]` to get the
      types `x0` or `[y0]`.

    This step is done by `tcHsPatSigType`, similar to the way we
    deal with pattern signatures.

* Step 2: Unify those types with the type arguments we expect from
  the context, in this case (Maybe a) and [b].  These unifications
  will (perhaps after the constraint solver has done its work)
  unify   x0 := Maybe a
          y0 := b
  Thus we learn that x stands for (Maybe a) and y for b.

* Step 3: Extend the lexical context to bind `x` to `x0` and
  `y` to `y0`, and typecheck the body of the pattern match.

However there are several quite tricky wrinkles.

(W1) Surprisingly, we can discard the coercions arising from
     these unifications.  The *only* thing the unification does is
     to side-effect those unification variables, so that we know
     what type x and y stand for; and cause an error if the equality
     is not soluble.  It's a bit like a constraint arising
     from a functional dependency, where we don't use the evidence.

(W2) Note that both here and in pattern signatures the unification may
     not even end up unifying the variable.  For example
       type S a b = a
       f :: Maybe a -&gt; Bool
       f (Just @(S a b) x) = True :: b
     In Step 2 we will unify (S a0 b0 ~ a), which succeeds, but has no
     effect on the unification variable b0, to which 'b' is bound.
     Later, in the RHS, we find that b0 must be Bool, and unify it there.
     All is fine.

(W3) The order of the arguments to the /data constructor/ may differ from
     the order of the arguments to the /type constructor/. Example
         data T a b where { MkT :: forall c d. (c,d) -&gt; T d c }
         f :: T Int Bool -&gt; blah
         f (MkT @x @y p) = ...
     The /first/ type argument to `MkT`, namely `@x` corresponds to the
     /second/ argument to `T` in the type `T Int Bool`.  So `x` is bound
     to `Bool` -- not to `Int`!.  That is why splitConTyArgs uses
     conLikeUserTyVarBinders to match up with the user-supplied type arguments
     in the pattern, not dataConUnivTyVars/dataConExTyVars.

(W4) A similar story works for existentials, but it is subtly different
     (#19847).  Consider
         data T a where { MkT :: forall a b. a -&gt; b -&gt; T a }
         f :: T Int -&gt; blah
         f (MkT @x @y v w) = blah
     Here we create a fresh unification variables x0,y0 for x,y and
     unify x0~Int, y0~b, where b is the fresh existential variable bound by
     the pattern. But
       * (x0~Int) must be /outside/ the implication constraint
       * (y0~b)   must be /inside/ it
     (and hence x0 and y0 themselves must have different levels).
     Thus:
         x0[1]~Int,  (forall[2] b. (y0[2]~b, ...constraints-from-blah...))

     We need (x0~Int) /outside/ so that it can influence the type of the
     pattern in an inferred setting, e.g.
         g :: T _ -&gt; blah
         g (MkT @Int @y v w) = blah
     Here we want to infer `g` to have type `T Int -&gt; blah`. If the
     (x0~Int) was inside the implication, and the the constructor bound
     equality constraints, `x0` would be untouchable. This was the root
     cause of #19847.

     We need (y0~b) to be /inside/ the implication, so that `b` is in
     scope.  In fact, we may actually /need/ equalities bound by the
     implication to prove the equality constraint we generate.
     Example   data T a where
                 MkT :: forall p q. T (p,q)
               f :: T (Int,Bool) -&gt; blah
               f (MkT @Int @Bool) = ...
     We get the implication
        forall[2] p q. (p,q)~(Int,Bool) =&gt; (p ~ Int, q ~ Bool, ...)
     where the Given comes from the GADT match, while (p~Int, q~Bool)
     comes from matching the type arguments.

     Wow.  That's all quite subtle! See the long discussion on #19847.  We
     must treat universal and existential arguments separately, even though
     they are all mixed up (W3).  The function splitConTyArgs separates the
     universals from existentials; and we build the implication between
     typechecking the two sets:
           tcConTyArgs ... univ_ty_args    $
           checkConstraints ...            $
           tcConTyArgs ... ex_ty_args      $
           ..typecheck body..
     You can see this code shape in tcDataConPat and tcPatSynPat.

     Where pattern synonyms are involved, this two-level split may not be
     enough.  See #22328 for the story.
-}</span><span>
</span><span id="line-1526"></span><span>
</span><span id="line-1527"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConValArgs"><span class="hs-identifier hs-type">tcConValArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1528"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaTypeFRR"><span class="hs-identifier hs-type">TcSigmaTypeFRR</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1529"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1530"></span><span id="tcConValArgs"><span class="annot"><span class="annottext">tcConValArgs :: ConLike
-&gt; [Scaled Type]
-&gt; Checker
     (HsConPatDetails (GhcPass 'Renamed)) (HsConPatDetails GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConValArgs"><span class="hs-identifier hs-var hs-var">tcConValArgs</span></a></span></span><span> </span><span id="local-6989586621682864174"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621682864175"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864175"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621682864176"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864176"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682864177"><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682864177"><span class="hs-identifier hs-var">con_args</span></a></span></span><span> </span><span id="local-6989586621682864178"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864178"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsConPatDetails (GhcPass 'Renamed)
</span><a href="#local-6989586621682864177"><span class="hs-identifier hs-var">con_args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1531"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span id="local-6989586621682864180"><span class="annot"><span class="annottext">[HsConPatTyArg (NoGhcTc (GhcPass 'Renamed))]
</span><a href="#local-6989586621682864180"><span class="hs-identifier hs-var">type_args</span></a></span></span><span> </span><span id="local-6989586621682864181"><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><a href="#local-6989586621682864181"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1532"></span><span>        </span><span class="hs-comment">-- NB: type_args already dealt with</span><span>
</span><span id="line-1533"></span><span>        </span><span class="hs-comment">-- See Note [Type applications in patterns]</span><span>
</span><span id="line-1534"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864183"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864184"><span class="hs-identifier hs-var">no_of_args</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Check correct arity</span><span>
</span><span id="line-1535"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; Int -&gt; Int -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnArityMismatch"><span class="hs-identifier hs-var">TcRnArityMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864183"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864184"><span class="hs-identifier hs-var">no_of_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682864187"><span class="annot"><span class="annottext">pats_w_tys :: [(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)]
</span><a href="#local-6989586621682864187"><span class="hs-identifier hs-var hs-var hs-var">pats_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
-&gt; [Scaled Type]
-&gt; [(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)]
forall a b. HasDebugCallStack =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConArgs&quot;</span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682864181"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864175"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1538"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864188"><span class="annot"><a href="#local-6989586621682864188"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864189"><span class="annot"><a href="#local-6989586621682864189"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checker
  (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)
  (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; Checker
     [(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)]
     [GenLocated SrcSpanAnnA (Pat GhcTc)]
forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
-&gt; (LPat (GhcPass 'Renamed), Scaled Type)
-&gt; TcM r
-&gt; TcM (LPat GhcTc, r)
PatEnv
-&gt; (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)
-&gt; TcM r
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcTc), r)
Checker (LPat (GhcPass 'Renamed), Scaled Type) (LPat GhcTc)
Checker
  (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)
  (GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864176"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)]
</span><a href="#local-6989586621682864187"><span class="hs-identifier hs-var">pats_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864178"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1539"></span><span>
</span><span id="line-1540"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864180"><span class="hs-identifier hs-type">type_args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864188"><span class="hs-identifier hs-type">arg_pats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864189"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1541"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1542"></span><span>      </span><span id="local-6989586621682864183"><span class="annot"><span class="annottext">con_arity :: Int
</span><a href="#local-6989586621682864183"><span class="hs-identifier hs-var hs-var">con_arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Int
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1543"></span><span>      </span><span id="local-6989586621682864184"><span class="annot"><span class="annottext">no_of_args :: Int
</span><a href="#local-6989586621682864184"><span class="hs-identifier hs-var hs-var">no_of_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682864181"><span class="hs-identifier hs-var">arg_pats</span></a></span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span id="local-6989586621682864193"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864193"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621682864194"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864194"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1546"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864195"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Check correct arity</span><span>
</span><span id="line-1547"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; Int -&gt; Int -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnArityMismatch"><span class="hs-identifier hs-var">TcRnArityMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682864195"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-1548"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682864196"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864196"><span class="hs-identifier hs-var hs-var">arg_ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682864197"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864197"><span class="hs-identifier hs-var hs-var">arg_ty2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864175"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>       </span><span class="hs-comment">-- This can't fail after the arity check</span><span>
</span><span id="line-1549"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621682864198"><span class="annot"><a href="#local-6989586621682864198"><span class="hs-identifier hs-var">p1'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682864199"><span class="annot"><a href="#local-6989586621682864199"><span class="hs-identifier hs-var">p2'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864200"><span class="annot"><a href="#local-6989586621682864200"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checker
  (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)
  (GenLocated SrcSpanAnnA (Pat GhcTc))
-&gt; Checker
     [(GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)]
     [GenLocated SrcSpanAnnA (Pat GhcTc)]
forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
-&gt; (LPat (GhcPass 'Renamed), Scaled Type)
-&gt; TcM r
-&gt; TcM (LPat GhcTc, r)
PatEnv
-&gt; (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)
-&gt; TcM r
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (GenLocated SrcSpanAnnA (Pat GhcTc), r)
Checker (LPat (GhcPass 'Renamed), Scaled Type) (LPat GhcTc)
Checker
  (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)), Scaled Type)
  (GenLocated SrcSpanAnnA (Pat GhcTc))
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864176"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682864193"><span class="hs-identifier hs-var">p1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864196"><span class="hs-identifier hs-var">arg_ty1</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682864194"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864197"><span class="hs-identifier hs-var">arg_ty2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1550"></span><span>                                                  </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864178"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1551"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864198"><span class="hs-identifier hs-type">p1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864199"><span class="hs-identifier hs-type">p2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864200"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1552"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1553"></span><span>      </span><span id="local-6989586621682864195"><span class="annot"><span class="annottext">con_arity :: Int
</span><a href="#local-6989586621682864195"><span class="hs-identifier hs-var hs-var">con_arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Int
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1554"></span><span>
</span><span id="line-1555"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span id="local-6989586621682864203"><span class="annot"><span class="annottext">[LHsRecField (GhcPass 'Renamed) (LPat (GhcPass 'Renamed))]
</span><a href="#local-6989586621682864203"><span class="hs-identifier hs-var">rpats</span></a></span></span><span> </span><span id="local-6989586621682864204"><span class="annot"><span class="annottext">Maybe (XRec (GhcPass 'Renamed) RecFieldsDotDot)
</span><a href="#local-6989586621682864204"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1556"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864205"><span class="annot"><a href="#local-6989586621682864205"><span class="hs-identifier hs-var">rpats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864206"><span class="annot"><a href="#local-6989586621682864206"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checker
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass 'Renamed)))
        (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)))))
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (Pat GhcTc))))
-&gt; Checker
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated SrcSpanAnnA (FieldOcc (GhcPass 'Renamed)))
           (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))))]
     [GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
           (GenLocated SrcSpanAnnA (Pat GhcTc)))]
forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
-&gt; LHsRecField (GhcPass 'Renamed) (LPat (GhcPass 'Renamed))
-&gt; TcM r
-&gt; TcM (LHsRecField GhcTc (LPat GhcTc), r)
PatEnv
-&gt; GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass 'Renamed)))
        (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))))
-&gt; TcM r
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (GenLocated
        SrcSpanAnnA
        (HsFieldBind
           (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
           (GenLocated SrcSpanAnnA (Pat GhcTc))),
      r)
Checker
  (LHsRecField (GhcPass 'Renamed) (LPat (GhcPass 'Renamed)))
  (LHsRecField GhcTc (LPat GhcTc))
Checker
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc (GhcPass 'Renamed)))
        (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)))))
  (GenLocated
     SrcSpanAnnA
     (HsFieldBind
        (GenLocated SrcSpanAnnA (FieldOcc GhcTc))
        (GenLocated SrcSpanAnnA (Pat GhcTc))))
</span><a href="#local-6989586621682864207"><span class="hs-identifier hs-var">tc_field</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864176"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField (GhcPass 'Renamed) (LPat (GhcPass 'Renamed))]
[GenLocated
   SrcSpanAnnA
   (HsFieldBind
      (GenLocated SrcSpanAnnA (FieldOcc (GhcPass 'Renamed)))
      (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))))]
</span><a href="#local-6989586621682864203"><span class="hs-identifier hs-var">rpats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864178"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1557"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864205"><span class="hs-identifier hs-type">rpats'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864204"><span class="hs-identifier hs-type">dd</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864206"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1558"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1559"></span><span>      </span><span class="annot"><a href="#local-6989586621682864207"><span class="hs-identifier hs-type">tc_field</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1560"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1561"></span><span>      </span><span id="local-6989586621682864207"><span class="annot"><span class="annottext">tc_field :: Checker
  (LHsRecField (GhcPass 'Renamed) (LPat (GhcPass 'Renamed)))
  (LHsRecField GhcTc (LPat GhcTc))
</span><a href="#local-6989586621682864207"><span class="hs-identifier hs-var hs-var">tc_field</span></a></span></span><span> </span><span id="local-6989586621682864212"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864212"><span class="hs-identifier hs-var">penv</span></a></span></span><span>
</span><span id="line-1562"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682864213"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682864213"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span> </span><span id="local-6989586621682864215"><span class="annot"><span class="annottext">XHsFieldBind (GenLocated SrcSpanAnnA (FieldOcc (GhcPass 'Renamed)))
</span><a href="#local-6989586621682864215"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682864216"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621682864216"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span id="local-6989586621682864218"><span class="annot"><span class="annottext">XCFieldOcc (GhcPass 'Renamed)
</span><a href="#local-6989586621682864218"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682864219"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621682864219"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621682864220"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621682864220"><span class="hs-identifier hs-var">rdr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682864221"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))
</span><a href="#local-6989586621682864221"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682864222"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864222"><span class="hs-identifier hs-var">pun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>               </span><span id="local-6989586621682864223"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864223"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1564"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682864224"><span class="annot"><a href="#local-6989586621682864224"><span class="hs-identifier hs-var">sel'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCoVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc (GhcPass 'Renamed)
Name
</span><a href="#local-6989586621682864218"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1565"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864226"><span class="annot"><a href="#local-6989586621682864226"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-type">setSrcSpanA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864216"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682864227"><span class="hs-identifier hs-type">find_field_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864218"><span class="hs-identifier hs-type">sel</span></a></span><span>
</span><span id="line-1566"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-type">rdrNameOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864220"><span class="hs-identifier hs-type">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864230"><span class="annot"><a href="#local-6989586621682864230"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864231"><span class="annot"><a href="#local-6989586621682864231"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-type">tcConArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864212"><span class="hs-identifier hs-type">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682864221"><span class="hs-identifier hs-type">pat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864226"><span class="hs-identifier hs-type">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864223"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1568"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864213"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsFieldBind"><span class="hs-identifier hs-type">HsFieldBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864215"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864216"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864224"><span class="hs-identifier hs-type">sel'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864219"><span class="hs-identifier hs-type">lr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864220"><span class="hs-identifier hs-type">rdr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682864230"><span class="hs-identifier hs-type">pat'</span></a></span><span>
</span><span id="line-1569"></span><span>                                                                        </span><span class="annot"><a href="#local-6989586621682864222"><span class="hs-identifier hs-type">pun</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864231"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1570"></span><span>
</span><span id="line-1571"></span><span>
</span><span id="line-1572"></span><span>      </span><span class="annot"><a href="#local-6989586621682864227"><span class="hs-identifier hs-type">find_field_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1573"></span><span>      </span><span id="local-6989586621682864227"><span class="annot"><span class="annottext">find_field_ty :: Name -&gt; FastString -&gt; TcRn (Scaled Type)
</span><a href="#local-6989586621682864227"><span class="hs-identifier hs-var hs-var">find_field_ty</span></a></span></span><span> </span><span id="local-6989586621682864232"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682864232"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621682864233"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682864233"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-1574"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864234"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864235"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682864235"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864234"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864234"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabel, Scaled Type)]
</span><a href="#local-6989586621682864236"><span class="hs-identifier hs-var">field_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621682864235"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682864232"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1575"></span><span>
</span><span id="line-1576"></span><span>                </span><span class="hs-comment">-- No matching field; chances are this field label comes from some</span><span>
</span><span id="line-1577"></span><span>                </span><span class="hs-comment">-- other record type (or maybe none).  If this happens, just fail,</span><span>
</span><span id="line-1578"></span><span>                </span><span class="hs-comment">-- otherwise we get crashes later (#8570), and similar:</span><span>
</span><span id="line-1579"></span><span>                </span><span class="hs-comment">--      f (R { foo = (a,b) }) = a+b</span><span>
</span><span id="line-1580"></span><span>                </span><span class="hs-comment">-- If foo isn't one of R's fields, we don't want to crash when</span><span>
</span><span id="line-1581"></span><span>                </span><span class="hs-comment">-- typechecking the &quot;a+b&quot;.</span><span>
</span><span id="line-1582"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn (Scaled Type)
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FieldLabelString -&gt; TcRnMessage
</span><a href="GHC.Rename.Utils.html#badFieldConErr"><span class="hs-identifier hs-var">badFieldConErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; FieldLabelString
</span><a href="Language.Haskell.Syntax.Basic.html#FieldLabelString"><span class="hs-identifier hs-var">FieldLabelString</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682864233"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span>
</span><span id="line-1584"></span><span>                </span><span class="hs-comment">-- The normal case, when the field comes from the right constructor</span><span>
</span><span id="line-1585"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621682864241"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864241"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682864242"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864242"><span class="hs-identifier hs-var">extras</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1586"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;find_field&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864241"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864242"><span class="hs-identifier hs-var">extras</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1587"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; TcRn (Scaled Type) -&gt; TcRn (Scaled Type)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864242"><span class="hs-identifier hs-var">extras</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; TcRn (Scaled Type)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682864241"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>
</span><span id="line-1589"></span><span>      </span><span class="annot"><a href="#local-6989586621682864236"><span class="hs-identifier hs-type">field_tys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1590"></span><span>      </span><span id="local-6989586621682864236"><span class="annot"><span class="annottext">field_tys :: [(FieldLabel, Scaled Type)]
</span><a href="#local-6989586621682864236"><span class="hs-identifier hs-var hs-var">field_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldLabel] -&gt; [Scaled Type] -&gt; [(FieldLabel, Scaled Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864174"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682864175"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1591"></span><span>          </span><span class="hs-comment">-- Don't use zipEqual! If the constructor isn't really a record, then</span><span>
</span><span id="line-1592"></span><span>          </span><span class="hs-comment">-- dataConFieldLabels will be empty (and each field in the pattern</span><span>
</span><span id="line-1593"></span><span>          </span><span class="hs-comment">-- will generate an error below).</span><span>
</span><span id="line-1594"></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#splitConTyArgs"><span class="hs-identifier hs-type">splitConTyArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1597"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatTyArg"><span class="hs-identifier hs-type">HsConPatTyArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Universals</span><span>
</span><span id="line-1598"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatTyArg"><span class="hs-identifier hs-type">HsConPatTyArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Existentials</span><span>
</span><span id="line-1599"></span><span class="hs-comment">-- See Note [Type applications in patterns] (W4)</span><span>
</span><span id="line-1600"></span><span class="hs-comment">-- This function is monadic only because of the error check</span><span>
</span><span id="line-1601"></span><span class="hs-comment">-- for too many type arguments</span><span>
</span><span id="line-1602"></span><span id="splitConTyArgs"><span class="annot"><span class="annottext">splitConTyArgs :: ConLike
-&gt; HsConPatDetails (GhcPass 'Renamed)
-&gt; TcM
     ([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
      [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
</span><a href="GHC.Tc.Gen.Pat.html#splitConTyArgs"><span class="hs-identifier hs-var hs-var">splitConTyArgs</span></a></span></span><span> </span><span id="local-6989586621682864245"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864245"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span id="local-6989586621682864246"><span class="annot"><span class="annottext">[HsConPatTyArg (NoGhcTc (GhcPass 'Renamed))]
</span><a href="#local-6989586621682864246"><span class="hs-identifier hs-var">type_args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Renamed)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1603"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsConPatTyArg (NoGhcTc (GhcPass 'Renamed))]
[HsConPatTyArg (GhcPass 'Renamed)]
</span><a href="#local-6989586621682864246"><span class="hs-identifier hs-var">type_args</span></a></span><span> </span><span class="annot"><span class="annottext">[HsConPatTyArg (GhcPass 'Renamed)] -&gt; [TyCoVar] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#leLength"><span class="hs-operator hs-var">`leLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864248"><span class="hs-identifier hs-var">con_spec_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Int -&gt; Int -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnTooManyTyArgsInConPattern"><span class="hs-identifier hs-var">TcRnTooManyTyArgsInConPattern</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864245"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1605"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864248"><span class="hs-identifier hs-var">con_spec_bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsConPatTyArg (GhcPass 'Renamed)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[HsConPatTyArg (NoGhcTc (GhcPass 'Renamed))]
[HsConPatTyArg (GhcPass 'Renamed)]
</span><a href="#local-6989586621682864246"><span class="hs-identifier hs-var">type_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864250"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>  </span><span class="hs-comment">-- Short cut common case</span><span>
</span><span id="line-1607"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
 [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
-&gt; TcM
     ([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
      [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
</span><a href="#local-6989586621682864251"><span class="hs-identifier hs-var">bndr_ty_arg_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1608"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
 [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
-&gt; TcM
     ([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
      [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((HsConPatTyArg (GhcPass 'Renamed), TyCoVar) -&gt; Bool)
-&gt; [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
-&gt; ([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
    [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">(HsConPatTyArg (GhcPass 'Renamed), TyCoVar) -&gt; Bool
</span><a href="#local-6989586621682864252"><span class="hs-identifier hs-var">is_universal</span></a></span><span> </span><span class="annot"><span class="annottext">[(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
</span><a href="#local-6989586621682864251"><span class="hs-identifier hs-var">bndr_ty_arg_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1609"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1610"></span><span>    </span><span id="local-6989586621682864250"><span class="annot"><span class="annottext">ex_tvs :: [TyCoVar]
</span><a href="#local-6989586621682864250"><span class="hs-identifier hs-var hs-var">ex_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [TyCoVar]
</span><a href="GHC.Core.ConLike.html#conLikeExTyCoVars"><span class="hs-identifier hs-var">conLikeExTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864245"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1611"></span><span>    </span><span id="local-6989586621682864248"><span class="annot"><span class="annottext">con_spec_bndrs :: [TyCoVar]
</span><a href="#local-6989586621682864248"><span class="hs-identifier hs-var hs-var">con_spec_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682864254"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621682864254"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682864254"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [VarBndr TyCoVar Specificity]
</span><a href="GHC.Core.ConLike.html#conLikeUserTyVarBinders"><span class="hs-identifier hs-var">conLikeUserTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864245"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1612"></span><span>        </span><span class="hs-comment">-- conLikeUserTyVarBinders: see (W3) in</span><span>
</span><span id="line-1613"></span><span>        </span><span class="hs-comment">--    Note [Type applications in patterns]</span><span>
</span><span id="line-1614"></span><span>        </span><span class="hs-comment">-- SpecifiedSpec: forgetting to filter out inferred binders led to #20443</span><span>
</span><span id="line-1615"></span><span>
</span><span id="line-1616"></span><span>    </span><span id="local-6989586621682864251"><span class="annot"><span class="annottext">bndr_ty_arg_prs :: [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
</span><a href="#local-6989586621682864251"><span class="hs-identifier hs-var hs-var">bndr_ty_arg_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsConPatTyArg (NoGhcTc (GhcPass 'Renamed))]
[HsConPatTyArg (GhcPass 'Renamed)]
</span><a href="#local-6989586621682864246"><span class="hs-identifier hs-var">type_args</span></a></span><span> </span><span class="annot"><span class="annottext">[HsConPatTyArg (GhcPass 'Renamed)]
-&gt; [TyCoVar] -&gt; [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864248"><span class="hs-identifier hs-var">con_spec_bndrs</span></a></span><span>
</span><span id="line-1617"></span><span>                      </span><span class="hs-comment">-- The zip truncates to length(type_args)</span><span>
</span><span id="line-1618"></span><span>
</span><span id="line-1619"></span><span>    </span><span id="local-6989586621682864252"><span class="annot"><span class="annottext">is_universal :: (HsConPatTyArg (GhcPass 'Renamed), TyCoVar) -&gt; Bool
</span><a href="#local-6989586621682864252"><span class="hs-identifier hs-var hs-var">is_universal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsConPatTyArg (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864257"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682864257"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682864257"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar -&gt; [TyCoVar] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864250"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1620"></span><span>         </span><span class="hs-comment">-- See Note [DataCon user type variable binders] in GHC.Core.DataCon</span><span>
</span><span id="line-1621"></span><span>         </span><span class="hs-comment">-- especially INVARIANT(dataConTyVars).</span><span>
</span><span id="line-1622"></span><span>
</span><span id="line-1623"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#splitConTyArgs"><span class="hs-identifier hs-var">splitConTyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
 [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
-&gt; TcM
     ([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
      [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- No type args in RecCon</span><span>
</span><span id="line-1624"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#splitConTyArgs"><span class="hs-identifier hs-var">splitConTyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
 [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
-&gt; TcM
     ([(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)],
      [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- No type args in InfixCon</span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span id="local-6989586621682862727"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-type">tcConTyArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatTyArg"><span class="hs-identifier hs-type">HsConPatTyArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1627"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862727"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862727"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1628"></span><span id="tcConTyArgs"><span class="annot"><span class="annottext">tcConTyArgs :: forall a.
Subst
-&gt; PatEnv
-&gt; [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
-&gt; TcM a
-&gt; TcM a
</span><a href="GHC.Tc.Gen.Pat.html#tcConTyArgs"><span class="hs-identifier hs-var hs-var">tcConTyArgs</span></a></span></span><span> </span><span id="local-6989586621682864259"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864259"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621682864260"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864260"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621682864261"><span class="annot"><span class="annottext">[(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
</span><a href="#local-6989586621682864261"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span id="local-6989586621682864262"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682864262"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1629"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Checker (HsConPatTyArg (GhcPass 'Renamed), TyCoVar) ()
-&gt; PatEnv
-&gt; [(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
-&gt; TcM a
-&gt; TcM a
forall inp r. Checker inp () -&gt; PatEnv -&gt; [inp] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple_"><span class="hs-identifier hs-var">tcMultiple_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Checker (HsConPatTyArg (GhcPass 'Renamed), TyCoVar) ()
</span><a href="GHC.Tc.Gen.Pat.html#tcConTyArg"><span class="hs-identifier hs-var">tcConTyArg</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864259"><span class="hs-identifier hs-var">tenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864260"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[(HsConPatTyArg (GhcPass 'Renamed), TyCoVar)]
</span><a href="#local-6989586621682864261"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682864262"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1630"></span><span>
</span><span id="line-1631"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArg"><span class="hs-identifier hs-type">tcConTyArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatTyArg"><span class="hs-identifier hs-type">HsConPatTyArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1632"></span><span id="tcConTyArg"><span class="annot"><span class="annottext">tcConTyArg :: Subst -&gt; Checker (HsConPatTyArg (GhcPass 'Renamed), TyCoVar) ()
</span><a href="GHC.Tc.Gen.Pat.html#tcConTyArg"><span class="hs-identifier hs-var hs-var">tcConTyArg</span></a></span></span><span> </span><span id="local-6989586621682864271"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864271"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621682864272"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864272"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatTyArg"><span class="hs-identifier hs-type">HsConPatTyArg</span></a></span><span> </span><span class="annot"><span class="annottext">XConPatTyArg (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682864274"><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864274"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864275"><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682864275"><span class="hs-identifier hs-var">con_tv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682864276"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621682864276"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1633"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864277"><span class="annot"><a href="#local-6989586621682864277"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864278"><span class="annot"><a href="#local-6989586621682864278"><span class="hs-identifier hs-var">sig_ibs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682864279"><span class="annot"><a href="#local-6989586621682864279"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
-&gt; Type -&gt; TcM ([(Name, TyCoVar)], [(Name, TyCoVar)], Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTyPat"><span class="hs-identifier hs-var">tcHsTyPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864274"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864271"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoVar
</span><a href="#local-6989586621682864275"><span class="hs-identifier hs-var">con_tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.List.NonEmpty.html/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-type">NE.nonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864278"><span class="hs-identifier hs-type">sig_ibs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1636"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682864280"><span class="annot"><span class="annottext">NonEmpty (Name, TyCoVar)
</span><a href="#local-6989586621682864280"><span class="hs-identifier hs-var">sig_ibs_ne</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var">inPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864272"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1637"></span><span>             </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Name, TyCoVar) -&gt; TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnCannotBindTyVarsInPatBind"><span class="hs-identifier hs-var">TcRnCannotBindTyVarsInPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Name, TyCoVar)
</span><a href="#local-6989586621682864280"><span class="hs-identifier hs-var">sig_ibs_ne</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1638"></span><span>           </span><span class="annot"><span class="annottext">Maybe (NonEmpty (Name, TyCoVar))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span>          </span><span class="hs-comment">-- This unification is straight from Figure 7 of</span><span>
</span><span id="line-1641"></span><span>          </span><span class="hs-comment">-- &quot;Type Variables in Patterns&quot;, Haskell'18</span><span>
</span><span id="line-1642"></span><span>          </span><span class="hs-comment">-- OK to drop coercions here. These unifications are all about</span><span>
</span><span id="line-1643"></span><span>          </span><span class="hs-comment">-- guiding inference based on a user-written type annotation</span><span>
</span><span id="line-1644"></span><span>          </span><span class="hs-comment">-- See Note [Type applications in patterns] (W1)</span><span>
</span><span id="line-1645"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-type">unifyType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><a href="#local-6989586621682864279"><span class="hs-identifier hs-type">arg_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier hs-type">substTyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864271"><span class="hs-identifier hs-type">tenv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864275"><span class="hs-identifier hs-type">con_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864283"><span class="annot"><a href="#local-6989586621682864283"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864277"><span class="hs-identifier hs-type">sig_wcs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1648"></span><span>                   </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-type">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682864278"><span class="hs-identifier hs-type">sig_ibs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1649"></span><span>                   </span><span class="annot"><a href="#local-6989586621682864276"><span class="hs-identifier hs-type">thing_inside</span></a></span><span>
</span><span id="line-1650"></span><span>             </span><span class="hs-comment">-- NB: Because we call tConTyArgs twice, once for universals and</span><span>
</span><span id="line-1651"></span><span>             </span><span class="hs-comment">--     once for existentials; so this brings things into scope</span><span>
</span><span id="line-1652"></span><span>             </span><span class="hs-comment">--     &quot;out of left-right order&quot;. But it doesn't matter; the renamer</span><span>
</span><span id="line-1653"></span><span>             </span><span class="hs-comment">--     has dealt with all that.</span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682864283"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-type">tcConArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span id="tcConArg"><span class="annot"><span class="annottext">tcConArg :: Checker (LPat (GhcPass 'Renamed), Scaled Type) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var hs-var">tcConArg</span></a></span></span><span> </span><span id="local-6989586621682864284"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864284"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682864285"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864285"><span class="hs-identifier hs-var">arg_pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682864286"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864286"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span> </span><span id="local-6989586621682864287"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864287"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaTypeFRR
-&gt; Checker (LPat (GhcPass 'Renamed)) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR -&gt; Scaled ExpSigmaTypeFRR
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864286"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ExpSigmaTypeFRR
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682864287"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621682864284"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864285"><span class="hs-identifier hs-var">arg_pat</span></a></span><span>
</span><span id="line-1660"></span><span>
</span><span id="line-1661"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-type">addDataConStupidTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1662"></span><span class="hs-comment">-- Instantiate the &quot;stupid theta&quot; of the data con, and throw</span><span>
</span><span id="line-1663"></span><span class="hs-comment">-- the constraints into the constraint set.</span><span>
</span><span id="line-1664"></span><span class="hs-comment">-- See Note [The stupid context] in GHC.Core.DataCon.</span><span>
</span><span id="line-1665"></span><span id="addDataConStupidTheta"><span class="annot"><span class="annottext">addDataConStupidTheta :: DataCon -&gt; [Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-var hs-var">addDataConStupidTheta</span></a></span></span><span> </span><span id="local-6989586621682864288"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864288"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621682864289"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864289"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-1666"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864290"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1667"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-var">instStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682864291"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864292"><span class="hs-identifier hs-var">inst_theta</span></a></span><span>
</span><span id="line-1668"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1669"></span><span>    </span><span id="local-6989586621682864291"><span class="annot"><span class="annottext">origin :: CtOrigin
</span><a href="#local-6989586621682864291"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864288"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>        </span><span class="hs-comment">-- The origin should always report &quot;occurrence of C&quot;</span><span>
</span><span id="line-1671"></span><span>        </span><span class="hs-comment">-- even when C occurs in a pattern</span><span>
</span><span id="line-1672"></span><span>    </span><span id="local-6989586621682864290"><span class="annot"><span class="annottext">stupid_theta :: [Type]
</span><a href="#local-6989586621682864290"><span class="hs-identifier hs-var hs-var">stupid_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Type]
</span><a href="GHC.Core.DataCon.html#dataConStupidTheta"><span class="hs-identifier hs-var">dataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864288"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1673"></span><span>    </span><span id="local-6989586621682864295"><span class="annot"><span class="annottext">univ_tvs :: [TyCoVar]
</span><a href="#local-6989586621682864295"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyCoVar]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864288"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1674"></span><span>    </span><span id="local-6989586621682864297"><span class="annot"><span class="annottext">tenv :: Subst
</span><a href="#local-6989586621682864297"><span class="hs-identifier hs-var hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [Type] -&gt; Subst
HasDebugCallStack =&gt; [TyCoVar] -&gt; [Type] -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864295"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoVar] -&gt; [Type] -&gt; [Type]
forall b a. [b] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#takeList"><span class="hs-identifier hs-var">takeList</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864295"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864289"><span class="hs-identifier hs-var">inst_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>         </span><span class="hs-comment">-- NB: inst_tys can be longer than the univ tyvars</span><span>
</span><span id="line-1676"></span><span>         </span><span class="hs-comment">--     because the constructor might have existentials</span><span>
</span><span id="line-1677"></span><span>    </span><span id="local-6989586621682864292"><span class="annot"><span class="annottext">inst_theta :: [Type]
</span><a href="#local-6989586621682864292"><span class="hs-identifier hs-var hs-var">inst_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682864297"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864290"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span>
</span><span id="line-1678"></span><span>
</span><span id="line-1679"></span><span class="hs-comment">{-
Note [Arrows and patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~
(Oct 07) Arrow notation has the odd property that it involves
&quot;holes in the scope&quot;. For example:
  expr :: Arrow a =&gt; a () Int
  expr = proc (y,z) -&gt; do
          x &lt;- term -&lt; y
          expr' -&lt; x

Here the 'proc (y,z)' binding scopes over the arrow tails but not the
arrow body (e.g 'term').  As things stand (bogusly) all the
constraints from the proc body are gathered together, so constraints
from 'term' will be seen by the tcPat for (y,z).  But we must *not*
bind constraints from 'term' here, because the desugarer will not make
these bindings scope over 'term'.

The Right Thing is not to confuse these constraints together. But for
now the Easy Thing is to ensure that we do not have existential or
GADT constraints in a 'proc', which we do by disallowing any
non-vanilla pattern match (i.e. one that introduces existential
variables or provided constraints), in tcDataConPat and tcPatSynPat.

We also short-cut the constraint simplification for such vanilla patterns,
so that we bind no constraints. Hence the 'fast path' in tcDataConPat;
which applies more generally (not just within 'proc'), as it's a good
plan in general to bypass the constraint simplification step entirely
when it's not needed.

Note [Pattern coercions]
~~~~~~~~~~~~~~~~~~~~~~~~
In principle, these program would be reasonable:

        f :: (forall a. a-&gt;a) -&gt; Int
        f (x :: Int-&gt;Int) = x 3

        g :: (forall a. [a]) -&gt; Bool
        g [] = True

In both cases, the function type signature restricts what arguments can be passed
in a call (to polymorphic ones).  The pattern type signature then instantiates this
type.  For example, in the first case,  (forall a. a-&gt;a) &lt;= Int -&gt; Int, and we
generate the translated term
        f = \x' :: (forall a. a-&gt;a).  let x = x' Int in x 3

From a type-system point of view, this is perfectly fine, but it's *very* seldom useful.
And it requires a significant amount of code to implement, because we need to decorate
the translated pattern with coercion functions (generated from the subsumption check
by tcSub).

So for now I'm just insisting on type *equality* in patterns.  No subsumption.

Old notes about desugaring, at a time when pattern coercions were handled:

A SigPat is a type coercion and must be handled one at a time.  We can't
combine them unless the type of the pattern inside is identical, and we don't
bother to check for that.  For example:

        data T = T1 Int | T2 Bool
        f :: (forall a. a -&gt; a) -&gt; T -&gt; t
        f (g::Int-&gt;Int)   (T1 i) = T1 (g i)
        f (g::Bool-&gt;Bool) (T2 b) = T2 (g b)

We desugar this as follows:

        f = \ g::(forall a. a-&gt;a) t::T -&gt;
            let gi = g Int
            in case t of { T1 i -&gt; T1 (gi i)
                           other -&gt;
            let gb = g Bool
            in case t of { T2 b -&gt; T2 (gb b)
                           other -&gt; fail }}

Note that we do not treat the first column of patterns as a
column of variables, because the coerced variables (gi, gb)
would be of different types.  So we get rather grotty code.
But I don't think this is a common case, and if it was we could
doubtless improve it.

Meanwhile, the strategy is:
        * treat each SigPat coercion (always non-identity coercions)
                as a separate block
        * deal with the stuff inside, and then wrap a binding round
                the result to bind the new variable (gi, gb, etc)


************************************************************************
*                                                                      *
\subsection{Errors and contexts}
*                                                                      *
************************************************************************

Note [Existential check]
~~~~~~~~~~~~~~~~~~~~~~~~
Lazy patterns can't bind existentials.  They arise in two ways:
  * Let bindings      let { C a b = e } in b
  * Twiddle patterns  f ~(C a b) = e
The pe_lazy field of PatEnv says whether we are inside a lazy
pattern (perhaps deeply)

See also Note [Typechecking pattern bindings] in GHC.Tc.Gen.Bind
-}</span><span>
</span><span id="line-1781"></span><span>
</span><span id="line-1782"></span><span id="local-6989586621682862575"><span id="local-6989586621682862576"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-type">maybeWrapPatCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862576"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682862576"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-1783"></span><span class="hs-comment">-- Not all patterns are worth pushing a context</span><span>
</span><span id="line-1784"></span><span id="maybeWrapPatCtxt"><span class="annot"><span class="annottext">maybeWrapPatCtxt :: forall a b.
Pat (GhcPass 'Renamed) -&gt; (TcM a -&gt; TcM b) -&gt; TcM a -&gt; TcM b
</span><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-var hs-var">maybeWrapPatCtxt</span></a></span></span><span> </span><span id="local-6989586621682864303"><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864303"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682864304"><span class="annot"><span class="annottext">TcM a -&gt; TcM b
</span><a href="#local-6989586621682864304"><span class="hs-identifier hs-var">tcm</span></a></span></span><span> </span><span id="local-6989586621682864305"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682864305"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1785"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; Bool
forall p. Pat p -&gt; Bool
</span><a href="#local-6989586621682864306"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864303"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM b
</span><a href="#local-6989586621682864304"><span class="hs-identifier hs-var">tcm</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682864305"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1786"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM b -&gt; TcM b
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682864308"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM b -&gt; TcM b) -&gt; TcM b -&gt; TcM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM b
</span><a href="#local-6989586621682864304"><span class="hs-identifier hs-var">tcm</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM b) -&gt; TcM a -&gt; TcM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a
forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-var">popErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682864305"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1787"></span><span>                               </span><span class="hs-comment">-- Remember to pop before doing thing_inside</span><span>
</span><span id="line-1788"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1789"></span><span>   </span><span id="local-6989586621682864306"><span class="annot"><span class="annottext">worth_wrapping :: Pat p -&gt; Bool
</span><a href="#local-6989586621682864306"><span class="hs-identifier hs-var hs-var">worth_wrapping</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1790"></span><span>   </span><span class="annot"><a href="#local-6989586621682864306"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1791"></span><span>   </span><span class="annot"><a href="#local-6989586621682864306"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1792"></span><span>   </span><span class="annot"><a href="#local-6989586621682864306"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="annot"><span class="annottext">Pat p
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1793"></span><span>   </span><span id="local-6989586621682864308"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621682864308"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the pattern:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Pat (GhcPass 'Renamed)
</span><a href="#local-6989586621682864303"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1794"></span><span>
</span><span id="line-1795"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span class="hs-comment">-- | Check that a pattern isn't a GADT, or doesn't have existential variables,</span><span>
</span><span id="line-1798"></span><span class="hs-comment">-- in a situation in which that is not permitted (inside a lazy pattern, or</span><span>
</span><span id="line-1799"></span><span class="hs-comment">-- in arrow notation).</span><span>
</span><span id="line-1800"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-type">checkGADT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1801"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ existentials</span></span><span>
</span><span id="line-1802"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ argument types</span></span><span>
</span><span id="line-1803"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-1804"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1805"></span><span id="checkGADT"><span class="annot"><span class="annottext">checkGADT :: ConLike -&gt; [TyCoVar] -&gt; [Type] -&gt; PatEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-var hs-var">checkGADT</span></a></span></span><span> </span><span id="local-6989586621682864310"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864310"><span class="hs-identifier hs-var">conlike</span></a></span></span><span> </span><span id="local-6989586621682864311"><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864311"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span> </span><span id="local-6989586621682864312"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864312"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1806"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1807"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-type">ArrowMatchCtxt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1809"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="GHC.Core.ConLike.html#isVanillaConLike"><span class="hs-identifier hs-var">isVanillaConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864310"><span class="hs-identifier hs-var">conlike</span></a></span><span>
</span><span id="line-1810"></span><span>    </span><span class="hs-comment">-- See Note [Arrows and patterns]</span><span>
</span><span id="line-1811"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnArrowProcGADTPattern"><span class="hs-identifier hs-var">TcRnArrowProcGADTPattern</span></a></span><span>
</span><span id="line-1812"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1813"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864317"><span class="hs-identifier hs-var">has_existentials</span></a></span><span>
</span><span id="line-1814"></span><span>    </span><span class="hs-comment">-- See Note [Existential check]</span><span>
</span><span id="line-1815"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnMessage -&gt; TcRn ()
forall a. TcRnMessage -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnMessage
</span><a href="GHC.Tc.Errors.Types.html#TcRnLazyGADTPattern"><span class="hs-identifier hs-var">TcRnLazyGADTPattern</span></a></span><span>
</span><span id="line-1816"></span><span>  </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1817"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1818"></span><span>    </span><span class="annot"><a href="#local-6989586621682864317"><span class="hs-identifier hs-type">has_existentials</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1819"></span><span>    </span><span id="local-6989586621682864317"><span class="annot"><span class="annottext">has_existentials :: Bool
</span><a href="#local-6989586621682864317"><span class="hs-identifier hs-var hs-var">has_existentials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCoVar -&gt; Bool) -&gt; [TyCoVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682864312"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCoVar]
</span><a href="#local-6989586621682864311"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-1820"></span><span>
</span><span id="line-1821"></span><span class="hs-comment">-- | Very similar to GHC.Tc.Pat.isIrrefutableHsPat, but doesn't typecheck the pattern</span><span>
</span><span id="line-1822"></span><span class="hs-comment">--   It does depend on the type checker monad (`TcM`) however as we need to check ConPat case in more detail.</span><span>
</span><span id="line-1823"></span><span class="hs-comment">--   Specifically, we call `tcLookupGlobal` to obtain constructor details from global packages</span><span>
</span><span id="line-1824"></span><span class="hs-comment">--   for a comprehensive irrefutability check and avoid false negatives. (testcase pattern-fails.hs)</span><span>
</span><span id="line-1825"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#isIrrefutableHsPatRnTcM"><span class="hs-identifier hs-type">isIrrefutableHsPatRnTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1826"></span><span id="isIrrefutableHsPatRnTcM"><span class="annot"><span class="annottext">isIrrefutableHsPatRnTcM :: Bool
-&gt; LPat (GhcPass 'Renamed) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="GHC.Tc.Gen.Pat.html#isIrrefutableHsPatRnTcM"><span class="hs-identifier hs-var hs-var">isIrrefutableHsPatRnTcM</span></a></span></span><span> </span><span id="local-6989586621682864322"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864322"><span class="hs-identifier hs-var">is_strict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPatIrrefutableCheck
  (IOEnv (Env TcGblEnv TcLclEnv)) (GhcPass 'Renamed)
forall (m :: * -&gt; *) (p :: Pass).
(Monad m, OutputableBndrId p) =&gt;
LPatIrrefutableCheck m (GhcPass p)
</span><a href="GHC.Hs.Pat.html#isIrrefutableHsPatHelperM"><span class="hs-identifier hs-var">isIrrefutableHsPatHelperM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864322"><span class="hs-identifier hs-var">is_strict</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; XRec (GhcPass 'Renamed) (ConLikeP (GhcPass 'Renamed))
-&gt; HsConPatDetails (GhcPass 'Renamed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
Bool
-&gt; GenLocated (Anno (ConLikeP (GhcPass 'Renamed))) Name
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass 'Renamed)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed)))
     (HsRecFields
        (GhcPass 'Renamed)
        (GenLocated SrcSpanAnnA (Pat (GhcPass 'Renamed))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
forall {p :: Pass}.
(ConLikeP (GhcPass p) ~ Name, OutputableBndr (IdGhcP p),
 OutputableBndr (IdGhcP (NoGhcTcPass p)), IsPass p,
 Outputable (GenLocated (Anno (IdGhcP p)) (IdGhcP p)),
 Outputable
   (GenLocated
      (Anno (IdGhcP (NoGhcTcPass p))) (IdGhcP (NoGhcTcPass p)))) =&gt;
Bool
-&gt; GenLocated (Anno (ConLikeP (GhcPass p))) Name
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
     (HsRecFields
        (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864324"><span class="hs-identifier hs-var">isConLikeIrr</span></a></span><span>
</span><span id="line-1827"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1828"></span><span>      </span><span id="local-6989586621682864361"><span class="annot"><span class="annottext">doWork :: Bool
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass p))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864361"><span class="hs-identifier hs-var hs-var">doWork</span></a></span></span><span> </span><span id="local-6989586621682864362"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864362"><span class="hs-identifier hs-var">is_strict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPatIrrefutableCheck (IOEnv (Env TcGblEnv TcLclEnv)) (GhcPass p)
forall (m :: * -&gt; *) (p :: Pass).
(Monad m, OutputableBndrId p) =&gt;
LPatIrrefutableCheck m (GhcPass p)
</span><a href="GHC.Hs.Pat.html#isIrrefutableHsPatHelperM"><span class="hs-identifier hs-var">isIrrefutableHsPatHelperM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864362"><span class="hs-identifier hs-var">is_strict</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; XRec (GhcPass p) (ConLikeP (GhcPass p))
-&gt; HsConDetails
     (HsConPatTyArg (NoGhcTc (GhcPass p)))
     (XRec (GhcPass p) (Pat (GhcPass p)))
     (HsRecFields (GhcPass p) (XRec (GhcPass p) (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
Bool
-&gt; GenLocated (Anno (ConLikeP (GhcPass p))) Name
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
     (HsRecFields
        (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864324"><span class="hs-identifier hs-var">isConLikeIrr</span></a></span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span>      </span><span id="local-6989586621682864324"><span class="annot"><span class="annottext">isConLikeIrr :: Bool
-&gt; GenLocated (Anno (ConLikeP (GhcPass p))) Name
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
     (HsRecFields
        (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864324"><span class="hs-identifier hs-var hs-var">isConLikeIrr</span></a></span></span><span> </span><span id="local-6989586621682864363"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864363"><span class="hs-identifier hs-var">is_strict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno (ConLikeP (GhcPass p))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682864364"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682864364"><span class="hs-identifier hs-var">dcName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682864365"><span class="annot"><span class="annottext">HsConDetails
  (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
  (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
  (HsRecFields
     (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
</span><a href="#local-6989586621682864365"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1831"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682864366"><span class="annot"><a href="#local-6989586621682864366"><span class="hs-identifier hs-var">tyth</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookupGlobal"><span class="hs-identifier hs-var">tcLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682864364"><span class="hs-identifier hs-var">dcName</span></a></span><span>
</span><span id="line-1832"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682864366"><span class="hs-identifier hs-type">tyth</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1833"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621682864368"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864368"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; TyCon
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
     (HsRecFields
        (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864369"><span class="hs-identifier hs-var">doCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864363"><span class="hs-identifier hs-var">is_strict</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864368"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDetails
  (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
  (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
  (HsRecFields
     (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
</span><a href="#local-6989586621682864365"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-1834"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span id="local-6989586621682864370"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864370"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1835"></span><span>                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621682864370"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1836"></span><span>                   </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621682864371"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864371"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; TyCon
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
     (HsRecFields
        (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864369"><span class="hs-identifier hs-var">doCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864363"><span class="hs-identifier hs-var">is_strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682864371"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsConDetails
  (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
  (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
  (HsRecFields
     (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
</span><a href="#local-6989586621682864365"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-1837"></span><span>                   </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621682864372"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621682864372"><span class="hs-identifier hs-var">_pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- conservative</span><span>
</span><span id="line-1838"></span><span>               </span><span class="annot"><span class="annottext">TyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>                  </span><span class="hs-comment">-- conservative</span><span>
</span><span id="line-1839"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1840"></span><span>
</span><span id="line-1841"></span><span>      </span><span id="local-6989586621682864369"><span class="annot"><span class="annottext">doCheck :: Bool
-&gt; TyCon
-&gt; HsConDetails
     (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
     (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
     (HsRecFields
        (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864369"><span class="hs-identifier hs-var hs-var">doCheck</span></a></span></span><span> </span><span id="local-6989586621682864373"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864373"><span class="hs-identifier hs-var">is_strict</span></a></span></span><span> </span><span id="local-6989586621682864374"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864374"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682864375"><span class="annot"><span class="annottext">HsConDetails
  (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
  (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
  (HsRecFields
     (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
</span><a href="#local-6989586621682864375"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682864376"><span class="annot"><span class="annottext">b :: Bool
</span><a href="#local-6989586621682864376"><span class="hs-identifier hs-var hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DataCon -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682864374"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1842"></span><span>                                            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682864378"><span class="annot"><a href="#local-6989586621682864378"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpanAnnA (Pat (GhcPass p))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool)
-&gt; [GenLocated SrcSpanAnnA (Pat (GhcPass p))]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
-&gt; GenLocated SrcSpanAnnA (Pat (GhcPass p))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Bool
</span><a href="#local-6989586621682864361"><span class="hs-identifier hs-var">doWork</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682864373"><span class="hs-identifier hs-var">is_strict</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsConDetails
  (HsConPatTyArg (NoGhcTc (GhcPass p)))
  (XRec (GhcPass p) (Pat (GhcPass p)))
  (HsRecFields (GhcPass p) (XRec (GhcPass p) (Pat (GhcPass p))))
-&gt; [XRec (GhcPass p) (Pat (GhcPass p))]
forall p. UnXRec p =&gt; HsConPatDetails p -&gt; [LPat p]
</span><a href="Language.Haskell.Syntax.Pat.html#hsConPatArgs"><span class="hs-identifier hs-var">hsConPatArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDetails
  (HsConPatTyArg (NoGhcTc (GhcPass p)))
  (XRec (GhcPass p) (Pat (GhcPass p)))
  (HsRecFields (GhcPass p) (XRec (GhcPass p) (Pat (GhcPass p))))
HsConDetails
  (HsConPatTyArg (GhcPass (NoGhcTcPass p)))
  (GenLocated SrcSpanAnnA (Pat (GhcPass p)))
  (HsRecFields
     (GhcPass p) (GenLocated SrcSpanAnnA (Pat (GhcPass p))))
</span><a href="#local-6989586621682864375"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1843"></span><span>                                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682864376"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">and</span></span><span> </span><span class="annot"><a href="#local-6989586621682864378"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1844"></span></pre></body></html>