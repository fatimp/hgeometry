<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Main data type</span></span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier">UniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Abstractly</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Operations on supplies</span></span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromSupply"><span class="hs-identifier">uniqFromSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier">uniqsFromSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- basic ops</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#takeUniqFromSupply"><span class="hs-identifier">takeUniqFromSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier">uniqFromTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier">mkSplitUniqSupply</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier">splitUniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#listSplitUniqSupply"><span class="hs-identifier">listSplitUniqSupply</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Unique supply monad and its abstraction</span></span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier">UniqSM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier">MonadUnique</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Operations on the monad</span></span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUs"><span class="hs-identifier">initUs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUs_"><span class="hs-identifier">initUs_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Set supply strategy</span></span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUniqSupply"><span class="hs-identifier">initUniqSupply</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.IO.html/GHC.IO.html"><span class="hs-identifier">GHC.IO</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Control.Monad.html/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Data.Word.html/Data.Word.html"><span class="hs-identifier">Data.Word</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.Exts.html/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Ptr</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">noDuplicate#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">oneShot</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//Foreign.Storable.html/Foreign.Storable.html"><span class="hs-identifier">Foreign.Storable</span></a></span><span class="hs-cpp">

#include &quot;MachDeps.h&quot;
</span><span class="hs-cpp">
#if WORD_SIZE_IN_BITS != 64
</span><span class="hs-cpp">#define NO_FETCH_ADD
</span><span class="hs-cpp">#endif
</span><span class="hs-cpp">
#if defined(NO_FETCH_ADD)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">atomicCasWord64Addr#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eqWord64#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">readWord64OffAddr#</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.Exts.html/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">fetchAddWordAddr#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">word64ToWord#</span></span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.Exts.html/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Addr#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">State#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word64#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RealWorld</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.Int.html/GHC.Int.html"><span class="hs-identifier">GHC.Int</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Int</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.Word.html/GHC.Word.html"><span class="hs-identifier">GHC.Word</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.20.0.0-4014/src//GHC.Exts.html/GHC.Exts.html"><span class="hs-identifier">GHC.Exts</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">plusWord64#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">int2Word#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">wordToWord64#</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Splittable Unique supply: @UniqSupply@}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">{- Note [How the unique supply works]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The basic idea (due to Lennart Augustsson) is that a UniqSupply is
lazily-evaluated infinite tree.

* At each MkSplitUniqSupply node is a unique Word64, and two
  sub-trees (see data UniqSupply)

* takeUniqFromSupply :: UniqSupply -&gt; (Unique, UniqSupply)
  returns the unique Word64 and one of the sub-trees

* splitUniqSupply :: UniqSupply -&gt; (UniqSupply, UniqSupply)
  returns the two sub-trees

* When you poke on one of the thunks, it does a foreign call
  to get a fresh Word64 from a thread-safe counter, and returns
  a fresh MkSplitUniqSupply node.  This has to be as efficient
  as possible: it should allocate only
     * The fresh node
     * A thunk for each sub-tree

Note [How unique supplies are used]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The general design (used throughout GHC) is to:

* For creating new uniques either a UniqSupply is used and threaded through
  or for monadic code a MonadUnique instance might conjure up uniques using
  `uniqFromTag`.
* Different parts of the compiler will use a UniqSupply or MonadUnique instance
  with a specific tag. This way the different parts of the compiler will
  generate uniques with different tags.

If different code shares the same tag then care has to be taken that all uniques
still get distinct numbers. Usually this is done by relying on genSym which
has *one* counter per GHC invocation that is relied on by all calls to it.
But using something like the address for pinned objects works as well and in fact is done
for fast strings.

This is important for example in the simplifier. Most passes of the simplifier use
the same tag 's'. However in some places we create a unique supply using `mkSplitUniqSupply`
and thread it through the code, while in GHC.Core.Opt.Simplify.Monad  we use the
`instance MonadUnique SimplM`, which uses `mkSplitUniqSupply` in getUniqueSupplyM
and `uniqFromTag` in getUniqueM.

Ultimately all these boil down to each new unique consisting of the tag and the result from
a call to `genSym`. The latter producing a distinct number for each invocation ensuring
uniques are distinct.

Note [Optimising the unique supply]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The inner loop of mkSplitUniqSupply is a function closure

     mk_supply s0 =
        case noDuplicate# s0 of { s1 -&gt;
        case unIO genSym s1 of { (# s2, u #) -&gt;
        case unIO (unsafeDupableInterleaveIO (IO mk_supply)) s2 of { (# s3, x #) -&gt;
        case unIO (unsafeDupableInterleaveIO (IO mk_supply)) s3 of { (# s4, y #) -&gt;
        (# s4, MkSplitUniqSupply (tag .|. u) x y #)
        }}}}

It's a classic example of an IO action that is captured and then called
repeatedly (see #18238 for some discussion). It mustn't allocate!  The test
perf/should_run/UniqLoop keeps track of this loop.  Watch it carefully.

We used to write it as:

     mk_supply :: IO UniqSupply
     mk_supply = unsafeInterleaveIO $
                 genSym      &gt;&gt;= \ u -&gt;
                 mk_supply   &gt;&gt;= \ s1 -&gt;
                 mk_supply   &gt;&gt;= \ s2 -&gt;
                 return (MkSplitUniqSupply (tag .|. u) s1 s2)

and to rely on -fno-state-hack, full laziness and inlining to get the same
result. It was very brittle and required enabling -fno-state-hack globally. So
it has been rewritten using lower level constructs to explicitly state what we
want.

Note [Optimising use of unique supplies]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When it comes to having a way to generate new Uniques
there are generally three ways to deal with this:

For pure code the only good approach is to take an UniqSupply
as argument. Then  thread it through the code splitting it
for sub-passes or when creating uniques.
The code for this is about as optimized as it gets, but we can't
get around the need to allocate one `UniqSupply` for each Unique
we need.

For code in IO we can improve on this by threading only the *tag*
we are going to use for Uniques. Using `uniqFromTag` to
generate uniques as needed. This gets rid of the overhead of
allocating a new UniqSupply for each unique generated. It also avoids
frequent state updates when the Unique/Tag is part of the state in a
state monad.

For monadic code in IO which always uses the same tag we can go further
and hardcode the tag into the MonadUnique instance. On top of all the
benefits of threading the tag this *also* has the benefit of avoiding
the tag getting captured in thunks, or being passed around at runtime.
It does however come at the cost of having to use a fixed tag for all
code run in this Monad. But remember, the tag is purely cosmetic:
See Note [Uniques and tags].

NB: It's *not* an optimization to pass around the UniqSupply inside an
IORef instead of the tag. While this would avoid frequent state updates
it still requires allocating one UniqSupply per Unique. On top of some
overhead for reading/writing to/from the IORef.

All of this hinges on the assumption that UniqSupply and
uniqFromTag use the same source of distinct numbers (`genSym`) which
allows both to be used at the same time, with the same tag, while still
ensuring distinct uniques.
One might consider this fact to be an &quot;accident&quot;. But GHC worked like this
as far back as source control history goes. It also allows the later two
optimizations to be used. So it seems safe to depend on this fact.

-}</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | Unique Supply</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- A value of type 'UniqSupply' is unique, and it can</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- supply /one/ distinct 'Unique'.  Also, from the supply, one can</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- also manufacture an arbitrary number of further 'UniqueSupply' values,</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- which will be distinct from the first and from all others.</span><span>
</span><span id="line-197"></span><span class="hs-keyword">data</span><span> </span><span id="UniqSupply"><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-var">UniqSupply</span></a></span></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MkSplitUniqSupply"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-var">MkSplitUniqSupply</span></a></span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-comment">-- make the Unique with this</span><span>
</span><span id="line-199"></span><span>                   </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span>
</span><span id="line-200"></span><span>                                </span><span class="hs-comment">-- when split =&gt; these two supplies</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-type">mkSplitUniqSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- ^ Create a unique supply out of thin air.</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- The &quot;tag&quot; (Char) supplied is purely cosmetic, making it easier</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- to figure out where a Unique was born. See</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- Note [Uniques and tags].</span><span>
</span><span id="line-207"></span><span class="hs-comment">--</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- The payload part of the Uniques allocated from this UniqSupply are</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- guaranteed distinct wrt all other supplies, regardless of their &quot;tag&quot;.</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- This is achieved by allocating the payload part from</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- a single source of Uniques, namely `genSym`, shared across</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- all UniqSupply's.</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- See Note [How the unique supply works]</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- See Note [Optimising the unique supply]</span><span>
</span><span id="line-216"></span><span id="mkSplitUniqSupply"><span class="annot"><span class="annottext">mkSplitUniqSupply :: Char -&gt; IO UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-var hs-var">mkSplitUniqSupply</span></a></span></span><span> </span><span id="local-6989586621682337066"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682337066"><span class="hs-identifier hs-var">c</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO UniqSupply -&gt; IO UniqSupply
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">unsafeDupableInterleaveIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, UniqSupply #))
-&gt; IO UniqSupply
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, UniqSupply #)
</span><a href="#local-6989586621682337068"><span class="hs-identifier hs-var">mk_supply</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>     </span><span class="hs-glyph">!</span><span id="local-6989586621682337069"><span class="annot"><span class="annottext">tag :: Word64
</span><a href="#local-6989586621682337069"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Word64
</span><a href="GHC.Types.Unique.html#mkTag"><span class="hs-identifier hs-var">mkTag</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682337066"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-comment">-- Here comes THE MAGIC: see Note [How the unique supply works]</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-comment">-- This is one of the most hammered bits in the whole compiler</span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-comment">-- See Note [Optimising the unique supply]</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- NB: Use noDuplicate# for thread-safety.</span><span>
</span><span id="line-226"></span><span>     </span><span id="local-6989586621682337068"><span class="annot"><span class="annottext">mk_supply :: State# RealWorld -&gt; (# State# RealWorld, UniqSupply #)
</span><a href="#local-6989586621682337068"><span class="hs-identifier hs-var hs-var">mk_supply</span></a></span></span><span> </span><span id="local-6989586621682337071"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337071"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State# RealWorld -&gt; State# RealWorld
forall d. State# d -&gt; State# d
</span><span class="hs-identifier hs-var">noDuplicate#</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337071"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682337072"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337072"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IO Word64 -&gt; State# RealWorld -&gt; (# State# RealWorld, Word64 #)
forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><span class="hs-identifier hs-var">unIO</span></span><span> </span><span class="annot"><span class="annottext">IO Word64
</span><a href="GHC.Types.Unique.Supply.html#genSym"><span class="hs-identifier hs-var">genSym</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337072"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337074"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337074"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337075"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337075"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-comment">-- deferred IO computations</span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IO UniqSupply
-&gt; State# RealWorld -&gt; (# State# RealWorld, UniqSupply #)
forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><span class="hs-identifier hs-var">unIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO UniqSupply -&gt; IO UniqSupply
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">unsafeDupableInterleaveIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, UniqSupply #))
-&gt; IO UniqSupply
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, UniqSupply #)
</span><a href="#local-6989586621682337068"><span class="hs-identifier hs-var">mk_supply</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337074"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337076"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337076"><span class="hs-identifier hs-var">s3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337077"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337077"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IO UniqSupply
-&gt; State# RealWorld -&gt; (# State# RealWorld, UniqSupply #)
forall a. IO a -&gt; State# RealWorld -&gt; (# State# RealWorld, a #)
</span><span class="hs-identifier hs-var">unIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO UniqSupply -&gt; IO UniqSupply
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">unsafeDupableInterleaveIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, UniqSupply #))
-&gt; IO UniqSupply
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, UniqSupply #)
</span><a href="#local-6989586621682337068"><span class="hs-identifier hs-var">mk_supply</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337076"><span class="hs-identifier hs-var">s3</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337078"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337078"><span class="hs-identifier hs-var">s4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337079"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337079"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337078"><span class="hs-identifier hs-var">s4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; UniqSupply -&gt; UniqSupply -&gt; UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-var">MkSplitUniqSupply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337069"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337075"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337077"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337079"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-cpp">

#if defined(NO_FETCH_ADD)
</span><span class="hs-comment">-- GHC currently does not provide this operation on 32-bit platforms,</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- hence the CAS-based implementation.</span><span>
</span><span id="line-238"></span><span class="hs-identifier">fetchAddWord64Addr#</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Addr#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Word64#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">State#</span><span> </span><span class="hs-identifier">RealWorld</span><span>
</span><span id="line-239"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">State#</span><span> </span><span class="hs-identifier">RealWorld</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Word64#</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-240"></span><span class="hs-identifier">fetchAddWord64Addr#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">go</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">inc</span><span> </span><span class="hs-identifier">s0</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWord64OffAddr#</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-number">0#</span><span> </span><span class="hs-identifier">s0</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">n0</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">atomicCasWord64Addr#</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">n0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n0</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">plusWord64#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">inc</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>            </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-247"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-number">1#</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqWord64#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">n0</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-248"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">inc</span><span> </span><span class="hs-identifier">s2</span><span class="hs-cpp">
#else
</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#fetchAddWord64Addr%23"><span class="hs-identifier hs-type">fetchAddWord64Addr#</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Addr#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span>
</span><span id="line-251"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64#</span></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-252"></span><span id="fetchAddWord64Addr%23"><span class="annot"><span class="annottext">fetchAddWord64Addr# :: Addr#
-&gt; Word64# -&gt; State# RealWorld -&gt; (# State# RealWorld, Word64# #)
</span><a href="GHC.Types.Unique.Supply.html#fetchAddWord64Addr%23"><span class="hs-identifier hs-var hs-var">fetchAddWord64Addr#</span></a></span></span><span> </span><span id="local-6989586621682337082"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682337082"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621682337083"><span class="annot"><span class="annottext">Word64#
</span><a href="#local-6989586621682337083"><span class="hs-identifier hs-var">inc</span></a></span></span><span> </span><span id="local-6989586621682337084"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337084"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr# -&gt; Word# -&gt; State# RealWorld -&gt; (# State# RealWorld, Word# #)
forall d. Addr# -&gt; Word# -&gt; State# d -&gt; (# State# d, Word# #)
</span><span class="hs-identifier hs-var">fetchAddWordAddr#</span></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682337082"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64# -&gt; Word#
</span><span class="hs-identifier hs-var">word64ToWord#</span></span><span> </span><span class="annot"><span class="annottext">Word64#
</span><a href="#local-6989586621682337083"><span class="hs-identifier hs-var">inc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337084"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337085"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337085"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337086"><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621682337086"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337085"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word64#
</span><span class="hs-identifier hs-var">wordToWord64#</span></span><span> </span><span class="annot"><span class="annottext">Word#
</span><a href="#local-6989586621682337086"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">#)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-257"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#genSym"><span class="hs-identifier hs-type">genSym</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-258"></span><span id="genSym"><span class="annot"><span class="annottext">genSym :: IO Word64
</span><a href="GHC.Types.Unique.Supply.html#genSym"><span class="hs-identifier hs-var hs-var">genSym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682337094"><span class="annot"><span class="annottext">mask :: Word64
</span><a href="#local-6989586621682337094"><span class="hs-identifier hs-var hs-var hs-var">mask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int -&gt; Word64
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`unsafeShiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Types.Unique.html#uNIQUE_BITS"><span class="hs-identifier hs-var">uNIQUE_BITS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span id="local-6989586621682337098"><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682337098"><span class="hs-identifier hs-var hs-var">counter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Word64
</span><a href="GHC.Types.Unique.Supply.html#ghc_unique_counter64"><span class="hs-identifier hs-var">ghc_unique_counter64</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621682337100"><span class="annot"><a href="#local-6989586621682337100"><span class="hs-identifier hs-var">inc#</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr Int -&gt; IO Int
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr Int
</span><a href="GHC.Types.Unique.Supply.html#ghc_unique_inc"><span class="hs-identifier hs-var">ghc_unique_inc</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682337103"><span class="annot"><a href="#local-6989586621682337103"><span class="hs-identifier hs-var hs-var">inc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word# -&gt; Word64#
</span><span class="hs-identifier hs-var">wordToWord64#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int# -&gt; Word#
</span><span class="hs-identifier hs-var">int2Word#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621682337100"><span class="hs-identifier hs-var">inc#</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621682337104"><span class="annot"><a href="#local-6989586621682337104"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682337105"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337105"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr#
-&gt; Word64# -&gt; State# RealWorld -&gt; (# State# RealWorld, Word64# #)
</span><a href="GHC.Types.Unique.Supply.html#fetchAddWord64Addr%23"><span class="hs-identifier hs-var">fetchAddWord64Addr#</span></a></span><span> </span><span class="annot"><span class="annottext">Addr#
</span><a href="#local-6989586621682337098"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">Word64#
</span><a href="#local-6989586621682337103"><span class="hs-identifier hs-var">inc</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337105"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337106"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337106"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337107"><span class="annot"><span class="annottext">Word64#
</span><a href="#local-6989586621682337107"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682337108"><span class="annot"><span class="annottext">u :: Word64
</span><a href="#local-6989586621682337108"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64# -&gt; Word64
</span><span class="hs-identifier hs-var">W64#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64#
</span><a href="#local-6989586621682337107"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Word64# -&gt; Word64# -&gt; Word64#
</span><span class="hs-operator hs-var">`plusWord64#`</span></span><span> </span><span class="annot"><span class="annottext">Word64#
</span><a href="#local-6989586621682337103"><span class="hs-identifier hs-var">inc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337094"><span class="hs-identifier hs-var">mask</span></a></span><span>
</span><span id="line-266"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621682337106"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337108"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-special">#)</span><span class="hs-cpp">
#if defined(DEBUG)
</span><span>    </span><span class="hs-comment">-- Uh oh! We will overflow next time a unique is requested.</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-comment">-- (Note that if the increment isn't 1 we may miss this check)</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-identifier">massert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">u</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">mask</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682337104"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&amp;ghc_unique_counter64&quot;</span></span><span> </span><span id="ghc_unique_counter64"><span class="annot"><a href="GHC.Types.Unique.Supply.html#ghc_unique_counter64"><span class="hs-identifier hs-var">ghc_unique_counter64</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-275"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;&amp;ghc_unique_inc&quot;</span></span><span>       </span><span id="ghc_unique_inc"><span class="annot"><a href="GHC.Types.Unique.Supply.html#ghc_unique_inc"><span class="hs-identifier hs-var">ghc_unique_inc</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUniqSupply"><span class="hs-identifier hs-type">initUniqSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span id="initUniqSupply"><span class="annot"><span class="annottext">initUniqSupply :: Word64 -&gt; Int -&gt; IO ()
</span><a href="GHC.Types.Unique.Supply.html#initUniqSupply"><span class="hs-identifier hs-var hs-var">initUniqSupply</span></a></span></span><span> </span><span id="local-6989586621682337111"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337111"><span class="hs-identifier hs-var">counter</span></a></span></span><span> </span><span id="local-6989586621682337112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682337112"><span class="hs-identifier hs-var">inc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><span class="annottext">Ptr Word64 -&gt; Word64 -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr Word64
</span><a href="GHC.Types.Unique.Supply.html#ghc_unique_counter64"><span class="hs-identifier hs-var">ghc_unique_counter64</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337111"><span class="hs-identifier hs-var">counter</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><span class="annottext">Ptr Int -&gt; Int -&gt; IO ()
forall a. Storable a =&gt; Ptr a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">poke</span></span><span> </span><span class="annot"><span class="annottext">Ptr Int
</span><a href="GHC.Types.Unique.Supply.html#ghc_unique_inc"><span class="hs-identifier hs-var">ghc_unique_inc</span></a></span><span>       </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682337112"><span class="hs-identifier hs-var">inc</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier hs-type">uniqFromTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span>
</span><span id="line-283"></span><span id="uniqFromTag"><span class="annot"><span class="annottext">uniqFromTag :: Char -&gt; IO Unique
</span><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-identifier hs-var hs-var">uniqFromTag</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682337114"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682337114"><span class="hs-identifier hs-var">tag</span></a></span></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682337115"><span class="annot"><a href="#local-6989586621682337115"><span class="hs-identifier hs-var">uqNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Word64
</span><a href="GHC.Types.Unique.Supply.html#genSym"><span class="hs-identifier hs-var">genSym</span></a></span><span>
</span><span id="line-285"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#mkUnique"><span class="hs-identifier hs-type">mkUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337114"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337115"><span class="hs-identifier hs-type">uqNum</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromTag"><span class="hs-pragma hs-type">uniqFromTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- We'll unbox everything, but we don't want to inline it</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier hs-type">splitUniqSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- ^ Build two 'UniqSupply' from a single one, each of which</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- can supply its own 'Unique'.</span><span>
</span><span id="line-291"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#listSplitUniqSupply"><span class="hs-identifier hs-type">listSplitUniqSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-292"></span><span class="annot"><span class="hs-comment">-- ^ Create an infinite list of 'UniqSupply' from a single one</span></span><span>
</span><span id="line-293"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqFromSupply"><span class="hs-identifier hs-type">uniqFromSupply</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span>
</span><span id="line-294"></span><span class="annot"><span class="hs-comment">-- ^ Obtain the 'Unique' from this particular 'UniqSupply'</span></span><span>
</span><span id="line-295"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-type">uniqsFromSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Infinite</span><span>
</span><span id="line-296"></span><span class="annot"><span class="hs-comment">-- ^ Obtain an infinite list of 'Unique' that can be generated by constant splitting of the supply</span></span><span>
</span><span id="line-297"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#takeUniqFromSupply"><span class="hs-identifier hs-type">takeUniqFromSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span class="annot"><span class="hs-comment">-- ^ Obtain the 'Unique' from this particular 'UniqSupply', and a new supply</span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span id="splitUniqSupply"><span class="annot"><span class="annottext">splitUniqSupply :: UniqSupply -&gt; (UniqSupply, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier hs-var hs-var">splitUniqSupply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-type">MkSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682337118"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337118"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682337119"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337119"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337118"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337119"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span id="listSplitUniqSupply"><span class="annot"><span class="annottext">listSplitUniqSupply :: UniqSupply -&gt; [UniqSupply]
</span><a href="GHC.Types.Unique.Supply.html#listSplitUniqSupply"><span class="hs-identifier hs-var hs-var">listSplitUniqSupply</span></a></span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-type">MkSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682337120"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337120"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682337121"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337121"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337120"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; [UniqSupply] -&gt; [UniqSupply]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; [UniqSupply]
</span><a href="GHC.Types.Unique.Supply.html#listSplitUniqSupply"><span class="hs-identifier hs-var">listSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337121"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span id="uniqFromSupply"><span class="annot"><span class="annottext">uniqFromSupply :: UniqSupply -&gt; Unique
</span><a href="GHC.Types.Unique.Supply.html#uniqFromSupply"><span class="hs-identifier hs-var hs-var">uniqFromSupply</span></a></span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-type">MkSplitUniqSupply</span></a></span><span> </span><span id="local-6989586621682337122"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337122"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Unique
</span><a href="GHC.Types.Unique.html#mkUniqueGrimily"><span class="hs-identifier hs-var">mkUniqueGrimily</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337122"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-304"></span><span id="uniqsFromSupply"><span class="annot"><span class="annottext">uniqsFromSupply :: UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var hs-var">uniqsFromSupply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-type">MkSplitUniqSupply</span></a></span><span> </span><span id="local-6989586621682337124"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337124"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682337125"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337125"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Unique
</span><a href="GHC.Types.Unique.html#mkUniqueGrimily"><span class="hs-identifier hs-var">mkUniqueGrimily</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337124"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; [Unique] -&gt; [Unique]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337125"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-305"></span><span id="takeUniqFromSupply"><span class="annot"><span class="annottext">takeUniqFromSupply :: UniqSupply -&gt; (Unique, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#takeUniqFromSupply"><span class="hs-identifier hs-var hs-var">takeUniqFromSupply</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MkSplitUniqSupply"><span class="hs-identifier hs-type">MkSplitUniqSupply</span></a></span><span> </span><span id="local-6989586621682337126"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337126"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682337127"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337127"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Unique
</span><a href="GHC.Types.Unique.html#mkUniqueGrimily"><span class="hs-identifier hs-var">mkUniqueGrimily</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682337126"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337127"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection[UniqSupply-monad]{@UniqSupply@ monad: @UniqSM@}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-keyword">type</span><span> </span><span id="UniqResult"><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span></span><span> </span><span id="local-6989586621682337128"><span class="annot"><a href="#local-6989586621682337128"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><a href="#local-6989586621682337128"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682336973"><span id="local-6989586621682336974"><span class="annot"><a href="#local-6989586621682336973"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682336974"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><a href="#local-6989586621682336973"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682336974"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">#)</span></span></span><span>
</span><span id="line-318"></span><span class="hs-keyword">pattern</span><span> </span><span id="UniqResult"><span id="%24mUniqResult"><span id="%24bUniqResult"><span class="annot"><span class="annottext">$mUniqResult :: forall {r} {a} {b}.
(# a, b #) -&gt; (a -&gt; b -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bUniqResult :: forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var hs-var hs-var">UniqResult</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621682337132"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337133"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337132"><span class="annot"><a href="#local-6989586621682337132"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337133"><span class="annot"><a href="#local-6989586621682337133"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-319"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-pragma hs-type">UniqResult</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">-- | A monad which just gives the ability to obtain 'Unique's</span></span><span>
</span><span id="line-322"></span><span class="hs-keyword">newtype</span><span> </span><span id="UniqSM"><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-var">UniqSM</span></a></span></span><span> </span><span id="local-6989586621682336978"><span class="annot"><a href="#local-6989586621682336978"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="USM"><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-var">USM</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unUSM"><span class="annot"><span class="annottext">forall result. UniqSM result -&gt; UniqSupply -&gt; UniqResult result
</span><a href="GHC.Types.Unique.Supply.html#unUSM"><span class="hs-identifier hs-var hs-var">unUSM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682336978"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-comment">-- See Note [The one-shot state monad trick] for why we don't derive this.</span><span>
</span><span id="line-325"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682337138"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-326"></span><span>  </span><span id="local-6989586621682337142"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; UniqSM a -&gt; UniqSM b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621682337143"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682337143"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337144"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337144"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult b) -&gt; UniqSM b
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="annot"><span class="annottext">((UniqSupply -&gt; UniqResult b) -&gt; UniqSM b)
-&gt; (UniqSupply -&gt; UniqResult b) -&gt; UniqSM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682337146"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337146"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337144"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337146"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621682337147"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337147"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682337148"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337148"><span class="hs-identifier hs-var">us'</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; UniqSupply -&gt; UniqResult b
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682337143"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337147"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337148"><span class="hs-identifier hs-var">us'</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | Smart constructor for 'UniqSM', as described in Note [The one-shot state</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- monad trick].</span><span>
</span><span id="line-332"></span><span id="local-6989586621682336989"><span class="annot"><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-type">mkUniqSM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682336989"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682336989"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-333"></span><span id="mkUniqSM"><span class="annot"><span class="annottext">mkUniqSM :: forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var hs-var">mkUniqSM</span></a></span></span><span> </span><span id="local-6989586621682337149"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337149"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-var">USM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult a) -&gt; UniqSupply -&gt; UniqResult a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">oneShot</span></span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337149"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-pragma hs-type">mkUniqSM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682337156"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621682337160"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. UniqSM a -&gt; (a -&gt; UniqSM b) -&gt; UniqSM b
</span><span class="hs-operator hs-var hs-var hs-var">(&gt;&gt;=)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM a -&gt; (a -&gt; UniqSM b) -&gt; UniqSM b
forall a b. UniqSM a -&gt; (a -&gt; UniqSM b) -&gt; UniqSM b
</span><a href="GHC.Types.Unique.Supply.html#thenUs"><span class="hs-identifier hs-var">thenUs</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621682337163"><span class="annot"><span class="annottext">&gt;&gt; :: forall a b. UniqSM a -&gt; UniqSM b -&gt; UniqSM b
</span><span class="hs-operator hs-var hs-var hs-var">(&gt;&gt;)</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM a -&gt; UniqSM b -&gt; UniqSM b
forall a b. UniqSM a -&gt; UniqSM b -&gt; UniqSM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">(*&gt;)</span></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682337169"><span id="local-6989586621682337173"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621682337176"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; UniqSM a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; UniqSM a
forall a. a -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#returnUs"><span class="hs-identifier hs-var">returnUs</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337178"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult (a -&gt; b)
</span><a href="#local-6989586621682337178"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682337179"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. UniqSM (a -&gt; b) -&gt; UniqSM a -&gt; UniqSM b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337180"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337180"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult b) -&gt; UniqSM b
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="annot"><span class="annottext">((UniqSupply -&gt; UniqResult b) -&gt; UniqSM b)
-&gt; (UniqSupply -&gt; UniqResult b) -&gt; UniqSM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682337181"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337181"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult (a -&gt; b)
</span><a href="#local-6989586621682337178"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337181"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-343"></span><span>                            </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span id="local-6989586621682337182"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682337182"><span class="hs-identifier hs-var">ff</span></a></span></span><span> </span><span id="local-6989586621682337183"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337183"><span class="hs-identifier hs-var">us1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337180"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337183"><span class="hs-identifier hs-var">us1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>                              </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span id="local-6989586621682337184"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337184"><span class="hs-identifier hs-var">xx</span></a></span></span><span> </span><span id="local-6989586621682337185"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337185"><span class="hs-identifier hs-var">us2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; UniqSupply -&gt; UniqResult b
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621682337182"><span class="hs-identifier hs-var">ff</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337184"><span class="hs-identifier hs-var">xx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337185"><span class="hs-identifier hs-var">us2</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621682337186"><span class="annot"><span class="annottext">*&gt; :: forall a b. UniqSM a -&gt; UniqSM b -&gt; UniqSM b
</span><span class="hs-operator hs-var hs-var hs-var">(*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM a -&gt; UniqSM b -&gt; UniqSM b
forall a b. UniqSM a -&gt; UniqSM b -&gt; UniqSM b
</span><a href="GHC.Types.Unique.Supply.html#thenUs_"><span class="hs-identifier hs-var">thenUs_</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-comment">-- TODO: try to get rid of this instance</span><span>
</span><span id="line-348"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621682337195"><span class="annot"><span class="annottext">fail :: forall a. String -&gt; UniqSM a
</span><span class="hs-identifier hs-var hs-var hs-var">fail</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; UniqSM a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><span class="hs-comment">-- | Run the 'UniqSM' action, returning the final 'UniqSupply'</span></span><span>
</span><span id="line-352"></span><span id="local-6989586621682337020"><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUs"><span class="hs-identifier hs-type">initUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337020"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682337020"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-353"></span><span id="initUs"><span class="annot"><span class="annottext">initUs :: forall a. UniqSupply -&gt; UniqSM a -&gt; (a, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#initUs"><span class="hs-identifier hs-var hs-var">initUs</span></a></span></span><span> </span><span id="local-6989586621682337197"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337197"><span class="hs-identifier hs-var">init_us</span></a></span></span><span> </span><span id="local-6989586621682337198"><span class="annot"><span class="annottext">UniqSM a
</span><a href="#local-6989586621682337198"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSM a -&gt; UniqSupply -&gt; UniqResult a
forall result. UniqSM result -&gt; UniqSupply -&gt; UniqResult result
</span><a href="GHC.Types.Unique.Supply.html#unUSM"><span class="hs-identifier hs-var">unUSM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSM a
</span><a href="#local-6989586621682337198"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337197"><span class="hs-identifier hs-var">init_us</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span id="local-6989586621682337199"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337199"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621682337200"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337200"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337199"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337200"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span class="annot"><span class="hs-comment">-- | Run the 'UniqSM' action, discarding the final 'UniqSupply'</span></span><span>
</span><span id="line-356"></span><span id="local-6989586621682337022"><span class="annot"><a href="GHC.Types.Unique.Supply.html#initUs_"><span class="hs-identifier hs-type">initUs_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337022"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682337022"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-357"></span><span id="initUs_"><span class="annot"><span class="annottext">initUs_ :: forall a. UniqSupply -&gt; UniqSM a -&gt; a
</span><a href="GHC.Types.Unique.Supply.html#initUs_"><span class="hs-identifier hs-var hs-var">initUs_</span></a></span></span><span> </span><span id="local-6989586621682337201"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337201"><span class="hs-identifier hs-var">init_us</span></a></span></span><span> </span><span id="local-6989586621682337202"><span class="annot"><span class="annottext">UniqSM a
</span><a href="#local-6989586621682337202"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSM a -&gt; UniqSupply -&gt; UniqResult a
forall result. UniqSM result -&gt; UniqSupply -&gt; UniqResult result
</span><a href="GHC.Types.Unique.Supply.html#unUSM"><span class="hs-identifier hs-var">unUSM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSM a
</span><a href="#local-6989586621682337202"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337201"><span class="hs-identifier hs-var">init_us</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span id="local-6989586621682337203"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337203"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337203"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#thenUs"><span class="hs-pragma hs-type">thenUs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-360"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#returnUs"><span class="hs-pragma hs-type">returnUs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-361"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-pragma hs-type">splitUniqSupply</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-comment">-- @thenUs@ is where we split the @UniqSupply@.</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span id="local-6989586621682337024"><span class="annot"><a href="GHC.Types.Unique.Supply.html#liftUSM"><span class="hs-identifier hs-type">liftUSM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337024"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682337024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-366"></span><span id="liftUSM"><span class="annot"><span class="annottext">liftUSM :: forall a. UniqSM a -&gt; UniqSupply -&gt; (a, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#liftUSM"><span class="hs-identifier hs-var hs-var">liftUSM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337205"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337205"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682337206"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337206"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337205"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337206"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span id="local-6989586621682337207"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337207"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682337208"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337208"><span class="hs-identifier hs-var">us1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337207"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337208"><span class="hs-identifier hs-var">us1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-369"></span><span>    </span><span id="local-6989586621682337214"><span class="annot"><span class="annottext">mfix :: forall a. (a -&gt; UniqSM a) -&gt; UniqSM a
</span><span class="hs-identifier hs-var hs-var hs-var">mfix</span></span></span><span> </span><span id="local-6989586621682337215"><span class="annot"><span class="annottext">a -&gt; UniqSM a
</span><a href="#local-6989586621682337215"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337216"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337216"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682337217"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337217"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682337218"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337218"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM a -&gt; UniqSupply -&gt; (a, UniqSupply)
forall a. UniqSM a -&gt; UniqSupply -&gt; (a, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#liftUSM"><span class="hs-identifier hs-var">liftUSM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; UniqSM a
</span><a href="#local-6989586621682337215"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337217"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337216"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">a -&gt; UniqSupply -&gt; UniqResult a
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337217"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337218"><span class="hs-identifier hs-var">us1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span id="local-6989586621682337219"><span id="local-6989586621682337220"><span class="annot"><a href="GHC.Types.Unique.Supply.html#thenUs"><span class="hs-identifier hs-type">thenUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337219"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682337219"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337220"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337220"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-372"></span><span id="thenUs"><span class="annot"><span class="annottext">thenUs :: forall a b. UniqSM a -&gt; (a -&gt; UniqSM b) -&gt; UniqSM b
</span><a href="GHC.Types.Unique.Supply.html#thenUs"><span class="hs-identifier hs-var hs-var">thenUs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337221"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337221"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682337222"><span class="annot"><span class="annottext">a -&gt; UniqSM b
</span><a href="#local-6989586621682337222"><span class="hs-identifier hs-var">cont</span></a></span></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult b) -&gt; UniqSM b
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337223"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337223"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337221"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337223"><span class="hs-identifier hs-var">us0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>                   </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span id="local-6989586621682337224"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337224"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621682337225"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337225"><span class="hs-identifier hs-var">us1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqSM b -&gt; UniqSupply -&gt; UniqResult b
forall result. UniqSM result -&gt; UniqSupply -&gt; UniqResult result
</span><a href="GHC.Types.Unique.Supply.html#unUSM"><span class="hs-identifier hs-var">unUSM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; UniqSM b
</span><a href="#local-6989586621682337222"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337224"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337225"><span class="hs-identifier hs-var">us1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span id="local-6989586621682337226"><span id="local-6989586621682337227"><span class="annot"><a href="GHC.Types.Unique.Supply.html#thenUs_"><span class="hs-identifier hs-type">thenUs_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337226"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337227"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337227"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-377"></span><span id="thenUs_"><span class="annot"><span class="annottext">thenUs_ :: forall a b. UniqSM a -&gt; UniqSM b -&gt; UniqSM b
</span><a href="GHC.Types.Unique.Supply.html#thenUs_"><span class="hs-identifier hs-var hs-var">thenUs_</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337228"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337228"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Supply.html#USM"><span class="hs-identifier hs-type">USM</span></a></span><span> </span><span id="local-6989586621682337229"><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult b
</span><a href="#local-6989586621682337229"><span class="hs-identifier hs-var">cont</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult b) -&gt; UniqSM b
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337230"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337230"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult a
</span><a href="#local-6989586621682337228"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337230"><span class="hs-identifier hs-var">us0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-type">UniqResult</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682337231"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337231"><span class="hs-identifier hs-var">us1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqResult b
</span><a href="#local-6989586621682337229"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337231"><span class="hs-identifier hs-var">us1</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span id="local-6989586621682337232"><span class="annot"><a href="GHC.Types.Unique.Supply.html#returnUs"><span class="hs-identifier hs-type">returnUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682337232"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682337232"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-381"></span><span id="returnUs"><span class="annot"><span class="annottext">returnUs :: forall a. a -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#returnUs"><span class="hs-identifier hs-var hs-var">returnUs</span></a></span></span><span> </span><span id="local-6989586621682337233"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337233"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337234"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337234"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; UniqSupply -&gt; UniqResult a
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682337233"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337234"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUs"><span class="hs-identifier hs-type">getUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span>
</span><span id="line-384"></span><span id="getUs"><span class="annot"><span class="annottext">getUs :: UniqSM UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUs"><span class="hs-identifier hs-var hs-var">getUs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult UniqSupply) -&gt; UniqSM UniqSupply
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337236"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337236"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; (UniqSupply, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier hs-var">splitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337236"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682337237"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337237"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682337238"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337238"><span class="hs-identifier hs-var">us2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; UniqSupply -&gt; UniqResult UniqSupply
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337237"><span class="hs-identifier hs-var">us1</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337238"><span class="hs-identifier hs-var">us2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="annot"><span class="hs-comment">-- | A monad for generating unique identifiers</span></span><span>
</span><span id="line-387"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621682337034"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadUnique"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-var">MonadUnique</span></a></span></span><span> </span><span id="local-6989586621682337034"><span class="annot"><a href="#local-6989586621682337034"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-comment">-- | Get a new UniqueSupply</span><span>
</span><span id="line-389"></span><span>    </span><span id="getUniqueSupplyM"><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-type">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682337034"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-comment">-- | Get a new unique identifier</span><span>
</span><span id="line-391"></span><span>    </span><span id="getUniqueM"><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniqueM"><span class="hs-identifier hs-type">getUniqueM</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682337034"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-comment">-- | Get an infinite list of new unique identifiers</span><span>
</span><span id="line-393"></span><span>    </span><span id="getUniquesM"><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniquesM"><span class="hs-identifier hs-type">getUniquesM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682337034"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-comment">-- This default definition of getUniqueM, while correct, is not as</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-comment">-- efficient as it could be since it needlessly generates and throws away</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-comment">-- an extra Unique. For your instances consider providing an explicit</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">-- definition for 'getUniqueM' which uses 'takeUniqFromSupply' directly.</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621682337244"><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniqueM"><span class="hs-identifier hs-var hs-var">getUniqueM</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; Unique) -&gt; m UniqSupply -&gt; m Unique
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; Unique
</span><a href="GHC.Types.Unique.Supply.html#uniqFromSupply"><span class="hs-identifier hs-var">uniqFromSupply</span></a></span><span>  </span><span class="annot"><span class="annottext">m UniqSupply
forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621682337249"><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniquesM"><span class="hs-identifier hs-var hs-var">getUniquesM</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; [Unique]) -&gt; m UniqSupply -&gt; m [Unique]
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">m UniqSupply
forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621682337260"><span class="annot"><span class="annottext">getUniqueSupplyM :: UniqSM UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var hs-var hs-var">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUs"><span class="hs-identifier hs-var">getUs</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621682337261"><span class="annot"><span class="annottext">getUniqueM :: UniqSM Unique
</span><a href="GHC.Types.Unique.Supply.html#getUniqueM"><span class="hs-identifier hs-var hs-var hs-var">getUniqueM</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM Unique
</span><a href="GHC.Types.Unique.Supply.html#getUniqueUs"><span class="hs-identifier hs-var">getUniqueUs</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621682337263"><span class="annot"><span class="annottext">getUniquesM :: UniqSM [Unique]
</span><a href="GHC.Types.Unique.Supply.html#getUniquesM"><span class="hs-identifier hs-var hs-var hs-var">getUniquesM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSM [Unique]
</span><a href="GHC.Types.Unique.Supply.html#getUniquesUs"><span class="hs-identifier hs-var">getUniquesUs</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniqueUs"><span class="hs-identifier hs-type">getUniqueUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span>
</span><span id="line-408"></span><span id="getUniqueUs"><span class="annot"><span class="annottext">getUniqueUs :: UniqSM Unique
</span><a href="GHC.Types.Unique.Supply.html#getUniqueUs"><span class="hs-identifier hs-var hs-var">getUniqueUs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult Unique) -&gt; UniqSM Unique
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337265"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337265"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; (Unique, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#takeUniqFromSupply"><span class="hs-identifier hs-var">takeUniqFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337265"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-409"></span><span>                           </span><span class="hs-special">(</span><span id="local-6989586621682337266"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682337266"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682337267"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337267"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; UniqSupply -&gt; UniqResult Unique
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682337266"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337267"><span class="hs-identifier hs-var">us1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.Types.Unique.Supply.html#getUniquesUs"><span class="hs-identifier hs-type">getUniquesUs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSM"><span class="hs-identifier hs-type">UniqSM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span id="getUniquesUs"><span class="annot"><span class="annottext">getUniquesUs :: UniqSM [Unique]
</span><a href="GHC.Types.Unique.Supply.html#getUniquesUs"><span class="hs-identifier hs-var hs-var">getUniquesUs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqSupply -&gt; UniqResult [Unique]) -&gt; UniqSM [Unique]
forall a. (UniqSupply -&gt; UniqResult a) -&gt; UniqSM a
</span><a href="GHC.Types.Unique.Supply.html#mkUniqSM"><span class="hs-identifier hs-var">mkUniqSM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682337268"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337268"><span class="hs-identifier hs-var">us0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; (UniqSupply, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier hs-var">splitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337268"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-413"></span><span>                            </span><span class="hs-special">(</span><span id="local-6989586621682337269"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337269"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682337270"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337270"><span class="hs-identifier hs-var">us2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Unique] -&gt; UniqSupply -&gt; UniqResult [Unique]
forall a b. a -&gt; b -&gt; (# a, b #)
</span><a href="GHC.Types.Unique.Supply.html#UniqResult"><span class="hs-identifier hs-var">UniqResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337269"><span class="hs-identifier hs-var">us1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682337270"><span class="hs-identifier hs-var">us2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span></pre></body></html>